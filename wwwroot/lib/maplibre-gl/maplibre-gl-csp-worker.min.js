var maplibregl=function(){"use strict";function c(e,a,o,l){return new(o=o||Promise)(function(r,t){function n(e){try{s(l.next(e))}catch(e){t(e)}}function i(e){try{s(l.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(n,i)}s((l=l.apply(e,a||[])).next())})}function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=B;function B(e,t){this.x=e,this.y=t}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),r=e*this.x+t*this.y;return this.x=t*this.x-e*this.y,this.y=r,this},_rotateAround:function(e,t){var r=Math.cos(e),e=Math.sin(e),n=t.y+e*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-e*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(e){return!(e instanceof B)&&Array.isArray(e)?new B(e[0],e[1]):e};var L=P(C),e=V;function V(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}let T,E;function F(e,t,r){return Math.min(r,Math.max(t,e))}function D(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function O(e,t){const r={};for(const n in e)r[n]=t.call(this,e[n],n,e);return r}function $(e){return Array.isArray(e)?e.map($):"object"==typeof e&&e?O(e,$):e}V.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=i/s}for(var a=0,o=1,r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)i<e?a=r:o=r,r=.5*(o-a)+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},new(P(e))(.25,.1,.25,1);const R={};function le(e){R[e]||("undefined"!=typeof console&&console.warn(e),R[e]=!0)}function j(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function q(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}function U(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}let N,Z;class G{constructor(e,t,r){const n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const s=new Int32Array(this.arrayBuffer);e=s[0],this.d=(t=s[1])+2*(r=s[2]);for(let e=0;e<this.d*this.d;e++){const t=s[3+e],r=s[3+e+1];n.push(t===r?null:s.subarray(t,r))}var i=s[3+n.length+1];this.keys=s.subarray(s[3+n.length],i),this.bboxes=s.subarray(i),this.insert=this._insertReadonly}else{this.d=t+2*r;for(let e=0;e<this.d*this.d;e++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;const s=r/t*e;this.min=-s,this.max=e+s}insert(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,r,n,i,s){this.cells[i].push(s)}query(e,t,r,n,i){const s=this.min,a=this.max;if(e<=s&&t<=s&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);{const s=[];return this._forEachCell(e,t,r,n,this._queryCell,s,{},i),s}}_queryCell(t,r,n,i,s,a,o,l){const u=this.cells[s];if(null!==u){const s=this.keys,h=this.bboxes;for(let e=0;e<u.length;e++){var c=u[e];if(void 0===o[c]){const u=4*c;(l?l(h[0+u],h[1+u],h[2+u],h[3+u]):t<=h[2+u]&&r<=h[3+u]&&n>=h[0+u]&&i>=h[1+u])?(o[c]=!0,a.push(s[c])):o[c]=!1}}}}_forEachCell(r,n,i,s,a,o,l,u){const e=this._convertToCellCoord(r),c=this._convertToCellCoord(n),h=this._convertToCellCoord(i),p=this._convertToCellCoord(s);for(let t=e;t<=h;t++)for(let e=c;e<=p;e++){const c=this.d*e+t;if((!u||u(this._convertFromCellCoord(t),this._convertFromCellCoord(e),this._convertFromCellCoord(t+1),this._convertFromCellCoord(e+1)))&&a.call(this,r,n,i,s,c,o,l,u))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;var t=this.cells,e=3+this.cells.length+1+1;let r=0;for(let e=0;e<this.cells.length;e++)r+=this.cells[e].length;const n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;let i=e;for(let e=0;e<t.length;e++){const r=t[e];n[3+e]=i,n.set(r,i),i+=r.length}return n[3+t.length]=i,n.set(this.keys,i),i+=this.keys.length,n[3+t.length+1]=i,n.set(this.bboxes,i),i+=this.bboxes.length,n.buffer}static serialize(e,t){e=e.toArrayBuffer();return t&&t.push(e),{buffer:e}}static deserialize(e){return new G(e.buffer)}}var s={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const X=["type","source","source-layer","minzoom","maxzoom","filter","layout"];class d{constructor(e,t,r,n){this.message=(e?e+": ":"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function H(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}class K extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class W{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new W(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Q={kind:"null"},h={kind:"number"},l={kind:"string"},u={kind:"boolean"},ee={kind:"color"},te={kind:"object"},p={kind:"value"},re={kind:"collator"},ne={kind:"formatted"},ie={kind:"padding"},se={kind:"resolvedImage"},ae={kind:"variableAnchorOffsetCollection"};function f(e,t){return{kind:"array",itemType:e,N:t}}function y(e){var t;return"array"===e.kind?(t=y(e.itemType),"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`):e.kind}const oe=[Q,h,l,u,ee,ne,te,f(p),ie,se,ae];function pe(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!pe(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of oe)if(!pe(e,t))return null}return`Expected ${y(e)} but found ${y(t)} instead.`}function de(t,e){return e.some(e=>e.kind===t.kind)}function fe(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function ye(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const me=.96422,ge=.82521,xe=4/29,ve=6/29,be=3*ve*ve,we=ve*ve*ve,_e=Math.PI/180,Se=180/Math.PI;function ke(e){return(e%=360)<0&&(e+=360),e}function Ae([e,t,r,n]){let i,s;var a=Me(.2225045*(e=Ie(e))+.7168786*(t=Ie(t))+.0606169*(r=Ie(r))),e=(e===t&&t===r?i=s=a:(i=Me((.4360747*e+.3850649*t+.1430804*r)/me),s=Me((.0139322*e+.0971045*t+.7141733*r)/ge)),116*a-16);return[e<0?0:e,500*(i-a),200*(a-s),n]}function Ie(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Me(e){return e>we?Math.pow(e,1/3):e/be+xe}function ze([e,t,r,n]){let i=(e+16)/116,s=isNaN(t)?i:i+t/500,a=isNaN(r)?i:i-r/200;return i=+Ce(i),s=me*Ce(s),a=ge*Ce(a),[Pe(3.1338561*s-1.6168667*i-.4906146*a),Pe(-.9787684*s+1.9161415*i+.033454*a),Pe(.0719453*s-.2289914*i+1.4052427*a),n]}function Pe(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:1<e?1:e}function Ce(e){return e>ve?e*e*e:be*(e-xe)}function Be(e){return parseInt(e.padEnd(2,e),16)/255}function Ve(e,t){return Te(t?e/100:e,0,1)}function Te(e,t,r){return Math.min(Math.max(t,e),r)}function Ee(e){return!e.some(Number.isNaN)}const Fe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class w{constructor(e,t,r,n=1,i=!0){this.r=e,this.g=t,this.b=r,this.a=n,i||(this.r*=n,this.g*=n,this.b*=n,n||this.overwriteGetter("rgb",[e,t,r,n]))}static parse(e){if(e instanceof w)return e;if("string"==typeof e)return e=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=Fe[e];if(t){const[e,n,l]=t;return[e/255,n/255,l/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;var r=1;return[Be(e.slice(1,r+=t)),Be(e.slice(r,r+=t)),Be(e.slice(r,r+=t)),Be(e.slice(r,r+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,n,u,c,h,p,d,f,y,m,g,x]=t,v=[c||" ",d||" ",m].join("");if("  "===v||"  /"===v||",,"===v||",,,"===v){const e=[u,p,y].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[Te(+n/t,0,1),Te(+h/t,0,1),Te(+f/t,0,1),g?Ve(+g,x):1];if(Ee(e))return e}}return}}const n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,t,b,w,_,S,k,A,I]=n,M=[b||" ",_||" ",k].join("");if("  "===M||"  /"===M||",,"===M||",,,"===M){const e=[+t,Te(+w,0,100),Te(+S,0,100),A?Ve(+A,I):1];if(Ee(e))return[s,a,o,r]=[e][0],s=ke(s),a/=100,o/=100,[i(0),i(8),i(4),r]}}function i(e){var e=(e+s/30)%12,t=a*Math.min(o,1-o);return o-t*Math.max(-1,Math.min(e-3,9-e,1))}var s,a,o}(e),e?new w(...e,!1):void 0}get rgb(){var{r:e,g:t,b:r,a:n}=this,i=n||1/0;return this.overwriteGetter("rgb",[e/i,t/i,r/i,n])}get hcl(){return this.overwriteGetter("hcl",function(e){var[e,t,r,n]=Ae(e),i=Math.sqrt(t*t+r*r);return[Math.round(1e4*i)?ke(Math.atan2(r,t)*Se):NaN,i,e,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ae(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,n]=this.rgb;return`rgba(${[e,t,r].map(e=>Math.round(255*e)).join(",")},${n})`}}w.black=new w(0,0,0,1),w.white=new w(1,1,1,1),w.transparent=new w(0,0,0,0),w.red=new w(1,0,0,1);class De{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class Le{constructor(e,t,r,n,i){this.text=e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class v{constructor(e){this.sections=e}static fromString(e){return new v([new Le(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof v?e:v.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}}class m{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof m)return e;if("number"==typeof e)return new m([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||4<e.length)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new m(e)}}toString(){return JSON.stringify(this.values)}}const Oe=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $e{constructor(e){this.values=e.slice()}static parse(t){if(t instanceof $e)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){var r=t[e],n=t[e+1];if("string"!=typeof r||!Oe.has(r))return;if(!Array.isArray(n)||2!==n.length||"number"!=typeof n[0]||"number"!=typeof n[1])return}return new $e(t)}}toString(){return JSON.stringify(this.values)}}class Re{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Re({name:e,available:!1}):null}}function je(e,t,r,n){return"number"==typeof e&&0<=e&&e<=255&&"number"==typeof t&&0<=t&&t<=255&&"number"==typeof r&&0<=r&&r<=255?void 0===n||"number"==typeof n&&0<=n&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qe(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof w||e instanceof De||e instanceof v||e instanceof m||e instanceof $e||e instanceof Re)return 1;if(Array.isArray(e)){for(const t of e)if(!qe(t))return;return 1}if("object"==typeof e){for(const r in e)if(!qe(e[r]))return;return 1}}function g(t){if(null===t)return Q;if("string"==typeof t)return l;if("boolean"==typeof t)return u;if("number"==typeof t)return h;if(t instanceof w)return ee;if(t instanceof De)return re;if(t instanceof v)return ne;if(t instanceof m)return ie;if(t instanceof $e)return ae;if(t instanceof Re)return se;if(Array.isArray(t)){var r=t.length;let e;for(const n of t){const t=g(n);if(e){if(e===t)continue;e=p;break}e=t}return f(e||p,r)}return te}function Ue(e){var t=typeof e;return null===e?"":"string"==t||"number"==t||"boolean"==t?String(e):e instanceof w||e instanceof v||e instanceof m||e instanceof $e||e instanceof Re?e.toString():JSON.stringify(e)}class Ne{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!qe(e[1]))return t.error("invalid value");e=e[1];let r=g(e);t=t.expectedType;return"array"!==r.kind||0!==r.N||!t||"array"!==t.kind||"number"==typeof t.N&&0!==t.N||(r=t),new Ne(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class x{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ze={string:l,number:h,boolean:u,object:te};class Ge{constructor(e,t){this.type=e,this.args=t}static parse(r,n){if(r.length<2)return n.error("Expected at least one argument.");let i,s=1;var e=r[0];if("array"===e){let e,t;if(2<r.length){const i=r[1];if("string"!=typeof i||!(i in Ze)||"object"===i)return n.error('The item type argument of "array" must be one of string, number, boolean',1);e=Ze[i],s++}else e=p;if(3<r.length){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return n.error('The length argument to "array" must be a positive integer literal',2);t=r[2],s++}i=f(e,t)}else{if(!Ze[e])throw new Error("Types doesn't contain name = "+e);i=Ze[e]}const t=[];for(;s<r.length;s++){const i=n.parse(r[s],s,p);if(!i)return null;t.push(i)}return new Ge(i,t)}evaluate(t){for(let e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!pe(this.type,g(r)))return r;if(e===this.args.length-1)throw new x(`Expected value to be of type ${y(this.type)}, but found ${y(g(r))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Xe={"to-boolean":u,"to-color":ee,"to-number":h,"to-string":l};class He{constructor(e,t){this.type=e,this.args=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");var e=t[0];if(!Xe[e])throw new Error(`Can't parse ${e} as it is not part of the known types`);if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return r.error("Expected one argument.");const n=Xe[e],i=[];for(let e=1;e<t.length;e++){const n=r.parse(t[e],e,p);if(!n)return null;i.push(n)}return new He(n,i)}evaluate(r){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(r));case"color":{let e,t;for(const a of this.args){if(e=a.evaluate(r),t=null,e instanceof w)return e;if("string"==typeof e){var n=r.parseColor(e);if(n)return n}else if(Array.isArray(e)&&!(t=e.length<3||4<e.length?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:je(e[0],e[1],e[2],e[3])))return new w(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new x(t||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const o of this.args){e=o.evaluate(r);var t=m.parse(e);if(t)return t}throw new x(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const l of this.args){e=l.evaluate(r);var i=$e.parse(e);if(i)return i}throw new x(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const u of this.args){if(null===(e=u.evaluate(r)))return 0;var s=Number(e);if(!isNaN(s))return s}throw new x(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return v.fromString(Ue(this.args[0].evaluate(r)));case"resolvedImage":return Re.fromString(Ue(this.args[0].evaluate(r)));default:return Ue(this.args[0].evaluate(r))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ye=["Unknown","Point","LineString","Polygon"];class Je{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ye[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t=t||(this._parseColorCache[e]=w.parse(e))}}class Ke{constructor(e,t,r=[],n,i=new W,s=[]){this.registry=e,this.path=r,this.key=r.map(e=>`[${e}]`).join(""),this.scope=i,this.errors=s,this.expectedType=n,this._isConstant=t}parse(e,t,r,n,i={}){return(t?this.concat(t,r,n):this)._parse(e,i)}_parse(t,r){function n(e,t,r){return"assert"===r?new Ge(t,[e]):"coerce"===r?new He(t,[e]):e}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var e=t[0];if("string"!=typeof e)return this.error(`Expression name must be a string, but found ${typeof e} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[e];if(i){let e=i.parse(t,this);if(!e)return null;if(this.expectedType){const t=this.expectedType,s=e.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==s.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==s.kind&&"string"!==s.kind)if("padding"!==t.kind||"value"!==s.kind&&"number"!==s.kind&&"array"!==s.kind)if("variableAnchorOffsetCollection"!==t.kind||"value"!==s.kind&&"array"!==s.kind){if(this.checkSubtype(t,s))return null}else e=n(e,t,r.typeAnnotation||"coerce");else e=n(e,t,r.typeAnnotation||"coerce");else e=n(e,t,r.typeAnnotation||"coerce");else e=n(e,t,r.typeAnnotation||"assert")}if(!(e instanceof Ne)&&"resolvedImage"!==e.type.kind&&this._isConstant(e)){const t=new Je;try{e=new Ne(e.type,e.evaluate(t))}catch(t){return this.error(t.message),null}}return e}return this.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(e,t,r){e="number"==typeof e?this.path.concat(e):this.path,r=r?this.scope.concat(r):this.scope;return new Ke(this.registry,this._isConstant,e,t||null,r,this.errors)}error(e,...t){t=""+this.key+t.map(e=>`[${e}]`).join("");this.errors.push(new K(t,e))}checkSubtype(e,t){e=pe(e,t);return e&&this.error(e),e}}class We{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let e=1;e<t.length-1;e+=2){var i=t[e];if("string"!=typeof i)return r.error(`Expected string, but found ${typeof i} instead.`,e);if(/[^a-zA-Z0-9_]/.test(i))return r.error("Variable names must contain only alphanumeric characters or '_'.",e);var s=r.parse(t[e+1],e+1);if(!s)return null;n.push([i,s])}var e=r.parse(t[t.length-1],t.length-1,r.expectedType,n);return e?new We(n,e):null}outputDefined(){return this.result.outputDefined()}}class Qe{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");e=e[1];return t.scope.has(e)?new Qe(e,t.scope.get(e)):t.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}function et(e,t){var r=e.length-1;let n,i,s=0,a=r,o;for(;s<=a;)if(n=e[o=Math.floor((s+a)/2)],i=e[o+1],n<=t){if(o===r||t<i)return o;s=o+1}else{if(!(t<n))throw new x("Input is not a number.");a=o-1}return 0}class tt{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");var e=r.parse(t[1],1,h);if(!e)return null;const n=[];let i=null;r.expectedType&&"value"!==r.expectedType.kind&&(i=r.expectedType);for(let e=1;e<t.length;e+=2){var s=1===e?-1/0:t[e],a=t[e+1],o=e,l=e+1;if("number"!=typeof s)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(n.length&&n[n.length-1][0]>=s)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);o=r.parse(a,l,i);if(!o)return null;i=i||o.type,n.push([s,o])}return new tt(i,e,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);var i=t.length;return(n>=t[i-1]?r[i-1]:r[et(t,n)]).evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}e=rt;function rt(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}rt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=i/s}for(var a=0,o=1,r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)i<e?a=r:o=r,r=.5*(o-a)+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var nt=(e=e)&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;function it(e,t,r){return e+r*(t-e)}function st(e,r,n){return e.map((e,t)=>it(e,r[t],n))}const at={number:it,color:function(r,n,i,s="rgb"){switch(s){case"rgb":{const[s,e,t,c]=st(r.rgb,n.rgb,i);return new w(s,e,t,c,!1)}case"hcl":{const[s,h,p,d]=r.hcl,[f,y,m,g]=n.hcl;let t,e;if(isNaN(s)||isNaN(f))isNaN(s)?isNaN(f)?t=NaN:(t=f,1!==p&&0!==p||(e=y)):(t=s,1!==m&&0!==m||(e=h));else{let e=f-s;f>s&&180<e?e-=360:f<s&&180<s-f&&(e+=360),t=s+i*e}[o,l,a,u]=[[t,null!=e?e:it(h,y,i),it(p,m,i),it(d,g,i)]][0],o=isNaN(o)?0:o*_e;var[a,o,l,u]=ze([a,Math.cos(o)*l,Math.sin(o)*l,u]);return new w(a,o,l,u,!1)}case"lab":{const[s,x,v,b]=ze(st(r.lab,n.lab,i));return new w(s,x,v,b,!1)}}},array:st,padding:function(e,t,r){return new m(st(e.values,t.values,r))},variableAnchorOffsetCollection:function(e,t,r){var n=e.values,i=t.values;if(n.length!==i.length)throw new x(`Cannot interpolate values of different length. from: ${e.toString()}, to: `+t.toString());const s=[];for(let e=0;e<n.length;e+=2){if(n[e]!==i[e])throw new x(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${n[e]}, to[${e}]: `+i[e]);s.push(n[e]);const[t,a]=n[e+1],[o,l]=i[e+1];s.push([it(t,o,r),it(a,l,r)])}return new $e(s)}};class ot{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;return"exponential"===e.name?i=lt(t,e.base,r,n):"linear"===e.name?i=lt(t,1,r,n):"cubic-bezier"===e.name&&(e=e.controlPoints,i=new nt(e[0],e[1],e[2],e[3]).solve(lt(t,1,r,n))),i}static parse(e,t){let[r,n,i,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error("Unknown interpolation type "+String(n[0]),1,0);{const e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||1<e))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(i=t.parse(i,2,h)))return null;const a=[];let o=null;"interpolate-hcl"===r||"interpolate-lab"===r?o=ee:t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);for(let e=0;e<s.length;e+=2){const r=s[e],n=s[e+1],i=e+3,u=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);var l=t.parse(n,u,o);if(!l)return null;o=o||l.type,a.push([r,l])}return ye(o,h)||ye(o,ee)||ye(o,ie)||ye(o,ae)||ye(o,f(h))?new ot(o,r,n,i,a):t.error(`Type ${y(o)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);var i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);var i=et(t,n),s=ot.interpolationFactor(this.interpolation,n,t[i],t[i+1]),a=r[i].evaluate(e),o=r[i+1].evaluate(e);switch(this.operator){case"interpolate":return at[this.type.kind](a,o,s);case"interpolate-hcl":return at.color(a,o,s,"hcl");case"interpolate-lab":return at.color(a,o,s,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function lt(e,t,r,n){n-=r,e-=r;return 0==n?0:1===t?e/n:(Math.pow(t,e)-1)/(Math.pow(t,n)-1)}class ut{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType,i=(n&&"value"!==n.kind&&(r=n),[]);for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}if(!r)throw new Error("No output type");e=n&&i.some(e=>pe(n,e.type));return new ut(e?p:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args)if(n++,r=i.evaluate(e),r&&r instanceof Re&&!r.available&&(t=t||r.name,r=null,n===this.args.length&&(r=t)),null!==r)break;return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function ct(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ht(e,t,r,n){return 0===n.compare(t,r)}function pt(n,i,s){const a="=="!==n&&"!="!==n;return class o{constructor(e,t,r){this.type=u,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var r=e[0];let n=t.parse(e[1],1,p);if(!n)return null;if(!ct(r,n.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${y(n.type)}'.`);let i=t.parse(e[2],2,p);if(!i)return null;if(!ct(r,i.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${y(i.type)}'.`);if(n.type.kind!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return t.error(`Cannot compare types '${y(n.type)}' and '${y(i.type)}'.`);a&&("value"===n.type.kind&&"value"!==i.type.kind?n=new Ge(i.type,[n]):"value"!==n.type.kind&&"value"===i.type.kind&&(i=new Ge(n.type,[i])));let s=null;if(4===e.length){if("string"!==n.type.kind&&"string"!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,re)))return null}return new o(n,i,s)}evaluate(e){var t=this.lhs.evaluate(e),r=this.rhs.evaluate(e);if(a&&this.hasUntypedArgument){const i=g(t),s=g(r);if(i.kind!==s.kind||"string"!==i.kind&&"number"!==i.kind)throw new x(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${i.kind}, ${s.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const n=g(t),s=g(r);if("string"!==n.kind||"string"!==s.kind)return i(e,t,r)}return this.collator?s(e,t,r,this.collator.evaluate(e)):i(e,t,r)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}var e=pt("==",function(e,t,r){return t===r},ht),t=pt("!=",function(e,t,r){return t!==r},function(e,t,r,n){return!ht(0,t,r,n)}),dt=pt("<",function(e,t,r){return t<r},function(e,t,r,n){return n.compare(t,r)<0}),ft=pt(">",function(e,t,r){return r<t},function(e,t,r,n){return 0<n.compare(t,r)}),yt=pt("<=",function(e,t,r){return t<=r},function(e,t,r,n){return n.compare(t,r)<=0}),mt=pt(">=",function(e,t,r){return r<=t},function(e,t,r,n){return 0<=n.compare(t,r)});class gt{constructor(e,t,r){this.type=re,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");e=e[1];if("object"!=typeof e||Array.isArray(e))return t.error("Collator options argument must be an object.");var r=t.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,u);if(!r)return null;var n=t.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,u);if(!n)return null;let i=null;return e.locale&&!(i=t.parse(e.locale,1,l))?null:new gt(r,n,i)}evaluate(e){return new De(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class xt{constructor(e){this.type=ne,this.sections=e}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");var e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return n.error("First argument must be an image or text section.");const i=[];let s=!1;for(let e=1;e<=t.length-1;++e){var a=t[e];if(s&&"object"==typeof a&&!Array.isArray(a)){s=!1;let e=null;if(a["font-scale"]&&!(e=n.parse(a["font-scale"],1,h)))return null;let t=null;if(a["text-font"]&&!(t=n.parse(a["text-font"],1,f(l))))return null;let r=null;if(a["text-color"]&&!(r=n.parse(a["text-color"],1,ee)))return null;const o=i[i.length-1];o.scale=e,o.font=t,o.textColor=r}else{a=n.parse(t[e],1,p);if(!a)return null;var r=a.type.kind;if("string"!==r&&"value"!==r&&"null"!==r&&"resolvedImage"!==r)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:a,scale:null,font:null,textColor:null})}}return new xt(i)}evaluate(r){return new v(this.sections.map(e=>{var t=e.content.evaluate(r);return g(t)===se?new Le("",t,null,null,null):new Le(Ue(t),null,e.scale?e.scale.evaluate(r):null,e.font?e.font.evaluate(r).join(","):null,e.textColor?e.textColor.evaluate(r):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}const vt=8192;function bt(e,t){var r=Math.pow(2,t.z);return[360*((e[0]/vt+t.x)/r)-180,(e=(e[1]/vt+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90)]}function wt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function _t(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function St(e,t,r,n){return 0!=(i=[n[0]-r[0],n[1]-r[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*s[0]&&It(e,t,r,n)&&It(r,n,e,t);var i,s}function kt(t,e,r=!1){let n=!1;for(const u of e)for(let e=0;e<u.length-1;e++){if(i=t,s=u[e],o=u[e+1],a=l=void 0,l=i[0]-s[0],s=i[1]-s[1],a=i[0]-o[0],i=i[1]-o[1],l*i-a*s==0&&l*a<=0&&s*i<=0)return r;(o=u[e])[1]>t[1]!=(l=u[e+1])[1]>t[1]&&t[0]<(l[0]-o[0])*(t[1]-o[1])/(l[1]-o[1])+o[0]&&(n=!n)}var i,s,a,o,l;return n}function At(t,r){for(const e of t)if(!kt(e,r))return;for(let e=0;e<t.length-1;++e)if(function(t,r,e){for(const n of e)for(let e=0;e<n.length-1;++e)if(St(t,r,n[e],n[e+1]))return 1}(t[e],t[e+1],r))return;return 1}function It(e,t,r,n){var i=n[0]-r[0],n=n[1]-r[1],e=(e[0]-r[0])*n-i*(e[1]-r[1]),n=(t[0]-r[0])*n-i*(t[1]-r[1]);return 0<e&&n<0||e<0&&0<n}function Mt(r,n,i){const e=[];for(let t=0;t<r.length;t++){const l=[];for(let e=0;e<r[t].length;e++){s=r[t][e],a=i,o=void 0,o=(180+s[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,a=Math.pow(2,a.z);o=[Math.round(o*a*vt),Math.round(s*a*vt)];wt(n,o),l.push(o)}e.push(l)}var s,a,o;return e}function zt(t,r,n){const i=[];for(let e=0;e<t.length;e++){var s=Mt(t[e],r,n);i.push(s)}return i}function Pt(t,r,n,i){if(t[0]<n[0]||t[0]>n[2]){const r=.5*i;let e=t[0]-n[0]>r?-i:n[0]-t[0]>r?i:0;0===e&&(e=t[0]-n[2]>r?-i:n[2]-t[0]>r?i:0),t[0]+=e}wt(r,t)}function Ct(e,t,r,n){const i=Math.pow(2,n.z)*vt,s=[n.x*vt,n.y*vt],a=[];for(const n of e)for(const e of n){const n=[e.x+s[0],e.y+s[1]];Pt(n,t,r,i),a.push(n)}return a}function Bt(e,t,r,n){const i=Math.pow(2,n.z)*vt,s=[n.x*vt,n.y*vt],a=[];for(const r of e){const e=[];for(const n of r){const r=[n.x+s[0],n.y+s[1]];wt(t,r),e.push(r)}a.push(e)}if(t[2]-t[0]<=i/2){(n=t)[0]=n[1]=1/0,n[2]=n[3]=-1/0;for(const e of a)for(const n of e)Pt(n,t,r,i)}return a}class Vt{constructor(e,t){this.type=u,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qe(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const r of t.features){const{type:t,coordinates:n}=r.geometry;"Polygon"===t&&e.push(n),"MultiPolygon"===t&&e.push(...n)}if(e.length)return new Vt(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Vt(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Vt(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType()){var t=e;var r=this.geometries;var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],s=t.canonicalID();if("Polygon"===r.type){var a=Mt(r.coordinates,i,s),o=Ct(t.geometry(),n,i,s);if(!_t(n,i))return!1;for(const t of o)if(!kt(t,a))return!1}if("MultiPolygon"===r.type){var l=zt(r.coordinates,i,s),o=Ct(t.geometry(),n,i,s);if(!_t(n,i))return!1;for(const t of o)if(!function(e,t){for(const r of t)if(kt(e,r))return 1}(t,l))return!1}return!0;return}if("LineString"===e.geometryType()){var u=e;r=this.geometries;t=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],n=u.canonicalID();if("Polygon"===r.type){var c=Mt(r.coordinates,s,n),h=Bt(u.geometry(),t,s,n);if(!_t(t,s))return!1;for(const u of h)if(!At(u,c))return!1}if("MultiPolygon"===r.type){var p=zt(r.coordinates,s,n),h=Bt(u.geometry(),t,s,n);if(!_t(t,s))return!1;for(const u of h)if(!function(e,t){for(const r of t)if(At(e,r))return 1}(u,p))return!1}return!0;return}}return!1}eachChild(){}outputDefined(){return!0}}let Tt=class{constructor(e=[],t=(e,t)=>e<t?-1:t<e?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),0<--this.length&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;0<e;){var i=e-1>>1,s=t[i];if(0<=r(n,s))break;t[e]=s,e=i}t[e]=n}_down(t){const{data:r,compare:n}=this,e=this.length>>1,i=r[t];for(;t<e;){let e=1+(t<<1);var s=e+1;if(s<this.length&&n(r[s],r[e])<0&&(e=s),0<=n(r[e],i))break;r[t]=r[e],t=e}r[t]=i}};function Et(e,t,r,n,i){!function e(t,r,n,i,s){for(;n<i;){600<i-n&&(a=i-n+1,o=r-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*l*(a-l)/a)*(o-a/2<0?-1:1),e(t,r,Math.max(n,Math.floor(r-o*l/a+u)),Math.min(i,Math.floor(r+(a-o)*l/a+u)),s));var a,o,l,u,c=t[r],h=n,p=i;for(Ft(t,n,r),0<s(t[i],c)&&Ft(t,n,i);h<p;){for(Ft(t,h,p),h++,p--;s(t[h],c)<0;)h++;for(;0<s(t[p],c);)p--}0===s(t[n],c)?Ft(t,n,p):Ft(t,++p,i),p<=r&&(n=p+1),r<=p&&(i=p-1)}}(e,t,r,n||e.length-1,i||Dt)}function Ft(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Dt(e,t){return e<t?-1:t<e?1:0}function Lt(e,t){if(e.length<=1)return[e];const r=[];let n,i;for(const t of e){const e=function(s){let a=0;for(let e,t,r=0,n=s.length,i=n-1;r<n;i=r++)e=s[r],t=s[i],a+=(t.x-e.x)*(e.y+t.y);return a}(t);0!==e&&(t.area=Math.abs(e),(i=void 0===i?e<0:i)===e<0?(n&&r.push(n),n=[t]):n.push(t))}if(n&&r.push(n),1<t)for(let e=0;e<r.length;e++)r[e].length<=t||(Et(r[e],t,1,r[e].length-1,Ot),r[e]=r[e].slice(0,t));return r}function Ot(e,t){return t.area-e.area}const $t=1/298.257223563,Rt=$t*(2-$t),jt=Math.PI/180;class qt{constructor(e){var t=6378.137*jt*1e3,e=Math.cos(e*jt),r=1/(1-Rt*(1-e*e)),n=Math.sqrt(r);this.kx=t*n*e,this.ky=t*n*r*(1-Rt)}distance(e,t){var r=this.wrap(e[0]-t[0])*this.kx,e=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+e*e)}pointOnLine(a,o){let l,u,c,h,p=1/0;for(let s=0;s<a.length-1;s++){let e=a[s][0],t=a[s][1],r=this.wrap(a[s+1][0]-e)*this.kx,n=(a[s+1][1]-t)*this.ky,i=0;0===r&&0===n||(1<(i=(this.wrap(o[0]-e)*this.kx*r+(o[1]-t)*this.ky*n)/(r*r+n*n))?(e=a[s+1][0],t=a[s+1][1]):0<i&&(e+=r/this.kx*i,t+=n/this.ky*i)),r=this.wrap(o[0]-e)*this.kx,n=(o[1]-t)*this.ky;var d=r*r+n*n;d<p&&(p=d,l=e,u=t,c=s,h=i)}return{point:[l,u],index:c,t:Math.max(0,Math.min(1,h))}}wrap(e){for(;e<-180;)e+=360;for(;180<e;)e-=360;return e}}function Ut(e,t){return t[0]-e[0]}function Nt(e){return e[1]-e[0]+1}function Zt(e,t){return e[1]>=e[0]&&e[1]<t}function Gt(e,t){if(e[0]>e[1])return[null,null];var r=Nt(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===r)return[e,null];t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}function Xt(t,r){if(!Zt(r,t.length))return[1/0,1/0,-1/0,-1/0];var n=[1/0,1/0,-1/0,-1/0];for(let e=r[0];e<=r[1];++e)wt(n,t[e]);return n}function Ht(e){var t=[1/0,1/0,-1/0,-1/0];for(const r of e)for(const e of r)wt(t,e);return t}function Yt(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function Jt(e,t,r){if(!Yt(e)||!Yt(t))return NaN;let n=0,i=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),r.distance([0,0],[n,i])}function Kt(e,t,r){t=r.pointOnLine(t,e);return r.distance(e,t.point)}function Wt(e,t,r,n,i){var s=Math.min(Kt(e,[r,n],i),Kt(t,[r,n],i)),r=Math.min(Kt(r,[e,t],i),Kt(n,[e,t],i));return Math.min(s,r)}function Qt(e,t){for(const r of e)for(const e of r)if(kt(e,t,!0))return 1}function er(e,t,r,n,i,s){!s||(n=Jt(Xt(n,s),i,r))<t&&e.push([n,s,[0,0]])}function tr(e,t,r,n,i,s,a){s&&a&&((n=Jt(Xt(n,s),Xt(i,a),r))<t&&e.push([n,s,a]))}function rr(t,e,r,n,i=1/0){let s=Math.min(n.distance(t[0],r[0][0]),i);if(0===s)return s;const a=new Tt([[0,[0,t.length-1],[0,0]]],Ut),o=Ht(r);for(;0<a.length;){const i=a.pop();if(!(i[0]>=s)){var l=i[1];if(Nt(l)<=(e?50:100)){if(!Zt(l,t.length))return NaN;if(e){const e=function(n,i,t,s){if(!Zt(i,n.length))return NaN;for(let e=i[0];e<=i[1];++e)if(kt(n[e],t,!0))return 0;let a=1/0;for(let e=i[0];e<i[1];++e){const i=n[e],u=n[e+1];for(const n of t)for(let e=0,t=n.length,r=t-1;e<t;r=e++){var o=n[r],l=n[e];if(St(i,u,o,l))return 0;a=Math.min(a,Wt(i,u,o,l,s))}}return a}(t,l,r,n);if(isNaN(e)||0===e)return e;s=Math.min(s,e)}else for(let e=l[0];e<=l[1];++e){const i=function(e,t,r){if(kt(e,t,!0))return 0;let n=1/0;for(const s of t){const t=s[0],a=s[s.length-1];if(t!==a&&0===(n=Math.min(n,Kt(e,[a,t],r))))return n;var i=r.pointOnLine(s,e);if(0===(n=Math.min(n,r.distance(e,i.point))))return n}return n}(t[e],r,n);if(0===(s=Math.min(s,i)))return 0}}else{const r=Gt(l,e);er(a,s,n,t,o,r[0]),er(a,s,n,t,o,r[1])}}}return s}function nr(r,n,i,e,s,t=1/0){let a=Math.min(t,s.distance(r[0],i[0]));if(0===a)return a;const o=new Tt([[0,[0,r.length-1],[0,i.length-1]]],Ut);for(;0<o.length;){const t=o.pop();if(!(t[0]>=a)){var l=t[1],u=t[2];if(Nt(l)<=(n?50:100)&&Nt(u)<=(e?50:100)){if(!Zt(l,r.length)&&Zt(u,i.length))return NaN;let t;if(n&&e)t=function(t,r,n,i,s){if(!Zt(r,t.length)||!Zt(i,n.length))return 1/0;let a=1/0;for(let e=r[0];e<r[1];++e){const r=t[e],o=t[e+1];for(let e=i[0];e<i[1];++e){const i=n[e],l=n[e+1];if(St(r,o,i,l))return 0;a=Math.min(a,Wt(r,o,i,l,s))}}return a}(r,l,i,u,s),a=Math.min(a,t);else if(n&&!e){const n=r.slice(l[0],l[1]+1);for(let e=u[0];e<=u[1];++e)if(t=Kt(i[e],n,s),0===(a=Math.min(a,t)))return a}else if(!n&&e){const n=i.slice(u[0],u[1]+1);for(let e=l[0];e<=l[1];++e)if(t=Kt(r[e],n,s),0===(a=Math.min(a,t)))return a}else t=function(r,e,n,i,s){if(!Zt(e,r.length)||!Zt(i,n.length))return NaN;let a=1/0;for(let t=e[0];t<=e[1];++t)for(let e=i[0];e<=i[1];++e)if(0===(a=Math.min(a,s.distance(r[t],n[e]))))return a;return a}(r,l,i,u,s),a=Math.min(a,t)}else{const t=Gt(l,n),c=Gt(u,e);tr(o,a,s,r,i,t[0],c[0]),tr(o,a,s,r,i,t[0],c[1]),tr(o,a,s,r,i,t[1],c[0]),tr(o,a,s,r,i,t[1],c[1])}}}return a}function ir(e){return"MultiPolygon"===e.type?e.coordinates.map(e=>({type:"Polygon",coordinates:e})):"MultiLineString"===e.type?e.coordinates.map(e=>({type:"LineString",coordinates:e})):"MultiPoint"===e.type?e.coordinates.map(e=>({type:"Point",coordinates:e})):[e]}class sr{constructor(e,t){this.type=h,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qe(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new sr(t,t.features.map(e=>ir(e.geometry)).flat());if("Feature"===t.type)return new sr(t,ir(t.geometry));if("type"in t&&"coordinates"in t)return new sr(t,ir(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType()){var r=t;var n=this.geometries;const h=r.geometry(),p=h.flat().map(e=>bt([e.x,e.y],r.canonical));if(0===h.length)return NaN;var i=new qt(p[0][1]);let e=1/0;for(const r of n){switch(r.type){case"Point":e=Math.min(e,nr(p,!1,[r.coordinates],!1,i,e));break;case"LineString":e=Math.min(e,nr(p,!1,r.coordinates,!0,i,e));break;case"Polygon":e=Math.min(e,rr(p,!1,r.coordinates,i,e))}if(0===e)return e}return e;return}if("LineString"===t.geometryType()){var s=t;n=this.geometries;const d=s.geometry(),f=d.flat().map(e=>bt([e.x,e.y],s.canonical));if(0===d.length)return NaN;var a=new qt(f[0][1]);let e=1/0;for(const s of n){switch(s.type){case"Point":e=Math.min(e,nr(f,!0,[s.coordinates],!1,a,e));break;case"LineString":e=Math.min(e,nr(f,!0,s.coordinates,!0,a,e));break;case"Polygon":e=Math.min(e,rr(f,!0,s.coordinates,a,e))}if(0===e)return e}return e;return}if("Polygon"===t.geometryType()){var o=t;var l=this.geometries;t=o.geometry();if(0===t.length||0===t[0].length)return NaN;var u=Lt(t,0).map(e=>e.map(e=>e.map(e=>bt([e.x,e.y],o.canonical)))),c=new qt(u[0][0][0][1]);let e=1/0;for(const o of l)for(const l of u){switch(o.type){case"Point":e=Math.min(e,rr([o.coordinates],!1,l,c,e));break;case"LineString":e=Math.min(e,rr(o.coordinates,!0,l,c,e));break;case"Polygon":e=Math.min(e,function(n,i,s,a=1/0){const o=Ht(n),e=Ht(i);if(a!==1/0&&Jt(o,e,s)>=a)return a;if(_t(o,e)){if(Qt(n,i))return 0}else if(Qt(i,n))return 0;let l=1/0;for(const a of n)for(let e=0,t=a.length,r=t-1;e<t;r=e++){const o=a[r],u=a[e];for(const n of i)for(let e=0,t=n.length,r=t-1;e<t;r=e++){const a=n[r],c=n[e];if(St(o,u,a,c))return 0;l=Math.min(l,Wt(o,u,a,c,s))}}return l}(l,o.coordinates,c,e))}if(0===e)return e}return e;return}}return NaN}eachChild(){}outputDefined(){return!0}}const ar={"==":e,"!=":t,">":ft,"<":dt,">=":mt,"<=":yt,array:Ge,at:class Oc{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,h),e=t.parse(e[2],2,f(t.expectedType||p));return r&&e?new Oc(e.type.itemType,r,e):null}evaluate(e){var t=this.index.evaluate(e),e=this.input.evaluate(e);if(t<0)throw new x(`Array index out of bounds: ${t} < 0.`);if(t>=e.length)throw new x(`Array index out of bounds: ${t} > ${e.length-1}.`);if(t!==Math.floor(t))throw new x(`Array index must be an integer, but found ${t} instead.`);return e[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}},boolean:Ge,case:class $c{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);const i=[];for(let e=1;e<t.length-1;e+=2){var s=r.parse(t[e],e,u);if(!s)return null;var a=r.parse(t[e+1],e+1,n);if(!a)return null;i.push([s,a]),n=n||a.type}var e=r.parse(t[t.length-1],t.length-1,n);if(!e)return null;if(n)return new $c(n,i,e);throw new Error("Can't infer output type")}evaluate(e){for(var[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(var[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([,e])=>e.outputDefined())&&this.otherwise.outputDefined()}},coalesce:ut,collator:gt,format:xt,image:class Rc{constructor(e){this.type=se,this.input=e}static parse(e,t){return 2!==e.length?t.error("Expected two arguments."):(e=t.parse(e[1],1,l))?new Rc(e):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Re.fromString(t);return r&&e.availableImages&&(r.available=-1<e.availableImages.indexOf(t)),r}eachChild(e){e(this.input)}outputDefined(){return!1}},in:class jc{constructor(e,t){this.type=u,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,p),e=t.parse(e[2],2,p);return r&&e?de(r.type,[u,l,h,Q,p])?new jc(r,e):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${y(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!fe(t,["boolean","string","number","null"]))throw new x(`Expected first argument to be of type boolean, string, number or null, but found ${y(g(t))} instead.`);if(fe(r,["string","array"]))return 0<=r.indexOf(t);throw new x(`Expected second argument to be of type array or string, but found ${y(g(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}},"index-of":class qc{constructor(e,t,r){this.type=h,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,p),n=t.parse(e[2],2,p);return r&&n?de(r.type,[u,l,h,Q,p])?4===e.length?(e=t.parse(e[3],3,h))?new qc(r,n,e):null:new qc(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${y(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!fe(t,["boolean","string","number","null"]))throw new x(`Expected first argument to be of type boolean, string, number or null, but found ${y(g(t))} instead.`);let n;if(this.fromIndex&&(n=this.fromIndex.evaluate(e)),fe(r,["string"])){const e=r.indexOf(t,n);return-1===e?-1:[...r.slice(0,e)].length}if(fe(r,["array"]))return r.indexOf(t,n);throw new x(`Expected second argument to be of type array or string, but found ${y(g(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}},interpolate:ot,"interpolate-hcl":ot,"interpolate-lab":ot,length:class Uc{constructor(e){this.type=h,this.input=e}static parse(e,t){return 2!==e.length?t.error(`Expected 1 argument, but found ${e.length-1} instead.`):(e=t.parse(e[1],1))?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?t.error(`Expected argument of type string or array, but found ${y(e.type)} instead.`):new Uc(e):null}evaluate(e){if("string"==typeof(e=this.input.evaluate(e)))return[...e].length;if(Array.isArray(e))return e.length;throw new x(`Expected value to be of type string or array, but found ${y(g(e))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}},let:We,literal:Ne,match:class Nc{constructor(e,t,r,n,i,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s}static parse(r,n){if(r.length<5)return n.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return n.error("Expected an even number of arguments.");let i,s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const a={},o=[];for(let t=2;t<r.length-1;t+=2){let e=r[t];var l=r[t+1];Array.isArray(e)||(e=[e]);const u=n.concat(t);if(0===e.length)return u.error("Expected at least one branch label.");for(const r of e){if("number"!=typeof r&&"string"!=typeof r)return u.error("Branch labels must be numbers or strings.");if("number"==typeof r&&Math.abs(r)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof r&&Math.floor(r)!==r)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,g(r)))return null}else i=g(r);if(void 0!==a[String(r)])return u.error("Branch labels must be unique.");a[String(r)]=o.length}if(!(l=n.parse(l,t,s)))return null;s=s||l.type,o.push(l)}var e=n.parse(r[1],1,p);if(!e)return null;var t=n.parse(r[r.length-1],r.length-1,s);return!t||"value"!==e.type.kind&&n.concat(1).checkSubtype(i,e.type)?null:new Nc(i,s,e,a,o,t)}evaluate(e){var t=this.input.evaluate(e);return(g(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}},number:Ge,"number-format":class Zc{constructor(e,t,r,n,i){this.type=l,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");var r=t.parse(e[1],1,h);if(!r)return null;if("object"!=typeof(e=e[2])||Array.isArray(e))return t.error("NumberFormat options argument must be an object.");let n=null;if(e.locale&&!(n=t.parse(e.locale,1,l)))return null;let i=null;if(e.currency&&!(i=t.parse(e.currency,1,l)))return null;let s=null;if(e["min-fraction-digits"]&&!(s=t.parse(e["min-fraction-digits"],1,h)))return null;let a=null;return e["max-fraction-digits"]&&!(a=t.parse(e["max-fraction-digits"],1,h))?null:new Zc(r,n,i,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}},object:Ge,slice:class Gc{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,p),n=t.parse(e[2],2,h);return r&&n?de(r.type,[f(p),l,p])?4===e.length?(e=t.parse(e[3],3,h))?new Gc(r.type,r,n,e):null:new Gc(r.type,r,n):t.error(`Expected first argument to be of type array or string, but found ${y(r.type)} instead`):null}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let n;if(this.endIndex&&(n=this.endIndex.evaluate(e)),fe(t,["string"]))return[...t].slice(r,n).join("");if(fe(t,["array"]))return t.slice(r,n);throw new x(`Expected first argument to be of type array or string, but found ${y(g(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}},step:tt,string:Ge,"to-boolean":He,"to-color":He,"to-number":He,"to-string":He,var:Qe,within:Vt,distance:sr};class or{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(r,n){const i=r[0],s=or.definitions[i];if(!s)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(s)?s[0]:s.type,o=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,l=o.filter(([e])=>!Array.isArray(e)||e.length===r.length-1);let u=null;for(const[s,o]of l){u=new Ke(n.registry,hr,n.path,null,n.scope);const l=[];let t=!1;for(let e=1;e<r.length;e++){const i=r[e],a=Array.isArray(s)?s[e-1]:s.type,o=u.parse(i,1+l.length,a);if(!o){t=!0;break}l.push(o)}if(!t)if(Array.isArray(s)&&s.length!==l.length)u.error(`Expected ${s.length} arguments, but found ${l.length} instead.`);else{for(let e=0;e<l.length;e++){const n=Array.isArray(s)?s[e]:s.type,i=l[e];u.concat(e+1).checkSubtype(n,i.type)}if(0===u.errors.length)return new or(i,a,o,l)}}if(1===l.length)n.errors.push(...u.errors);else{const i=(l.length?l:o).map(([e])=>{return e=e,Array.isArray(e)?`(${e.map(y).join(", ")})`:`(${y(e.type)}...)`}).join(" | "),s=[];for(let e=1;e<r.length;e++){const a=n.parse(r[e],1+s.length);if(!a)return null;s.push(y(a.type))}n.error(`Expected arguments of type ${i}, but found (${s.join(", ")}) instead.`)}return null}static register(e,t){for(const r in or.definitions=t)e[r]=or}}function lr(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);i=i?i.evaluate(e):1,e=je(t,r,n,i);if(e)throw new x(e);return new w(t/255,r/255,n/255,i,!1)}function ur(e,t){t=t[e];return void 0===t?null:t}function cr(e){return{type:e}}function hr(e){if(e instanceof Qe)return hr(e.boundExpression);if(e instanceof or&&"error"===e.name)return!1;if(e instanceof gt)return!1;if(e instanceof Vt)return!1;if(e instanceof sr)return!1;const t=e instanceof He||e instanceof Ge;let r=!0;return e.eachChild(e=>{r=t?r&&hr(e):r&&e instanceof Ne}),!!r&&pr(e)&&fr(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function pr(e){if(e instanceof or){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Vt)return!1;if(e instanceof sr)return!1;let t=!0;return e.eachChild(e=>{t&&!pr(e)&&(t=!1)}),t}function dr(e){if(!(e instanceof or&&"feature-state"===e.name)){let t=!0;return e.eachChild(e=>{t&&!dr(e)&&(t=!1)}),t}}function fr(e,t){if(e instanceof or&&0<=t.indexOf(e.name))return!1;let r=!0;return e.eachChild(e=>{r&&!fr(e,t)&&(r=!1)}),r}function yr(e){return{result:"success",value:e}}function mr(e){return{result:"error",value:e}}function gr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function xr(e){return e.expression&&-1<e.expression.parameters.indexOf("zoom")}function vr(e){return e.expression&&e.expression.interpolated}function b(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function br(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function wr(e){return e}function _r(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Sr(e,t,r,n,i){return _r(typeof r===i?n[r]:void 0,e.default,t.default)}function kr(e,t,r){if("number"!==b(r))return _r(e.default,t.default);t=e.stops.length;if(1===t)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[t-1][0])return e.stops[t-1][1];t=et(e.stops.map(e=>e[0]),r);return e.stops[t][1]}function Ar(r,e,t){var n=void 0!==r.base?r.base:1;if("number"!==b(t))return _r(r.default,e.default);var i,s=r.stops.length;if(1===s)return r.stops[0][1];if(t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[s-1][0])return r.stops[s-1][1];const a=et(r.stops.map(e=>e[0]),t),o=(s=t,t=n,n=r.stops[a][0],i=r.stops[a+1][0]-n,s-=n,0==i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)),l=r.stops[a][1],u=r.stops[a+1][1],c=at[e.type]||wr;return"function"==typeof l.evaluate?{evaluate(...e){var t=l.evaluate.apply(void 0,e),e=u.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==e)return c(t,e,o,r.colorSpace)}}:c(l,u,o,r.colorSpace)}function Ir(e,t,r){switch(t.type){case"color":r=w.parse(r);break;case"formatted":r=v.fromString(r.toString());break;case"resolvedImage":r=Re.fromString(r.toString());break;case"padding":r=m.parse(r);break;default:b(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0)}return _r(r,e.default,t.default)}or.register(ar,{error:[{kind:"error"},[l],(e,[t])=>{throw new x(t.evaluate(e))}],typeof:[l,[p],(e,[t])=>y(g(t.evaluate(e)))],"to-rgba":[f(h,4),[ee],(e,[t])=>{var[t,e,r,n]=t.evaluate(e).rgb;return[255*t,255*e,255*r,n]}],rgb:[ee,[h,h,h],lr],rgba:[ee,[h,h,h,h],lr],has:{type:u,overloads:[[[l],(e,[t])=>t.evaluate(e)in e.properties()],[[l,te],(e,[t,r])=>t.evaluate(e)in r.evaluate(e)]]},get:{type:p,overloads:[[[l],(e,[t])=>ur(t.evaluate(e),e.properties())],[[l,te],(e,[t,r])=>ur(t.evaluate(e),r.evaluate(e))]]},"feature-state":[p,[l],(e,[t])=>ur(t.evaluate(e),e.featureState||{})],properties:[te,[],e=>e.properties()],"geometry-type":[l,[],e=>e.geometryType()],id:[p,[],e=>e.id()],zoom:[h,[],e=>e.globals.zoom],"heatmap-density":[h,[],e=>e.globals.heatmapDensity||0],"line-progress":[h,[],e=>e.globals.lineProgress||0],accumulated:[p,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[h,cr(h),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[h,cr(h),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:h,overloads:[[[h,h],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[h],(e,[t])=>-t.evaluate(e)]]},"/":[h,[h,h],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[h,[h,h],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[h,[],()=>Math.LN2],pi:[h,[],()=>Math.PI],e:[h,[],()=>Math.E],"^":[h,[h,h],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[h,[h],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[h,[h],(e,[t])=>Math.log(t.evaluate(e))],log2:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[h,[h],(e,[t])=>Math.sin(t.evaluate(e))],cos:[h,[h],(e,[t])=>Math.cos(t.evaluate(e))],tan:[h,[h],(e,[t])=>Math.tan(t.evaluate(e))],asin:[h,[h],(e,[t])=>Math.asin(t.evaluate(e))],acos:[h,[h],(e,[t])=>Math.acos(t.evaluate(e))],atan:[h,[h],(e,[t])=>Math.atan(t.evaluate(e))],min:[h,cr(h),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[h,cr(h),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[h,[h],(e,[t])=>Math.abs(t.evaluate(e))],round:[h,[h],(e,[t])=>{t=t.evaluate(e);return t<0?-Math.round(-t):Math.round(t)}],floor:[h,[h],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[h,[h],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[u,[l,p],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[u,[p],(e,[t])=>e.id()===t.value],"filter-type-==":[u,[l],(e,[t])=>e.geometryType()===t.value],"filter-<":[u,[l,p],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<t}],"filter-id-<":[u,[p],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<t}],"filter->":[u,[l,p],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<e}],"filter-id->":[u,[p],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<e}],"filter-<=":[u,[l,p],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<=t}],"filter-id-<=":[u,[p],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<=t}],"filter->=":[u,[l,p],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<=e}],"filter-id->=":[u,[p],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<=e}],"filter-has":[u,[p],(e,[t])=>t.value in e.properties()],"filter-has-id":[u,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[u,[f(l)],(e,[t])=>0<=t.value.indexOf(e.geometryType())],"filter-id-in":[u,[f(p)],(e,[t])=>0<=t.value.indexOf(e.id())],"filter-in-small":[u,[l,f(p)],(e,[t,r])=>0<=r.value.indexOf(e.properties()[t.value])],"filter-in-large":[u,[l,f(p)],(e,[t,r])=>{for(var n=e.properties()[t.value],i=r.value,s=0,a=r.value.length-1;s<=a;){var o=s+a>>1;if(i[o]===n)return!0;i[o]>n?a=o-1:s=1+o}return!1}],all:{type:u,overloads:[[[u,u],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[cr(u),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:u,overloads:[[[u,u],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[cr(u),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[u,[u],(e,[t])=>!t.evaluate(e)],"is-supported-script":[u,[l],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[l,[l],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[l,[l],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[l,cr(p),(t,e)=>e.map(e=>Ue(e.evaluate(t))).join("")],"resolved-locale":[l,[re],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Mr{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Je,this._defaultValue=t?"color"===(e=t).type&&br(e.default)?new w(0,0,0,0):"color"===e.type?w.parse(e.default)||null:"padding"===e.type?m.parse(e.default)||null:"variableAnchorOffsetCollection"===e.type?$e.parse(e.default)||null:void 0===e.default?null:e.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(!this._enumValues||e in this._enumValues)return e;throw new x(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`)}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function zr(e){return Array.isArray(e)&&0<e.length&&"string"==typeof e[0]&&e[0]in ar}function Pr(e,t){const r=new Ke(ar,hr,[],t?(i=t,s={color:ee,string:l,number:h,enum:l,boolean:u,formatted:ne,padding:ie,resolvedImage:se,variableAnchorOffsetCollection:ae},"array"===i.type?f(s[i.value]||p,i.length):s[i.type]):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);var i,s;return n?yr(new Mr(n,t)):mr(r.errors)}class Cr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!dr(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}}class Br{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!dr(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}interpolationFactor(e,t,r){return this.interpolationType?ot.interpolationFactor(this.interpolationType,e,t,r):0}}function Vr(e,t){e=Pr(e,t);if("error"===e.result)return e;var r=e.value.expression,n=pr(r);if(!n&&!gr(t))return mr([new K("","data expressions not supported")]);var i=fr(r,["zoom"]);if(!i&&!xr(t))return mr([new K("","zoom expressions not supported")]);r=function r(e){let n=null;if(e instanceof We)n=r(e.result);else if(e instanceof ut){for(const t of e.args)if(n=r(t),n)break}else(e instanceof tt||e instanceof ot)&&e.input instanceof or&&"zoom"===e.input.name&&(n=e);return n instanceof K||e.eachChild(e=>{const t=r(e);t instanceof K?n=t:!n&&t?n=new K("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&t&&n!==t&&(n=new K("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(r);return r||i?r instanceof K?mr([r]):r instanceof ot&&!vr(t)?mr([new K("",'"interpolate" expressions cannot be used with this property')]):yr(r?new Br(n?"camera":"composite",e.value,r.labels,r instanceof ot?r.interpolation:void 0):new Cr(n?"constant":"source",e.value)):mr([new K("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tr{constructor(e,t){this._parameters=e,this._specification=t,H(this,function e(r,n){const t="color"===n.type,i=r.stops&&"object"==typeof r.stops[0][0],s=i||!(i||void 0!==r.property),a=r.type||(vr(n)?"exponential":"interval");if(t||"padding"===n.type){const i=(t?w:m).parse;(r=H({},r)).stops&&(r.stops=r.stops.map(e=>[e[0],i(e[1])])),r.default=i(r.default||n.default)}if(r.colorSpace&&"rgb"!==(o=r.colorSpace)&&"hcl"!==o&&"lab"!==o)throw new Error(`Unknown color space: "${r.colorSpace}"`);var o;let l,u,c;if("exponential"===a)l=Ar;else if("interval"===a)l=kr;else if("categorical"===a){l=Sr,u=Object.create(null);for(const n of r.stops)u[n[0]]=n[1];c=typeof r.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);l=Ir}if(i){const t={},i=[];for(let e=0;e<r.stops.length;e++){const s=r.stops[e],a=s[0].zoom;void 0===t[a]&&(t[a]={zoom:a,type:r.type,property:r.property,default:r.default,stops:[]},i.push(a)),t[a].stops.push([s[0].value,s[1]])}const s=[];for(const r of i)s.push([t[r].zoom,e(t[r],n)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:ot.interpolationFactor.bind(void 0,a),zoomStops:s.map(e=>e[0]),evaluate:({zoom:e},t)=>Ar({stops:s,base:r.base},n,e).evaluate(e,t)}}if(s){const t="exponential"===a?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:ot.interpolationFactor.bind(void 0,t),zoomStops:r.stops.map(e=>e[0]),evaluate:({zoom:e})=>l(r,n,e,u,c)}}return{kind:"source",evaluate(e,t){return void 0===(t=t&&t.properties?t.properties[r.property]:void 0)?_r(r.default,n.default):l(r,n,t,u,c)}}}(this._parameters,this._specification))}static deserialize(e){return new Tr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Er(e){if(!0===e||!1===e)return 1;if(Array.isArray(e)&&0!==e.length)switch(e[0]){case"has":return 2<=e.length&&"$id"!==e[1]&&"$type"!==e[1];case"in":return 3<=e.length&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Er(t)&&"boolean"!=typeof t)return;return 1;default:return 1}}const Fr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Dr(e){if(null==e)return{filter:()=>!0,needGeometry:!1};const n=Pr(e=Er(e)?e:Or(e),Fr);if("error"===n.result)throw new Error(n.value.map(e=>e.key+": "+e.message).join(", "));return{filter:(e,t,r)=>n.value.evaluate(e,t,{},r),needGeometry:function t(r){if(!Array.isArray(r))return!1;if("within"===r[0]||"distance"===r[0])return!0;for(let e=1;e<r.length;e++)if(t(r[e]))return!0;return!1}(e)}}function Lr(e,t){return e<t?-1:t<e?1:0}function Or(e){if(!e)return!0;var t,r=e[0];return e.length<=1?"any"!==r:"=="===r?$r(e[1],e[2],"=="):"!="===r?qr($r(e[1],e[2],"==")):"<"===r||">"===r||"<="===r||">="===r?$r(e[1],e[2],r):"any"===r?(t=e.slice(1),["any"].concat(t.map(Or))):"all"===r?["all"].concat(e.slice(1).map(Or)):"none"===r?["all"].concat(e.slice(1).map(Or).map(qr)):"in"===r?Rr(e[1],e.slice(2)):"!in"===r?qr(Rr(e[1],e.slice(2))):"has"===r?jr(e[1]):"!has"!==r||qr(jr(e[1]))}function $r(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Rr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return 200<t.length&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Lr)]]:["filter-in-small",e,["literal",t]]}}function jr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function qr(e){return["!",e]}function Ur(e){let t="";for(const r of X)t+="/"+function t(r){var e=typeof r;if("number"==e||"boolean"==e||"string"==e||null==r)return JSON.stringify(r);if(Array.isArray(r)){let e="[";for(const n of r)e+=t(n)+",";return e+"]"}const n=Object.keys(r).sort();let i="{";for(let e=0;e<n.length;e++)i+=`${JSON.stringify(n[e])}:${t(r[n[e]])},`;return i+"}"}(e[r]);return t}function Nr(e){var t=e.value;return t?[new d(e.key,t,"constants have been deprecated as of v8")]:[]}function _(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Zr(e){if(Array.isArray(e))return e.map(Zr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Zr(e[r]);return t}return _(e)}function Gr(t){var r=t.key,n=t.value,i=t.valueSpec||{},s=t.objectElementValidators||{},a=t.style,o=t.styleSpec,l=t.validateSpec;let u=[];const c=b(n);if("object"!==c)return[new d(r,n,`object expected, ${c} found`)];for(const t in n){const c=t.split(".")[0],h=i[c]||i["*"];let e;if(s[c])e=s[c];else if(i[c])e=l;else if(s["*"])e=s["*"];else{if(!i["*"]){u.push(new d(r,n[t],`unknown property "${t}"`));continue}e=l}u=u.concat(e({key:(r&&r+".")+t,value:n[t],valueSpec:h,style:a,styleSpec:o,object:n,objectKey:t,validateSpec:l},n))}for(const t in i)s[t]||i[t].required&&void 0===i[t].default&&void 0===n[t]&&u.push(new d(r,n,`missing required property "${t}"`));return u}function Xr(t){const r=t.value,e=t.valueSpec,n=t.style,i=t.styleSpec,s=t.key,a=t.arrayElementValidator||t.validateSpec;if("array"!==b(r))return[new d(s,r,`array expected, ${b(r)} found`)];if(e.length&&r.length!==e.length)return[new d(s,r,`array length ${e.length} expected, length ${r.length} found`)];if(e["min-length"]&&r.length<e["min-length"])return[new d(s,r,`array length at least ${e["min-length"]} expected, length ${r.length} found`)];let o={type:e.value,values:e.values},l=(i.$version<7&&(o.function=e.function),"object"===b(e.value)&&(o=e.value),[]);for(let e=0;e<r.length;e++)l=l.concat(a({array:r,arrayIndex:e,value:r[e],valueSpec:o,validateSpec:t.validateSpec,style:n,styleSpec:i,key:`${s}[${e}]`}));return l}function Hr(e){var t=e.key,r=e.value,e=e.valueSpec;let n=b(r);return"number"!==(n="number"===n&&r!=r?"NaN":n)?[new d(t,r,`number expected, ${n} found`)]:"minimum"in e&&r<e.minimum?[new d(t,r,r+" is less than the minimum value "+e.minimum)]:"maximum"in e&&r>e.maximum?[new d(t,r,r+" is greater than the maximum value "+e.maximum)]:[]}function Yr(e){const i=e.valueSpec,s=_(e.value.type);let a,o,l,u={};const t="categorical"!==s&&void 0===e.value.property,r=!t,c="array"===b(e.value.stops)&&"array"===b(e.value.stops[0])&&"object"===b(e.value.stops[0][0]),n=Gr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===s)return[new d(e.key,e.value,'identity function may not have a "stops" property')];let t=[];var r=e.value;return t=t.concat(Xr({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===b(r)&&0===r.length&&t.push(new d(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:i,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===s&&t&&n.push(new d(e.key,e.value,'missing required property "property"')),"identity"===s||e.value.stops||n.push(new d(e.key,e.value,'missing required property "stops"')),"exponential"===s&&e.valueSpec.expression&&!vr(e.valueSpec)&&n.push(new d(e.key,e.value,"exponential functions not supported")),8<=e.styleSpec.$version&&(r&&!gr(e.valueSpec)?n.push(new d(e.key,e.value,"property functions not supported")):t&&!xr(e.valueSpec)&&n.push(new d(e.key,e.value,"zoom functions not supported"))),"categorical"!==s&&!c||void 0!==e.value.property||n.push(new d(e.key,e.value,'"property" property is required')),n;function h(e){let t=[];var r=e.value,n=e.key;if("array"!==b(r))return[new d(n,r,`array expected, ${b(r)} found`)];if(2!==r.length)return[new d(n,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==b(r[0]))return[new d(n,r,`object expected, ${b(r[0])} found`)];if(void 0===r[0].zoom)return[new d(n,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new d(n,r,"object stop key must have value")];if(l&&l>_(r[0].zoom))return[new d(n,r[0].zoom,"stop zoom values must appear in ascending order")];_(r[0].zoom)!==l&&(l=_(r[0].zoom),o=void 0,u={}),t=t.concat(Gr({key:n+"[0]",value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Hr,value:p}}))}else t=t.concat(p({key:n+"[0]",value:r[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return zr(Zr(r[1]))?t.concat([new d(n+"[1]",r[1],"expressions are not allowed in function stops.")]):t.concat(e.validateSpec({key:n+"[1]",value:r[1],valueSpec:i,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function p(t,r){var n=b(t.value),e=_(t.value),r=null!==t.value?t.value:r;if(a){if(n!==a)return[new d(t.key,r,n+" stop domain type must match previous stop domain type "+a)]}else a=n;if("number"!==n&&"string"!==n&&"boolean"!==n)return[new d(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===n||"categorical"===s)return"categorical"!==s||"number"!==n||isFinite(e)&&Math.floor(e)===e?"categorical"!==s&&"number"===n&&void 0!==o&&e<o?[new d(t.key,r,"stop domain values must appear in ascending order")]:(o=e,"categorical"===s&&e in u?[new d(t.key,r,"stop domain values must be unique")]:(u[e]=!0,[])):[new d(t.key,r,"integer expected, found "+e)];{let e=`number expected, ${n} found`;return gr(i)&&void 0===s&&(e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new d(t.key,r,e)]}}}function Jr(t){const e=("property"===t.expressionContext?Vr:Pr)(Zr(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new d(""+t.key+e.key,t.value,e.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new d(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!dr(r))return[new d(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!dr(r))return[new d(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!fr(r,["zoom","feature-state"]))return[new d(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!pr(r))return[new d(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kr(e){const t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(_(r))&&i.push(new d(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(_(r))&&i.push(new d(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function Wr(e){return Er(Zr(e.value))?Jr(H({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){const n=r.value,i=r.key;if("array"!==b(n))return[new d(i,n,`array expected, ${b(n)} found`)];const s=r.styleSpec;let a,o=[];if(n.length<1)return[new d(i,n,"filter array must have at least 1 element")];switch(o=o.concat(Kr({key:i+"[0]",value:n[0],valueSpec:s.filter_operator,style:r.style,styleSpec:r.styleSpec})),_(n[0])){case"<":case"<=":case">":case">=":2<=n.length&&"$type"===_(n[1])&&o.push(new d(i,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&o.push(new d(i,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":2<=n.length&&("string"!==(a=b(n[1]))&&o.push(new d(i+"[1]",n[1],`string expected, ${a} found`)));for(let e=2;e<n.length;e++)a=b(n[e]),"$type"===_(n[1])?o=o.concat(Kr({key:`${i}[${e}]`,value:n[e],valueSpec:s.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&o.push(new d(`${i}[${e}]`,n[e],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)o=o.concat(t({key:`${i}[${e}]`,value:n[e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":a=b(n[1]),2!==n.length?o.push(new d(i,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==a&&o.push(new d(i+"[1]",n[1],`string expected, ${a} found`))}return o}(e)}function Qr(e,t){const r=e.key,n=e.validateSpec,i=e.style,s=e.styleSpec,a=e.value,o=e.objectKey,l=s[t+"_"+e.layerType];if(!l)return[];var u=o.match(/^(.*)-transition$/);if("paint"===t&&u&&l[u[1]]&&l[u[1]].transition)return n({key:r,value:a,valueSpec:s.transition,style:i,styleSpec:s});u=e.valueSpec||l[o];if(!u)return[new d(r,a,`unknown property "${o}"`)];let c;if("string"===b(a)&&gr(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(a)))return[new d(r,a,`"${o}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new d(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&br(Zr(a))&&"identity"===_(a.type)&&h.push(new d(r,a,'"text-font" does not support identity functions'))),h.concat(n({key:e.key,value:a,valueSpec:u,style:i,styleSpec:s,expressionContext:"property",propertyType:t,propertyKey:o}))}function en(e){return Qr(e,"paint")}function tn(e){return Qr(e,"layout")}function rn(t){let r=[];const n=t.value,i=t.key,s=t.style,a=t.styleSpec;n.type||n.ref||r.push(new d(i,n,'either "type" or "ref" is required'));let o=_(n.type);const l=_(n.ref);if(n.id){const a=_(n.id);for(let e=0;e<t.arrayIndex;e++){const t=s.layers[e];_(t.id)===a&&r.push(new d(i,n.id,`duplicate layer id "${n.id}", previously used at line `+t.id.__line__))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(e=>{e in n&&r.push(new d(i,n[e],`"${e}" is prohibited for ref layers`))}),s.layers.forEach(e=>{_(e.id)===l&&(t=e)}),t?t.ref?r.push(new d(i,n.ref,"ref cannot reference another ref layer")):o=_(t.type):r.push(new d(i,n.ref,`ref layer "${l}" not found`))}else if("background"!==o)if(n.source){const t=s.sources&&s.sources[n.source],a=t&&_(t.type);t?"vector"===a&&"raster"===o?r.push(new d(i,n.source,`layer "${n.id}" requires a raster source`)):"raster-dem"!==a&&"hillshade"===o?r.push(new d(i,n.source,`layer "${n.id}" requires a raster-dem source`)):"raster"===a&&"raster"!==o?r.push(new d(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o?r.push(new d(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===a&&t.lineMetrics||r.push(new d(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new d(i,n,`layer "${n.id}" must specify a "source-layer"`)):r.push(new d(i,n.source,`source "${n.source}" not found`))}else r.push(new d(i,n,'missing required property "source"'));return r=r.concat(Gr({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:i+".type",value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"}),filter:Wr,layout:e=>Gr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>tn(H({layerType:o},e))}}),paint:e=>Gr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>en(H({layerType:o},e))}})}}))}function nn(e){var t=e.value,e=e.key,r=b(t);return"string"!==r?[new d(e,t,`string expected, ${r} found`)]:[]}const sn={promoteId:function({key:e,value:t}){if("string"===b(t))return nn({key:e,value:t});{const r=[];for(const n in t)r.push(...nn({key:e+"."+n,value:t[n]}));return r}}};function an(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style,s=e.validateSpec;if(!t.type)return[new d(r,t,'"type" is required')];const a=_(t.type);let o;switch(a){case"vector":case"raster":return o=Gr({key:r,value:t,valueSpec:n["source_"+a.replace("-","_")],style:e.style,styleSpec:n,objectElementValidators:sn,validateSpec:s});case"raster-dem":return o=function(e){var t=null!=(o=e.sourceName)?o:"",r=e.value,n=e.styleSpec,i=n.source_raster_dem,s=e.style;let a=[];var o=b(r);if(void 0===r)return a;if("object"!==o)return a.push(new d("source_raster_dem",r,`object expected, ${o} found`)),a;const l="custom"===_(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],c=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const o in r)!l&&u.includes(o)?a.push(new d(o,r[o],`In "${t}": "${o}" is only valid when "encoding" is set to "custom". ${c} encoding found`)):i[o]?a=a.concat(e.validateSpec({key:o,value:r[o],valueSpec:i[o],validateSpec:e.validateSpec,style:s,styleSpec:n})):a.push(new d(o,r[o],`unknown property "${o}"`));return a}({sourceName:r,value:t,style:e.style,styleSpec:n,validateSpec:s});case"geojson":if(o=Gr({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,validateSpec:s,objectElementValidators:sn}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],a="string"==typeof n?[n,["accumulated"],["get",e]]:n;o.push(...Jr({key:`${r}.${e}.map`,value:i,validateSpec:s,expressionContext:"cluster-map"})),o.push(...Jr({key:`${r}.${e}.reduce`,value:a,validateSpec:s,expressionContext:"cluster-reduce"}))}return o;case"video":return Gr({key:r,value:t,valueSpec:n.source_video,style:i,validateSpec:s,styleSpec:n});case"image":return Gr({key:r,value:t,valueSpec:n.source_image,style:i,validateSpec:s,styleSpec:n});case"canvas":return[new d(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kr({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,validateSpec:s,styleSpec:n})}}function on(e){var t=e.value,r=e.styleSpec,n=r.light,i=e.style;let s=[];const a=b(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new d("light",t,`object expected, ${a} found`)]);for(const a in t){var o=a.match(/^(.*)-transition$/);s=s.concat(o&&n[o[1]]&&n[o[1]].transition?e.validateSpec({key:a,value:t[a],valueSpec:r.transition,validateSpec:e.validateSpec,style:i,styleSpec:r}):n[a]?e.validateSpec({key:a,value:t[a],valueSpec:n[a],validateSpec:e.validateSpec,style:i,styleSpec:r}):[new d(a,t[a],`unknown property "${a}"`)])}return s}function ln(e){const t=e.value,r=e.styleSpec,n=r.sky,i=e.style,s=b(t);if(void 0===t)return[];if("object"!==s)return[new d("sky",t,`object expected, ${s} found`)];let a=[];for(const s in t)a=a.concat(n[s]?e.validateSpec({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r}):[new d(s,t[s],`unknown property "${s}"`)]);return a}function un(e){var t=e.value,r=e.styleSpec,n=r.terrain,i=e.style;let s=[];const a=b(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new d("terrain",t,`object expected, ${a} found`)]);for(const a in t)s=s.concat(n[a]?e.validateSpec({key:a,value:t[a],valueSpec:n[a],validateSpec:e.validateSpec,style:i,styleSpec:r}):[new d(a,t[a],`unknown property "${a}"`)]);return s}function cn(e){let t=[];var r=e.value,n=e.key;if(Array.isArray(r)){const i=[],s=[];for(const a in r)r[a].id&&i.includes(r[a].id)&&t.push(new d(n,r,`all the sprites' ids must be unique, but ${r[a].id} is duplicated`)),i.push(r[a].id),r[a].url&&s.includes(r[a].url)&&t.push(new d(n,r,`all the sprites' URLs must be unique, but ${r[a].url} is duplicated`)),s.push(r[a].url),t=t.concat(Gr({key:`${n}[${a}]`,value:r[a],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return nn({key:n,value:r})}const hn={"*":()=>[],array:Xr,boolean:function(e){var t=e.value,e=e.key,r=b(t);return"boolean"!==r?[new d(e,t,`boolean expected, ${r} found`)]:[]},number:Hr,color:function(e){var t=e.key,e=e.value,r=b(e);return"string"!==r?[new d(t,e,`color expected, ${r} found`)]:w.parse(String(e))?[]:[new d(t,e,`color expected, "${e}" found`)]},constants:Nr,enum:Kr,filter:Wr,function:Yr,layer:rn,object:Gr,source:an,light:on,sky:ln,terrain:un,projection:function(e){const t=e.value,r=e.styleSpec,n=r.projection,i=e.style,s=b(t);if(void 0===t)return[];if("object"!==s)return[new d("projection",t,`object expected, ${s} found`)];let a=[];for(const s in t)a=a.concat(n[s]?e.validateSpec({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r}):[new d(s,t[s],`unknown property "${s}"`)]);return a},string:nn,formatted:function(e){return 0===nn(e).length?[]:Jr(e)},resolvedImage:function(e){return 0===nn(e).length?[]:Jr(e)},padding:function(r){var n=r.key,i=r.value;if("array"!==b(i))return Hr({key:n,value:i,valueSpec:{}});{if(i.length<1||4<i.length)return[new d(n,i,`padding requires 1 to 4 values; ${i.length} values found`)];var s={type:"number"};let t=[];for(let e=0;e<i.length;e++)t=t.concat(r.validateSpec({key:`${n}[${e}]`,value:i[e],validateSpec:r.validateSpec,valueSpec:s}));return t}},variableAnchorOffsetCollection:function(t){var r=t.key,n=t.value,e=b(n),i=t.styleSpec;if("array"!==e||n.length<1||n.length%2!=0)return[new d(r,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let e=0;e<n.length;e+=2)s=(s=s.concat(Kr({key:`${r}[${e}]`,value:n[e],valueSpec:i.layout_symbol["text-anchor"]}))).concat(Xr({key:`${r}[${e+1}]`,value:n[e+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:i}));return s},sprite:cn};function pn(e){var t=e.value,r=e.valueSpec,n=e.styleSpec;return e.validateSpec=pn,r.expression&&br(_(t))?Yr(e):r.expression&&zr(Zr(t))?Jr(e):r.type&&hn[r.type]?hn[r.type](e):Gr(H({},e,{valueSpec:r.type?n[r.type]:r}))}function dn(e){const t=e.value,r=e.key,n=nn(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new d(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new d(r,t,'"glyphs" url must include a "{range}" token'))),n}function fn(e,t=s){let r=[];return r=r.concat(pn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:pn,objectElementValidators:{glyphs:dn,"*":()=>[]}})),mn(r=e.constants?r.concat(Nr({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:pn})):r)}function yn(t){return function(e){return t({...e,validateSpec:pn})}}function mn(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function gn(t){return function(...e){return mn(t.apply(this,e))}}fn.source=gn(yn(an)),fn.sprite=gn(yn(cn)),fn.glyphs=gn(yn(dn)),fn.light=gn(yn(on)),fn.sky=gn(yn(ln)),fn.terrain=gn(yn(un)),fn.layer=gn(yn(rn)),fn.filter=gn(yn(Wr)),fn.paintProperty=gn(yn(en)),fn.layoutProperty=gn(yn(tn));const xn="AbortError";function vn(){return new Error(xn)}const bn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wn(e,t){bn.REGISTERED_PROTOCOLS[e]=t}function _n(e){delete bn.REGISTERED_PROTOCOLS[e]}const Sn="global-dispatcher";class kn extends Error{constructor(e,t,r,n){super(`AJAXError: ${t} (${e}): `+r),this.status=e,this.statusText=t,this.url=r,this.body=n}}function An(e,t){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const c=bn.REGISTERED_PROTOCOLS[(r=e.url).substring(0,r.indexOf("://"))];if(c)return c(e,t);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:Sn},t)}var r,i,s;if(r=e.url,!(/^file:/.test(r)||/^file:/.test(In())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(n,i){return c(this,void 0,void 0,function*(){const e=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:In(),signal:i.signal}),t=("json"!==n.type||e.headers.has("Accept")||e.headers.set("Accept","application/json"),yield fetch(e));if(!t.ok){const e=yield t.blob();throw new kn(t.status,t.statusText,n.url,e)}var r=yield"arrayBuffer"===n.type||"image"===n.type?t.arrayBuffer():"json"===n.type?t.json():t.text();if(i.signal.aborted)throw vn();return{data:r,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires")}})}(e,t);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:Sn},t)}return i=e,s=t,new Promise((t,r)=>{var e;const n=new XMLHttpRequest;n.open(i.method||"GET",i.url,!0),"arrayBuffer"!==i.type&&"image"!==i.type||(n.responseType="arraybuffer");for(const s in i.headers)n.setRequestHeader(s,i.headers[s]);"json"===i.type&&(n.responseType="text",null!=(e=i.headers)&&e.Accept||n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===i.credentials,n.onerror=()=>{r(new Error(n.statusText))},n.onload=()=>{if(!s.signal.aborted)if((200<=n.status&&n.status<300||0===n.status)&&null!==n.response){let e=n.response;if("json"===i.type)try{e=JSON.parse(n.response)}catch(e){return void r(e)}t({data:e,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")})}else{const s=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});r(new kn(n.status,n.statusText,i.url,s))}},s.signal.addEventListener("abort",()=>{n.abort(),r(vn())}),n.send(i.body)})}const In=()=>q(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,Mn={};function r(e,t,r={}){if(Mn[e])throw new Error(e+" is already registered.");Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Mn[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}r("Object",Object),r("TransferableGridIndex",G),r("Color",w),r("Error",Error),r("AJAXError",kn),r("ResolvedImage",Re),r("StylePropertyFunction",Tr),r("StyleExpression",Mr,{omit:["_evaluator"]}),r("ZoomDependentExpression",Br),r("ZoomConstantExpression",Cr),r("CompoundExpression",or,{omit:["_evaluate"]});for(const c in ar)ar[c]._classRegistryKey||r("Expression_"+c,ar[c]);function zn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Pn(e){return e.$name||e.constructor._classRegistryKey}function Cn(e){return!function(e){if(null!==e&&"object"==typeof e)return e=Pn(e),e&&"Object"!==e}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||zn(e)||U(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function Bn(e,t){if(Cn(e))return(zn(e)||U(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(Bn(n,t));return r}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const r=Pn(e);if(!r)throw new Error("can't serialize object of unregistered class "+e.constructor.name);if(!Mn[r])throw new Error(r+" is not registered.");const n=Mn[r]["klass"],i=n.serialize?n.serialize(e,t):{};if(n.serialize){if(t&&i===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const n in e){var s;!e.hasOwnProperty(n)||0<=Mn[r].omit.indexOf(n)||(s=e[n],i[n]=0<=Mn[r].shallow.indexOf(n)?s:Bn(s,t))}e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(i.$name=r),i}function Vn(e){if(Cn(e))return e;if(Array.isArray(e))return e.map(Vn);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);var t,r=Pn(e)||"Object";if(!Mn[r])throw new Error("can't deserialize unregistered class "+r);const n=Mn[r]["klass"];if(!n)throw new Error("can't deserialize unregistered class "+r);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const n of Object.keys(e))"$name"!==n&&(t=e[n],i[n]=0<=Mn[r].shallow.indexOf(n)?t:Vn(t));return i}class Tn{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}class En{constructor(e,t){var r,n,i;this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Tn(()=>this.process()),this.subscription=(r=this.target,n="message",i=e=>this.receive(e),r.addEventListener(n,i,!1),{unsubscribe:()=>{r.removeEventListener(n,i,!1)}}),this.globalScope=q(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(n,i){return new Promise((e,t)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[r]={resolve:e,reject:t},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[r];var e={id:r,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)},{once:!0});e=[],t=Object.assign(Object.assign({},n),{id:r,sourceMapId:this.mapId,origin:location.origin,data:Bn(n.data,e)});this.target.postMessage(t,{transfer:e})})}receive(e){var e=e.data,t=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[t];const e=this.abortControllers[t];return delete this.abortControllers[t],void(e&&e.abort())}if(q(self)||e.mustQueue)return this.tasks[t]=e,this.taskQueue.push(t),void this.invoker.trigger();this.processTask(t,e)}}process(){var e,t;0!==this.taskQueue.length&&(e=this.taskQueue.shift(),t=this.tasks[e],delete this.tasks[e],0<this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t))}processTask(n,i){return c(this,void 0,void 0,function*(){if("<response>"===i.type){const t=this.resolveRejects[n];return(delete this.resolveRejects[n],t)?void(i.error?t.reject(Vn(i.error)):t.resolve(Vn(i.data))):void 0}if(this.messageHandlers[i.type]){const t=Vn(i.data),r=new AbortController;this.abortControllers[n]=r;try{var e=yield this.messageHandlers[i.type](i.sourceMapId,t,r);this.completeTask(n,null,e)}catch(t){this.completeTask(n,t)}}else this.completeTask(n,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: `+Object.keys(this.messageHandlers).join(", ")))})}completeTask(e,t,r){var n=[],e=(delete this.abortControllers[e],{id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Bn(t):null,data:Bn(r,n)});this.target.postMessage(e,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}}function Fn(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Dn(e,t,r){r&&r[e]&&(-1!==(t=r[e].indexOf(t))&&r[e].splice(t,1))}class Ln{constructor(e,t={}){D(this,t),this.type=e}}class On extends Ln{constructor(e,t={}){super("error",D({error:e},t))}}const $n=fn,Rn=$n.paintProperty,jn=$n.layoutProperty;class qn{constructor(){this.first=!0}update(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const S={"Latin-1 Supplement":e=>128<=e&&e<=255,"Hangul Jamo":e=>4352<=e&&e<=4607,Khmer:e=>6016<=e&&e<=6143,"General Punctuation":e=>8192<=e&&e<=8303,"Letterlike Symbols":e=>8448<=e&&e<=8527,"Number Forms":e=>8528<=e&&e<=8591,"Miscellaneous Technical":e=>8960<=e&&e<=9215,"Control Pictures":e=>9216<=e&&e<=9279,"Optical Character Recognition":e=>9280<=e&&e<=9311,"Enclosed Alphanumerics":e=>9312<=e&&e<=9471,"Geometric Shapes":e=>9632<=e&&e<=9727,"Miscellaneous Symbols":e=>9728<=e&&e<=9983,"Miscellaneous Symbols and Arrows":e=>11008<=e&&e<=11263,"Ideographic Description Characters":e=>12272<=e&&e<=12287,"CJK Symbols and Punctuation":e=>12288<=e&&e<=12351,Katakana:e=>12448<=e&&e<=12543,Kanbun:e=>12688<=e&&e<=12703,"CJK Strokes":e=>12736<=e&&e<=12783,"Enclosed CJK Letters and Months":e=>12800<=e&&e<=13055,"CJK Compatibility":e=>13056<=e&&e<=13311,"Yijing Hexagram Symbols":e=>19904<=e&&e<=19967,"Private Use Area":e=>57344<=e&&e<=63743,"Vertical Forms":e=>65040<=e&&e<=65055,"CJK Compatibility Forms":e=>65072<=e&&e<=65103,"Small Form Variants":e=>65104<=e&&e<=65135,"Halfwidth and Fullwidth Forms":e=>65280<=e&&e<=65519};function Un(e){for(const t of e)if(Hn(t.charCodeAt(0)))return!0;return!1}function Nn(e){for(const r of e)if(t=r.charCodeAt(0),Gn.test(String.fromCodePoint(t)))return;var t;return 1}function Zn(e){const t=e.map(e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}}).filter(e=>e);return new RegExp(t.join("|"),"u")}const Gn=Zn(["Arab","Dupl","Mong","Ougr","Syrc"]);const Xn=Zn(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Hn(e){return 746===e||747===e||!(e<4352)&&(S["CJK Compatibility Forms"](e)&&!(65097<=e&&e<=65103)||S["CJK Compatibility"](e)||S["CJK Strokes"](e)||!(!S["CJK Symbols and Punctuation"](e)||12296<=e&&e<=12305||12308<=e&&e<=12319||12336===e)||S["Enclosed CJK Letters and Months"](e)||S["Ideographic Description Characters"](e)||S.Kanbun(e)||S.Katakana(e)&&12540!==e||!(!S["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||65306<=e&&e<=65310||65339===e||65341===e||65343===e||65371<=e&&e<=65503||65507===e||65512<=e&&e<=65519)||!(!S["Small Form Variants"](e)||65112<=e&&e<=65118||65123<=e&&e<=65126)||S["Vertical Forms"](e)||S["Yijing Hexagram Symbols"](e)||/\p{sc=Cans}/u.test(String.fromCodePoint(e))||/\p{sc=Hang}/u.test(String.fromCodePoint(e))||Xn.test(String.fromCodePoint(e)))}function Yn(e){return!(Hn(e)||(e=e,S["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||S["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||S["Letterlike Symbols"](e)||S["Number Forms"](e)||S["Miscellaneous Technical"](e)&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||S["Control Pictures"](e)&&9251!==e||S["Optical Character Recognition"](e)||S["Enclosed Alphanumerics"](e)||S["Geometric Shapes"](e)||S["Miscellaneous Symbols"](e)&&!(9754<=e&&e<=9759)||S["Miscellaneous Symbols and Arrows"](e)&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||S["CJK Symbols and Punctuation"](e)||S.Katakana(e)||S["Private Use Area"](e)||S["CJK Compatibility Forms"](e)||S["Small Form Variants"](e)||S["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e))}const Jn=Zn(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Kn(e){return Jn.test(String.fromCodePoint(e))}const Y=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class k{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qn,this.transition={})}isSupportedScript(e){var t,r,n="loaded"===Y.getRTLTextPluginStatus();for(const i of e)if(t=i.charCodeAt(0),r=n,!r&&Kn(t)||2304<=t&&t<=3583||3840<=t&&t<=4255||S.Khmer(t))return!1;return!0}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class Wn{constructor(e,t){this.property=e,this.value=t,this.expression=function(t,r){if(br(t))return new Tr(t,r);if(zr(t)){const e=Vr(t,r);if("error"===e.result)throw new Error(e.value.map(e=>e.key+": "+e.message).join(", "));return e.value}{let e=t;return"color"===r.type&&"string"==typeof t?e=w.parse(t):"padding"!==r.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===r.type&&Array.isArray(t)&&(e=$e.parse(t)):e=m.parse(t),{kind:"constant",evaluate:()=>e}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Qn{constructor(e){this.property=e,this.value=new Wn(e,void 0)}transitioned(e,t){return new ti(this.property,this.value,t,D({},e.transition,this.transition),e.now)}untransitioned(){return new ti(this.property,this.value,null,{},0)}}class ei{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].value=new Wn(this._values[e].property,null===t?void 0:$(t))}getTransition(e){return $(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].transition=$(t)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r),t=(void 0!==t&&(e[r]=t),this.getTransition(r));void 0!==t&&(e[r+"-transition"]=t)}return e}transitioned(e,t){const r=new ri(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new ri(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ti{constructor(e,t,r,n,i){this.property=e,this.value=t,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),s=this.prior;if(s){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return s.possiblyEvaluate(e,t,r);var a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,r),i,function(){if(a<=0)return 0;if(1<=a)return 1;var e=a*a,t=e*a;return 4*(a<.5?t:3*(a-e)+t-.75)}())}return i}}class ri{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new si(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ni{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return $(this._values[e].value)}setValue(e,t){this._values[e]=new Wn(this._values[e].property,null===t?void 0:$(t))}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r);void 0!==t&&(e[r]=t)}return e}possiblyEvaluate(e,t,r){const n=new si(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class ii{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class si{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class n{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,r){const n=at[this.specification.type];return n?n(e,t,r):e}}class i{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return new ii(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new ii(this,{kind:"constant",value:void 0},e.parameters);const n=at[this.specification.type];return n?(t=n(e.value.value,t.value.value,r),new ii(this,{kind:"constant",value:t},e.parameters)):e}evaluate(e,t,r,n,i,s){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,s)}}class ai extends i{possiblyEvaluate(e,t,r,n){if(void 0===e.value)return new ii(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind)return r=e.expression.evaluate(t,null,{},r,n),n="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,r=this._calculate(n,n,n,t),new ii(this,{kind:"constant",value:r},t);if("camera"!==e.expression.kind)return new ii(this,e.expression,t);{const r=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ii(this,{kind:"constant",value:r},t)}}evaluate(e,t,r,n,i,s){return"source"===e.kind?(i=e.evaluate(t,r,n,i,s),this._calculate(i,i,i,t)):"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,n),e.evaluate({zoom:Math.floor(t.zoom)},r,n),e.evaluate({zoom:Math.floor(t.zoom)+1},r,n),t):e.value}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class oi{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){if(void 0!==e.value)return"constant"===e.expression.kind?(r=e.expression.evaluate(t,null,{},r,n),this._calculate(r,r,r,t)):this._calculate(e.expression.evaluate(new k(Math.floor(t.zoom-1),t)),e.expression.evaluate(new k(Math.floor(t.zoom),t)),e.expression.evaluate(new k(Math.floor(t.zoom+1),t)),t)}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class li{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class a{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){var t=e[r];t.specification.overridable&&this.overridableProperties.push(r);const n=this.defaultPropertyValues[r]=new Wn(t,void 0),i=this.defaultTransitionablePropertyValues[r]=new Qn(t);this.defaultTransitioningPropertyValues[r]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=n.possiblyEvaluate({})}}}r("DataDrivenProperty",i),r("DataConstantProperty",n),r("CrossFadedDataDrivenProperty",ai),r("CrossFadedProperty",oi),r("ColorRampProperty",li);const ui="-transition";class ci extends class{on(e,t){return this._listeners=this._listeners||{},Fn(e,t,this._listeners),this}off(e,t){return Dn(e,t,this._listeners),Dn(e,t,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Fn(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(e,t){const r=(e="string"==typeof e?new Ln(e,t||{}):e).type;if(this.listens(r)){const t=(e.target=this)._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);for(const t of this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[])Dn(r,t,this._oneTimeListeners),t.call(this,e);const n=this._eventedParent;n&&(D(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof On&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&0<this._listeners[e].length||this._oneTimeListeners&&this._oneTimeListeners[e]&&0<this._oneTimeListeners[e].length||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new ni(t.layout)),t.paint)){this._transitionablePaint=new ei(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new si(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(jn,`layers.${this.id}.layout.`+e,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(ui)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(Rn,`layers.${this.id}.paint.`+e,e,t,r))return!1;if(e.endsWith(ui))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const r=this._transitionablePaint._values[e],n="cross-faded-data-driven"===r.property.specification["property-type"],i=r.value.isDataDriven(),s=r.value,a=(this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e),this._transitionablePaint._values[e].value);return a.isDataDriven()||i||n||this._handleOverridablePaintPropertyUpdate(e,s,a)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(e,t){const r={};for(const n in e)t.call(this,e[n],n,e)&&(r[n]=e[n]);return r}(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&function(e,t){let r=!1;if(t&&t.length)for(const n of t)e.fire(new On(new Error(n.message))),r=!0;return r}(this,e.call($n,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:s,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){var e=this.paint.get(t);if(e instanceof ii&&gr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const hi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class pi{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class o{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){e>this.capacity&&(this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),e=this.uint8,this._refreshViews(),e&&this.uint8.set(e))}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(e,i=1){let s=0,a=0;return{members:e.map(e=>{var t=hi[e.type].BYTES_PER_ELEMENT,r=s=di(s,Math.max(i,t)),n=e.components||1;return a=Math.max(a,t),s+=t*n,{name:e.name,type:e.type,components:n,offset:r}}),size:di(s,Math.max(a,i)),alignment:i}}function di(e,t){return Math.ceil(e/t)*t}class fi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.int16[0+n]=t,this.int16[1+n]=r,e}}fi.prototype.bytesPerElement=4,r("StructArrayLayout2i4",fi);class yi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.int16[0+i]=t,this.int16[1+i]=r,this.int16[2+i]=n,e}}yi.prototype.bytesPerElement=6,r("StructArrayLayout3i6",yi);class mi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var s=4*e;return this.int16[0+s]=t,this.int16[1+s]=r,this.int16[2+s]=n,this.int16[3+s]=i,e}}mi.prototype.bytesPerElement=8,r("StructArrayLayout4i8",mi);class gi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){var o=6*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.int16[2+o]=n,this.int16[3+o]=i,this.int16[4+o]=s,this.int16[5+o]=a,e}}gi.prototype.bytesPerElement=12,r("StructArrayLayout2i4i12",gi);class xi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){var o=4*e,l=8*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.uint8[4+l]=n,this.uint8[5+l]=i,this.uint8[6+l]=s,this.uint8[7+l]=a,e}}xi.prototype.bytesPerElement=8,r("StructArrayLayout2i4ub8",xi);class vi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.float32[0+n]=t,this.float32[1+n]=r,e}}vi.prototype.bytesPerElement=8,r("StructArrayLayout2f8",vi);class bi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u){var c=this.length;return this.resize(c+1),this.emplace(c,e,t,r,n,i,s,a,o,l,u)}emplace(e,t,r,n,i,s,a,o,l,u,c){var h=10*e;return this.uint16[0+h]=t,this.uint16[1+h]=r,this.uint16[2+h]=n,this.uint16[3+h]=i,this.uint16[4+h]=s,this.uint16[5+h]=a,this.uint16[6+h]=o,this.uint16[7+h]=l,this.uint16[8+h]=u,this.uint16[9+h]=c,e}}bi.prototype.bytesPerElement=20,r("StructArrayLayout10ui20",bi);class wi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,s,a,o,l,u,c,h)}emplace(e,t,r,n,i,s,a,o,l,u,c,h,p){var d=12*e;return this.int16[0+d]=t,this.int16[1+d]=r,this.int16[2+d]=n,this.int16[3+d]=i,this.uint16[4+d]=s,this.uint16[5+d]=a,this.uint16[6+d]=o,this.uint16[7+d]=l,this.int16[8+d]=u,this.int16[9+d]=c,this.int16[10+d]=h,this.int16[11+d]=p,e}}wi.prototype.bytesPerElement=24,r("StructArrayLayout4i4ui4i24",wi);class _i extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.float32[0+i]=t,this.float32[1+i]=r,this.float32[2+i]=n,e}}_i.prototype.bytesPerElement=12,r("StructArrayLayout3f12",_i);class Si extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[+e+0]=t,e}}Si.prototype.bytesPerElement=4,r("StructArrayLayout1ul4",Si);class ki extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l){var u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,n,i,s,a,o,l)}emplace(e,t,r,n,i,s,a,o,l,u){var c=10*e,h=5*e;return this.int16[0+c]=t,this.int16[1+c]=r,this.int16[2+c]=n,this.int16[3+c]=i,this.int16[4+c]=s,this.int16[5+c]=a,this.uint32[3+h]=o,this.uint16[8+c]=l,this.uint16[9+c]=u,e}}ki.prototype.bytesPerElement=20,r("StructArrayLayout6i1ul2ui20",ki);class Ai extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){var o=6*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.int16[2+o]=n,this.int16[3+o]=i,this.int16[4+o]=s,this.int16[5+o]=a,e}}Ai.prototype.bytesPerElement=12,r("StructArrayLayout2i2i2i12",Ai);class Ii extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){var a=4*e,o=8*e;return this.float32[0+a]=t,this.float32[1+a]=r,this.float32[2+a]=n,this.int16[6+o]=i,this.int16[7+o]=s,e}}Ii.prototype.bytesPerElement=16,r("StructArrayLayout2f1f2i16",Ii);class Mi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){var o=16*e,l=4*e,u=8*e;return this.uint8[0+o]=t,this.uint8[1+o]=r,this.float32[1+l]=n,this.float32[2+l]=i,this.int16[6+u]=s,this.int16[7+u]=a,e}}Mi.prototype.bytesPerElement=16,r("StructArrayLayout2ub2f2i16",Mi);class zi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.uint16[0+i]=t,this.uint16[1+i]=r,this.uint16[2+i]=n,e}}zi.prototype.bytesPerElement=6,r("StructArrayLayout3ui6",zi);class Pi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m){var g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m)}emplace(e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m,g){var x=24*e,v=12*e,b=48*e;return this.int16[0+x]=t,this.int16[1+x]=r,this.uint16[2+x]=n,this.uint16[3+x]=i,this.uint32[2+v]=s,this.uint32[3+v]=a,this.uint32[4+v]=o,this.uint16[10+x]=l,this.uint16[11+x]=u,this.uint16[12+x]=c,this.float32[7+v]=h,this.float32[8+v]=p,this.uint8[36+b]=d,this.uint8[37+b]=f,this.uint8[38+b]=y,this.uint32[10+v]=m,this.int16[22+x]=g,e}}Pi.prototype.bytesPerElement=48,r("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Pi);class Ci extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,k,A,I,M){var z=this.length;return this.resize(z+1),this.emplace(z,e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,k,A,I,M)}emplace(e,t,r,n,i,s,a,o,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,k,A,I,M,z){var P=32*e,C=16*e;return this.int16[0+P]=t,this.int16[1+P]=r,this.int16[2+P]=n,this.int16[3+P]=i,this.int16[4+P]=s,this.int16[5+P]=a,this.int16[6+P]=o,this.int16[7+P]=l,this.uint16[8+P]=u,this.uint16[9+P]=c,this.uint16[10+P]=h,this.uint16[11+P]=p,this.uint16[12+P]=d,this.uint16[13+P]=f,this.uint16[14+P]=y,this.uint16[15+P]=m,this.uint16[16+P]=g,this.uint16[17+P]=x,this.uint16[18+P]=v,this.uint16[19+P]=b,this.uint16[20+P]=w,this.uint16[21+P]=_,this.uint16[22+P]=S,this.uint32[12+C]=k,this.float32[13+C]=A,this.float32[14+C]=I,this.uint16[30+P]=M,this.uint16[31+P]=z,e}}Ci.prototype.bytesPerElement=64,r("StructArrayLayout8i15ui1ul2f2ui64",Ci);class Bi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[+e+0]=t,e}}Bi.prototype.bytesPerElement=4,r("StructArrayLayout1f4",Bi);class Vi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.uint16[6*e+0]=t,this.float32[1+i]=r,this.float32[2+i]=n,e}}Vi.prototype.bytesPerElement=12,r("StructArrayLayout1ui2f12",Vi);class Ti extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=4*e;return this.uint32[2*e+0]=t,this.uint16[2+i]=r,this.uint16[3+i]=n,e}}Ti.prototype.bytesPerElement=8,r("StructArrayLayout1ul2ui8",Ti);class Ei extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.uint16[0+n]=t,this.uint16[1+n]=r,e}}Ei.prototype.bytesPerElement=4,r("StructArrayLayout2ui4",Ei);class Fi extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[+e+0]=t,e}}Fi.prototype.bytesPerElement=2,r("StructArrayLayout1ui2",Fi);class Di extends o{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var s=4*e;return this.float32[0+s]=t,this.float32[1+s]=r,this.float32[2+s]=n,this.float32[3+s]=i,e}}Di.prototype.bytesPerElement=16,r("StructArrayLayout4f16",Di);class Li extends pi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}Li.prototype.size=20;class Oi extends ki{get(e){return new Li(this,e)}}r("CollisionBoxArray",Oi);class $i extends pi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$i.prototype.size=48;class Ri extends Pi{get(e){return new $i(this,e)}}r("PlacedSymbolArray",Ri);class ji extends pi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ji.prototype.size=64;class qi extends Ci{get(e){return new ji(this,e)}}r("SymbolInstanceArray",qi);class Ui extends Bi{getoffsetX(e){return this.float32[+e+0]}}r("GlyphOffsetArray",Ui);class Ni extends yi{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}r("SymbolLineVertexArray",Ni);class Zi extends pi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Zi.prototype.size=12;class Gi extends Vi{get(e){return new Zi(this,e)}}r("TextAnchorOffsetArray",Gi);class Xi extends pi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Xi.prototype.size=8;class Hi extends Ti{get(e){return new Xi(this,e)}}r("FeatureIndexArray",Hi);class Yi extends fi{}class Ji extends fi{}class Ki extends fi{}class Wi extends gi{}class Qi extends xi{}class es extends vi{}class ts extends bi{}class rs extends wi{}class ns extends _i{}class is extends Si{}class ss extends Ai{}class as extends Mi{}class os extends zi{}class ls extends Ei{}const us=A([{name:"a_pos",components:2,type:"Int16"}],4),cs=us["members"];class I{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>I.MAX_VERTEX_ARRAY_LENGTH&&le(`Max vertices per segment is ${I.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+e),(!i||i.vertexLength+e>I.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new I([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function hs(e,t){return 256*(e=F(Math.floor(e),0,255))+F(Math.floor(t),0,255)}I.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,r("SegmentVector",I);const ps=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var e={exports:{}},t={exports:{}},ft=(t.exports=function(e,t){for(var r,n,i,s=e.length-(r=3&e.length),a=t,o=3432918353,l=461845907,u=0;u<s;)i=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,a=27492+(65535&(n=5*(65535&(a=(a^=i=(65535&(i=(i=(65535&i)*o+(((i>>>16)*o&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(i=0,r){case 3:i^=(255&e.charCodeAt(u+2))<<16;case 2:i^=(255&e.charCodeAt(u+1))<<8;case 1:a^=i=(65535&(i=(i=(65535&(i^=255&e.charCodeAt(u)))*o+(((i>>>16)*o&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295}return a=2246822507*(65535&(a=(a^=e.length)^a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,((a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295)^a>>>16)>>>0},t.exports),dt={exports:{}},mt=(dt.exports=function(e,t){for(var r,n=e.length,i=t^n,s=0;4<=n;)r=1540483477*(65535&(r=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16),n-=4,++s;switch(n){case 3:i^=(255&e.charCodeAt(s+2))<<16;case 2:i^=(255&e.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return((i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16))^i>>>15)>>>0},ft),yt=dt.exports,ds=(e.exports=mt,e.exports.murmur3=mt,e.exports.murmur2=yt,P(e.exports));class fs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(ys(e)),this.positions.push(t,r,n)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");var t=ys(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=t?n=e:r=1+e}const i=[];for(;this.ids[r]===t;)i.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return i}static serialize(e,t){var r=new Float64Array(e.ids),e=new Uint32Array(e.positions);return function r(n,i,s,a){for(;s<a;){const o=n[s+a>>1];let e=s-1,t=a+1;for(;;){for(;e++,n[e]<o;);for(;t--,n[t]>o;);if(e>=t)break;ms(n,e,t),ms(i,3*e,3*t),ms(i,3*e+1,3*t+1),ms(i,3*e+2,3*t+2)}t-s<a-t?(r(n,i,s,t),s=t+1):(r(n,i,t+1,a),a=t)}}(r,e,0,r.length-1),t&&t.push(r.buffer,e.buffer),{ids:r,positions:e}}static deserialize(e){const t=new fs;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function ys(e){var t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ds(String(e))}function ms(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}r("FeaturePositionMap",fs);class gs{constructor(e,t){this.gl=e.gl,this.location=t}}class xs extends gs{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class vs extends gs{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class bs extends gs{constructor(e,t){super(e,t),this.current=w.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}function ws(e){return[hs(255*e.r,255*e.g),hs(255*e.b,255*e.a)]}class _s{constructor(e,t,r){this.value=e,this.uniformNames=t.map(e=>"u_"+e),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return new("color"===this.type?bs:xs)(e,t)}}class Ss{constructor(e,t){this.uniformNames=t.map(e=>"u_"+e),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,r,n){n="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;n&&e.set(n)}getBinding(e,t,r){return new("u_pattern"===r.substr(0,9)?vs:xs)(e,t)}}class ks{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i){var s=this.paintVertexArray.length,t=this.expression.evaluate(new k(0),t,{},n,[],i);this.paintVertexArray.resize(e),this._setPaintValue(s,e,t)}updatePaintArray(e,t,r,n){r=this.expression.evaluate({zoom:0},r,n);this._setPaintValue(e,t,r)}_setPaintValue(t,r,n){if("color"===this.type){var i=ws(n);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i[0],i[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class As{constructor(e,t,r,n,i,s){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,t,r,n,i){var s=this.expression.evaluate(new k(this.zoom),t,{},n,[],i),t=this.expression.evaluate(new k(this.zoom+1),t,{},n,[],i),n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(n,e,s,t)}updatePaintArray(e,t,r,n){var i=this.expression.evaluate({zoom:this.zoom},r,n),r=this.expression.evaluate({zoom:this.zoom+1},r,n);this._setPaintValue(e,t,i,r)}_setPaintValue(t,r,n,i){if("color"===this.type){var s=ws(n),a=ws(i);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,s[0],s[1],a[0],a[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){t=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,t=F(this.expression.interpolationFactor(t,this.zoom,this.zoom+1),0,1);e.set(t)}getBinding(e,t,r){return new xs(e,t)}}class Is{constructor(e,t,r,n,i,s){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=n,this.layerId=s,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}populatePaintArray(e,t,r){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],i)}_setPaintValues(t,r,e,n){if(n&&e){var{min:e,mid:i,max:s}=e,a=n[e],o=n[i],l=n[s];if(a&&o&&l)for(let e=t;e<r;e++)this.zoomInPaintVertexArray.emplace(e,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(e,o.tl[0],o.tl[1],o.br[0],o.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],o.pixelRatio,l.pixelRatio)}}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ps.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ps.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ms{constructor(e,t,r){this.binders={},this._buffers=[];const n=[];for(const u in e.paint._values)if(r(u)){var i=e.paint.get(u);if(i instanceof ii&&gr(i.property.specification)){s=u,a=e.type;var s={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(a+"-","").replace(/-/g,"_")],a=i.value,o=i.property.specification.type,l=i.property.useIntegerZoom,i=i.property.specification["property-type"],i="cross-faded"===i||"cross-faded-data-driven"===i;if("constant"===a.kind)this.binders[u]=i?new Ss(a.value,s):new _s(a.value,s,o),n.push("/u_"+u);else if("source"===a.kind||i){const r=Ps(u,o,"source");this.binders[u]=i?new Is(a,o,l,t,r,e.id):new ks(a,s,o,r),n.push("/a_"+u)}else{const e=Ps(u,o,"composite");this.binders[u]=new As(a,s,o,l,t,e),n.push("/z_"+u)}}}var s,a;this.cacheKey=n.sort().join("")}getMaxValue(e){e=this.binders[e];return e instanceof ks||e instanceof As?e.maxValue:0}populatePaintArrays(e,t,r,n,i){for(const s in this.binders){const a=this.binders[s];(a instanceof ks||a instanceof As||a instanceof Is)&&a.populatePaintArray(e,t,r,n,i)}}setConstantPatternPositions(e,t){for(const r in this.binders){const n=this.binders[r];n instanceof Ss&&n.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,n,i){let s=!1;for(const u in e){var a=t.getPositions(u);for(const t of a){var o,l=r.feature(t.index);for(const r in this.binders){const c=this.binders[r];(c instanceof ks||c instanceof As||c instanceof Is)&&!0===c.expression.isStateDependent&&(o=n.paint.get(r),c.expression=o.value,c.updatePaintArray(t.start,t.end,l,e[u],i),s=!0)}}}return s}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof _s||r instanceof Ss)&&e.push(...r.uniformNames.map(e=>"#define HAS_UNIFORM_"+e))}return e}getBinderAttributes(){const t=[];for(const e in this.binders){var r=this.binders[e];if(r instanceof ks||r instanceof As)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name);else if(r instanceof Is)for(let e=0;e<ps.members.length;e++)t.push(ps.members[e].name)}return t}getBinderUniforms(){const e=[];for(const r in this.binders){var t=this.binders[r];if(t instanceof _s||t instanceof Ss||t instanceof As)for(const n of t.uniformNames)e.push(n)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const r=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof _s||s instanceof Ss||s instanceof As)for(const a of s.uniformNames){var n;t[a]&&(n=s.getBinding(e,t[a],a),r.push({name:a,property:i,binding:n}))}}return r}setUniforms(e,t,r,n){for(const{name:e,property:i,binding:s}of t)this.binders[i].setUniform(s,n,r.get(i),e)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){var t,r=this.binders[n];e&&r instanceof Is?(t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer)&&this._buffers.push(t):(r instanceof ks||r instanceof As)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof ks||r instanceof As||r instanceof Is)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof ks||t instanceof As||t instanceof Is)&&t.destroy()}}}class zs{constructor(e,t,r=()=>!0){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new Ms(n,t,r);this.needsUpload=!1,this._featureMap=new fs,this._bufferOffset=0}populatePaintArrays(e,t,r,n,i,s){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,s);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n){for(const i of r)this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,t,i,n)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ps(e,t,r){var n={color:{source:vi,composite:Di},number:{source:Bi,composite:vi}},e=(e=e,{"line-pattern":{source:ts,composite:ts},"fill-pattern":{source:ts,composite:ts},"fill-extrusion-pattern":{source:ts,composite:ts}}[e]);return e&&e[r]||n[t][r]}r("ConstantBinder",_s),r("CrossFadedConstantBinder",Ss),r("SourceExpressionBinder",ks),r("CrossFadedCompositeBinder",Is),r("CompositeExpressionBinder",As),r("ProgramConfiguration",Ms,{omit:["_buffers"]}),r("ProgramConfigurationSet",zs);const ue=8192,Cs=Math.pow(2,14)-1,Bs=-Cs-1;function Vs(e){const t=ue/e.extent,r=e.loadGeometry();for(let e=0;e<r.length;e++){var n=r[e];for(let e=0;e<n.length;e++){const r=n[e],i=Math.round(r.x*t),s=Math.round(r.y*t);r.x=F(i,Bs,Cs),r.y=F(s,Bs,Cs),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&le("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ts(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Vs(e):[]}}function Es(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}class Fs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ji,this.indexArray=new os,this.segments=new I,this.programConfigurations=new zs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){const n=this.layers[0],i=[];let s=null,a=!1;"circle"===n.type&&(s=n.layout.get("circle-sort-key"),a=!s.isConstant());for(const{feature:t,id:n,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ts(t,e);var o;this.layers[0]._featureFilter.filter(new k(this.zoom),c,r)&&(o=a?s.evaluate(c,{},r):void 0,o={id:n,properties:t.properties,type:t.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:Vs(t),patterns:{},sortKey:o},i.push(o))}a&&i.sort((e,t)=>e.sortKey-t.sortKey);for(const n of i){const{geometry:i,index:s,sourceLayerIndex:a}=n,h=e[s].feature;this.addFeature(n,i,s,r),t.featureIndex.insert(h,i,s,a,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(!(r<0||r>=ue||n<0||n>=ue)){const i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=i.vertexLength;Es(this.layoutVertexArray,r,n,-1,-1),Es(this.layoutVertexArray,r,n,1,-1),Es(this.layoutVertexArray,r,n,1,1),Es(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+3,s+2),i.vertexLength+=4,i.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n)}}function Ds(t,r){if(1===t.length)return Rs(r,t[0]);for(let e=0;e<r.length;e++){var n=r[e];for(let e=0;e<n.length;e++)if(js(t,n[e]))return!0}for(let e=0;e<t.length;e++)if(Rs(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(Ls(t,r[e]))return!0;return!1}function Ls(t,r){var n,i,s,a;if(0!==t.length&&0!==r.length)for(let e=0;e<t.length-1;e++){var o=t[e],l=t[e+1];for(let e=0;e<r.length-1;e++)if(n=o,i=l,s=r[e],a=r[e+1],j(n,s,a)!==j(i,s,a)&&j(n,i,s)!==j(n,i,a))return 1}}function Os(t,r,e){var n=e*e;if(1===r.length)return t.distSqr(r[0])<n;for(let e=1;e<r.length;e++)if($s(t,r[e-1],r[e])<n)return 1}function $s(e,t,r){var n=t.distSqr(r);if(0===n)return e.distSqr(t);n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(n<0?t:1<n?r:r.sub(t)._mult(n)._add(t))}function Rs(n,i){let s,a,o,l=!1;for(let r=0;r<n.length;r++)for(let e=0,t=(s=n[r]).length-1;e<s.length;t=e++)a=s[e],o=s[t],a.y>i.y!=o.y>i.y&&i.x<(o.x-a.x)*(i.y-a.y)/(o.y-a.y)+a.x&&(l=!l);return l}function js(r,n){let i=!1;for(let e=0,t=r.length-1;e<r.length;t=e++){var s=r[e],a=r[t];s.y>n.y!=a.y>n.y&&n.x<(a.x-s.x)*(n.y-s.y)/(a.y-s.y)+s.x&&(i=!i)}return i}function qs(e,t,r){var n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Us(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ns(t,e,r,n,i){if(!e[0]&&!e[1])return t;const s=L.convert(e)._mult(i),a=("viewport"===r&&s._rotate(-n),[]);for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}let Zs,Gs;r("CircleBucket",Fs,{omit:["layers"]});var Xs={get paint(){return Gs=Gs||new a({"circle-radius":new i(s.paint_circle["circle-radius"]),"circle-color":new i(s.paint_circle["circle-color"]),"circle-blur":new i(s.paint_circle["circle-blur"]),"circle-opacity":new i(s.paint_circle["circle-opacity"]),"circle-translate":new n(s.paint_circle["circle-translate"]),"circle-translate-anchor":new n(s.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new n(s.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new n(s.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new i(s.paint_circle["circle-stroke-width"]),"circle-stroke-color":new i(s.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new i(s.paint_circle["circle-stroke-opacity"])})},get layout(){return Zs=Zs||new a({"circle-sort-key":new i(s.layout_circle["circle-sort-key"])})}},t="undefined"!=typeof Float32Array?Float32Array:Array;function Hs(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ys(e,t,r){var n=t[0],i=t[1],s=t[2],t=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*t,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*t,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*t,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*t,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),ft=new t(4),t!=Float32Array&&(ft[0]=0,ft[1]=0,ft[2]=0,ft[3]=0);class Js extends ci{constructor(e){super(e,Xs)}createBucket(e){return new Fs(e)}queryRadius(e){return qs("circle-radius",this,e)+qs("circle-stroke-width",this,e)+Us(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,e,n,i,s,a,o){const l=Ns(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,a),u=this.paint.get("circle-radius").evaluate(r,e)+this.paint.get("circle-stroke-width").evaluate(r,e),c="map"===this.paint.get("circle-pitch-alignment"),h=c?l:(d=o,l.map(e=>Ks(e,d))),p=c?u*a:u;var d,f,y,m;for(const t of n)for(const r of t){const t=c?r:Ks(r,o);let e=p;const n=Ys([],[r.x,r.y,0,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?e*=n[3]/s.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(e*=s.cameraToCenterDistance/n[3]),f=h,y=t,m=e,js(f,y)||Os(y,f,m))return!0}return!1}}function Ks(e,t){e=Ys([],[e.x,e.y,0,1],t);return new L(e[0]/e[3],e[1]/e[3])}class Ws extends Fs{}let Qs;r("HeatmapBucket",Ws,{omit:["layers"]});var ea={get paint(){return Qs=Qs||new a({"heatmap-radius":new i(s.paint_heatmap["heatmap-radius"]),"heatmap-weight":new i(s.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new n(s.paint_heatmap["heatmap-intensity"]),"heatmap-color":new li(s.paint_heatmap["heatmap-color"]),"heatmap-opacity":new n(s.paint_heatmap["heatmap-opacity"])})}};function ta(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError(`mismatched image size. expected: ${i.length} but got: `+t*r*n)}else i=new Uint8Array(t*r*n);return e.width=t,e.height=r,e.data=i,e}function ra(e,{width:t,height:r},n){var i;t===e.width&&r===e.height||(na(e,i=ta({},{width:t,height:r},n),{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,r)},n),e.width=t,e.height=r,e.data=i.data)}function na(t,r,n,i,s,a){if(0!==s.width&&0!==s.height){if(s.width>t.width||s.height>t.height||n.x>t.width-s.width||n.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>r.width||s.height>r.height||i.x>r.width-s.width||i.y>r.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const u=t.data,c=r.data;if(u===c)throw new Error("srcData equals dstData, so image is already copied");for(let e=0;e<s.height;e++){var o=((n.y+e)*t.width+n.x)*a,l=((i.y+e)*r.width+i.x)*a;for(let e=0;e<s.width*a;e++)c[l+e]=u[o+e]}}}class ia{constructor(e,t){ta(this,e,1,t)}resize(e){ra(this,e,1)}clone(){return new ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){na(e,t,r,n,i,1)}}class sa{constructor(e,t){ta(this,e,4,t)}resize(e){ra(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new sa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){na(e,t,r,n,i,4)}}r("AlphaImage",ia),r("RGBAImage",sa);class aa extends ci{createBucket(e){return new Ws(e)}constructor(e){super(e,ea),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=function(i){const n={},s=i.resolution||256,e=i.clips?i.clips.length:1,a=i.image||new sa({width:s,height:e});if(Math.log(s)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - "+s);var o=(e,t,r)=>{n[i.evaluationKey]=r;r=i.expression.evaluate(n);a.data[e+t+0]=Math.floor(255*r.r/r.a),a.data[e+t+1]=Math.floor(255*r.g/r.a),a.data[e+t+2]=Math.floor(255*r.b/r.a),a.data[e+t+3]=Math.floor(255*r.a)};if(i.clips)for(let r=0,n=0;r<e;++r,n+=4*s)for(let e=0,t=0;e<s;e++,t+=4){var l=e/(s-1),{start:u,end:c}=i.clips[r];o(n,t,u*(1-l)+c*l)}else for(let e=0,t=0;e<s;e++,t+=4)o(0,t,e/(s-1));return a}({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has("big-fb")&&this.heatmapFbos.delete("big-fb")}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let oa;var la={get paint(){return oa=oa||new a({"hillshade-illumination-direction":new n(s.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new n(s.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new n(s.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new n(s.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new n(s.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new n(s.paint_hillshade["hillshade-accent-color"])})}};class ua extends ci{constructor(e){super(e,la)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const ca=A([{name:"a_pos",components:2,type:"Int16"}],4),ha=ca["members"];function pa(n,e,i=2){const t=e&&e.length,s=t?e[0]*i:n.length;let r=da(n,0,s,i,!0);var a=[];if(!r||r.next===r.prev)return a;let o,l,u;if(t&&(r=function(r,n,t,i){const s=[];for(let e=0,t=n.length;e<t;e++){const a=da(r,n[e]*i,e<t-1?n[e+1]*i:r.length,i,!1);a===a.next&&(a.steiner=!0),s.push(function(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}(a))}s.sort(ma);for(let e=0;e<s.length;e++)t=function(e,t){var r=function(e,t){let r=t;var n=e.x,i=e.y;let s,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>a&&(a=e,s=r.x<r.next.x?r:r.next,e===n))return s}}while((r=r.next)!==t);if(!s)return null;var o,l,u=s,c=s.x,h=s.y;let p=1/0;r=s;do{if(n>=r.x&&r.x>=c&&n!==r.x&&xa(i<h?n:a,i,c,h,i<h?a:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Sa(r,e)&&(t<p||t===p&&(r.x>s.x||r.x===s.x&&(o=s,l=r,M(o.prev,o,l.prev)<0&&M(l.next,o,o.next)<0)))&&(s=r,p=t)}}while((r=r.next)!==u);return s}(e,t);if(!r)return t;t=ka(r,e);return fa(t,t.next),fa(r,r.next)}(s[e],t);return t}(n,e,r,i)),n.length>80*i){o=1/0,l=1/0;let t=-1/0,r=-1/0;for(let e=i;e<s;e+=i){const i=n[e],s=n[e+1];i<o&&(o=i),s<l&&(l=s),i>t&&(t=i),s>r&&(r=s)}u=0!==(u=Math.max(t-o,r-l))?32767/u:0}return ya(r,a,i,o,l,u,0),a}function da(t,a,r,n,e){let i;if(e===0<function(r,n,i){let s=0;for(let e=a,t=n-i;e<n;e+=i)s+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return s}(t,r,n))for(let e=a;e<r;e+=n)i=Aa(e/n|0,t[e],t[e+1],i);else for(let e=r-n;e>=a;e-=n)i=Aa(e/n|0,t[e],t[e+1],i);return i&&va(i,i.next)&&(Ia(i),i=i.next),i}function fa(e,t){if(!e)return e;t=t||e;let r,n=e;do{if(r=!1,n.steiner||!va(n,n.next)&&0!==M(n.prev,n,n.next))n=n.next;else{if(Ia(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function ya(t,r,n,i,s,a,o){if(t){if(!o&&a){var l=t;var u=i;var c=s;var h=a;let e=l;for(;0===e.z&&(e.z=ga(e.x,e.y,u,c,h)),e.prevZ=e.prev,e.nextZ=e.next,(e=e.next)!==l;);e.prevZ.nextZ=null,e.prevZ=null;{var p=e;let a,o=1;do{let n,i=p,s=p=null;for(a=0;i;){a++;let t=i,r=0;for(let e=0;e<o&&(r++,t=t.nextZ);e++);let e=o;for(;0<r||0<e&&t;)0!==r&&(0===e||!t||i.z<=t.z)?(i=(n=i).nextZ,r--):(t=(n=t).nextZ,e--),s?s.nextZ=n:p=n,n.prevZ=s,s=n;i=t}s.nextZ=null,o*=2}while(1<a)}}let e=t;for(;t.prev!==t.next;){var d=t.prev,f=t.next;if(a?function(e,t,r,n){var i=e.prev,s=e,a=e.next;if(0<=M(i,s,a))return;var o=i.x,l=s.x,u=a.x,c=i.y,h=s.y,p=a.y,d=o<l?o<u?o:u:l<u?l:u,f=c<h?c<p?c:p:h<p?h:p,y=l<o?u<o?o:u:u<l?l:u,m=h<c?p<c?c:p:p<h?h:p,g=ga(d,f,t,r,n),x=ga(y,m,t,r,n);let v=e.prevZ,b=e.nextZ;for(;v&&v.z>=g&&b&&b.z<=x;){if(v.x>=d&&v.x<=y&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&xa(o,c,l,h,u,p,v.x,v.y)&&0<=M(v.prev,v,v.next))return;if(v=v.prevZ,b.x>=d&&b.x<=y&&b.y>=f&&b.y<=m&&b!==i&&b!==a&&xa(o,c,l,h,u,p,b.x,b.y)&&0<=M(b.prev,b,b.next))return;b=b.nextZ}for(;v&&v.z>=g;){if(v.x>=d&&v.x<=y&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&xa(o,c,l,h,u,p,v.x,v.y)&&0<=M(v.prev,v,v.next))return;v=v.prevZ}for(;b&&b.z<=x;){if(b.x>=d&&b.x<=y&&b.y>=f&&b.y<=m&&b!==i&&b!==a&&xa(o,c,l,h,u,p,b.x,b.y)&&0<=M(b.prev,b,b.next))return;b=b.nextZ}return 1}(t,i,s,a):function(e){var t=e.prev,r=e,e=e.next;if(0<=M(t,r,e))return;var n=t.x,i=r.x,s=e.x,a=t.y,o=r.y,l=e.y,u=n<i?n<s?n:s:i<s?i:s,c=a<o?a<l?a:l:o<l?o:l,h=i<n?s<n?n:s:s<i?i:s,p=o<a?l<a?a:l:l<o?o:l;let d=e.next;for(;d!==t;){if(d.x>=u&&d.x<=h&&d.y>=c&&d.y<=p&&xa(n,a,i,o,s,l,d.x,d.y)&&0<=M(d.prev,d,d.next))return;d=d.next}return 1}(t))r.push(d.i,t.i,f.i),Ia(t),t=f.next,e=f.next;else if((t=f)===e){o?1===o?ya(t=function(e,t){let r=e;do{var n=r.prev,i=r.next.next;!va(n,i)&&ba(n,r,r.next,i)&&Sa(n,i)&&Sa(i,n)&&(t.push(n.i,r.i,i.i),Ia(r),Ia(r.next),r=e=i),r=r.next}while(r!==e);return fa(r)}(fa(t),r),r,n,i,s,a,2):2===o&&function(e,t,r,n,i,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){var o;if(a.i!==e.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&ba(r,r.next,e,t))return 1}while((r=r.next)!==e)}(e,t)&&(Sa(e,t)&&Sa(t,e)&&function(e,t){let r=e,n=!1;for(var i=(e.x+t.x)/2,s=(e.y+t.y)/2;r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),(r=r.next)!==e;);return n}(e,t)&&(M(e.prev,e,t.prev)||M(e,t.prev,t))||va(e,t)&&0<M(e.prev,e,e.next)&&0<M(t.prev,t,t.next))}(a,e))return o=ka(a,e),a=fa(a,a.next),o=fa(o,o.next),ya(a,t,r,n,i,s,0),ya(o,t,r,n,i,s,0);e=e.next}}while(a=a.next,a!==e)}(t,r,n,i,s,a):ya(fa(t),r,n,i,s,a,1);break}}}}function ma(e,t){return e.x-t.x}function ga(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xa(e,t,r,n,i,s,a,o){return(e-a)*(s-o)<=(i-a)*(t-o)&&(r-a)*(t-o)<=(e-a)*(n-o)&&(i-a)*(n-o)<=(r-a)*(s-o)}function M(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function va(e,t){return e.x===t.x&&e.y===t.y}function ba(e,t,r,n){var i=_a(M(e,t,r)),s=_a(M(e,t,n)),a=_a(M(r,n,e)),o=_a(M(r,n,t));return i!==s&&a!==o||0===i&&wa(e,r,t)||0===s&&wa(e,n,t)||0===a&&wa(r,e,n)||0===o&&wa(r,t,n)}function wa(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function _a(e){return 0<e?1:e<0?-1:0}function Sa(e,t){return M(e.prev,e,e.next)<0?0<=M(e,t,e.next)&&0<=M(e,e.prev,t):M(e,t,e.prev)<0||M(e,e.next,t)<0}function ka(e,t){const r=Ma(e.i,e.x,e.y),n=Ma(t.i,t.x,t.y),i=e.next,s=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(s.next=n).prev=s,n}function Aa(e,t,r,n){const i=Ma(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function Ia(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ma(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function za(e,t,r){const n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(e+"-pattern");t.isConstant()||(i=!0);var s=t.constantOr(null);s&&(i=!0,n[s.to]=!0,n[s.from]=!0)}return i}function Pa(e,n,i,s,a){const o=a.patternDependencies;for(const l of n){const n=l.paint.get(e+"-pattern").value;if("constant"!==n.kind){let e=n.evaluate({zoom:s-1},i,{},a.availableImages),t=n.evaluate({zoom:s},i,{},a.availableImages),r=n.evaluate({zoom:s+1},i,{},a.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,r=r&&r.name?r.name:r,o[e]=!0,o[t]=!0,o[r]=!0,i.patterns[l.id]={min:e,mid:t,max:r}}}return i}class Ca{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ki,this.indexArray=new os,this.indexArray2=new ls,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new I,this.segments2=new I,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=za("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),i=!n.isConstant(),s=[];for(var{feature:a,id:o,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Ts(a,e);var c;this.layers[0]._featureFilter.filter(new k(this.zoom),h,r)&&(c=i?n.evaluate(h,{},r,t.availableImages):void 0,o={id:o,properties:a.properties,type:a.type,sourceLayerIndex:u,index:l,geometry:e?h.geometry:Vs(a),patterns:{},sortKey:c},s.push(o))}i&&s.sort((e,t)=>e.sortKey-t.sortKey);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:p}=n;if(this.hasPattern){const e=Pa("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,{});t.featureIndex.insert(e[s].feature,i,s,p,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ha),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,n,i,s){for(const t of Lt(r,500)){let e=0;for(const n of t)e+=n.length;const n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),i=n.vertexLength,s=[],o=[];for(const r of t)if(0!==r.length){r!==t[0]&&o.push(s.length/2);const n=this.segments2.prepareSegment(r.length,this.layoutVertexArray,this.indexArray2),i=n.vertexLength;this.layoutVertexArray.emplaceBack(r[0].x,r[0].y),this.indexArray2.emplaceBack(i+r.length-1,i),s.push(r[0].x),s.push(r[0].y);for(let e=1;e<r.length;e++)this.layoutVertexArray.emplaceBack(r[e].x,r[e].y),this.indexArray2.emplaceBack(i+e-1,i+e),s.push(r[e].x),s.push(r[e].y);n.vertexLength+=r.length,n.primitiveLength+=r.length}var a=pa(s,o);for(let e=0;e<a.length;e+=3)this.indexArray.emplaceBack(i+a[e],i+a[e+1],i+a[e+2]);n.vertexLength+=e,n.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,i)}}let Ba,Va;r("FillBucket",Ca,{omit:["layers","patternFeatures"]});var Ta={get paint(){return Va=Va||new a({"fill-antialias":new n(s.paint_fill["fill-antialias"]),"fill-opacity":new i(s.paint_fill["fill-opacity"]),"fill-color":new i(s.paint_fill["fill-color"]),"fill-outline-color":new i(s.paint_fill["fill-outline-color"]),"fill-translate":new n(s.paint_fill["fill-translate"]),"fill-translate-anchor":new n(s.paint_fill["fill-translate-anchor"]),"fill-pattern":new ai(s.paint_fill["fill-pattern"])})},get layout(){return Ba=Ba||new a({"fill-sort-key":new i(s.layout_fill["fill-sort-key"])})}};class Ea extends ci{constructor(e){super(e,Ta)}recalculate(e,t){super.recalculate(e,t);e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ca(e)}queryRadius(){return Us(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,s,a){return Ds(Ns(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,a),n)}isTileClipped(){return!0}}const Fa=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Da=A([{name:"a_centroid",components:2,type:"Int16"}],4),La=Fa["members"];var Oa={},$a=C,dt=Ra;function Ra(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(ja,this,t)}function ja(e,t,r){if(1==e)t.id=r.readVarint();else if(2!=e)3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos);else for(var n=r,i=t,s=n.readVarint()+n.pos;n.pos<s;){var a=i._keys[n.readVarint()],o=i._values[n.readVarint()];i.properties[a]=o}}Ra.types=["Unknown","Point","LineString","Polygon"],Ra.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r,n=e.readVarint()+e.pos,i=1,s=0,a=0,o=0,l=[];e.pos<n;)if(s<=0&&(i=7&(r=e.readVarint()),s=r>>3),s--,1===i||2===i)a+=e.readSVarint(),o+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new $a(a,o));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}return t&&l.push(t),l},Ra.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,i=0,s=0,a=0,o=1/0,l=-1/0,u=1/0,c=-1/0;e.pos<r;)if(i<=0&&(n=7&(t=e.readVarint()),i=t>>3),i--,1===n||2===n)(s+=e.readSVarint())<o&&(o=s),l<s&&(l=s),(a+=e.readSVarint())<u&&(u=a),c<a&&(c=a);else if(7!==n)throw new Error("unknown command "+n);return[o,u,l,c]},Ra.prototype.toGeoJSON=function(e,t,r){var n,i=this.extent*Math.pow(2,r),s=this.extent*e,a=this.extent*t,o=this.loadGeometry(),r=Ra.types[this.type];function l(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+s)/i-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+a)/i)*Math.PI/180))-90]}}switch(this.type){case 1:for(var u=[],c=0;c<o.length;c++)u[c]=o[c][0];l(o=u);break;case 2:for(c=0;c<o.length;c++)l(o[c]);break;case 3:for(o=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],s=0;s<t;s++){var a=function(e){for(var t,r,n=0,i=0,s=e.length,a=s-1;i<s;a=i++)n+=((r=e[a]).x-(t=e[i]).x)*(t.y+r.y);return n}(e[s]);0!==a&&((n=void 0===n?a<0:n)===a<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}return r&&i.push(r),i}(o),c=0;c<o.length;c++)for(n=0;n<o[c].length;n++)l(o[c][n])}1===o.length?o=o[0]:r="Multi"+r;e={type:"Feature",geometry:{type:r,coordinates:o},properties:this.properties};return"id"in this&&(e.id=this.id),e};var qa=dt,mt=Ua;function Ua(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Na,this,t),this.length=this._features.length}function Na(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;)var n=e.readVarint()>>3,t=1==n?e.readString():2==n?e.readFloat():3==n?e.readDouble():4==n?e.readVarint64():5==n?e.readVarint():6==n?e.readSVarint():7==n?e.readBoolean():null;return t}(r))}Ua.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new qa(this._pbf,e,this.extent,this._keys,this._values)};var Za=mt;function Ga(e,t,r){3===e&&(e=new Za(r,r.readVarint()+r.pos)).length&&(t[e.name]=e)}Oa.VectorTile=function(e,t){this.layers=e.readFields(Ga,{},t)},Oa.VectorTileFeature=dt,Oa.VectorTileLayer=mt;const Xa=Oa.VectorTileFeature.types,Ha=Math.pow(2,13);function Ya(e,t,r,n,i,s,a,o){e.emplaceBack(t,r,2*Math.floor(n*Ha)+a,i*Ha*2,s*Ha*2,Math.round(o))}class Ja{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Wi,this.centroidVertexArray=new Yi,this.indexArray=new os,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new I,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.features=[],this.hasPattern=za("fill-extrusion",this.layers,t);for(var{feature:n,id:i,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,o=Ts(n,e);this.layers[0]._featureFilter.filter(new k(this.zoom),o,r)&&(i={id:i,sourceLayerIndex:a,index:s,geometry:e?o.geometry:Vs(n),properties:n.properties,type:n.type,patterns:{}},this.hasPattern?this.features.push(Pa("fill-extrusion",this.layers,i,this.zoom,t)):this.addFeature(i,i.geometry,s,r,{}),t.featureIndex.insert(n,i.geometry,s,a,this.index,!0))}}addFeatures(e,t,r){for(const e of this.features){var n=e["geometry"];this.addFeature(e,n,e.index,t,r)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,La),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Da.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,i,t,s,e){for(const t of Lt(i,500)){const i={x:0,y:0,vertexCount:0};let e=0;for(const n of t)e+=n.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const n of t)if(0!==n.length&&!((u=n).every(e=>e.x<0)||u.every(e=>e.x>ue)||u.every(e=>e.y<0)||u.every(e=>e.y>ue))){let t=0;for(let e=0;e<n.length;e++){const c=n[e];if(1<=e){const h=n[e-1];if(o=c,l=h,!(o.x===l.x&&(o.x<0||o.x>ue)||o.y===l.y&&(o.y<0||o.y>ue))){r.vertexLength+4>I.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const n=c.sub(h)._perp()._unit(),s=h.dist(c);32768<t+s&&(t=0),Ya(this.layoutVertexArray,c.x,c.y,n.x,n.y,0,0,t),Ya(this.layoutVertexArray,c.x,c.y,n.x,n.y,0,1,t),i.x+=2*c.x,i.y+=2*c.y,i.vertexCount+=2,t+=s,Ya(this.layoutVertexArray,h.x,h.y,n.x,n.y,0,0,t),Ya(this.layoutVertexArray,h.x,h.y,n.x,n.y,0,1,t),i.x+=2*h.x,i.y+=2*h.y,i.vertexCount+=2;l=r.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+e>I.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"===Xa[n.type]){const p=[],d=[],f=r.vertexLength;for(const n of t)if(0!==n.length){n!==t[0]&&d.push(p.length/2);for(let e=0;e<n.length;e++){const s=n[e];Ya(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),i.x+=s.x,i.y+=s.y,i.vertexCount+=1,p.push(s.x),p.push(s.y)}}var a=pa(p,d);for(let e=0;e<a.length;e+=3)this.indexArray.emplaceBack(f+a[e],f+a[e+2],f+a[e+1]);r.primitiveLength+=a.length/3,r.vertexLength+=e;for(let e=0;e<i.vertexCount;e++){const n=Math.floor(i.x/i.vertexCount),t=Math.floor(i.y/i.vertexCount);this.centroidVertexArray.emplaceBack(n,t)}}}var o,l,u;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,t,e,s)}}let Ka;r("FillExtrusionBucket",Ja,{omit:["layers","features"]});var Wa={get paint(){return Ka=Ka||new a({"fill-extrusion-opacity":new n(s["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new i(s["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new n(s["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new n(s["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ai(s["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new i(s["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new i(s["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new n(s["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Qa extends ci{constructor(e){super(e,Wa)}createBucket(e){return new Ja(e)}queryRadius(){return Us(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,n,t,i,s,a,o){e=Ns(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),s=this.paint.get("fill-extrusion-height").evaluate(r,n),a=this.paint.get("fill-extrusion-base").evaluate(r,n),r=function(e,t){const r=[];for(const n of e){const e=[n.x,n.y,0,1];Ys(e,e,t),r.push(new L(e[0]/e[3],e[1]/e[3]))}return r}(e,o),n=function(e,t,r,n){const i=[],s=[],a=n[8]*t,o=n[9]*t,l=n[10]*t,u=n[11]*t,c=n[8]*r,h=n[9]*r,p=n[10]*r,d=n[11]*r;for(const t of e){const e=[],r=[];for(const i of t){const t=i.x,s=i.y,f=n[0]*t+n[4]*s+n[12],y=n[1]*t+n[5]*s+n[13],m=n[2]*t+n[6]*s+n[14],g=n[3]*t+n[7]*s+n[15],x=m+l,v=g+u,b=f+c,w=y+h,_=m+p,S=g+d,k=new L((f+a)/v,(y+o)/v),A=(k.z=x/v,e.push(k),new L(b/S,w/S));A.z=_/S,r.push(A)}i.push(e),s.push(r)}return[i,s]}(t,a,s,o);{var l=n[0],u=n[1],c=r;let t=1/0;Ds(c,u)&&(t=to(c,u[0]));for(let e=0;e<u.length;e++){var h=u[e],p=l[e];for(let e=0;e<h.length-1;e++){const u=h[e],d=[u,h[e+1],p[e+1],p[e],u];!function(t,r){for(let e=0;e<t.length;e++)if(js(r,t[e]))return 1;for(let e=0;e<r.length;e++)if(js(t,r[e]))return 1;return Ls(t,r)}(c,d)||(t=Math.min(t,to(c,d)))}}return t!==1/0&&t}}}function eo(e,t){return e.x*t.x+e.y*t.y}function to(r,n){if(1===r.length){let e=0;const i=n[e++];let t;for(;!t||i.equals(t);)if(!(t=n[e++]))return 1/0;for(;e<n.length;e++){const s=n[e],a=r[0],o=t.sub(i),l=s.sub(i),u=a.sub(i),c=eo(o,o),h=eo(o,l),p=eo(l,l),d=eo(u,o),f=eo(u,l),y=c*p-h*h,m=(p*d-h*f)/y,g=(c*f-h*d)/y,x=i.z*(1-m-g)+t.z*m+s.z*g;if(isFinite(x))return x}return 1/0}{let e=1/0;for(const t of n)e=Math.min(e,t.z);return e}}const ro=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),no=ro["members"],io=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),so=io["members"],ao=Oa.VectorTileFeature.types,oo=Math.cos(Math.PI/180*37.5),lo=Math.pow(2,14)/.5;class uo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Qi,this.layoutVertexArray2=new es,this.indexArray=new os,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new I,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=za("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),i=!n.isConstant(),s=[];for(const{feature:t,id:o,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ts(t,e);var a;this.layers[0]._featureFilter.filter(new k(this.zoom),c,r)&&(a=i?n.evaluate(c,{},r):void 0,a={id:o,properties:t.properties,type:t.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:Vs(t),patterns:{},sortKey:a},s.push(a))}i&&s.sort((e,t)=>e.sortKey-t.sortKey);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:h}=n;if(this.hasPattern){const e=Pa("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,{});t.featureIndex.insert(e[s].feature,i,s,h,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,so)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,no),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,n,i){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),o=s.get("line-cap"),l=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,a,o,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,n)}addLine(l,u,c,h,p,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<l.length-1;e++)this.totalDistance+=l[e].dist(l[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var f="Polygon"===ao[u.type];let y=l.length;for(;2<=y&&l[y-1].equals(l[y-2]);)y--;let m=0;for(;m<y-1&&l[m].equals(l[m+1]);)m++;if(!(y<(f?3:2))){"bevel"===c&&(p=1.05);var g=this.overscaling<=16?15*ue/(512*this.overscaling):0,x=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let n,i,s,a,o;this.e1=this.e2=-1,f&&(n=l[y-2],o=l[m].sub(n)._unit()._perp());for(let r=m;r<y;r++)if(!(s=r===y-1?f?l[m+1]:void 0:l[r+1])||!l[r].equals(s)){o&&(a=o),n&&(i=n),n=l[r],o=s?s.sub(n)._unit()._perp():a;let e=(a=a||o).add(o);0===e.x&&0===e.y||e._unit();var v=a.x*o.x+a.y*o.y,b=e.x*o.x+e.y*o.y,w=0!=b?1/b:1/0,_=2*Math.sqrt(2-2*b),b=b<oo&&i&&s,S=0<a.x*o.y-a.y*o.x;if(b&&r>m){const l=n.dist(i);if(l>2*g){const u=n.sub(n.sub(i)._mult(g/l)._round());this.updateDistance(i,u),this.addCurrentVertex(u,a,0,0,x),i=u}}var k=i&&s;let t=k?c:f?"butt":h;if(k&&"round"===t&&(w<d?t="miter":w<=2&&(t="fakeround")),"bevel"===(t="miter"===t&&p<w?"bevel":t)&&(2<w&&(t="flipbevel"),w<p&&(t="miter")),i&&this.updateDistance(i,n),"miter"===t)e._mult(w),this.addCurrentVertex(n,e,0,0,x);else if("flipbevel"===t){if(100<w)e=o.mult(-1);else{const l=w*a.add(o).mag()/a.sub(o).mag();e._perp()._mult(l*(S?-1:1))}this.addCurrentVertex(n,e,0,0,x),this.addCurrentVertex(n,e.mult(-1),0,0,x)}else if("bevel"===t||"fakeround"===t){const l=-Math.sqrt(w*w-1),u=S?l:0,c=S?0:l;if(i&&this.addCurrentVertex(n,a,u,c,x),"fakeround"===t){const l=Math.round(180*_/Math.PI/20);for(let t=1;t<l;t++){let e=t/l;if(.5!==e){const l=e-.5;e+=e*l*(e-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*l*l+(.848013+v*(.215638*v-1.06021)))}const h=o.sub(a)._mult(e)._add(a)._unit()._mult(S?-1:1);this.addHalfVertex(n,h.x,h.y,!1,S,0,x)}}s&&this.addCurrentVertex(n,o,-u,-c,x)}else if("butt"===t)this.addCurrentVertex(n,e,0,0,x);else if("square"===t){const l=i?1:-1;this.addCurrentVertex(n,e,l,l,x)}else"round"===t&&(i&&(this.addCurrentVertex(n,a,0,0,x),this.addCurrentVertex(n,a,1,1,x,!0)),s&&(this.addCurrentVertex(n,o,-1,-1,x,!0),this.addCurrentVertex(n,o,0,0,x)));if(b&&r<y-1){const l=n.dist(s);if(l>2*g){const u=n.add(s.sub(n)._mult(g/l)._round());this.updateDistance(n,u),this.addCurrentVertex(u,o,0,0,x),n=u}}}}}addCurrentVertex(e,t,r,n,i,s=!1){var a=t.y*n-t.x,o=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,s,!1,r,i),this.addHalfVertex(e,a,o,s,!0,-n,i),this.distance>lo/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,r,n,i,s))}addHalfVertex({x:e,y:t},r,n,i,s,a,o){var l=.5*(this.lineClips?this.scaledDistance*(lo-1):this.scaledDistance),e=(this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length),o.vertexLength++);0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,e),o.primitiveLength++),s?this.e2=e:this.e1=e}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let co,ho;r("LineBucket",uo,{omit:["layers","patternFeatures"]});var po={get paint(){return ho=ho||new a({"line-opacity":new i(s.paint_line["line-opacity"]),"line-color":new i(s.paint_line["line-color"]),"line-translate":new n(s.paint_line["line-translate"]),"line-translate-anchor":new n(s.paint_line["line-translate-anchor"]),"line-width":new i(s.paint_line["line-width"]),"line-gap-width":new i(s.paint_line["line-gap-width"]),"line-offset":new i(s.paint_line["line-offset"]),"line-blur":new i(s.paint_line["line-blur"]),"line-dasharray":new oi(s.paint_line["line-dasharray"]),"line-pattern":new ai(s.paint_line["line-pattern"]),"line-gradient":new li(s.paint_line["line-gradient"])})},get layout(){return co=co||new a({"line-cap":new n(s.layout_line["line-cap"]),"line-join":new i(s.layout_line["line-join"]),"line-miter-limit":new n(s.layout_line["line-miter-limit"]),"line-round-limit":new n(s.layout_line["line-round-limit"]),"line-sort-key":new i(s.layout_line["line-sort-key"])})}};class fo extends i{possiblyEvaluate(e,t){return t=new k(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=D({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}let yo;class mo extends ci{constructor(e){super(e,po),this.gradientVersion=0,yo||((yo=new fo(po.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!(void 0===e._styleExpression)&&e._styleExpression.expression instanceof tt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=yo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new uo(e)}queryRadius(e){var t=go(qs("line-width",this,e),qs("line-gap-width",this,e)),e=qs("line-offset",this,e);return t/2+Math.abs(e)+Us(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,s,a){var e=Ns(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),s=a/2*go(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),t=this.paint.get("line-offset").evaluate(t,r),o=(t&&(n=function(t,r){const n=[];for(let e=0;e<t.length;e++){const i=t[e],s=[];for(let e=0;e<i.length;e++){const n=i[e-1],a=i[e],o=i[e+1],l=0===e?new L(0,0):a.sub(n)._unit()._perp(),u=e===i.length-1?new L(0,0):o.sub(a)._unit()._perp(),c=l._add(u)._unit(),h=c.x*u.x+c.y*u.y;0!=h&&c._mult(1/h),s.push(c._mult(r)._add(a))}n.push(s)}return n}(n,t*a)),e),l=n,u=s;for(let e=0;e<l.length;e++){var c=l[e];if(3<=o.length)for(let e=0;e<c.length;e++)if(js(o,c[e]))return!0;if(function(t,r,n){if(1<t.length){if(Ls(t,r))return 1;for(let e=0;e<r.length;e++)if(Os(r[e],t,n))return 1}for(let e=0;e<t.length;e++)if(Os(t[e],r,n))return 1}(o,c,u))return!0}return!1}isTileClipped(){return!0}}function go(e,t){return 0<t?t+2*e:e}const xo=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vo=A([{name:"a_projected_pos",components:3,type:"Float32"}],4),bo=(A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}])),wo=(A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4));A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _o={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function So(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,i=e[t+h];for(h+=p,s=i&(1<<-c)-1,i>>=-c,c+=o;0<c;s=256*s+e[t+h],h+=p,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;0<c;a=256*a+e[t+h],h+=p,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(i?-1:1);a+=Math.pow(2,n),s-=u}return(i?-1:1)*a*Math.pow(2,s-n)}function ko(e,t,r,n,i,s){var a,o,l=8*s-i-1,u=(1<<l)-1,c=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,d=n?1:-1,s=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+c?h/n:h*Math.pow(2,1-c))*n&&(a++,n/=2),u<=a+c?(o=0,a=u):1<=a+c?(o=(t*n-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));8<=i;e[r+p]=255&o,p+=d,o/=256,i-=8);for(a=a<<i|o,l+=i;0<l;e[r+p]=255&a,p+=d,a/=256,l-=8);e[r+p-d]|=128*s}var ce=24,yt=z;function z(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}z.Varint=0,z.Fixed64=1,z.Bytes=2,z.Fixed32=5;var Ao=4294967296,Io=1/Ao,Mo="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function zo(e){return e.type===z.Bytes?e.readVarint()+e.pos:e.pos+1}function Po(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Co(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;e<=i;i--)r.buf[i+n]=r.buf[i]}function Bo(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Vo(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function To(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Eo(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Fo(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Do(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Lo(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Oo(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function $o(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Ro(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function jo(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function qo(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}z.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,e(i,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ro(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=qo(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ro(this.buf,this.pos)+Ro(this.buf,this.pos+4)*Ao;return this.pos+=8,e},readSFixed64:function(){var e=Ro(this.buf,this.pos)+qo(this.buf,this.pos+4)*Ao;return this.pos+=8,e},readFloat:function(){var e=So(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=So(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r=127&(n=t[this.pos++]);{if(n<128)return r;if(r|=(127&(n=t[this.pos++]))<<7,n<128)return r;if(r|=(127&(n=t[this.pos++]))<<14,n<128)return r;if(r|=(127&(n=t[this.pos++]))<<21,n<128)return r;var n=r|=(15&t[this.pos])<<28;t=e;var i,e=(r=this).buf,s=(112&(i=e[r.pos++]))>>4;if(i<128)return Po(n,s,t);if(s|=(127&(i=e[r.pos++]))<<3,i<128)return Po(n,s,t);if(s|=(127&(i=e[r.pos++]))<<10,i<128)return Po(n,s,t);if(s|=(127&(i=e[r.pos++]))<<17,i<128)return Po(n,s,t);if(s|=(127&(i=e[r.pos++]))<<24,i<128)return Po(n,s,t);if(s|=(1&(i=e[r.pos++]))<<31,i<128)return Po(n,s,t);throw new Error("Expected varint not more than 10 bytes")}},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e,t=this.readVarint()+this.pos,r=this.pos;if(12<=(this.pos=t)-r&&Mo)return e=this.buf,Mo.decode(e.subarray(r,t));for(var n=this.buf,i=t,s="",a=r;a<i;){var o,l,u,c=n[a],h=null,p=239<c?4:223<c?3:191<c?2:1;if(i<a+p)break;1===p?c<128&&(h=c):2===p?128==(192&(o=n[a+1]))&&(h=(31&c)<<6|63&o)<=127&&(h=null):3===p?(l=n[a+2],128==(192&(o=n[a+1]))&&128==(192&l)&&((h=(15&c)<<12|(63&o)<<6|63&l)<=2047||55296<=h&&h<=57343)&&(h=null)):4===p&&(l=n[a+2],u=n[a+3],128==(192&(o=n[a+1]))&&128==(192&l)&&128==(192&u)&&((h=(15&c)<<18|(63&o)<<12|(63&l)<<6|63&u)<=65535||1114112<=h)&&(h=null)),null===h?(h=65533,p=1):65535<h&&(h-=65536,s+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),s+=String.fromCharCode(h),a+=p}return s},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==z.Bytes)return e.push(this.readVarint(t));var r=zo(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==z.Bytes)return e.push(this.readSVarint());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==z.Bytes)return e.push(this.readBoolean());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==z.Bytes)return e.push(this.readFloat());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==z.Bytes)return e.push(this.readDouble());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==z.Bytes)return e.push(this.readFixed32());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==z.Bytes)return e.push(this.readSFixed32());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==z.Bytes)return e.push(this.readFixed64());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==z.Bytes)return e.push(this.readSFixed64());var t=zo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){e&=7;if(e===z.Varint)for(;127<this.buf[this.pos++];);else if(e===z.Bytes)this.pos=this.readVarint()+this.pos;else if(e===z.Fixed32)this.pos+=4;else{if(e!==z.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,r=this.length||16;r<this.pos+e;)r*=2;r!==this.length&&((t=new Uint8Array(r)).set(this.buf),this.buf=t,this.length=r)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),jo(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),jo(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),jo(this.buf,-1&e,this.pos),jo(this.buf,Math.floor(e*Io),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),jo(this.buf,-1&e,this.pos),jo(this.buf,Math.floor(e*Io),this.pos+4),this.pos+=8},writeVarint:function(e){if(268435455<(e=+e||0)||e<0){var t,r,n,i,s=this;if(0<=e?(n=e%4294967296|0,t=e/4294967296|0):(t=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:t=t+1|(n=0)),0x10000000000000000<=e||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),n=n,(i=s).buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,i.buf[i.pos]=127&(n>>>=7),r=(7&(i=t))<<4,(s=s).buf[s.pos++]|=r|((i>>>=3)?128:0),i&&(s.buf[s.pos++]=127&i|((i>>>=7)?128:0),i&&(s.buf[s.pos++]=127&i|((i>>>=7)?128:0),i&&(s.buf[s.pos++]=127&i|((i>>>=7)?128:0),i&&(s.buf[s.pos++]=127&i|((i>>>=7)?128:0),i&&(s.buf[s.pos++]=127&i)))))}else this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),void(e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos,e=(this.pos=function(e,t,r){for(var n,i,s=0;s<t.length;s++){if(55295<(n=t.charCodeAt(s))&&n<57344){if(!i){56319<n||s+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos),this.pos-t);128<=e&&Co(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(e){this.realloc(4),ko(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ko(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos,e=(e(t,this),this.pos-r);128<=e&&Co(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeMessage:function(e,t,r){this.writeTag(e,z.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Bo,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Vo,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Fo,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,To,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Eo,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Do,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Lo,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Oo,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,$o,t)},writeBytesField:function(e,t){this.writeTag(e,z.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,z.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,z.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,z.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,z.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,z.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,z.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,z.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,z.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,z.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var he,Uo=P(yt);const No=3;function Zo(e){let t=0,r=0;for(const n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort((e,t)=>t.h-e.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,s=0;for(const t of e)for(let e=n.length-1;0<=e;e--){const r=n[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,s=Math.max(s,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===r.w&&t.h===r.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):(t.w!==r.w&&n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:i,h:s,fill:t/(i*s)||0}}const J=1;class Go{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:s,textFitWidth:a,textFitHeight:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=s,this.version=r,this.textFitWidth=a,this.textFitHeight=o}get tl(){return[this.paddedRect.x+J,this.paddedRect.y+J]}get br(){return[this.paddedRect.x+this.paddedRect.w-J,this.paddedRect.y+this.paddedRect.h-J]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*J)/this.pixelRatio,(this.paddedRect.h-2*J)/this.pixelRatio]}}class Xo{constructor(e,t){const r={},n={},i=(this.haveRenderCallbacks=[],[]),{w:s,h:a}=(this.addImages(e,r,i),this.addImages(t,n,i),Zo(i)),o=new sa({width:s||1,height:a||1});for(const t in e){const n=e[t],i=r[t].paddedRect;sa.copy(n.data,o,{x:0,y:0},{x:i.x+J,y:i.y+J},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,s=i.x+J,a=i.y+J,l=r.data.width,u=r.data.height;sa.copy(r.data,o,{x:0,y:0},{x:s,y:a},r.data),sa.copy(r.data,o,{x:0,y:u-1},{x:s,y:a-1},{width:l,height:1}),sa.copy(r.data,o,{x:0,y:0},{x:s,y:a+u},{width:l,height:1}),sa.copy(r.data,o,{x:l-1,y:0},{x:s-1,y:a},{width:1,height:u}),sa.copy(r.data,o,{x:0,y:0},{x:s+l,y:a},{width:1,height:u})}this.image=o,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const s in e){var n=e[s],i={x:0,y:0,w:n.data.width+2*J,h:n.data.height+2*J};r.push(i),t[s]=new Go(i,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){var n;e&&t&&e.version!==t.version&&(e.version=t.version,[e,n]=e.tl,r.update(t.data,void 0,{x:e,y:n}))}}r("ImagePosition",Go),r("ImageAtlas",Xo),(e=he=he||{})[e.none=0]="none",e[e.horizontal=1]="horizontal",e[e.vertical=2]="vertical",e[e.horizontalOnly=3]="horizontalOnly";const Ho=-17;class Yo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Yo;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Yo;return t.imageName=e,t}}class Jo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const n=new Jo;for(let e=0;e<t.sections.length;e++){var i=t.sections[e];i.image?n.addImageSection(i):n.addTextSection(i,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(t){let r="";for(let e=0;e<t.length;e++){var n=t.charCodeAt(e+1)||null,i=t.charCodeAt(e-1)||null;r+=n&&Yn(n)&&!_o[t[e+1]]||i&&Yn(i)&&!_o[t[e-1]]||!_o[t[e]]?t[e]:_o[t[e]]}return r}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&Wo[this.text.charCodeAt(e)];e++)t++;let r=this.text.length;for(let e=this.text.length-1;0<=e&&e>=t&&Wo[this.text.charCodeAt(e)];e--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(e,t){const r=new Jo;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Yo.forText(t.scale,t.fontStack||e));var r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r)}addImageSection(e){var t,e=e.image?e.image.name:"";0===e.length?le("Can't add FormattedSection with an empty image."):(t=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(t),this.sections.push(Yo.forImage(e)),this.sectionIndex.push(this.sections.length-1)):le("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ko(n,i,L,s,a,o,O,$,R,l,h,p,j,d,q){const e=Jo.fromFeature(n,a);let f;p===he.vertical&&e.verticalizePunctuation();const{processBidirectionalText:t,processStyledBidirectionalText:r}=Y;if(t&&1===e.sections.length){f=[];const n=t(e.toString(),il(e,l,o,i,s,d));for(const i of n){const n=new Jo;n.text=i,n.sections=e.sections;for(let e=0;e<i.length;e++)n.sectionIndex.push(0);f.push(n)}}else if(r){f=[];const n=r(e.text,e.sectionIndex,il(e,l,o,i,s,d));for(const i of n){const n=new Jo;n.text=i[0],n.sectionIndex=i[1],n.sections=e.sections,f.push(n)}}else f=function(e,t){const r=[],n=e.text;let i=0;for(const n of t)r.push(e.substring(i,n)),i=n;return i<n.length&&r.push(e.substring(i,n.length)),r}(e,il(e,l,o,i,s,d));var y,u=[],n={positionedLines:u,text:e.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:p,iconsInText:!1,verticalizable:!1};{var m=n,g=i,x=L,v=s,b=f,w=O,_=$,S=R,U=p,k=l,A=j,N=q;let u=0,c=Ho,e=0,t=0;const T="right"===S?1:"left"===S?0:.5;let r=0;for(const _ of b){_.trim();const b=_.getMaxScale(),S=(b-1)*ce,E={positionedGlyphs:[],lineOffset:0},F=(m.positionedLines[r]=E).positionedGlyphs;let l=0;if(_.length()){for(let o=0;o<_.length();o++){const e=_.getSection(o),t=_.getSectionIndex(o),T=_.getCharCode(o);let r=0,n=null,i=null,s=null,a=ce;y=!(U===he.horizontal||!A&&!Hn(T)||A&&(Wo[T]||(y=T,/\p{sc=Arab}/u.test(String.fromCodePoint(y)))));if(e.imageName){const g=v[e.imageName];if(!g)continue;s=e.imageName,m.iconsInText=m.iconsInText||!0,i=g.paddedRect;const x=g.displaySize,w=(e.scale=e.scale*ce/N,n={width:x[0],height:x[1],left:J,top:-No,advance:y?x[1]:x[0]},r=S+(ce-x[1]*e.scale),a=n.advance,y?x[0]*e.scale-ce*b:x[1]*e.scale-ce*b);0<w&&w>l&&(l=w)}else{const m=x[e.fontStack],v=m&&m[T];if(v&&v.rect)i=v.rect,n=v.metrics;else{const m=g[e.fontStack],x=m&&m[T];if(!x)continue;n=x.metrics}r=(b-e.scale)*ce}y?(m.verticalizable=!0,F.push({glyph:T,imageName:s,x:u,y:c+r,vertical:y,scale:e.scale,fontStack:e.fontStack,sectionIndex:t,metrics:n,rect:i}),u+=a*e.scale+k):(F.push({glyph:T,imageName:s,x:u,y:c+r,vertical:y,scale:e.scale,fontStack:e.fontStack,sectionIndex:t,metrics:n,rect:i}),u+=n.advance*e.scale+k)}if(0!==F.length){e=Math.max(u-k,e);{I=void 0;Z=void 0;M=void 0;z=void 0;P=void 0;C=void 0;G=void 0;var I=F;var Z=0;var M=F.length-1;var z=T;var P=l;if(z||P){var C=I[M],G=(I[M].x+C.metrics.advance*C.scale)*z;for(let e=Z;e<=M;e++)I[e].x-=G,I[e].y+=P}}}u=0;C=w*b+l;E.lineOffset=Math.max(l,S),c+=C,t=Math.max(C,t),++r}else c+=w,++r}const E=c-Ho,{horizontalAlign:F,verticalAlign:D}=sl(_);var B=m.positionedLines,V=T,S=F,_=D,a=e,o=t,d=w,h=E,b=b.length,X=(V-S)*a,H=o!==d?-h*_-Ho:(-_*b+.5)*d;for(const V of B)for(const B of V.positionedGlyphs)B.x+=X,B.y+=H;m.top+=-D*E,m.bottom=m.top+E,m.left+=-F*e,m.right=m.left+e}return!function(){for(const e of u)if(0!==e.positionedGlyphs.length)return;return 1}()&&n}const Wo={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qo={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},el={40:!0};function tl(e,t,r,n,i,s){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*ce/s+i:0}{const n=r[t.fontStack],s=n&&n[e];return s?s.metrics.advance*t.scale+i:0}}function rl(e,t,r,n){var i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function nl(e,t,r,n,i,s){let a=null,o=rl(t,r,i,s);for(const e of n){const n=rl(t-e.x,r,i,s)+e.badness;n<=o&&(a=e,o=n)}return{index:e,x:t,priorBreak:a,badness:o}}function il(t,r,e,n,i,s){if(!t)return[];const a=[],o=function(t,r,e,n,i,s){let a=0;for(let e=0;e<t.length();e++){var o=t.getSection(e);a+=tl(t.getCharCode(e),o,n,i,r,s)}return a/Math.max(1,Math.ceil(a/e))}(t,r,e,n,i,s),l=0<=t.text.indexOf("");let u=0;for(let e=0;e<t.length();e++){var c=t.getSection(e),h=t.getCharCode(e);if(Wo[h]||(u+=tl(h,c,n,i,r,s)),e<t.length()-1){const r=!((p=h)<11904)&&(!!S["CJK Compatibility Forms"](p)||!!S["CJK Compatibility"](p)||!!S["CJK Strokes"](p)||!!S["CJK Symbols and Punctuation"](p)||!!S["Enclosed CJK Letters and Months"](p)||!!S["Halfwidth and Fullwidth Forms"](p)||!!S["Ideographic Description Characters"](p)||!!S["Vertical Forms"](p)||Xn.test(String.fromCodePoint(p)));(Qo[h]||r||c.imageName||e!==t.length()-2&&el[t.getCharCode(e+1)])&&a.push(nl(e+1,u,o,a,function(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}(h,t.getCharCode(e+1),r&&l),!1))}}var p;return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(nl(t.length(),u,o,a,0,!0))}function sl(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function al(e){let t=e.left,r=e.top,n=e.right-t,i=e.bottom-r;var s=null!=(s=e.image.textFitWidth)?s:"stretchOrShrink",a=null!=(a=e.image.textFitHeight)?a:"stretchOrShrink",o=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===a){if("stretchOnly"===s&&n/i<o||"proportional"===s){const e=Math.ceil(i*o);t*=e/n,n=e}}else if("proportional"===s&&"stretchOnly"===a&&0!=o&&n/i>o){const e=Math.ceil(n/o);r*=e/i,i=e}return{x1:t,y1:r,x2:t+n,y2:r+i}}function ol(e,t,r,n,i,s){var a=e.image;let o;if(a.content){const e=a.content,t=a.pixelRatio||1;o=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}var e=t.left*s,l=t.right*s;let u,c,h,p;c="width"===r||"both"===r?(p=i[0]+e-n[3],i[0]+l+n[1]):(p=i[0]+(e+l-a.displaySize[0])/2)+a.displaySize[0];e=t.top*s,l=t.bottom*s;return h="height"===r||"both"===r?(u=i[1]+e-n[0],i[1]+l+n[2]):(u=i[1]+(e+l-a.displaySize[1])/2)+a.displaySize[1],{image:a,top:u,right:c,bottom:h,left:p,collisionPadding:o}}const ll=255,ul=128,cl=ll*ul;function hl(r,n){const i=n["expression"];if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new k(r+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:n,interpolationType:o}=i;let e=0;for(;e<n.length&&n[e]<=r;)e++;let t=e=Math.max(0,e-1);for(;t<n.length&&n[t]<r+1;)t++;t=Math.min(n.length-1,t);var s=n[e],a=n[t];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:o}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new k(s)),maxSize:i.evaluate(new k(a)),interpolationType:o}}}function pl(e,t,r){let n="never";t=e.get(t);return t?n=t:e.get(r)&&(n="always"),n}const dl=Oa.VectorTileFeature.types,fl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yl(e,t,r,n,i,s,a,o,l,u,c,h,p){var d=o?Math.min(cl,Math.round(o[0])):0,o=o?Math.min(cl,Math.round(o[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),s,a,(d<<1)+(l?1:0),o,16*u,16*c,256*h,256*p)}function ml(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function gl(e){for(const t of e.sections)if(function(e){for(const t of e)if(Kn(t.charCodeAt(0)))return 1}(t.text))return!0;return!1}class xl{constructor(e){this.layoutVertexArray=new rs,this.indexArray=new os,this.programConfigurations=e,this.segments=new I,this.dynamicLayoutVertexArray=new ns,this.opacityVertexArray=new is,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ri}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xo.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vo.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fl,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}r("SymbolBuffers",xl);class vl{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new I,this.collisionVertexArray=new as}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,bo.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}r("CollisionBuffers",vl);class bl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hs([]),this.placementViewportMatrix=Hs([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hl(this.zoom,t["text-size"]),this.iconSizeData=hl(this.zoom,t["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap="never"!==pl(r,"text-overlap","text-allow-overlap")||"never"!==pl(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(e=>he[e])),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID}createArrays(){this.text=new xl(new zs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new xl(new zs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ui,this.lineVertexArray=new Ni,this.symbolInstances=new qi,this.textAnchorOffsets=new Gi}calculateGlyphDependencies(t,r,n,i,s){for(let e=0;e<t.length;e++)if(r[t.charCodeAt(e)]=!0,(n||i)&&s){const n=_o[t.charAt(e)];n&&(r[n.charCodeAt(0)]=!0)}}populate(r,n,i){const s=this.layers[0],a=s.layout,o=a.get("text-font"),l=a.get("text-field"),u=a.get("icon-image"),c=("constant"!==l.value.kind||l.value.value instanceof v&&!l.value.value.isEmpty()||0<l.value.value.toString().length)&&("constant"!==o.value.kind||0<o.value.value.length),h="constant"!==u.value.kind||!!u.value.value||0<Object.keys(u.parameters).length,p=a.get("symbol-sort-key");if(this.features=[],c||h){const f=n.iconDependencies,y=n.glyphDependencies,m=n.availableImages,e=new k(this.zoom);for(const{feature:n,id:l,index:u,sourceLayerIndex:g}of r){const r=s._featureFilter.needGeometry,x=Ts(n,r);if(s._featureFilter.filter(e,x,i)){let e,t;if(r||(x.geometry=Vs(n)),c){const r=s.getValueAndResolveTokens("text-field",x,i,m),n=v.factory(r),a=this.hasRTLText=this.hasRTLText||gl(n);(!a||"unavailable"===Y.getRTLTextPluginStatus()||a&&Y.isParsed())&&(e=function(e,r,t){return e.sections.forEach(e=>{e.text=function(e,t){t=r.layout.get("text-transform").evaluate(t,{});return"uppercase"===t?e=e.toLocaleUpperCase():"lowercase"===t&&(e=e.toLocaleLowerCase()),e=Y.applyArabicShaping?Y.applyArabicShaping(e):e}(e.text,t)}),e}(n,s,x))}if(h){const r=s.getValueAndResolveTokens("icon-image",x,i,m);t=r instanceof Re?r:Re.fromString(r)}if(e||t){var d=this.sortFeaturesByKey?p.evaluate(x,{},i):void 0;if(this.features.push({id:l,text:e,icon:t,index:u,sourceLayerIndex:g,geometry:x.geometry,properties:n.properties,type:dl[n.type],sortKey:d}),t&&(f[t.name]=!0),e){const r=o.evaluate(x,{},i).join(","),n="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(he.vertical);for(const i of e.sections)if(i.image)f[i.image.name]=!0;else{const s=Un(e.toString()),a=i.fontStack||r,o=y[a]=y[a]||{};this.calculateGlyphDependencies(i.text,o,n,this.allowVerticalPlacement,s)}}}}}"line"===a.get("symbol-placement")&&(this.features=function(t){const i={},s={},a=[];let r=0;function n(e){a.push(t[e]),r++}function o(e,t,r){var n=s[e];return delete s[e],s[t]=n,a[n].geometry[0].pop(),a[n].geometry[0]=a[n].geometry[0].concat(r[0]),n}function l(e,t,r){var n=i[t];return delete i[t],i[e]=n,a[n].geometry[0].shift(),a[n].geometry[0]=r[0].concat(a[n].geometry[0]),n}function u(e,t,r){r=r?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:`+r.y}for(let e=0;e<t.length;e++){const p=t[e],d=p.geometry,f=p.text?p.text.toString():null;if(f){var c=u(f,d),h=u(f,d,!0);if(c in s&&h in i&&s[c]!==i[h]){const t=l(c,h,d),r=o(c,h,a[t].geometry);delete i[c],delete s[h],s[u(f,a[r].geometry,!0)]=r,a[t].geometry=null}else c in s?o(c,h,d):h in i?l(c,h,d):(n(e),i[c]=r-1,s[h]=r-1)}else n(e)}return a.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}}update(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,i){var e=this.lineVertexArray.length;if(void 0!==n.segment){let t=n.dist(i[n.segment+1]),r=n.dist(i[n.segment]);const s={};for(let e=n.segment+1;e<i.length;e++)s[e]={x:i[e].x,y:i[e].y,tileUnitDistanceFromAnchor:t},e<i.length-1&&(t+=i[e+1].dist(i[e]));for(let e=n.segment||0;0<=e;e--)s[e]={x:i[e].x,y:i[e].y,tileUnitDistanceFromAnchor:r},0<e&&(r+=i[e-1].dist(i[e]));for(let e=0;e<i.length;e++){const i=s[e];this.lineVertexArray.emplaceBack(i.x,i.y,i.tileUnitDistanceFromAnchor)}}return{lineStartIndex:e,lineLength:this.lineVertexArray.length-e}}addSymbols(t,r,n,e,i,s,a,o,l,u,c,h){const p=t.indexArray,d=t.layoutVertexArray,f=t.segments.prepareSegment(4*r.length,d,p,this.canOverlap?s.sortKey:void 0),y=this.glyphOffsetArray.length,m=f.vertexLength,g=this.allowVerticalPlacement&&a===he.vertical?Math.PI/2:0,x=s.text&&s.text.sections;for(let e=0;e<r.length;e++){const{tl:i,tr:a,bl:l,br:u,tex:c,pixelOffsetTL:y,pixelOffsetBR:m,minFontScaleX:v,minFontScaleY:b,glyphOffset:w,isSDF:_,sectionIndex:S}=r[e],k=f.vertexLength,A=w[1];yl(d,o.x,o.y,i.x,A+i.y,c.x,c.y,n,_,y.x,y.y,v,b),yl(d,o.x,o.y,a.x,A+a.y,c.x+c.w,c.y,n,_,m.x,y.y,v,b),yl(d,o.x,o.y,l.x,A+l.y,c.x,c.y+c.h,n,_,y.x,m.y,v,b),yl(d,o.x,o.y,u.x,A+u.y,c.x+c.w,c.y+c.h,n,_,m.x,m.y,v,b),ml(t.dynamicLayoutVertexArray,o,g),p.emplaceBack(k,k+1,k+2),p.emplaceBack(k+1,k+2,k+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(w[0]),e!==r.length-1&&S===r[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,s,s.index,{},h,x&&x[S])}t.placedSymbolArray.emplaceBack(o.x,o.y,y,this.glyphOffsetArray.length-y,m,l,u,o.segment,n?n[0]:0,n?n[1]:0,e[0],e[1],a,0,!1,0,c)}_addCollisionDebugVertex(e,t,r,n,i,s){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,n,i,Math.round(s.x),Math.round(s.y))}addCollisionDebugVertices(e,t,r,n,i,s,a){const o=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=o.vertexLength,u=i.layoutVertexArray,c=i.collisionVertexArray,h=a.anchorX,p=a.anchorY,d=(this._addCollisionDebugVertex(u,c,s,h,p,new L(e,t)),this._addCollisionDebugVertex(u,c,s,h,p,new L(r,t)),this._addCollisionDebugVertex(u,c,s,h,p,new L(r,n)),this._addCollisionDebugVertex(u,c,s,h,p,new L(e,n)),o.vertexLength+=4,i.indexArray);d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),o.primitiveLength+=4}addDebugCollisionBoxes(t,r,n,i){for(let e=t;e<r;e++){const t=this.collisionBoxArray.get(e);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,i?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vl(ss,wo.members,ls),this.iconCollisionBox=new vl(ss,wo.members,ls);for(let e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(t,r,n,i,s,a,o,l,u){const c={};for(let e=r;e<n;e++){const r=t.get(e);c.textBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,anchorPointX:r.anchorPointX,anchorPointY:r.anchorPointY},c.textFeatureIndex=r.featureIndex;break}for(let e=i;e<s;e++){const n=t.get(e);c.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalTextFeatureIndex=n.featureIndex;break}for(let e=a;e<o;e++){const n=t.get(e);c.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.iconFeatureIndex=n.featureIndex;break}for(let e=l;e<u;e++){const n=t.get(e);c.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalIconFeatureIndex=n.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(t,r){var r=t.placedSymbolArray.get(r),n=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],s=[];for(let e=0;e<this.symbolInstances.length;++e){s.push(e);var a=this.symbolInstances.get(e);n.push(0|Math.round(t*a.anchorX+r*a.anchorY)),i.push(a.featureIndex)}return s.sort((e,t)=>n[e]-n[t]||i[t]-i[e]),s}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach((e,t,r)=>{0<=e&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),0<=t.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),0<=t.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),0<=t.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wl,_l;r("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=ml;var Sl={get paint(){return _l=_l||new a({"icon-opacity":new i(s.paint_symbol["icon-opacity"]),"icon-color":new i(s.paint_symbol["icon-color"]),"icon-halo-color":new i(s.paint_symbol["icon-halo-color"]),"icon-halo-width":new i(s.paint_symbol["icon-halo-width"]),"icon-halo-blur":new i(s.paint_symbol["icon-halo-blur"]),"icon-translate":new n(s.paint_symbol["icon-translate"]),"icon-translate-anchor":new n(s.paint_symbol["icon-translate-anchor"]),"text-opacity":new i(s.paint_symbol["text-opacity"]),"text-color":new i(s.paint_symbol["text-color"],{runtimeType:ee,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new i(s.paint_symbol["text-halo-color"]),"text-halo-width":new i(s.paint_symbol["text-halo-width"]),"text-halo-blur":new i(s.paint_symbol["text-halo-blur"]),"text-translate":new n(s.paint_symbol["text-translate"]),"text-translate-anchor":new n(s.paint_symbol["text-translate-anchor"])})},get layout(){return wl=wl||new a({"symbol-placement":new n(s.layout_symbol["symbol-placement"]),"symbol-spacing":new n(s.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new n(s.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new i(s.layout_symbol["symbol-sort-key"]),"symbol-z-order":new n(s.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new n(s.layout_symbol["icon-allow-overlap"]),"icon-overlap":new n(s.layout_symbol["icon-overlap"]),"icon-ignore-placement":new n(s.layout_symbol["icon-ignore-placement"]),"icon-optional":new n(s.layout_symbol["icon-optional"]),"icon-rotation-alignment":new n(s.layout_symbol["icon-rotation-alignment"]),"icon-size":new i(s.layout_symbol["icon-size"]),"icon-text-fit":new n(s.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new n(s.layout_symbol["icon-text-fit-padding"]),"icon-image":new i(s.layout_symbol["icon-image"]),"icon-rotate":new i(s.layout_symbol["icon-rotate"]),"icon-padding":new i(s.layout_symbol["icon-padding"]),"icon-keep-upright":new n(s.layout_symbol["icon-keep-upright"]),"icon-offset":new i(s.layout_symbol["icon-offset"]),"icon-anchor":new i(s.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new n(s.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new n(s.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new n(s.layout_symbol["text-rotation-alignment"]),"text-field":new i(s.layout_symbol["text-field"]),"text-font":new i(s.layout_symbol["text-font"]),"text-size":new i(s.layout_symbol["text-size"]),"text-max-width":new i(s.layout_symbol["text-max-width"]),"text-line-height":new n(s.layout_symbol["text-line-height"]),"text-letter-spacing":new i(s.layout_symbol["text-letter-spacing"]),"text-justify":new i(s.layout_symbol["text-justify"]),"text-radial-offset":new i(s.layout_symbol["text-radial-offset"]),"text-variable-anchor":new n(s.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new i(s.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new i(s.layout_symbol["text-anchor"]),"text-max-angle":new n(s.layout_symbol["text-max-angle"]),"text-writing-mode":new n(s.layout_symbol["text-writing-mode"]),"text-rotate":new i(s.layout_symbol["text-rotate"]),"text-padding":new n(s.layout_symbol["text-padding"]),"text-keep-upright":new n(s.layout_symbol["text-keep-upright"]),"text-transform":new i(s.layout_symbol["text-transform"]),"text-offset":new i(s.layout_symbol["text-offset"]),"text-allow-overlap":new n(s.layout_symbol["text-allow-overlap"]),"text-overlap":new n(s.layout_symbol["text-overlap"]),"text-ignore-placement":new n(s.layout_symbol["text-ignore-placement"]),"text-optional":new n(s.layout_symbol["text-optional"])})}};class kl{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Q,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}r("FormatSectionOverride",kl,{omit:["defaultValue"]});class Al extends ci{constructor(e){super(e,Sl)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const r of e)t.indexOf(r)<0&&t.push(r);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||zr(s.value)||!i?i:(a=t.properties,i.replace(/{([^{}]+)}/g,(e,t)=>a&&t in a?String(a[t]):""));var a}createBucket(e){return new bl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Sl.paint.overridableProperties){var e,t,r;Al.hasPaintOverride(this.layout,n)&&(e=this.paint.get(n),t=new kl(e),t=new Mr(t,e.property.specification),r=null,r="constant"===e.value.kind||"source"===e.value.kind?new Cr("source",t):new Br("composite",t,e.value.zoomStops),this.paint._values[n]=new ii(e.property,r,e.parameters))}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&Al.hasPaintOverride(this.layout,e)}static hasPaintOverride(t,e){const r=t.get("text-field"),n=Sl.paint.properties[e];let i=!1;const s=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof v)s(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{i||(e instanceof Ne&&g(e.value)===ne?s(e.value.sections):e instanceof xt?s(e.sections):e.eachChild(t))},e=r.value;e._styleExpression&&t(e._styleExpression.expression)}return i}}let Il;var Ml={get paint(){return Il=Il||new a({"background-color":new n(s.paint_background["background-color"]),"background-pattern":new oi(s.paint_background["background-pattern"]),"background-opacity":new n(s.paint_background["background-opacity"])})}};class zl extends ci{constructor(e){super(e,Ml)}}let Pl;var Cl,Bl={get paint(){return Pl=Pl||new a({"raster-opacity":new n(s.paint_raster["raster-opacity"]),"raster-hue-rotate":new n(s.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new n(s.paint_raster["raster-brightness-min"]),"raster-brightness-max":new n(s.paint_raster["raster-brightness-max"]),"raster-saturation":new n(s.paint_raster["raster-saturation"]),"raster-contrast":new n(s.paint_raster["raster-contrast"]),"raster-resampling":new n(s.paint_raster["raster-resampling"]),"raster-fade-duration":new n(s.paint_raster["raster-fade-duration"])})}};class Vl extends ci{constructor(e){super(e,Bl)}}class Tl extends ci{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class El{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,r){for(const r of e){this._layerConfigs[r.id]=r;const e=this._layers[r.id]=function(e){if("custom"===e.type)return new Tl(e);switch(e.type){case"background":return new zl(e);case"circle":return new Js(e);case"fill":return new Ea(e);case"fill-extrusion":return new Qa(e);case"heatmap":return new aa(e);case"hillshade":return new ua(e);case"line":return new mo(e);case"raster":return new Vl(e);case"symbol":return new Al(e)}}(r);e._featureFilter=Dr(e.filter),this.keyCache[r.id]&&delete this.keyCache[r.id]}for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const n=function(r,n){const i={};for(let t=0;t<r.length;t++){var s=n&&n[r[t].id]||Ur(r[t]);n&&(n[r[t].id]=s);let e=i[s];(e=e||(i[s]=[])).push(r[t])}const e=[];for(const r in i)e.push(i[r]);return e}(Object.values(this._layerConfigs),this.keyCache);for(const e of n){const r=e.map(e=>this._layers[e.id]),n=r[0];if("none"!==n.visibility){var i=n.source||"";let e=this.familiesBySource[i];e=e||(this.familiesBySource[i]={});i=n.sourceLayer||"_geojsonTileLayer";let t=e[i];(t=t||(e[i]=[])).push(r)}}}}class Fl{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length `+this._numberToString.length);return this._numberToString[e]}}class Dl{constructor(e,t,r,n,i){this.type="Feature",(this._vectorTileFeature=e)._z=t,e._x=r,e._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class Ll{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new G(ue,16,0),this.grid3D=new G(ue,16,0),this.featureIndexArray=new Hi,this.promoteId=t}insert(e,t,r,n,i,s){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);const o=s?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<ue&&n[1]<ue&&0<=n[2]&&0<=n[3]&&o.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Oa.VectorTile(new Uo(this.rawTileData)).layers,this.sourceLayerCoder=new Fl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,t,r,i){this.loadVTLayers();const s=c.params||{},a=ue/c.tileSize/c.scale,o=Dr(s.filter),l=c.queryGeometry,h=c.queryPadding*a,u=$l(l),n=this.grid.query(u.minX-h,u.minY-h,u.maxX+h,u.maxY+h),e=$l(c.cameraQueryGeometry),p=this.grid3D.query(e.minX-h,e.minY-h,e.maxX+h,e.maxY+h,(e,t,r,n)=>{var i=c.cameraQueryGeometry,s=e-h,a=t-h,o=r+h,l=n+h;for(const L of i)if(s<=L.x&&a<=L.y&&o>=L.x&&l>=L.y)return!0;var u=[new L(s,a),new L(s,l),new L(o,l),new L(o,a)];if(2<i.length)for(const s of u)if(js(i,s))return!0;for(let e=0;e<i.length-1;e++)if(function(e,t,r){var n=r[0],i=r[2];if(!(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y))return(n=j(e,t,r[0]))!==j(e,t,r[1])||n!==j(e,t,r[2])||n!==j(e,t,r[3])}(i[e],i[e+1],u))return!0;return!1});for(const c of p)n.push(c);n.sort(Rl);var d={};let f;for(let e=0;e<n.length;e++){const h=n[e];if(h!==f){f=h;const u=this.featureIndexArray.get(h);let n=null;this.loadMatchingFeature(d,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,o,s.layers,s.availableImages,t,r,i,(e,t,r)=>(n=n||Vs(e),t.queryIntersectsFeature(l,e,r,n,this.z,c.transform,a,c.pixelPosMatrix)))}}return d}loadMatchingFeature(t,e,r,n,i,s,a,o,l,u,c){var h=this.bucketLayerIDs[e];if(!s||function(t,r){for(let e=0;e<t.length;e++)if(0<=r.indexOf(t[e]))return 1}(s,h)){var e=this.sourceLayerCoder.decode(r),p=this.vtLayers[e].feature(n);if(i.needGeometry){const t=Ts(p,!0);if(!i.filter(new k(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new k(this.tileID.overscaledZ),p))return;var d=this.getId(p,e);for(let e=0;e<h.length;e++){const r=h[e];if(!(s&&s.indexOf(r)<0)){const i=o[r];if(i){let e={};d&&u&&(e=u.getState(i.sourceLayer||"_geojsonTileLayer",d));const y=D({},l[r]);y.paint=Ol(y.paint,i.paint,p,e,a),y.layout=Ol(y.layout,i.layout,p,e,a);var f=!c||c(p,i,e);if(f){const m=new Dl(p,this.z,this.x,this.y,d);m.layer=y;let e=t[r];(e=void 0===e?t[r]=[]:e).push({featureIndex:n,feature:m,intersectionZ:f})}}}}}}lookupSymbolFeatures(e,t,r,n,i,s,a,o){var l={},u=(this.loadVTLayers(),Dr(i));for(const i of e)this.loadMatchingFeature(l,r,n,i,u,s,a,o,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&("boolean"==typeof(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]])&&(r=Number(r))),r}}function Ol(e,n,i,s,a){return O(e,(e,t)=>{const r=n instanceof si?n.get(t):null;return r&&r.evaluate?r.evaluate(i,s,a):r})}function $l(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const s of e)t=Math.min(t,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);return{minX:t,minY:r,maxX:n,maxY:i}}function Rl(e,t){return t-e}r("FeatureIndex",Ll,{omit:["rawTileData","sourceLayerCoder"]});class jl extends L{constructor(e,t,r,n){super(e,t),this.angle=r,void 0!==n&&(this.segment=n)}clone(){return new jl(this.x,this.y,this.angle,this.segment)}}function ql(e,t,r,n,i){if(void 0===t.segment||0===r)return 1;let s=t,a=t.segment+1,o=0;for(;o>-r/2;){if(--a<0)return;o-=e[a].dist(s),s=e[a]}o+=e[a].dist(e[a+1]),a++;const l=[];let u=0;for(;o<r/2;){const t=e[a],r=e[a+1];if(!r)return;var c=e[a-1].angleTo(t)-t.angleTo(r),c=Math.abs((c+3*Math.PI)%(2*Math.PI)-Math.PI);for(l.push({distance:o,angleDelta:c}),u+=c;o-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return;a++,o+=t.dist(r)}return 1}function Ul(t){let r=0;for(let e=0;e<t.length-1;e++)r+=t[e].dist(t[e+1]);return r}function Nl(e,t,r){return e?.6*t*r:0}function Zl(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Gl(e,t,r,n,i,s,a,o,l){var u=Nl(n,s,a),n=Zl(n,i),i=n*a,c=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-i<t/4&&(t=i+t/4),function e(t,r,n,i,s,a,o,l,u){const c=a/2,h=Ul(t);let p=0,d=r-n,f=[];for(let e=0;e<t.length-1;e++){const o=t[e],l=t[e+1],y=o.dist(l),m=l.angleTo(o);for(;d+n<p+y;){const g=((d+=n)-p)/y,x=at.number(o.x,l.x,g),v=at.number(o.y,l.y,g);if(0<=x&&x<u&&0<=v&&v<u&&0<=d-c&&d+c<=h){const n=new jl(x,v,m,e);n._round(),i&&!ql(t,n,a,i,s)||f.push(n)}}p+=y}return l||f.length||o||(f=e(t,p/2,n,i,s,a,o,!0,u)),f}(e,c?t/2*o%t:(n/2+2*s)*a*o%t,t,u,r,i,c,!1,l)}r("Anchor",jl);const Xl=J;function Hl(t,v,b,r){const n=[],w=t.image,_=w.pixelRatio,e=w.paddedRect.w-2*Xl,i=w.paddedRect.h-2*Xl;let s={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const a=w.stretchX||[[0,e]],o=w.stretchY||[[0,i]],l=(e,t)=>e+t[1]-t[0],S=a.reduce(l,0),k=o.reduce(l,0),u=e-S,c=i-k;let A=0,I=S,M=0,z=k,P=0,C=u,B=0,V=c;if(w.content&&r){const v=w.content,b=v[2]-v[0],r=v[3]-v[1];(w.textFitWidth||w.textFitHeight)&&(s=al(t)),A=Yl(a,0,v[0]),M=Yl(o,0,v[1]),I=Yl(a,v[0],v[2]),z=Yl(o,v[1],v[3]),P=v[0]-A,B=v[1]-M,C=b-I,V=r-z}const T=s.x1,E=s.y1,F=s.x2-T,D=s.y2-E,h=(e,t,r,n)=>{const i=(e.stretch-A)/I*F+T,s=e.fixed-P-C*e.stretch/S,a=(t.stretch-M)/z*D+E,o=t.fixed-B-V*t.stretch/k,l=(r.stretch-A)/I*F+T,u=r.fixed-P-C*r.stretch/S,c=(n.stretch-M)/z*D+E,h=n.fixed-B-V*n.stretch/k,p=new L(i,a),d=new L(l,a),f=new L(l,c),y=new L(i,c),m=new L(s/_,o/_),g=new L(u/_,h/_),x=v*Math.PI/180;if(x){const e=Math.sin(x),v=Math.cos(x),b=[v,-e,e,v];p._matMult(b),d._matMult(b),y._matMult(b),f._matMult(b)}e=e.stretch+e.fixed,t=t.stretch+t.fixed;return{tl:p,tr:d,bl:y,br:f,tex:{x:w.paddedRect.x+Xl+e,y:w.paddedRect.y+Xl+t,w:r.stretch+r.fixed-e,h:n.stretch+n.fixed-t},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:m,pixelOffsetBR:g,minFontScaleX:C/_/F,minFontScaleY:V/_/D,isSDF:b}};if(r&&(w.stretchX||w.stretchY)){const t=Jl(a,u,S),v=Jl(o,c,k);for(let e=0;e<t.length-1;e++){const r=t[e],L=t[e+1];for(let e=0;e<v.length-1;e++)n.push(h(r,v[e],L,v[e+1]))}}else n.push(h({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+e},{fixed:0,stretch:1+i}));return n}function Yl(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Jl(e,t,r){const n=[{fixed:-Xl,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+Xl,stretch:r}),n}class Kl{constructor(e,t,r,n,i,s,a,o,l,u){if(this.boxStartIndex=e.length,l){let e=s.top,t=s.bottom;const r=s.collisionPadding;r&&(e-=r[1],t+=r[3]);l=t-e;0<l&&(l=Math.max(10,l),this.circleDiameter=l)}else{const l=null!=(c=s.image)&&c.content&&(s.image.textFitWidth||s.image.textFitHeight)?al(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};l.y1=l.y1*a-o[0],l.y2=l.y2*a+o[2],l.x1=l.x1*a-o[3],l.x2=l.x2*a+o[1];var c=s.collisionPadding;if(c&&(l.x1-=c[0]*a,l.y1-=c[1]*a,l.x2+=c[2]*a,l.y2+=c[3]*a),u){const e=new L(l.x1,l.y1),t=new L(l.x2,l.y1),r=new L(l.x1,l.y2),n=new L(l.x2,l.y2),i=u*Math.PI/180;e._rotate(i),t._rotate(i),r._rotate(i),n._rotate(i),l.x1=Math.min(e.x,t.x,r.x,n.x),l.x2=Math.max(e.x,t.x,r.x,n.x),l.y1=Math.min(e.y,t.y,r.y,n.y),l.y2=Math.max(e.y,t.y,r.y,n.y)}e.emplaceBack(t.x,t.y,l.x1,l.y1,l.x2,l.y2,r,n,i)}this.boxEndIndex=e.length}}class Wl{constructor(e=[],t=(e,t)=>e<t?-1:t<e?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),0<--this.length&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;0<e;){var i=e-1>>1,s=t[i];if(0<=r(n,s))break;t[e]=s,e=i}t[e]=n}_down(t){const{data:r,compare:n}=this,e=this.length>>1,i=r[t];for(;t<e;){let e=1+(t<<1);var s=e+1;if(s<this.length&&n(r[s],r[e])<0&&(e=s),0<=n(r[e],i))break;r[t]=r[e],t=e}r[t]=i}}function Ql(e,t){return t.max-e.max}function eu(e,t,r,n){this.p=new L(e,t),this.h=r,this.d=function(n,t){let i=!1,s=1/0;for(let e=0;e<t.length;e++){var a=t[e];for(let e=0,t=a.length,r=t-1;e<t;r=e++){var o=a[e],l=a[r];o.y>n.y!=l.y>n.y&&n.x<(l.x-o.x)*(n.y-o.y)/(l.y-o.y)+o.x&&(i=!i),s=Math.min(s,$s(n,o,l))}}return(i?1:-1)*Math.sqrt(s)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}(t=Cl=Cl||{})[t.center=1]="center",t[t.left=2]="left",t[t.right=3]="right",t[t.top=4]="top",t[t.bottom=5]="bottom",t[t["top-left"]=6]="top-left",t[t["top-right"]=7]="top-right",t[t["bottom-left"]=8]="bottom-left",t[t["bottom-right"]=9]="bottom-right";const tu=7,ru=Number.POSITIVE_INFINITY;function nu(r,n){if(n[1]!==ru){var i=r,s=n[0],a=n[1];let e=0,t=0;switch(s=Math.abs(s),a=Math.abs(a),i){case"top-right":case"top-left":case"top":t=a-tu;break;case"bottom-right":case"bottom-left":case"bottom":t=-a+tu}switch(i){case"top-right":case"bottom-right":case"right":e=-s;break;case"top-left":case"bottom-left":case"left":e=s}return[e,t]}{var i=r,o=n[0];let e=0,t=0;var l=(o=o<0?0:o)/Math.SQRT2;switch(i){case"top-right":case"top-left":t=l-tu;break;case"bottom-right":case"bottom-left":t=-l+tu;break;case"bottom":t=-o+tu;break;case"top":t=o-tu}switch(i){case"top-right":case"bottom-right":e=-l;break;case"top-left":case"bottom-left":e=l;break;case"left":e=o;break;case"right":e=-o}return[e,t]}}function iu(t,r,e){const n=t.layout,i=null==(s=n.get("text-variable-anchor-offset"))?void 0:s.evaluate(r,{},e);if(i){const t=i.values,r=[];for(let e=0;e<t.length;e+=2){const s=r[e]=t[e],n=t[e+1].map(e=>e*ce);s.startsWith("top")?n[1]-=tu:s.startsWith("bottom")&&(n[1]+=tu),r[e+1]=n}return new $e(r)}var s=n.get("text-variable-anchor");if(s){var a=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(r,{},e)*ce,ru]:n.get("text-offset").evaluate(r,{},e).map(e=>e*ce);const i=[];for(const t of s)i.push(t,nu(t,a));return new $e(i)}return null}function su(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=ue/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const i=n.bucket.layers[0],s=i.layout,a=i._unevaluatedLayout._values,o={layoutIconSize:a["icon-size"].possiblyEvaluate(new k(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new k(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new k(18))};if("composite"===n.bucket.textSizeData.kind){const{minZoom:i,maxZoom:s}=n.bucket.textSizeData;o.compositeTextSizes=[a["text-size"].possiblyEvaluate(new k(i),n.canonical),a["text-size"].possiblyEvaluate(new k(s),n.canonical)]}if("composite"===n.bucket.iconSizeData.kind){const{minZoom:i,maxZoom:s}=n.bucket.iconSizeData;o.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new k(i),n.canonical),a["icon-size"].possiblyEvaluate(new k(s),n.canonical)]}const l=s.get("text-line-height")*ce,u="viewport"!==s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),c=s.get("text-keep-upright"),h=s.get("text-size");for(const a of n.bucket.features){const d=s.get("text-font").evaluate(a,{},n.canonical).join(","),f=h.evaluate(a,{},n.canonical),y=o.layoutTextSize.evaluate(a,{},n.canonical),m=o.layoutIconSize.evaluate(a,{},n.canonical),g={horizontal:{},vertical:void 0},x=a.text;let e,r=[0,0];if(x){const o=x.toString(),h=s.get("text-letter-spacing").evaluate(a,{},n.canonical)*ce,v=Nn(o)?h:0,le=s.get("text-anchor").evaluate(a,{},n.canonical),b=iu(i,a,n.canonical);if(!b){const i=s.get("text-radial-offset").evaluate(a,{},n.canonical);r=i?nu(le,[i*ce,ru]):s.get("text-offset").evaluate(a,{},n.canonical).map(e=>e*ce)}let t=u?"center":s.get("text-justify").evaluate(a,{},n.canonical);const w="point"===s.get("symbol-placement")?s.get("text-max-width").evaluate(a,{},n.canonical)*ce:1/0,_=()=>{n.bucket.allowVerticalPlacement&&Un(o)&&(g.vertical=Ko(x,n.glyphMap,n.glyphPositions,n.imagePositions,d,w,l,le,"left",v,r,he.vertical,!0,y,f))};if(!u&&b){const i=new Set;if("auto"===t)for(let e=0;e<b.values.length;e+=2)i.add(au(b.values[e]));else i.add(t);let e=!1;for(const a of i)if(!g.horizontal[a])if(e)g.horizontal[a]=g.horizontal[0];else{const i=Ko(x,n.glyphMap,n.glyphPositions,n.imagePositions,d,w,l,"center",a,v,r,he.horizontal,!1,y,f);i&&(g.horizontal[a]=i,e=1===i.positionedLines.length)}_()}else{"auto"===t&&(t=au(le));const i=Ko(x,n.glyphMap,n.glyphPositions,n.imagePositions,d,w,l,le,t,v,r,he.horizontal,!1,y,f);i&&(g.horizontal[t]=i),_(),Un(o)&&u&&c&&(g.vertical=Ko(x,n.glyphMap,n.glyphPositions,n.imagePositions,d,w,l,le,t,v,r,he.vertical,!1,y,f))}}let t=!1;if(a.icon&&a.icon.name){const i=n.imageMap[a.icon.name];i&&(e=function(e,t,r){var{horizontalAlign:r,verticalAlign:n}=sl(r),r=t[0]-e.displaySize[0]*r,t=t[1]-e.displaySize[1]*n;return{image:e,top:t,bottom:t+e.displaySize[1],left:r,right:r+e.displaySize[0]}}(n.imagePositions[a.icon.name],s.get("icon-offset").evaluate(a,{},n.canonical),s.get("icon-anchor").evaluate(a,{},n.canonical)),t=!!i.sdf,void 0===n.bucket.sdfIcons?n.bucket.sdfIcons=t:n.bucket.sdfIcons!==t&&le("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),i.pixelRatio===n.bucket.pixelRatio&&0===s.get("icon-rotate").constantOr(1)||(n.bucket.iconsNeedLinear=!0))}var p=lu(g.horizontal)||g.vertical;n.bucket.iconsInText=!!p&&p.iconsInText,(p||e)&&function(N,Z,G,X,H,Y,J,e,K,W,Q){let t=Y.textMaxSize.evaluate(Z,{});void 0===t&&(t=J);const r=N.layers[0].layout,ee=r.get("icon-offset").evaluate(Z,{},Q),n=lu(G.horizontal),i=J/24,te=N.tilePixelRatio*i,s=N.tilePixelRatio*t/24,re=N.tilePixelRatio*e,a=N.tilePixelRatio*r.get("symbol-spacing"),ne=r.get("text-padding")*N.tilePixelRatio,ie=function(e,t,r,n=1){e=e.get("icon-padding").evaluate(t,{},r),t=e&&e.values;return[t[0]*n,t[1]*n,t[2]*n,t[3]*n]}(r,Z,Q,N.tilePixelRatio),o=r.get("text-max-angle")/180*Math.PI,se="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),ae="map"===r.get("icon-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("symbol-placement"),u=a/2,c=r.get("icon-text-fit");let oe;X&&"none"!==c&&(N.allowVerticalPlacement&&G.vertical&&(oe=ol(X,G.vertical,c,r.get("icon-text-fit-padding"),ee,i)),n&&(X=ol(X,n,c,r.get("icon-text-fit-padding"),ee,i)));var h=(p,d)=>{if(!(d.x<0||d.x>=ue||d.y<0||d.y>=ue)){var f=N,y=d,m=p,g=G,x=X,v=H,b=oe,w=N.layers[0],_=N.collisionBoxArray,S=Z.index,k=Z.sourceLayerIndex,A=N.index,I=te,M=[ne,ne,ne,ne],z=se,P=K,d=re,p=ie,C=ae,B=ee,V=Z,T=Y,E=W,F=Q,D=J,L=f.addToLineVertexArray(y,m);let e,t,r,n,i=0,s=0,a=0,o=0,l=-1,u=-1;var O={};let c=ds("");if(f.allowVerticalPlacement&&g.vertical){const f=w.layout.get("text-rotate").evaluate(V,{},F)+90;r=new Kl(_,y,S,k,A,g.vertical,I,M,z,f),b&&(n=new Kl(_,y,S,k,A,b,d,p,z,f))}if(x){const m=w.layout.get("icon-rotate").evaluate(V,{}),g="none"!==w.layout.get("icon-text-fit"),v=Hl(x,m,E,g),I=b?Hl(b,m,E,g):void 0,M=(t=new Kl(_,y,S,k,A,x,d,p,!1,m),i=4*v.length,f.iconSizeData);let e=null;"source"===M.kind?(e=[ul*w.layout.get("icon-size").evaluate(V,{})])[0]>cl&&le(`${f.layerIds[0]}: Value for "icon-size" is >= ${ll}. Reduce your "icon-size".`):"composite"===M.kind&&(((e=[ul*T.compositeIconSizes[0].evaluate(V,{},F),ul*T.compositeIconSizes[1].evaluate(V,{},F)])[0]>cl||e[1]>cl)&&le(`${f.layerIds[0]}: Value for "icon-size" is >= ${ll}. Reduce your "icon-size".`)),f.addSymbols(f.icon,v,e,B,C,V,he.none,y,L.lineStartIndex,L.lineLength,-1,F),l=f.icon.placedSymbolArray.length-1,I&&(s=4*I.length,f.addSymbols(f.icon,I,e,B,C,V,he.vertical,y,L.lineStartIndex,L.lineLength,-1,F),u=f.icon.placedSymbolArray.length-1)}var $=Object.keys(g.horizontal);for(const m of $){const x=g.horizontal[m];if(!e){c=ds(x.text);const f=w.layout.get("text-rotate").evaluate(V,{},F);e=new Kl(_,y,S,k,A,x,I,M,z,f)}const b=1===x.positionedLines.length;if(a+=ou(f,y,x,v,w,z,V,P,L,g.vertical?he.horizontal:he.horizontalOnly,b?$:[m],O,l,T,F),b)break}g.vertical&&(o+=ou(f,y,g.vertical,v,w,z,V,P,L,he.vertical,["vertical"],O,u,T,F)),m=e?e.boxStartIndex:f.collisionBoxArray.length,b=e?e.boxEndIndex:f.collisionBoxArray.length,E=r?r.boxStartIndex:f.collisionBoxArray.length,x=r?r.boxEndIndex:f.collisionBoxArray.length,d=t?t.boxStartIndex:f.collisionBoxArray.length,p=t?t.boxEndIndex:f.collisionBoxArray.length,B=n?n.boxStartIndex:f.collisionBoxArray.length,C=n?n.boxEndIndex:f.collisionBoxArray.length;let h=-1;var R=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;h=R(e,h),h=R(r,h),h=R(t,h),(R=-1<(h=R(n,h))?1:0)&&(h*=D/ce),f.glyphOffsetArray.length>=bl.MAX_GLYPHS&&le("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==V.sortKey&&f.addToSortKeyRanges(f.symbolInstances.length,V.sortKey);const j=iu(w,V,F),[q,U]=function(t){const r=t.length,n=null==j?void 0:j.values;if(0<(null==n?void 0:n.length))for(let e=0;e<n.length;e+=2){const r=n[e+1];t.emplaceBack(Cl[n[e]],r[0],r[1])}return[r,t.length]}(f.textAnchorOffsets);f.symbolInstances.emplaceBack(y.x,y.y,0<=O.right?O.right:-1,0<=O.center?O.center:-1,0<=O.left?O.left:-1,O.vertical||-1,l,u,c,m,b,E,x,d,p,B,C,S,a,o,i,s,R,0,I,h,q,U)}};if("line"===l)for(const H of function(t,i,s){const a=[];for(let e=0;e<t.length;e++){const o=t[e];let n;for(let r=0;r<o.length-1;r++){let e=o[r],t=o[r+1];e.x<0&&t.x<0||(e.x<0?e=new L(0,e.y+(0-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x<0&&(t=new L(0,e.y+(0-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y<0&&t.y<0||(e.y<0?e=new L(e.x+(0-e.y)/(t.y-e.y)*(t.x-e.x),0)._round():t.y<0&&(t=new L(e.x+(0-e.y)/(t.y-e.y)*(t.x-e.x),0)._round()),e.x>=i&&t.x>=i||(e.x>=i?e=new L(i,e.y+(i-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x>=i&&(t=new L(i,e.y+(i-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y>=s&&t.y>=s||(e.y>=s?e=new L(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round():t.y>=s&&(t=new L(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round()),n&&e.equals(n[n.length-1])||(n=[e],a.push(n)),n.push(t)))))}}return a}(Z.geometry,ue,ue)){const Z=Gl(H,a,o,G.vertical||n,X,24,s,N.overscaling,ue);for(const G of Z)n&&function(t,e,r,n){const i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;0<=e;e--)if(n.dist(t[e])<r)return 1}else i[e]=[];return i[e].push(n),0}(N,n.text,u,G)||h(H,G)}else if("line-center"===l){for(const N of Z.geometry)if(1<N.length){const Z=function(t,r,e,n,i,s){var a=Nl(e,i,s),o=Zl(e,n)*s;let l=0;var u=Ul(t)/2;for(let e=0;e<t.length-1;e++){const n=t[e],i=t[e+1],s=n.dist(i);if(l+s>u){const c=(u-l)/s,h=at.number(n.x,i.x,c),p=at.number(n.y,i.y,c),d=new jl(h,p,i.angleTo(n),e);return d._round(),!a||ql(t,d,o,a,r)?d:void 0}l+=s}}(N,o,G.vertical||n,X,24,s);Z&&h(N,Z)}}else if("Polygon"===Z.type)for(const N of Lt(Z.geometry,0)){const Z=function(r,t,e=!1){let n=1/0,i=1/0,s=-1/0,a=-1/0;var o=r[0];for(let e=0;e<o.length;e++){const t=o[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<i)&&(i=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>a)&&(a=t.y)}var l=Math.min(s-n,a-i);let u=l/2;const c=new Wl([],Ql);if(0===l)return new L(n,i);for(let t=n;t<s;t+=l)for(let e=i;e<a;e+=l)c.push(new eu(t+u,e+u,u,r));let h=function(e){let n=0,i=0,s=0;var a=e[0];for(let e=0,t=a.length,r=t-1;e<t;r=e++){var o=a[e],l=a[r],u=o.x*l.y-l.x*o.y;i+=(o.x+l.x)*u,s+=(o.y+l.y)*u,n+=3*u}return new eu(i/n,s/n,0,e)}(r),p=c.length;for(;c.length;){const n=c.pop();(n.d>h.d||!h.d)&&(h=n,e&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-h.d<=t||(u=n.h/2,c.push(new eu(n.p.x-u,n.p.y-u,u,r)),c.push(new eu(n.p.x+u,n.p.y-u,u,r)),c.push(new eu(n.p.x-u,n.p.y+u,u,r)),c.push(new eu(n.p.x+u,n.p.y+u,u,r)),p+=4)}return e&&(console.log("num probes: "+p),console.log("best distance: "+h.d)),h.p}(N,16);h(N[0],new jl(Z.x,Z.y,0))}else if("LineString"===Z.type)for(const N of Z.geometry)h(N,new jl(N[0].x,N[0].y,0));else if("Point"===Z.type)for(const N of Z.geometry)for(const Z of N)h([Z],new jl(Z.x,Z.y,0))}(n.bucket,a,g,e,n.imageMap,o,y,m,r,t,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()}function au(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ou(e,t,r,n,i,s,a,o,l,u,c,h,p,d,f){r=function(a,o,l,u,c,h,p){const d=l.layout.get("text-rotate").evaluate(c,{})*Math.PI/180,f=[];for(const x of a.positionedLines)for(const l of x.positionedGlyphs)if(l.rect){const c=l.rect||{};let e=No+1,t=!0,r=1,n=0;var y=(u||p)&&l.vertical,m=l.metrics.advance*l.scale/2;if(p&&a.verticalizable&&(n=x.lineOffset/2-(l.imageName?-(ce-l.metrics.width*l.scale)/2:(l.scale-1)*ce)),l.imageName){const x=h[l.imageName];t=x.sdf,r=x.pixelRatio,e=J/r}var g=u?[l.x+m,l.y]:[0,0];let i=u?[0,0]:[l.x+m+o[0],l.y+o[1]-n],s=[0,0];y&&(s=i,i=[0,0]);const v=l.metrics.isDoubleResolution?2:1,b=(l.metrics.left-e)*l.scale-m+i[0],w=(-l.metrics.top-e)*l.scale+i[1],_=b+c.w/v*l.scale/r,S=w+c.h/v*l.scale/r,k=new L(b,w),A=new L(_,w),I=new L(b,S),M=new L(_,S);if(y){const x=new L(-m,m-Ho),a=-Math.PI/2,o=ce/2-m,u=new L(5-Ho-o,-(l.imageName?o:0)),c=new L(...s);k._rotateAround(a,x)._add(u)._add(c),A._rotateAround(a,x)._add(u)._add(c),I._rotateAround(a,x)._add(u)._add(c),M._rotateAround(a,x)._add(u)._add(c)}if(d){const x=Math.sin(d),a=Math.cos(d),o=[a,-x,x,a];k._matMult(o),A._matMult(o),I._matMult(o),M._matMult(o)}y=new L(0,0),m=new L(0,0);f.push({tl:k,tr:A,bl:I,br:M,tex:c,writingMode:a.writingMode,glyphOffset:g,sectionIndex:l.sectionIndex,isSDF:t,pixelOffsetTL:y,pixelOffsetBR:m,minFontScaleX:0,minFontScaleY:0})}return f}(r,o,i,s,a,n,e.allowVerticalPlacement),n=e.textSizeData;let y=null;"source"===n.kind?(y=[ul*i.layout.get("text-size").evaluate(a,{})])[0]>cl&&le(`${e.layerIds[0]}: Value for "text-size" is >= ${ll}. Reduce your "text-size".`):"composite"===n.kind&&((y=[ul*d.compositeTextSizes[0].evaluate(a,{},f),ul*d.compositeTextSizes[1].evaluate(a,{},f)])[0]>cl||y[1]>cl)&&le(`${e.layerIds[0]}: Value for "text-size" is >= ${ll}. Reduce your "text-size".`),e.addSymbols(e.text,r,y,o,s,a,u,t,l.lineStartIndex,l.lineLength,p,f);for(const t of c)h[t]=e.text.placedSymbolArray.length-1;return 4*r.length}function lu(e){for(const t in e)return e[t];return null}class uu{constructor(e){const t={},r=[];for(const n in e){const i=e[n],s=t[n]={};for(const e in i){const t=i[+e];if(t&&0!==t.bitmap.width&&0!==t.bitmap.height){const n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(n),s[e]={rect:n,metrics:t.metrics}}}}const{w:n,h:i}=Zo(r),s=new ia({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n){const i=n[+e];var a;i&&0!==i.bitmap.width&&0!==i.bitmap.height&&(a=t[r][e].rect,ia.copy(i.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},i.bitmap))}}this.image=s,this.positions=t}}function cu(e,t,r){r=2*Math.PI*6378137/256/Math.pow(2,r);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}r("GlyphAtlas",uu);const hu=6371008.8;class pu{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pu(function(e){e=((e- -180)%360+360)%360-180;return-180==e?180:e}(this.lng),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){var t=Math.PI/180,r=this.lat*t,n=e.lat*t,r=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return hu*Math.acos(Math.min(r,1))}static convert(e){if(e instanceof pu)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new pu(Number(e[0]),Number(e[1]));if(Array.isArray(e)||"object"!=typeof e||null===e)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new pu(Number("lng"in e?e.lng:e.lon),Number(e.lat))}}const du=2*Math.PI*hu;function fu(e){return du*Math.cos(e*Math.PI/180)}function yu(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class mu{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){e=pu.convert(e);return new mu((180+e.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e.lat*Math.PI/360)))/360,t/fu(e.lat))}toLngLat(){return new pu(360*this.x-180,yu(this.y))}toAltitude(){return this.z*fu(yu(this.y))}meterInMercatorCoordinateUnits(){return 1/du*(e=yu(this.y),1/Math.cos(e*Math.PI/180));var e}}class gu{constructor(e,t,r){if(i=t,(n=e)<0||25<n||r<0||r>=Math.pow(2,n)||i<0||i>=Math.pow(2,n))throw new Error(`x=${t}, y=${r}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);var n,i;this.z=e,this.x=t,this.y=r,this.key=bu(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,r){s=this.y,a=this.z,n=cu(256*(i=this.x),256*(s=Math.pow(2,a)-s-1),a),i=cu(256*(i+1),256*(1+s),a);var n,i,s=n[0]+","+n[1]+","+i[0]+","+i[1],a=function(t,r,n){let i,s="";for(let e=t;0<e;e--)i=1<<e-1,s+=(r&i?1:0)+(n&i?2:0);return s}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,1<t?"@2x":"").replace(/{quadkey}/g,a).replace(/{bbox-epsg-3857}/g,s)}isChildOf(e){var t=this.z-e.z;return 0<t&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){var t=Math.pow(2,this.z);return new L((e.x*t-this.x)*ue,(e.y*t-this.y)*ue)}toString(){return`${this.z}/${this.x}/`+this.y}}class xu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=bu(e,t.z,t.z,t.x,t.y)}}class vu{constructor(e,t,r,n,i){if(e<r)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = `+r);this.overscaledZ=e,this.wrap=t,this.canonical=new gu(r,+n,+i),this.key=bu(t,e,r,n,i)}clone(){return new vu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = `+this.overscaledZ);var t=this.canonical.z-e;return e>this.canonical.z?new vu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = `+this.overscaledZ);var r=this.canonical.z-e;return e>this.canonical.z?bu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):bu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}isChildOf(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new vu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,t=2*this.canonical.x,r=2*this.canonical.y;return[new vu(e,this.wrap,e,t,r),new vu(e,this.wrap,e,1+t,r),new vu(e,this.wrap,e,t,1+r),new vu(e,this.wrap,e,1+t,1+r)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}getTilePoint(e){return this.canonical.getTilePoint(new mu(e.x-this.wrap,e.y))}}function bu(e,t,r,n,i){var s=1<<r;return(s*s*(e=(e*=2)<0?-1*e-1:e)+s*i+n).toString(36)+r.toString(36)+t.toString(36)}r("CanonicalTileID",gu),r("OverscaledTileID",vu,{omit:["posMatrix"]});class wu{constructor(e){this.tileID=new vu(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(f,y,m,g){return c(this,void 0,void 0,function*(){this.status="parsing",this.data=f,this.collisionBoxArray=new Oi;const e=new Fl(Object.keys(f.layers).sort()),t=new Ll(this.tileID,this.promoteId),r=(t.bucketLayerIDs=[],{}),n={featureIndex:t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:m},i=y.familiesBySource[this.source];for(const y in i){const g=f.layers[y];if(g){1===g.version&&le(`Vector tile source "${this.source}" layer "${y}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=e.encode(y),a=[];for(let e=0;e<g.length;e++){const f=g.feature(e),m=t.getId(f,y);a.push({feature:f,id:m,index:e,sourceLayerIndex:s})}for(const e of i[y]){const f=e[0];f.source!==this.source&&le(`layer.source = ${f.source} does not equal this.source = `+this.source),f.minzoom&&this.zoom<Math.floor(f.minzoom)||f.maxzoom&&this.zoom>=f.maxzoom||"none"!==f.visibility&&(_u(e,this.zoom,m),(r[f.id]=f.createBucket({index:t.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,n,this.tileID.canonical),t.bucketLayerIDs.push(e.map(e=>e.id)))}}}const s=O(n.glyphDependencies,e=>Object.keys(e).map(Number));this.inFlightDependencies.forEach(e=>null==e?void 0:e.abort()),this.inFlightDependencies=[];let a=Promise.resolve({});if(Object.keys(s).length){const e=new AbortController;this.inFlightDependencies.push(e),a=g.sendAsync({type:"GG",data:{stacks:s,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}var o=Object.keys(n.iconDependencies);let l=Promise.resolve({});if(o.length){const e=new AbortController;this.inFlightDependencies.push(e),l=g.sendAsync({type:"GI",data:{icons:o,source:this.source,tileID:this.tileID,type:"icons"}},e)}o=Object.keys(n.patternDependencies);let u=Promise.resolve({});if(o.length){const e=new AbortController;this.inFlightDependencies.push(e),u=g.sendAsync({type:"GI",data:{icons:o,source:this.source,tileID:this.tileID,type:"patterns"}},e)}var[c,h,o]=yield Promise.all([a,l,u]),p=new uu(c),d=new Xo(h,o);for(const e in r){const f=r[e];f instanceof bl?(_u(f.layers,this.zoom,m),su({bucket:f,glyphMap:c,glyphPositions:p.positions,imageMap:h,imagePositions:d.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):f.hasPattern&&(f instanceof uo||f instanceof Ca||f instanceof Ja)&&(_u(f.layers,this.zoom,m),f.addFeatures(n,this.tileID.canonical,d.patternPositions))}return this.status="done",{buckets:Object.values(r).filter(e=>!e.isEmpty()),featureIndex:t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:p.image,imageAtlas:d,glyphMap:this.returnDependencies?c:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?p.positions:null}})}}function _u(e,t,r){var n=new k(t);for(const t of e)t.recalculate(n,r)}class Su{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}}class ku{constructor(e,t,r){this.actor=e,this.layerIndex=t,this.availableImages=r,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(n,e){return c(this,void 0,void 0,function*(){t=n.request,r=e;var t=yield An(D(t,{type:"arrayBuffer"}),r);try{return{vectorTile:new Oa.VectorTile(new Uo(t.data)),rawData:t.data,cacheControl:t.cacheControl,expires:t.expires}}catch(e){var r=new Uint8Array(t.data),t=`Unable to parse the tile at ${n.request.url}, `;throw t+=31===r[0]&&139===r[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: "+e.message,new Error(t)}})}loadTile(u){return c(this,void 0,void 0,function*(){const t=u.uid,e=!!(u&&u.request&&u.request.collectResourceTiming)&&new Su(u.request),r=new wu(u);this.loading[t]=r;var n=new AbortController;r.abort=n;try{var i=yield this.loadVectorTile(u,n);if(delete this.loading[t],!i)return null;const a=i.rawData,o={},l=(i.expires&&(o.expires=i.expires),i.cacheControl&&(o.cacheControl=i.cacheControl),{});if(e){const t=e.finish();t&&(l.resourceTiming=JSON.parse(JSON.stringify(t)))}r.vectorTile=i.vectorTile;var s=r.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[t]=r,this.fetching[t]={rawTileData:a,cacheControl:o,resourceTiming:l};try{const t=yield s;return D({rawTileData:a.slice(0)},t,o,l)}finally{delete this.fetching[t]}}catch(e){throw delete this.loading[t],r.status="done",this.loaded[t]=r,e}})}reloadTile(s){return c(this,void 0,void 0,function*(){var t=s.uid;if(!this.loaded||!this.loaded[t])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[t];if(r.showCollisionBoxes=s.showCollisionBoxes,"parsing"===r.status){const s=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor);let e;if(this.fetching[t]){const{rawTileData:r,cacheControl:n,resourceTiming:i}=this.fetching[t];delete this.fetching[t],e=D({rawTileData:r.slice(0)},s,n,i)}else e=s;return e}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(r){return c(this,void 0,void 0,function*(){const e=this.loading,t=r.uid;e&&e[t]&&e[t].abort&&(e[t].abort.abort(),delete e[t])})}removeTile(e){return c(this,void 0,void 0,function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]})}}class Au{constructor(e,t,r,n=1,i=1,s=1,a=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&!["mapbox","terrarium","custom"].includes(r))le(`"${r}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);else{this.stride=t.height;var o=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),r){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=n,this.greenFactor=i,this.blueFactor=s,this.baseShift=a;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<o;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(o,e)]=this.data[this._idx(o-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,o)]=this.data[this._idx(e,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<o;t++)for(let e=0;e<o;e++){const r=this.get(t,e);r>this.max&&(this.max=r),r<this.min&&(this.min=r)}}}get(e,t){var r=new Uint8Array(this.data.buffer),e=4*this._idx(e,t);return this.unpack(r[e],r[1+e],r[2+e])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,r){return e*this.redFactor+t*this.greenFactor+r*this.blueFactor-this.baseShift}getPixels(){return new sa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,e,t){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,i=e*this.dim+this.dim,s=t*this.dim,a=t*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(t){case-1:s=a-1;break;case 1:a=s+1}var o=-e*this.dim,l=-t*this.dim;for(let t=s;t<a;t++)for(let e=n;e<i;e++)this.data[this._idx(e,t)]=r.data[this._idx(e+o,t+l)]}}r("DEMData",Au);class Iu{constructor(){this.loaded={}}loadTile(u){return c(this,void 0,void 0,function*(){var{uid:e,encoding:t,rawImageData:r,redFactor:n,greenFactor:i,blueFactor:s,baseShift:a}=u,o=r.width+2,l=r.height+2,o=U(r)?new sa({width:o,height:l},yield function(s,a,o){return c(this,void 0,void 0,function*(){if(function(){if(null==E&&(E=!1,T=null==T?"undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap:T)){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let e=0;e<25;e++){var t=4*e;n.fillStyle=`rgb(${t},${1+t},${2+t})`,n.fillRect(e%5,Math.floor(e/5),1,1)}var r=n.getImageData(0,0,5,5).data;for(let e=0;e<100;e++)if(e%4!=3&&r[e]!==e){E=!0;break}}}return E}())try{return yield function(h,p,d){return c(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(h,{timestamp:0});try{const l=null==e?void 0:e.format;if(!l||!l.startsWith("BGR")&&!l.startsWith("RGB"))throw new Error("Unrecognized format "+l);const u=l.startsWith("BGR"),c=new Uint8ClampedArray(p*d*4);if(yield e.copyTo(c,(t=h,r=p,n=d,i=4*Math.max(1,0),i=(Math.max(0,-1)- -1)*r*4+i,s=4*r,a=Math.max(0,-1),o=Math.max(0,-1),{rect:{x:a,y:o,width:Math.min(t.width,-1+r)-a,height:Math.min(t.height,-1+n)-o},layout:[{offset:i,stride:s}]})),u)for(let e=0;e<c.length;e+=4){const h=c[e];c[e]=c[e+2],c[e+2]=h}return c}finally{e.close()}var t,r,n,i,s,a,o})}(s,a,o)}catch(e){}return t=a,r=o,n=(e=s).width,i=e.height,N&&Z||(N=new OffscreenCanvas(n,i),Z=N.getContext("2d",{willReadFrequently:!0})),N.width=n,N.height=i,Z.drawImage(e,0,0,n,i),e=Z.getImageData(-1,-1,t,r),Z.clearRect(0,0,n,i),e.data;var e,t,r,n,i})}(r,o,l)):r,l=new Au(e,o,t,n,i,s,a);return this.loaded=this.loaded||{},this.loaded[e]=l})}removeTile(e){const t=this.loaded,r=e.uid;t&&t[r]&&delete t[r]}}function Mu(e,t){if(0!==e.length){zu(e[0],t);for(var r=1;r<e.length;r++)zu(e[r],!t)}}function zu(e,t){for(var r=0,n=0,i=0,s=e.length,a=s-1;i<s;a=i++){var o=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),l=r+o;n+=Math.abs(r)>=Math.abs(o)?r-l+o:o-l+r,r=l}0<=r+n!=!!t&&e.reverse()}var Pu=P(function e(t,r){var n,i=t&&t.type;if("FeatureCollection"===i)for(n=0;n<t.features.length;n++)e(t.features[n],r);else if("GeometryCollection"===i)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],r);else if("Feature"===i)e(t.geometry,r);else if("Polygon"===i)Mu(t.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<t.coordinates.length;n++)Mu(t.coordinates[n],r);return t});const Cu=Oa.VectorTileFeature.prototype.toGeoJSON;var ft={exports:{}},Bu=C,dt=Oa.VectorTileFeature,mt=Vu;function Vu(e,t){this.options=t||{},this.features=e,this.length=e.length}function Tu(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}Vu.prototype.feature=function(e){return new Tu(this.features[e],this.options.extent)},Tu.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],n=[],i=0;i<r.length;i++)n.push(new Bu(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},Tu.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,i=-1/0,s=0;s<e.length;s++)for(var a=e[s],o=0;o<a.length;o++)var l=a[o],t=Math.min(t,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y);return[t,n,r,i]},Tu.prototype.toGeoJSON=dt.prototype.toGeoJSON;var Eu=yt,Fu=mt;function Du(e){var t,r=new Eu,n=e,i=r;for(t in n.layers)i.writeMessage(3,Lu,n.layers[t]);return r.finish()}function Lu(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);for(var r={keys:[],values:[],keycache:{},valuecache:{}},n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,Ou,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var s=r.values;for(n=0;n<s.length;n++)t.writeMessage(4,Uu,s[n])}function Ou(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,$u,e),t.writeVarintField(3,r.type),t.writeMessage(4,qu,r)}function $u(e,t){var r,n=e.feature,i=e.keys,s=e.values,a=e.keycache,o=e.valuecache;for(r in n.properties){var l,u=n.properties[r],c=a[r];null!==u&&(void 0===c&&(i.push(r),a[r]=c=i.length-1),t.writeVarint(c),void 0===(l=o[c=(c=typeof u)+":"+(u="string"!=c&&"boolean"!=c&&"number"!=c?JSON.stringify(u):u)])&&(s.push(u),o[c]=l=s.length-1),t.writeVarint(l))}}function Ru(e,t){return(t<<3)+(7&e)}function ju(e){return e<<1^e>>31}function qu(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,s=0,a=r.length,o=0;o<a;o++){var l=r[o],u=1;1===n&&(u=l.length),t.writeVarint(Ru(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&t.writeVarint(Ru(2,c-1));var p=l[h].x-i,d=l[h].y-s;t.writeVarint(ju(p)),t.writeVarint(ju(d)),i+=p,s+=d}3===n&&t.writeVarint(15)}}function Uu(e,t){var r=typeof e;"string"==r?t.writeStringField(1,e):"boolean"==r?t.writeBooleanField(7,e):"number"==r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}ft.exports=Du,ft.exports.fromVectorTileJs=Du,ft.exports.fromGeojsonVt=function(e,t){t=t||{};var r,n={};for(r in e)n[r]=new Fu(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return Du({layers:n})},ft.exports.GeoJSONWrapper=Fu;var Nu,Zu=P(ft.exports);const Gu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");t=r>>4;if(1!=t)throw new Error(`Got v${t} data when expected v1.`);t=Gu[15&r];if(!t)throw new Error("Unrecognized array type.");var[r]=new Uint16Array(e,2,1),[n]=new Uint32Array(e,4,1);return new Xu(n,r,t,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var i=Gu.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,n,i,s,a){if(s-i<=n)return;const o=i+s>>1;Hu(t,r,o,i,s,a),e(t,r,n,i,o-1,1-a),e(t,r,n,1+o,s,1-a)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:a,nodeSize:e}=this,o=[0,s.length-1,0],l=[];for(;o.length;){var u=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=e)for(let e=h;e<=c;e++){const o=a[2*e],y=a[2*e+1];o>=t&&o<=n&&r<=y&&y<=i&&l.push(s[e])}else{var p=h+c>>1,d=a[2*p],f=a[2*p+1];t<=d&&d<=n&&r<=f&&f<=i&&l.push(s[p]),(0===u?t<=d:r<=f)&&(o.push(h),o.push(p-1),o.push(1-u)),(0===u?d<=n:f<=i)&&(o.push(1+p),o.push(c),o.push(1-u))}}return l}within(t,r,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:s}=this,a=[0,n.length-1,0],o=[],l=e*e;for(;a.length;){var u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=s)for(let e=h;e<=c;e++)Ku(i[2*e],i[2*e+1],t,r)<=l&&o.push(n[e]);else{var p=h+c>>1,d=i[2*p],f=i[2*p+1];Ku(d,f,t,r)<=l&&o.push(n[p]),(0===u?t-e<=d:r-e<=f)&&(a.push(h),a.push(p-1),a.push(1-u)),(0===u?d<=t+e:f<=r+e)&&(a.push(1+p),a.push(c),a.push(1-u))}}return o}}function Hu(r,n,i,s,a,o){for(;s<a;){600<a-s&&(l=a-s+1,u=i-s+1,h=Math.log(l),c=.5*Math.exp(2*h/3),h=.5*Math.sqrt(h*c*(l-c)/l)*(u-l/2<0?-1:1),Hu(r,n,i,Math.max(s,Math.floor(i-u*c/l+h)),Math.min(a,Math.floor(i+(l-u)*c/l+h)),o));var l,u,c,h,p=n[2*i+o];let e=s,t=a;for(Yu(r,n,s,i),n[2*a+o]>p&&Yu(r,n,s,a);e<t;){for(Yu(r,n,e,t),e++,t--;n[2*e+o]<p;)e++;for(;n[2*t+o]>p;)t--}n[2*s+o]===p?Yu(r,n,s,t):Yu(r,n,++t,a),t<=i&&(s=t+1),i<=t&&(a=t-1)}}function Yu(e,t,r,n){Ju(e,r,n),Ju(t,2*r,2*n),Ju(t,2*r+1,2*n+1)}function Ju(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Ku(e,t,r,n){e-=r,r=t-n;return e*e+r*r}const Wu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},Qu=Math.fround||(Nu=new Float32Array(1),e=>(Nu[0]=+e,Nu[0])),ec=3,tc=5,rc=6;class nc{constructor(e){this.options=Object.assign(Object.create(Wu),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:r,minZoom:n,maxZoom:i}=this.options,s=(r&&console.time("total time"),`prepare ${t.length} points`),a=(r&&console.time(s),this.points=t,[]);for(let e=0;e<t.length;e++){const n=t[e];if(n.geometry){const[i,s]=n.geometry.coordinates,o=Qu(ac(i)),l=Qu(oc(s));a.push(o,l,1/0,e,-1,1),this.options.reduce&&a.push(0)}}let o=this.trees[i+1]=this._createTree(a);r&&console.timeEnd(s);for(let e=i;e>=n;e--){const n=+Date.now();o=this.trees[e]=this._createTree(this._cluster(o,e)),r&&console.log("z%d: %d clusters in %dms",e,o.numItems,+Date.now()-n)}return r&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;var n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;var s=Math.max(-90,Math.min(90,e[3]));if(360<=e[2]-e[0])r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,s],t),a=this.getClusters([-180,n,i,s],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],o=a.range(ac(r),oc(s),ac(i),oc(n)),l=a.data,u=[];for(const e of o){const t=this.stride*e;u.push(1<l[t+tc]?ic(l,t,this.clusterProps):this.points[l[t+ec]])}return u}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var s=i.data;if(t*this.stride>=s.length)throw new Error(n);const a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),o=i.within(s[t*this.stride],s[t*this.stride+1],a),l=[];for(const t of o){const r=t*this.stride;s[4+r]===e&&l.push(1<s[r+tc]?ic(s,r,this.clusterProps):this.points[s[r+ec]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){var n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:s,radius:a}=this.options,o=a/s,l=(r-o)/i,u=(r+1+o)/i,c={features:[]};return this._addTileFeatures(n.range((t-o)/i,l,(t+1+o)/i,u),n.data,t,r,i,c),0===t&&this._addTileFeatures(n.range(1-o/i,l,1,u),n.data,i,r,i,c),t===i-1&&this._addTileFeatures(n.range(0,l,o/i,u),n.data,-1,r,i,c),c.features.length?c:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const s=this.getChildren(t);for(const t of s){const s=t.properties;if(s&&s.cluster?i+s.point_count<=n?i+=s.point_count:i=this._appendLeaves(e,s.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_createTree(t){const r=new Xu(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(n,i,s,a,o,l){for(const c of n){const n=c*this.stride,h=1<i[n+tc];let e,t,r;if(h)e=sc(i,n,this.clusterProps),t=i[n],r=i[1+n];else{const s=this.points[i[n+ec]],[a,o]=(e=s.properties,s.geometry.coordinates);t=ac(a),r=oc(o)}const p={type:1,geometry:[[Math.round(this.options.extent*(t*o-s)),Math.round(this.options.extent*(r*o-a))]],tags:e};var u=h||this.options.generateId?i[n+ec]:this.points[i[n+ec]].id;void 0!==u&&(p.id=u),l.features.push(p)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,a){const{radius:t,extent:o,reduce:l,minPoints:r}=this.options,n=t/(o*Math.pow(2,a)),u=e.data,c=[],h=this.stride;for(let s=0;s<u.length;s+=h)if(!(u[s+2]<=a)){u[s+2]=a;const o=u[s],f=u[s+1],y=e.within(u[s],u[s+1],n),m=u[s+tc];let i=m;for(const e of y){const t=e*h;u[2+t]>a&&(i+=u[t+tc])}if(i>m&&i>=r){let e,t=o*m,r=f*m,n=-1;var p,d=((s/h|0)<<5)+(a+1)+this.points.length;for(const o of y){const c=o*h;u[2+c]<=a||(u[2+c]=a,p=u[c+tc],t+=u[c]*p,r+=u[1+c]*p,u[4+c]=d,l&&(e||(e=this._map(u,s,!0),n=this.clusterProps.length,this.clusterProps.push(e)),l(e,this._map(u,c))))}u[s+4]=d,c.push(t/i,r/i,1/0,d,-1,i),l&&c.push(n)}else{for(let e=0;e<h;e++)c.push(u[s+e]);if(1<i)for(const e of y){const t=e*h;if(!(u[2+t]<=a)){u[2+t]=a;for(let e=0;e<h;e++)c.push(u[t+e])}}}}return c}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(1<e[t+tc]){const n=this.clusterProps[e[t+rc]];return r?Object.assign({},n):n}const n=this.points[e[t+ec]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function ic(e,t,r){return{type:"Feature",id:e[t+ec],properties:sc(e,t,r),geometry:{type:"Point",coordinates:[360*(e[t]-.5),function(e){e=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(e[t+1])]}}}function sc(e,t,r){var n=e[t+tc],i=1e4<=n?Math.round(n/1e3)+"k":1e3<=n?Math.round(n/100)/10+"k":n,s=e[t+rc],r=-1===s?{}:Object.assign({},r[s]);return Object.assign(r,{cluster:!0,cluster_id:e[t+ec],point_count:n,point_count_abbreviated:i})}function ac(e){return e/360+.5}function oc(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function lc(t,r,n,e){let i=e;var s=r+(n-r>>1);let a,o=n-r;var l=t[r],u=t[r+1],c=t[n],h=t[n+1];for(let e=r+3;e<n;e+=3){const r=function(e,t,r,n,i,s){let a=i-r,o=s-n;{var l;0===a&&0===o||(1<(l=((e-r)*a+(t-n)*o)/(a*a+o*o))?(r=i,n=s):0<l&&(r+=a*l,n+=o*l))}return a=e-r,o=t-n,a*a+o*o}(t[e],t[e+1],l,u,c,h);if(r>i)a=e,i=r;else if(r===i){const t=Math.abs(e-s);t<o&&(a=e,o=t)}}i>e&&(3<a-r&&lc(t,r,a,e),t[a+2]=i,3<n-a&&lc(t,a,n,e))}function uc(e,t,r,n){var i={id:null==e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)cc(i,r);else if("Polygon"===t)cc(i,r[0]);else if("MultiLineString"===t)for(const e of r)cc(i,e);else if("MultiPolygon"===t)for(const e of r)cc(i,e[0]);return i}function cc(t,r){for(let e=0;e<r.length;e+=3)t.minX=Math.min(t.minX,r[e]),t.minY=Math.min(t.minY,r[e+1]),t.maxX=Math.max(t.maxX,r[e]),t.maxY=Math.max(t.maxY,r[e+1])}function hc(r,n,i,s){if(n.geometry){const l=n.geometry.coordinates;if(!l||0!==l.length){var a=n.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let e=[],t=n.id;if(i.promoteId?t=n.properties[i.promoteId]:i.generateId&&(t=s||0),"Point"===a)pc(l,e);else if("MultiPoint"===a)for(const r of l)pc(r,e);else if("LineString"===a)dc(l,e,o,!1);else if("MultiLineString"===a){if(i.lineMetrics){for(const i of l)e=[],dc(i,e,o,!1),r.push(uc(t,"LineString",e,n.properties));return}fc(l,e,o,!1)}else if("Polygon"===a)fc(l,e,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"!==a)throw new Error("Input data is not a valid GeoJSON object.");for(const l of n.geometry.geometries)hc(r,{id:t,geometry:l,properties:n.properties},i,s);return}for(const r of l){const n=[];fc(r,n,o,!0),e.push(n)}}r.push(uc(t,a,e,n.properties))}}}function pc(e,t){t.push(yc(e[0]),mc(e[1]),0)}function dc(t,r,e,n){let i,s,a=0;for(let e=0;e<t.length;e++){const o=yc(t[e][0]),l=mc(t[e][1]);r.push(o,l,0),0<e&&(a+=n?(i*l-o*s)/2:Math.sqrt(Math.pow(o-i,2)+Math.pow(l-s,2))),i=o,s=l}const o=r.length-3;r[2]=1,lc(r,0,o,e),r[o+2]=1,r.size=Math.abs(a),r.start=0,r.end=r.size}function fc(t,r,n,i){for(let e=0;e<t.length;e++){var s=[];dc(t[e],s,n,i),r.push(s)}}function yc(e){return e/360+.5}function mc(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function gc(r,n,i,s,a,e,o,l){if(s/=n,e>=(i/=n)&&o<s)return r;if(o<i||s<=e)return null;const u=[];for(const n of r){const r=n.geometry;let t=n.type;const o=0===a?n.minX:n.minY,m=0===a?n.maxX:n.maxY;if(o>=i&&m<s)u.push(n);else if(!(m<i||o>=s)){let e=[];if("Point"===t||"MultiPoint"===t){c=void 0;h=void 0;p=void 0;d=void 0;f=void 0;y=void 0;var c=r;var h=e;var p=i;var d=s;var f=a;for(let e=0;e<c.length;e+=3){var y=c[e+f];p<=y&&y<=d&&wc(h,c[e],c[e+1],c[e+2])}}else if("LineString"===t)xc(r,e,i,s,a,!1,l.lineMetrics);else if("MultiLineString"===t)bc(r,e,i,s,a,!1);else if("Polygon"===t)bc(r,e,i,s,a,!0);else if("MultiPolygon"===t)for(const n of r){const r=[];bc(n,r,i,s,a,!0),r.length&&e.push(r)}if(e.length)if(l.lineMetrics&&"LineString"===t)for(const r of e)u.push(uc(n.id,t,r,n.tags));else"LineString"!==t&&"MultiLineString"!==t||(1===e.length?(t="LineString",e=e[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===e.length?"Point":"MultiPoint"),u.push(uc(n.id,t,e,n.tags))}}return u.length?u:null}function xc(r,n,i,s,a,o,l){let u=vc(r);const c=0===a?_c:Sc;let h,p,d=r.start;for(let t=0;t<r.length-3;t+=3){const f=r[t],y=r[t+1],m=r[t+2],g=r[t+3],x=r[t+4],v=0===a?f:y,b=0===a?g:x;let e=!1;l&&(h=Math.sqrt(Math.pow(f-g,2)+Math.pow(y-x,2))),v<i?i<b&&(p=c(u,f,y,g,x,i),l&&(u.start=d+h*p)):s<v?b<s&&(p=c(u,f,y,g,x,s),l&&(u.start=d+h*p)):wc(u,f,y,m),b<i&&i<=v&&(p=c(u,f,y,g,x,i),e=!0),s<b&&v<=s&&(p=c(u,f,y,g,x,s),e=!0),!o&&e&&(l&&(u.end=d+h*p),n.push(u),u=vc(r)),l&&(d+=h)}let e=r.length-3;const f=r[e],y=r[e+1],m=0===a?f:y;m>=i&&m<=s&&wc(u,f,y,r[e+2]),e=u.length-3,o&&3<=e&&(u[e]!==u[0]||u[e+1]!==u[1])&&wc(u,u[0],u[1],u[2]),u.length&&n.push(u)}function vc(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function bc(e,t,r,n,i,s){for(const a of e)xc(a,t,r,n,i,s,!1)}function wc(e,t,r,n){e.push(t,r,n)}function _c(e,t,r,n,i,s){n=(s-t)/(n-t);return wc(e,s,r+(i-r)*n,1),n}function Sc(e,t,r,n,i,s){i=(s-r)/(i-r);return wc(e,t+(n-t)*i,s,1),i}function kc(r,n){const i=[];for(let t=0;t<r.length;t++){var s=r[t],a=s.type;let e;if("Point"===a||"MultiPoint"===a||"LineString"===a)e=Ac(s.geometry,n);else if("MultiLineString"===a||"Polygon"===a){e=[];for(const r of s.geometry)e.push(Ac(r,n))}else if("MultiPolygon"===a){e=[];for(const r of s.geometry){const i=[];for(const o of r)i.push(Ac(o,n));e.push(i)}}i.push(uc(s.id,a,e,s.tags))}return i}function Ac(t,r){const n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(let e=0;e<t.length;e+=3)n.push(t[e]+r,t[e+1],t[e+2]);return n}function Ic(r,n){if(r.transformed)return r;var i=1<<r.z,s=r.x,a=r.y;for(const o of r.features){const r=o.geometry,e=o.type;if(o.geometry=[],1===e)for(let e=0;e<r.length;e+=2)o.geometry.push(Mc(r[e],r[e+1],n,i,s,a));else for(let t=0;t<r.length;t++){const l=[];for(let e=0;e<r[t].length;e+=2)l.push(Mc(r[t][e],r[t][e+1],n,i,s,a));o.geometry.push(l)}}return r.transformed=!0,r}function Mc(e,t,r,n,i,s){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-s))]}function zc(e,t,r,n,i){var s=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e){o=void 0;l=void 0;u=void 0;c=void 0;var o=a;var l=t;var u=s;var c=i;const h=l.geometry,p=l.type,d=[];if(o.minX=Math.min(o.minX,l.minX),o.minY=Math.min(o.minY,l.minY),o.maxX=Math.max(o.maxX,l.maxX),o.maxY=Math.max(o.maxY,l.maxY),"Point"===p||"MultiPoint"===p)for(let e=0;e<h.length;e+=3)d.push(h[e],h[e+1]),o.numPoints++,o.numSimplified++;else if("LineString"===p)Pc(d,h,o,u,!1,!1);else if("MultiLineString"===p||"Polygon"===p)for(let e=0;e<h.length;e++)Pc(d,h[e],o,u,"Polygon"===p,0===e);else if("MultiPolygon"===p)for(let e=0;e<h.length;e++){const c=h[e];for(let e=0;e<c.length;e++)Pc(d,c[e],o,u,!0,0===e)}if(d.length){let e=l.tags||null;if("LineString"===p&&c.lineMetrics){e={};for(const o in l.tags)e[o]=l.tags[o];e.mapbox_clip_start=h.start/h.size,e.mapbox_clip_end=h.end/h.size}const f={geometry:d,type:"Polygon"===p||"MultiPolygon"===p?3:"LineString"===p||"MultiLineString"===p?2:1,tags:e};null!==l.id&&(f.id=l.id),o.features.push(f)}}return a}function Pc(e,t,r,n,i,s){var a=n*n;if(0<n&&t.size<(i?a:n))return r.numPoints+=t.length/3;const o=[];for(let e=0;e<t.length;e+=3)(0===n||t[e+2]>a)&&(r.numSimplified++,o.push(t[e],t[e+1])),r.numPoints++;if(i){var l=o;i=s;let n=0;for(let e=0,t=l.length,r=t-2;e<t;r=e,e+=2)n+=(l[e]-l[r])*(l[e+1]+l[r+1]);if(0<n===i)for(let e=0,t=l.length;e<t/2;e+=2){var u=l[e],c=l[e+1];l[e]=l[t-2-e],l[e+1]=l[t-1-e],l[t-2-e]=u,l[t-1-e]=c}}e.push(o)}const Cc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bc{constructor(e,t){var r=(t=this.options=function(e,t){for(const r in t)e[r]=t[r];return e}(Object.create(Cc),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");e=function(t,r){var n=[];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;e++)hc(n,t.features[e],r,e);else hc(n,"Feature"===t.type?t:{geometry:t},r);return n}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(e=function(e,t){var r=t.buffer/t.extent;let n=e;var i=gc(e,1,-1-r,r,0,-1,2,t),s=gc(e,1,1-r,2+r,0,-1,2,t);return(i||s)&&(n=gc(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=kc(i,1).concat(n)),s&&(n=n.concat(kc(s,-1)))),n}(e,t)).length&&this.splitTile(e,0,0,0),r&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(o,l,u,c,e,t,r){const h=[o,l,u,c],p=this.options,d=p.debug;for(;h.length;){c=h.pop(),u=h.pop(),l=h.pop(),o=h.pop();var f=1<<l,y=Vc(l,u,c);let a=this.tiles[y];if(!a&&(1<d&&console.time("creation"),a=this.tiles[y]=zc(o,l,u,c,p),this.tileCoords.push({z:l,x:u,y:c}),d)){1<d&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",l,u,c,a.numFeatures,a.numPoints,a.numSimplified),console.timeEnd("creation"));const o="z"+l;this.stats[o]=(this.stats[o]||0)+1,this.total++}if(a.source=o,null==e){if(l===p.indexMaxZoom||a.numPoints<=p.indexMaxPoints)continue}else{if(l===p.maxZoom||l===e)continue;if(null!=e){const o=e-l;if(u!==t>>o||c!==r>>o)continue}}if(a.source=null,0!==o.length){1<d&&console.time("clipping");var y=.5*p.buffer/p.extent,m=.5-y,g=.5+y,x=1+y;let e=null,t=null,r=null,n=null,i=gc(o,f,u-y,u+g,0,a.minX,a.maxX,p),s=gc(o,f,u+m,u+x,0,a.minX,a.maxX,p);o=null,i&&(e=gc(i,f,c-y,c+g,1,a.minY,a.maxY,p),t=gc(i,f,c+m,c+x,1,a.minY,a.maxY,p),0),s&&(r=gc(s,f,c-y,c+g,1,a.minY,a.maxY,p),n=gc(s,f,c+m,c+x,1,a.minY,a.maxY,p),0),1<d&&console.timeEnd("clipping"),h.push(e||[],l+1,2*u,2*c),h.push(t||[],l+1,2*u,2*c+1),h.push(r||[],l+1,2*u+1,2*c),h.push(n||[],l+1,2*u+1,2*c+1)}}}getTile(e,t,r){var{extent:n,debug:i}=this.options;if((e=+e)<0||24<e)return null;var s=1<<e,s=Vc(e,t=(t=+t)+s&s-1,r=+r);if(this.tiles[s])return Ic(this.tiles[s],n);1<i&&console.log("drilling down to z%d-%d-%d",e,t,r);let a,o=e,l=t,u=r;for(;!a&&0<o;)o--,l>>=1,u>>=1,a=this.tiles[Vc(o,l,u)];return a&&a.source?(1<i&&(console.log("found parent tile z%d-%d-%d",o,l,u),console.time("drilling down")),this.splitTile(a.source,o,l,u,e,t,r),1<i&&console.timeEnd("drilling down"),this.tiles[s]?Ic(this.tiles[s],n):null):null}}function Vc(e,t,r){return 32*((1<<e)*r+t)+e}function Tc(e,t){return t?e.properties[t]:e.id}function Ec(e,t){if(null==e)return 1;if("Feature"===e.type)return null!=Tc(e,t);if("FeatureCollection"===e.type){const r=new Set;for(const n of e.features){const e=Tc(n,t);if(null==e)return;if(r.has(e))return;r.add(e)}return 1}}function Fc(e,t){const r=new Map;if(null!=e)if("Feature"===e.type)r.set(Tc(e,t),e);else for(const n of e.features)r.set(Tc(n,t),n);return r}class Dc extends ku{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(r,e){return c(this,void 0,void 0,function*(){var e=r.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");e=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!e)return null;e=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=ue,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=ue,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const t of this._feature.geometry)e.push([new L(t[0],t[1])]);return e}{const r=[];for(const n of this._feature.geometry){const i=[];for(const s of n)i.push(new L(s[0],s[1]));r.push(i)}return r}}toGeoJSON(e,t,r){return Cu.call(this,e,t,r)}}(this._features[e])}}(e.features);let t=Zu(e);return{vectorTile:e,rawData:(t=0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t:new Uint8Array(t)).buffer}})}loadData(n){return c(this,void 0,void 0,function*(){var e,t;null!=(e=this._pendingRequest)&&e.abort();const r=!!(n&&n.request&&n.request.collectResourceTiming)&&new Su(n.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(n,this._pendingRequest),this._geoJSONIndex=n.cluster?new nc(function({superclusterOptions:e,clusterProperties:t}){if(!t||!e)return e;const r={},n={},i={accumulated:null,zoom:0},s={properties:null},a=Object.keys(t);for(const e of a){const[i,s]=t[e],a=Pr(s),o=Pr("string"==typeof i?[i,["accumulated"],["get",e]]:i);r[e]=a.value,n[e]=o.value}return e.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=r[e].evaluate(i,s);return t},e.reduce=(e,t)=>{s.properties=t;for(const t of a)i.accumulated=e[t],e[t]=n[t].evaluate(i,s)},e}(n)).load((yield this._pendingData).features):(t=yield this._pendingData,new Bc(t,n.geojsonVtOptions)),this.loaded={};const e={};if(r){const t=r.finish();t&&(e.resourceTiming={},e.resourceTiming[n.source]=JSON.parse(JSON.stringify(t)))}return e}catch(e){if(delete this._pendingRequest,e.message===xn)return{abandoned:!0};throw e}})}getData(){return c(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(e){var t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(r,n){return c(this,void 0,void 0,function*(){let e=yield this.loadGeoJSON(r,n);if(delete this._pendingRequest,"object"!=typeof e)throw new Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`);if(Pu(e,!0),r.filter){const n=Pr(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(e=>e.key+": "+e.message).join(", "));var t=e.features.filter(e=>n.value.evaluate({zoom:0},e));e={type:"FeatureCollection",features:t}}return e})}loadGeoJSON(l,u){return c(this,void 0,void 0,function*(){var e,t,r,n=l["promoteId"];if(l.request)return e=l.request,t=u,e=yield An(D(e,{type:"json"}),t),this._dataUpdateable=Ec(e.data,n)?Fc(e.data,n):void 0,e.data;if("string"==typeof l.data)try{const u=JSON.parse(l.data);return this._dataUpdateable=Ec(u,n)?Fc(u,n):void 0,u}catch(n){throw new Error(`Input data given to '${l.source}' is not a valid GeoJSON object.`)}if(!l.dataDiff)throw new Error(`Input data given to '${l.source}' is not a valid GeoJSON object.`);if(this._dataUpdateable){{var i=this._dataUpdateable;var s=l.dataDiff;var a=n;if(s.removeAll&&i.clear(),s.remove)for(const a of s.remove)i.delete(a);if(s.add)for(const o of s.add){const s=Tc(o,a);null!=s&&i.set(s,o)}if(s.update)for(const a of s.update){let e=i.get(a.id);if(null!=e){var o=!a.removeAllProperties&&(0<(null==(o=a.removeProperties)?void 0:o.length)||0<(null==(o=a.addOrUpdateProperties)?void 0:o.length));if((a.newGeometry||a.removeAllProperties||o)&&(e=Object.assign({},e),i.set(a.id,e),o&&(e.properties=Object.assign({},e.properties))),a.newGeometry&&(e.geometry=a.newGeometry),a.removeAllProperties)e.properties={};else if(0<(null==(r=a.removeProperties)?void 0:r.length))for(const i of a.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,i)&&delete e.properties[i];if(0<(null==(r=a.addOrUpdateProperties)?void 0:r.length))for(const{key:i,value:o}of a.addOrUpdateProperties)e.properties[i]=o}}}return{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}throw new Error("Cannot update existing geojson data in "+l.source)})}removeSource(e){return c(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class Lc{constructor(e){this.self=e,this.actor=new En(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=wn,this.self.removeProtocol=_n,this.self.registerRTLTextPlugin=e=>{if(Y.isParsed())throw new Error("RTL text plugin already registered.");Y.setMethods(e)},this.actor.registerMessageHandler("LDT",(e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t)),this.actor.registerMessageHandler("RDT",(e,t)=>c(this,void 0,void 0,function*(){this._getDEMWorkerSource(e,t.source).removeTile(t)})),this.actor.registerMessageHandler("GCEZ",(e,t)=>c(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterExpansionZoom(t)})),this.actor.registerMessageHandler("GCC",(e,t)=>c(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterChildren(t)})),this.actor.registerMessageHandler("GCL",(e,t)=>c(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterLeaves(t)})),this.actor.registerMessageHandler("LD",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t)),this.actor.registerMessageHandler("GD",(e,t)=>this._getWorkerSource(e,t.type,t.source).getData()),this.actor.registerMessageHandler("LT",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t)),this.actor.registerMessageHandler("RT",(e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t)),this.actor.registerMessageHandler("AT",(e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t)),this.actor.registerMessageHandler("RMT",(e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t)),this.actor.registerMessageHandler("RS",(t,r)=>c(this,void 0,void 0,function*(){if(this.workerSources[t]&&this.workerSources[t][r.type]&&this.workerSources[t][r.type][r.source]){const e=this.workerSources[t][r.type][r.source];delete this.workerSources[t][r.type][r.source],void 0!==e.removeSource&&e.removeSource(r)}})),this.actor.registerMessageHandler("RM",e=>c(this,void 0,void 0,function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})),this.actor.registerMessageHandler("SR",(e,t)=>c(this,void 0,void 0,function*(){this.referrer=t})),this.actor.registerMessageHandler("SRPS",(e,t)=>this._syncRTLPluginState(e,t)),this.actor.registerMessageHandler("IS",(e,t)=>c(this,void 0,void 0,function*(){this.self.importScripts(t)})),this.actor.registerMessageHandler("SI",(e,t)=>this._setImages(e,t)),this.actor.registerMessageHandler("UL",(e,t)=>c(this,void 0,void 0,function*(){this._getLayerIndex(e).update(t.layers,t.removedIds)})),this.actor.registerMessageHandler("SL",(e,t)=>c(this,void 0,void 0,function*(){this._getLayerIndex(e).replace(t)}))}_setImages(n,i){return c(this,void 0,void 0,function*(){this.availableImages[n]=i;for(const e in this.workerSources[n]){const t=this.workerSources[n][e];for(const r in t)t[r].availableImages=i}})}_syncRTLPluginState(e,r){return c(this,void 0,void 0,function*(){if(Y.isParsed())return Y.getState();if("loading"!==r.pluginStatus)return Y.setState(r),r;var e,t=r.pluginURL;if(this.self.importScripts(t),Y.isParsed())return e={pluginStatus:"loaded",pluginURL:t},Y.setState(e),e;throw Y.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from "+t)})}_getAvailableImages(e){let t=this.availableImages[e];return t=t||[]}_getLayerIndex(e){let t=this.layerIndexes[e];return t=t||(this.layerIndexes[e]=new El)}_getWorkerSource(r,e,t){if(this.workerSources[r]||(this.workerSources[r]={}),this.workerSources[r][e]||(this.workerSources[r][e]={}),!this.workerSources[r][e][t]){var n={sendAsync:(e,t)=>(e.targetMapId=r,this.actor.sendAsync(e,t))};switch(e){case"vector":this.workerSources[r][e][t]=new ku(n,this._getLayerIndex(r),this._getAvailableImages(r));break;case"geojson":this.workerSources[r][e][t]=new Dc(n,this._getLayerIndex(r),this._getAvailableImages(r));break;default:this.workerSources[r][e][t]=new this.externalWorkerSourceTypes[e](n,this._getLayerIndex(r),this._getAvailableImages(r))}}return this.workerSources[r][e][t]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new Iu),this.demWorkerSources[e][t]}}return q(self)&&(self.worker=new Lc(self)),Lc}();