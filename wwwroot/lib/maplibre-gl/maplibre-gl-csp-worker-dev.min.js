var maplibregl=function(){"use strict";function p(e,s,o,l){return new(o=o||Promise)(function(r,t){function i(e){try{a(l.next(e))}catch(e){t(e)}}function n(e){try{a(l.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,n)}a((l=l.apply(e,s||[])).next())})}Object.create;Object.create;function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=B;function B(e,t){this.x=e,this.y=t}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,e=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=e,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),r=t*this.x-e*this.y,e=e*this.x+t*this.y;return this.x=r,this.y=e,this},_rotateAround:function(e,t){var r=Math.cos(e),e=Math.sin(e),i=t.x+r*(this.x-t.x)-e*(this.y-t.y),e=t.y+e*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(e){return!(e instanceof B)&&Array.isArray(e)?new B(e[0],e[1]):e};var O=P(C),V=T;function T(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}T.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var r=e,i=0;i<8;i++){var n=this.sampleCurveX(r)-e;if(Math.abs(n)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=n/a}for(var s=0,o=1,r=e,i=0;i<20&&(n=this.sampleCurveX(r),!(Math.abs(n-e)<t));i++)n<e?s=r:o=r,r=.5*(o-s)+s;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var E=P(V);let F;let D;function L(){if(null==D&&(D=!1,F=null==F?"undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap:F)){const e=new OffscreenCanvas(5,5),i=e.getContext("2d",{willReadFrequently:!0});if(i){for(let e=0;e<25;e++){var t=4*e;i.fillStyle=`rgb(${t},${1+t},${2+t})`,i.fillRect(e%5,Math.floor(e/5),1,1)}var r=i.getImageData(0,0,5,5).data;for(let e=0;e<100;e++)if(e%4!=3&&r[e]!==e){D=!0;break}}}return D}!function(e,t,r,i){const n=new E(e,t,r,i)}(.25,.1,.25,1);function $(e,t,r){return Math.min(r,Math.max(t,e))}function R(e,...t){for(const r of t)for(const i in r)e[i]=r[i];return e}function j(e,t,r){const i={};for(const n in e)i[n]=t.call(r||this,e[n],n,e);return i}function q(e){return Array.isArray(e)?e.map(q):"object"==typeof e&&e?j(e,q):e}const U={};function ue(e){U[e]||("undefined"!=typeof console&&console.warn(e),U[e]=!0)}function N(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Z(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}function G(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function X(f,y,m,g,v){return p(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(f,{timestamp:0});try{const p=null===e||void 0===e?void 0:e.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error("Unrecognized format "+p);var t=p.startsWith("BGR");const d=new Uint8ClampedArray(g*v*4);if(yield e.copyTo(d,(i=f,n=y,a=m,s=g,o=v,l=4*Math.max(-n,0),l=(Math.max(0,a)-a)*s*4+l,u=4*s,h=Math.max(0,n),c=Math.max(0,a),{rect:{x:h,y:c,width:Math.min(i.width,n+s)-h,height:Math.min(i.height,a+o)-c},layout:[{offset:l,stride:u}]})),t)for(let e=0;e<d.length;e+=4){var r=d[e];d[e]=d[e+2],d[e+2]=r}return d}finally{e.close()}var i,n,a,s,o,l,u,h,c})}let H,Y;function J(o,l,u,h,c){return p(this,void 0,void 0,function*(){if(L())try{return yield X(o,l,u,h,c)}catch(e){}return t=l,r=u,i=h,n=c,a=(e=o).width,s=e.height,H&&Y||(H=new OffscreenCanvas(a,s),Y=H.getContext("2d",{willReadFrequently:!0})),H.width=a,H.height=s,Y.drawImage(e,0,0,a,s),e=Y.getImageData(t,r,i,n),Y.clearRect(0,0,a,s),e.data;var e,t,r,i,n,a,s})}class K{constructor(e,t,r){const i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const l=new Int32Array(this.arrayBuffer);e=l[0],t=l[1],r=l[2],this.d=t+2*r;for(let e=0;e<this.d*this.d;e++){var n=l[3+e],a=l[3+e+1];i.push(n===a?null:l.subarray(n,a))}var s=l[3+i.length],o=l[3+i.length+1];this.keys=l.subarray(s,o),this.bboxes=l.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*r;for(let e=0;e<this.d*this.d;e++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;s=r/t*e;this.min=-s,this.max=e+s}insert(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,r,i,n,a){this.cells[n].push(a)}query(e,t,r,i,n){var a=this.min,s=this.max;return e<=a&&t<=a&&s<=r&&s<=i&&!n?Array.prototype.slice.call(this.keys):(this._forEachCell(e,t,r,i,this._queryCell,a=[],{},n),a)}_queryCell(t,r,i,n,e,a,s,o){var l=this.cells[e];if(null!==l){var u=this.keys,h=this.bboxes;for(let e=0;e<l.length;e++){var c,p=l[e];void 0===s[p]&&(c=4*p,(o?o(h[0+c],h[1+c],h[2+c],h[3+c]):t<=h[2+c]&&r<=h[3+c]&&i>=h[0+c]&&n>=h[1+c])?(s[p]=!0,a.push(u[p])):s[p]=!1)}}}_forEachCell(r,i,n,a,s,o,l,u){var e=this._convertToCellCoord(r),h=this._convertToCellCoord(i),c=this._convertToCellCoord(n),p=this._convertToCellCoord(a);for(let t=e;t<=c;t++)for(let e=h;e<=p;e++){var d=this.d*e+t;if((!u||u(this._convertFromCellCoord(t),this._convertFromCellCoord(e),this._convertFromCellCoord(t+1),this._convertFromCellCoord(e+1)))&&s.call(this,r,i,n,a,d,o,l,u))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;var t=this.cells,e=3+this.cells.length+1+1;let r=0;for(let e=0;e<this.cells.length;e++)r+=this.cells[e].length;const i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let n=e;for(let e=0;e<t.length;e++){var a=t[e];i[3+e]=n,i.set(a,n),n+=a.length}return i[3+t.length]=n,i.set(this.keys,n),n+=this.keys.length,i[3+t.length+1]=n,i.set(this.bboxes,n),n+=this.bboxes.length,i.buffer}static serialize(e,t){e=e.toArrayBuffer();return t&&t.push(e),{buffer:e}}static deserialize(e){return new K(e.buffer)}}var l={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const W=["type","source","source-layer","minzoom","maxzoom","filter","layout"];class d{constructor(e,t,r,i){this.message=(e?e+": ":"")+r,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Q(e,...t){for(const r of t)for(const i in r)e[i]=r[i];return e}class ee extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class te{constructor(e,t=[]){this.parent=e,this.bindings={};for(var[r,i]of t)this.bindings[r]=i}concat(e){return new te(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const re={kind:"null"},f={kind:"number"},u={kind:"string"},h={kind:"boolean"},ie={kind:"color"},se={kind:"object"},c={kind:"value"};const oe={kind:"collator"},le={kind:"formatted"},de={kind:"padding"},fe={kind:"resolvedImage"},ye={kind:"variableAnchorOffsetCollection"};function y(e,t){return{kind:"array",itemType:e,N:t}}function g(e){var t;return"array"===e.kind?(t=g(e.itemType),"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`):e.kind}const me=[re,f,u,h,ie,le,se,y(c),de,fe,ye];function ge(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ge(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const r of me)if(!ge(r,t))return null}return`Expected ${g(e)} but found ${g(t)} instead.`}function ve(t,e){return e.some(e=>e.kind===t.kind)}function xe(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function be(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const we=.96422,_e=1,Se=.82521,ke=4/29,Ae=6/29,Ie=3*Ae*Ae,Me=Ae*Ae*Ae,ze=Math.PI/180,Pe=180/Math.PI;function Ce(e){return(e%=360)<0&&(e+=360),e}function Be([e,t,r,i]){let n,a;var s=Te((.2225045*(e=Ve(e))+.7168786*(t=Ve(t))+.0606169*(r=Ve(r)))/_e),e=(e===t&&t===r?n=a=s:(n=Te((.4360747*e+.3850649*t+.1430804*r)/we),a=Te((.0139322*e+.0971045*t+.7141733*r)/Se)),116*s-16);return[e<0?0:e,500*(n-s),200*(s-a),i]}function Ve(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Te(e){return e>Me?Math.pow(e,1/3):e/Ie+ke}function Ee([e,t,r,i]){let n=(e+16)/116,a=isNaN(t)?n:n+t/500,s=isNaN(r)?n:n-r/200;return n=_e*De(n),a=we*De(a),s=Se*De(s),[Fe(3.1338561*a-1.6168667*n-.4906146*s),Fe(-.9787684*a+1.9161415*n+.033454*s),Fe(.0719453*a-.2289914*n+1.4052427*s),i]}function Fe(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:1<e?1:e}function De(e){return e>Ae?e*e*e:Ie*(e-ke)}function Le(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];var t=qe[e];if(t)return[t,i,r]=t,[t/255,i/255,r/255,1];if(e.startsWith("#")){const l=/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/;if(l.test(e))return t=e.length<6?1:2,[Oe(e.slice(i=1,i+=t)),Oe(e.slice(i,i+=t)),Oe(e.slice(i,i+=t)),Oe(e.slice(i,i+t)||"ff")]}if(e.startsWith("rgb")){var r=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(r){const[,u,h,c,p,d,f,y,m,g,v,x]=r;var i=[c||" ",f||" ",g].join("");if("  "===i||"  /"===i||",,"===i||",,,"===i){t=[h,d,m].join(""),r="%%%"===t?100:""===t?255:0;if(r){i=[Re(+u/r,0,1),Re(+p/r,0,1),Re(+y/r,0,1),v?$e(+v,x):1];if(je(i))return i}}return}}var n,a,s,t=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[,b,w,_,S,k,A,I,M]=t;r=[w||" ",S||" ",A].join("");if("  "===r||"  /"===r||",,"===r||",,,"===r){i=[+b,Re(+_,0,100),Re(+k,0,100),I?$e(+I,M):1];if(je(i))return[n,a,s,e]=[i][0],n=Ce(n),a/=100,s/=100,[o(0),o(8),o(4),e]}}function o(e){var e=(e+n/30)%12,t=a*Math.min(s,1-s);return s-t*Math.max(-1,Math.min(e-3,9-e,1))}}function Oe(e){return parseInt(e.padEnd(2,e),16)/255}function $e(e,t){return Re(t?e/100:e,0,1)}function Re(e,t,r){return Math.min(Math.max(t,e),r)}function je(e){return!e.some(Number.isNaN)}const qe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class v{constructor(e,t,r,i=1,n=!0){this.r=e,this.g=t,this.b=r,this.a=i,n||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,r,i]))}static parse(e){if(e instanceof v)return e;if("string"==typeof e)return e=Le(e),e?new v(...e,!1):void 0}get rgb(){var{r:e,g:t,b:r,a:i}=this,n=i||1/0;return this.overwriteGetter("rgb",[e/n,t/n,r/n,i])}get hcl(){return this.overwriteGetter("hcl",function(e){var[e,t,r,i]=Be(e),n=Math.sqrt(t*t+r*r);return[Math.round(1e4*n)?Ce(Math.atan2(r,t)*Pe):NaN,n,e,i]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Be(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,i]=this.rgb;return`rgba(${[e,t,r].map(e=>Math.round(255*e)).join(",")},${i})`}}v.black=new v(0,0,0,1),v.white=new v(1,1,1,1),v.transparent=new v(0,0,0,0),v.red=new v(1,0,0,1);class Ue{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class Ne{constructor(e,t,r,i,n){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=n}}class M{constructor(e){this.sections=e}static fromString(e){return new M([new Ne(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof M?e:M.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}}class x{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof x)return e;if("number"==typeof e)return new x([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||4<e.length)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new x(e)}}toString(){return JSON.stringify(this.values)}}const Ze=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ge{constructor(e){this.values=e.slice()}static parse(t){if(t instanceof Ge)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){var r=t[e],i=t[e+1];if("string"!=typeof r||!Ze.has(r))return;if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new Ge(t)}}toString(){return JSON.stringify(this.values)}}class Xe{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Xe({name:e,available:!1}):null}}function He(e,t,r,i){if("number"==typeof e&&0<=e&&e<=255&&"number"==typeof t&&0<=t&&t<=255&&"number"==typeof r&&0<=r&&r<=255)return void 0===i||"number"==typeof i&&0<=i&&i<=1?null:`Invalid rgba value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`;{const n="number"==typeof i?[e,t,r,i]:[e,t,r];return`Invalid rgba value [${n.join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}}function Ye(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof v||e instanceof Ue||e instanceof M||e instanceof x||e instanceof Ge||e instanceof Xe)return 1;if(Array.isArray(e)){for(const t of e)if(!Ye(t))return;return 1}if("object"==typeof e){for(const r in e)if(!Ye(e[r]))return;return 1}}function m(t){if(null===t)return re;if("string"==typeof t)return u;if("boolean"==typeof t)return h;if("number"==typeof t)return f;if(t instanceof v)return ie;if(t instanceof Ue)return oe;if(t instanceof M)return le;if(t instanceof x)return de;if(t instanceof Ge)return ye;if(t instanceof Xe)return fe;if(Array.isArray(t)){var r=t.length;let e;for(const n of t){var i=m(n);if(e){if(e!==i){e=c;break}}else e=i}return y(e||c,r)}return se}function Je(e){var t=typeof e;return null===e?"":"string"==t||"number"==t||"boolean"==t?String(e):e instanceof v||e instanceof M||e instanceof x||e instanceof Ge||e instanceof Xe?e.toString():JSON.stringify(e)}class Ke{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ye(e[1]))return t.error("invalid value");e=e[1];let r=m(e);t=t.expectedType;return"array"!==r.kind||0!==r.N||!t||"array"!==t.kind||"number"==typeof t.N&&0!==t.N||(r=t),new Ke(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class b{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const We={string:u,number:f,boolean:h,object:se};class Qe{constructor(e,t){this.type=e,this.args=t}static parse(r,i){if(r.length<2)return i.error("Expected at least one argument.");let n=1,a;var e=r[0];if("array"===e){let e;if(2<r.length){const a=r[1];if("string"!=typeof a||!(a in We)||"object"===a)return i.error('The item type argument of "array" must be one of string, number, boolean',1);e=We[a],n++}else e=c;let t;if(3<r.length){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return i.error('The length argument to "array" must be a positive integer literal',2);t=r[2],n++}a=y(e,t)}else{if(!We[e])throw new Error("Types doesn't contain name = "+e);a=We[e]}const t=[];for(;n<r.length;n++){var s=i.parse(r[n],n,c);if(!s)return null;t.push(s)}return new Qe(a,t)}evaluate(t){for(let e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!ge(this.type,m(r)))return r;if(e===this.args.length-1)throw new b(`Expected value to be of type ${g(this.type)}, but found ${g(m(r))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const et={"to-boolean":h,"to-color":ie,"to-number":f,"to-string":u};class tt{constructor(e,t){this.type=e,this.args=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");var e=t[0];if(!et[e])throw new Error(`Can't parse ${e} as it is not part of the known types`);if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return r.error("Expected one argument.");e=et[e];const i=[];for(let e=1;e<t.length;e++){var n=r.parse(t[e],e,c);if(!n)return null;i.push(n)}return new tt(e,i)}evaluate(r){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(r));case"color":{let e,t;for(const s of this.args){if(e=s.evaluate(r),t=null,e instanceof v)return e;if("string"==typeof e){var i=r.parseColor(e);if(i)return i}else if(Array.isArray(e)&&!(t=e.length<3||4<e.length?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:He(e[0],e[1],e[2],e[3])))return new v(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new b(t||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const o of this.args){e=o.evaluate(r);var t=x.parse(e);if(t)return t}throw new b(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const l of this.args){e=l.evaluate(r);var n=Ge.parse(e);if(n)return n}throw new b(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const u of this.args){if(null===(e=u.evaluate(r)))return 0;var a=Number(e);if(!isNaN(a))return a}throw new b(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return M.fromString(Je(this.args[0].evaluate(r)));case"resolvedImage":return Xe.fromString(Je(this.args[0].evaluate(r)));default:return Je(this.args[0].evaluate(r))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const rt=["Unknown","Point","LineString","Polygon"];class it{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?rt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t=t||(this._parseColorCache[e]=v.parse(e))}}class nt{constructor(e,t,r=[],i,n=new te,a=[]){this.registry=e,this.path=r,this.key=r.map(e=>`[${e}]`).join(""),this.scope=n,this.errors=a,this.expectedType=i,this._isConstant=t}parse(e,t,r,i,n={}){return(t?this.concat(t,r,i):this)._parse(e,n)}_parse(t,r){function i(e,t,r){return"assert"===r?new Qe(t,[e]):"coerce"===r?new tt(t,[e]):e}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var e=t[0];if("string"!=typeof e)return this.error(`Expression name must be a string, but found ${typeof e} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[e];if(s){let e=s.parse(t,this);if(!e)return null;if(this.expectedType){var n=this.expectedType,a=e.type;if("string"!==n.kind&&"number"!==n.kind&&"boolean"!==n.kind&&"object"!==n.kind&&"array"!==n.kind||"value"!==a.kind)if("color"!==n.kind&&"formatted"!==n.kind&&"resolvedImage"!==n.kind||"value"!==a.kind&&"string"!==a.kind)if("padding"!==n.kind||"value"!==a.kind&&"number"!==a.kind&&"array"!==a.kind)if("variableAnchorOffsetCollection"!==n.kind||"value"!==a.kind&&"array"!==a.kind){if(this.checkSubtype(n,a))return null}else e=i(e,n,r.typeAnnotation||"coerce");else e=i(e,n,r.typeAnnotation||"coerce");else e=i(e,n,r.typeAnnotation||"coerce");else e=i(e,n,r.typeAnnotation||"assert")}if(!(e instanceof Ke)&&"resolvedImage"!==e.type.kind&&this._isConstant(e)){a=new it;try{e=new Ke(e.type,e.evaluate(a))}catch(e){return this.error(e.message),null}}return e}return this.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(e,t,r){e="number"==typeof e?this.path.concat(e):this.path,r=r?this.scope.concat(r):this.scope;return new nt(this.registry,this._isConstant,e,t||null,r,this.errors)}error(e,...t){t=""+this.key+t.map(e=>`[${e}]`).join("");this.errors.push(new ee(t,e))}checkSubtype(e,t){e=ge(e,t);return e&&this.error(e),e}}class at{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let e=1;e<t.length-1;e+=2){var n=t[e];if("string"!=typeof n)return r.error(`Expected string, but found ${typeof n} instead.`,e);if(/[^a-zA-Z0-9_]/.test(n))return r.error("Variable names must contain only alphanumeric characters or '_'.",e);var a=r.parse(t[e+1],e+1);if(!a)return null;i.push([n,a])}var e=r.parse(t[t.length-1],t.length-1,r.expectedType,i);return e?new at(i,e):null}outputDefined(){return this.result.outputDefined()}}class st{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");e=e[1];return t.scope.has(e)?new st(e,t.scope.get(e)):t.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}function ot(e,t){var r=e.length-1;let i=0,n=r;for(var a,s,o;i<=n;)if(s=e[a=Math.floor((i+n)/2)],o=e[a+1],s<=t){if(a===r||t<o)return a;i=a+1}else{if(!(t<s))throw new b("Input is not a number.");n=a-1}return 0}class lt{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var[i,n]of r)this.labels.push(i),this.outputs.push(n)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");var e=r.parse(t[1],1,f);if(!e)return null;const i=[];let n=null;r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);for(let e=1;e<t.length;e+=2){var a=1===e?-1/0:t[e],s=t[e+1],o=e,l=e+1;if("number"!=typeof a)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(i.length&&i[i.length-1][0]>=a)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);o=r.parse(s,l,n);if(!o)return null;n=n||o.type,i.push([a,o])}return new lt(n,e,i)}evaluate(e){var t=this.labels;const r=this.outputs;if(1===t.length)return r[0].evaluate(e);var i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);var n=t.length;if(i>=t[n-1])return r[n-1].evaluate(e);n=ot(t,i);return r[n].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ut(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}V=ht;function ht(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}ht.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var r=e,i=0;i<8;i++){var n=this.sampleCurveX(r)-e;if(Math.abs(n)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=n/a}for(var s=0,o=1,r=e,i=0;i<20&&(n=this.sampleCurveX(r),!(Math.abs(n-e)<t));i++)n<e?s=r:o=r,r=.5*(o-s)+s;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var ct=ut(V);function pt(e,t,r){return e+r*(t-e)}function dt(r,i,n,e="rgb"){switch(e){case"rgb":var[a,s,o,l]=ft(r.rgb,i.rgb,n);return new v(a,s,o,l,!1);case"hcl":{var[a,s,o,l]=r.hcl,[u,h,c,p]=i.hcl;let t,e;if(isNaN(a)||isNaN(u))isNaN(a)?isNaN(u)?t=NaN:(t=u,1!==o&&0!==o||(e=h)):(t=a,1!==c&&0!==c||(e=s));else{let e=u-a;a<u&&180<e?e-=360:u<a&&180<a-u&&(e+=360),t=a+n*e}[u,a,s,h]=[[t,null!==e&&void 0!==e?e:pt(s,h,n),pt(o,c,n),pt(l,p,n)]][0],u=isNaN(u)?0:u*ze;var[o,c,l,p]=Ee([s,Math.cos(u)*a,Math.sin(u)*a,h]);return new v(o,c,l,p,!1)}case"lab":var[u,h,o,c]=Ee(ft(r.lab,i.lab,n));return new v(u,h,o,c,!1)}}function ft(e,r,i){return e.map((e,t)=>pt(e,r[t],i))}function yt(e,t,r){return new x(ft(e.values,t.values,r))}function mt(e,t,r){var i=e.values,n=t.values;if(i.length!==n.length)throw new b(`Cannot interpolate values of different length. from: ${e.toString()}, to: `+t.toString());const a=[];for(let e=0;e<i.length;e+=2){if(i[e]!==n[e])throw new b(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${i[e]}, to[${e}]: `+n[e]);a.push(i[e]);var[s,o]=i[e+1],[l,u]=n[e+1];a.push([pt(s,l,r),pt(o,u,r)])}return new Ge(a)}const gt={number:pt,color:dt,array:ft,padding:yt,variableAnchorOffsetCollection:mt};class vt{constructor(e,t,r,i,n){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(var[a,s]of n)this.labels.push(a),this.outputs.push(s)}static interpolationFactor(e,t,r,i){let n=0;if("exponential"===e.name)n=xt(t,e.base,r,i);else if("linear"===e.name)n=xt(t,1,r,i);else if("cubic-bezier"===e.name){e=e.controlPoints;const a=new ct(e[0],e[1],e[2],e[3]);n=a.solve(xt(t,1,r,i))}return n}static parse(e,t){let[r,i,n,...a]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var s=i[1];if("number"!=typeof s)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:s}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type "+String(i[0]),1,0);{const d=i.slice(1);if(4!==d.length||d.some(e=>"number"!=typeof e||e<0||1<e))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:d}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(n=t.parse(n,2,f)))return null;const o=[];let l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=ie:t.expectedType&&"value"!==t.expectedType.kind&&(l=t.expectedType);for(let e=0;e<a.length;e+=2){var u=a[e],h=a[e+1],c=e+3,p=e+4;if("number"!=typeof u)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(o.length&&o[o.length-1][0]>=u)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',c);c=t.parse(h,p,l);if(!c)return null;l=l||c.type,o.push([u,c])}return be(l,f)||be(l,ie)||be(l,de)||be(l,ye)||be(l,y(f))?new vt(l,r,i,n,o):t.error(`Type ${g(l)} is not interpolatable.`)}evaluate(e){var t=this.labels;const r=this.outputs;if(1===t.length)return r[0].evaluate(e);var i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);var n=t.length;if(i>=t[n-1])return r[n-1].evaluate(e);var n=ot(t,i),a=t[n],t=t[n+1],s=vt.interpolationFactor(this.interpolation,i,a,t),o=r[n].evaluate(e),l=r[n+1].evaluate(e);switch(this.operator){case"interpolate":return gt[this.type.kind](o,l,s);case"interpolate-hcl":return gt.color(o,l,s,"hcl");case"interpolate-lab":return gt.color(o,l,s,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function xt(e,t,r,i){i-=r,e-=r;return 0==i?0:1===t?e/i:(Math.pow(t,e)-1)/(Math.pow(t,i)-1)}class bt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const i=t.expectedType,n=(i&&"value"!==i.kind&&(r=i),[]);for(const s of e.slice(1)){var a=t.parse(s,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!a)return null;r=r||a.type,n.push(a)}if(r)return i&&n.some(e=>ge(i,e.type))?new bt(c,n):new bt(r,n);throw new Error("No output type")}evaluate(e){let t=null,r=0,i;for(const n of this.args)if(r++,(t=n.evaluate(e))&&t instanceof Xe&&!t.available&&(i=i||t.name,t=null,r===this.args.length&&(t=i)),null!==t)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function wt(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function _t(e,t,r,i){return 0===i.compare(t,r)}function St(a,s,o){const l="=="!==a&&"!="!==a;return class u{constructor(e,t,r){this.type=h,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var r=e[0];let i=t.parse(e[1],1,c);if(!i)return null;if(!wt(r,i.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${g(i.type)}'.`);let n=t.parse(e[2],2,c);if(!n)return null;if(!wt(r,n.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${g(n.type)}'.`);if(i.type.kind!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind)return t.error(`Cannot compare types '${g(i.type)}' and '${g(n.type)}'.`);l&&("value"===i.type.kind&&"value"!==n.type.kind?i=new Qe(n.type,[i]):"value"!==i.type.kind&&"value"===n.type.kind&&(n=new Qe(i.type,[n])));let a=null;if(4===e.length){if("string"!==i.type.kind&&"string"!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(a=t.parse(e[3],3,oe)))return null}return new u(i,n,a)}evaluate(e){var t=this.lhs.evaluate(e),r=this.rhs.evaluate(e);if(l&&this.hasUntypedArgument){var i=m(t),n=m(r);if(i.kind!==n.kind||"string"!==i.kind&&"number"!==i.kind)throw new b(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${i.kind}, ${n.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){i=m(t),n=m(r);if("string"!==i.kind||"string"!==n.kind)return s(e,t,r)}return this.collator?o(e,t,r,this.collator.evaluate(e)):s(e,t,r)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}var V=St("==",function(e,t,r){return t===r},_t),kt=St("!=",function(e,t,r){return t!==r},function(e,t,r,i){return!_t(0,t,r,i)}),At=St("<",function(e,t,r){return t<r},function(e,t,r,i){return i.compare(t,r)<0}),It=St(">",function(e,t,r){return r<t},function(e,t,r,i){return 0<i.compare(t,r)}),Mt=St("<=",function(e,t,r){return t<=r},function(e,t,r,i){return i.compare(t,r)<=0}),zt=St(">=",function(e,t,r){return r<=t},function(e,t,r,i){return 0<=i.compare(t,r)});class Pt{constructor(e,t,r){this.type=oe,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");e=e[1];if("object"!=typeof e||Array.isArray(e))return t.error("Collator options argument must be an object.");var r=t.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,h);if(!r)return null;var i=t.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,h);if(!i)return null;let n=null;return e.locale&&!(n=t.parse(e.locale,1,u))?null:new Pt(r,i,n)}evaluate(e){return new Ue(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ct{constructor(e){this.type=le,this.sections=e}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");var e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return i.error("First argument must be an image or text section.");const n=[];let a=!1;for(let e=1;e<=t.length-1;++e){var s=t[e];if(a&&"object"==typeof s&&!Array.isArray(s)){a=!1;let e=null;if(s["font-scale"]&&!(e=i.parse(s["font-scale"],1,f)))return null;let t=null;if(s["text-font"]&&!(t=i.parse(s["text-font"],1,y(u))))return null;let r=null;if(s["text-color"]&&!(r=i.parse(s["text-color"],1,ie)))return null;const o=n[n.length-1];o.scale=e,o.font=t,o.textColor=r}else{s=i.parse(t[e],1,c);if(!s)return null;var r=s.type.kind;if("string"!==r&&"value"!==r&&"null"!==r&&"resolvedImage"!==r)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,n.push({content:s,scale:null,font:null,textColor:null})}}return new Ct(n)}evaluate(r){return new M(this.sections.map(e=>{var t=e.content.evaluate(r);return m(t)===fe?new Ne("",t,null,null,null):new Ne(Je(t),null,e.scale?e.scale.evaluate(r):null,e.font?e.font.evaluate(r).join(","):null,e.textColor?e.textColor.evaluate(r):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}const Bt=8192;function Vt(e,t){var r=(180+e[0])/360,e=(e=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360),t=Math.pow(2,t.z);return[Math.round(r*t*Bt),Math.round(e*t*Bt)]}function Tt(e,t){var r=Math.pow(2,t.z),i=(e[0]/Bt+t.x)/r,e=(e[1]/Bt+t.y)/r;return[360*i-180,360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90]}function Et(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ft(e,t){return!(e[0]<=t[0])&&(!(e[2]>=t[2])&&(!(e[1]<=t[1])&&!(e[3]>=t[3])))}function Dt(e,t,r,i){var n=[t[0]-e[0],t[1]-e[1]],a=[i[0]-r[0],i[1]-r[1]];if(0!=a[0]*n[1]-a[1]*n[0])return!(!$t(e,t,r,i)||!$t(r,i,e,t))}function Lt(t,e,r=!1){let i=!1;for(const u of e)for(let e=0;e<u.length-1;e++){if(n=t,a=u[e],s=u[e+1],l=o=void 0,o=n[0]-a[0],a=n[1]-a[1],l=n[0]-s[0],n=n[1]-s[1],o*n-l*a==0&&o*l<=0&&a*n<=0)return r;s=t,o=u[e],l=u[e+1],o[1]>s[1]!=l[1]>s[1]&&s[0]<(l[0]-o[0])*(s[1]-o[1])/(l[1]-o[1])+o[0]&&(i=!i)}var n,a,s,o,l;return i}function Ot(t,r){for(const e of t)if(!Lt(e,r))return;for(let e=0;e<t.length-1;++e)if(function(t,r,e){for(const i of e)for(let e=0;e<i.length-1;++e)if(Dt(t,r,i[e],i[e+1]))return 1}(t[e],t[e+1],r))return;return 1}function $t(e,t,r,i){var n=e[0]-r[0],e=e[1]-r[1],a=t[0]-r[0],t=t[1]-r[1],s=i[0]-r[0],i=i[1]-r[1],r=n*i-s*e,n=a*i-s*t;return 0<r&&n<0||r<0&&0<n}function Rt(r,i,n){const e=[];for(let t=0;t<r.length;t++){const s=[];for(let e=0;e<r[t].length;e++){var a=Vt(r[t][e],n);Et(i,a),s.push(a)}e.push(s)}return e}function jt(t,r,i){const n=[];for(let e=0;e<t.length;e++){var a=Rt(t[e],r,i);n.push(a)}return n}function qt(t,e,r,i){if(t[0]<r[0]||t[0]>r[2]){var n=.5*i;let e=t[0]-r[0]>n?-i:r[0]-t[0]>n?i:0;0===e&&(e=t[0]-r[2]>n?-i:r[2]-t[0]>n?i:0),t[0]+=e}Et(e,t)}function Ut(e,t,r,i){var n=Math.pow(2,i.z)*Bt,a=[i.x*Bt,i.y*Bt];const s=[];for(const l of e)for(const u of l){var o=[u.x+a[0],u.y+a[1]];qt(o,t,r,n),s.push(o)}return s}function Nt(e,t,r,i){var n=Math.pow(2,i.z)*Bt,a=[i.x*Bt,i.y*Bt];const s=[];for(const l of e){const u=[];for(const h of l){var o=[h.x+a[0],h.y+a[1]];Et(t,o),u.push(o)}s.push(u)}if(t[2]-t[0]<=n/2){(i=t)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(const c of s)for(const p of c)qt(p,t,r,n)}return s}function Zt(e,t){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=Rt(t.coordinates,i,n),s=Ut(e.geometry(),r,i,n);if(!Ft(r,i))return!1;for(const l of s)if(!Lt(l,a))return!1}if("MultiPolygon"===t.type){var o=jt(t.coordinates,i,n),s=Ut(e.geometry(),r,i,n);if(!Ft(r,i))return!1;for(const u of s)if(!function(e,t){for(const r of t)if(Lt(e,r))return 1}(u,o))return!1}return!0}function Gt(e,t){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=Rt(t.coordinates,i,n),s=Nt(e.geometry(),r,i,n);if(!Ft(r,i))return!1;for(const l of s)if(!Ot(l,a))return!1}if("MultiPolygon"===t.type){var o=jt(t.coordinates,i,n),s=Nt(e.geometry(),r,i,n);if(!Ft(r,i))return!1;for(const u of s)if(!function(e,t){for(const r of t)if(Ot(e,r))return 1}(u,o))return!1}return!0}class Xt{constructor(e,t){this.type=h,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ye(e[1])){e=e[1];if("FeatureCollection"===e.type){const a=[];for(const s of e.features){var{type:r,coordinates:i}=s.geometry;"Polygon"===r&&a.push(i),"MultiPolygon"===r&&a.push(...i)}if(a.length)return n={type:"MultiPolygon",coordinates:a},new Xt(e,n)}else if("Feature"===e.type){var n=e.geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Xt(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Xt(e,e)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return Zt(e,this.geometries);if("LineString"===e.geometryType())return Gt(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ht=class{constructor(e=[],t=(e,t)=>e<t?-1:t<e?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),0<--this.length&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this;for(var i=t[e];0<e;){var n=e-1>>1,a=t[n];if(0<=r(i,a))break;t[e]=a,e=n}t[e]=i}_down(t){const{data:r,compare:i}=this;for(var e=this.length>>1,n=r[t];t<e;){let e=1+(t<<1);var a=e+1;if(a<this.length&&i(r[a],r[e])<0&&(e=a),0<=i(r[e],n))break;r[t]=r[e],t=e}r[t]=n}};function Yt(e,t,r,i,n){!function e(t,r,i,n,a){for(;i<n;){600<n-i&&(s=n-i+1,h=r-i+1,l=Math.log(s),o=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*o*(s-o)/s)*(h-s/2<0?-1:1),u=Math.max(i,Math.floor(r-h*o/s+l)),h=Math.min(n,Math.floor(r+(s-h)*o/s+l)),e(t,r,u,h,a));var s,o,l,u,h,c=t[r],p=i,d=n;for(Jt(t,i,r),0<a(t[n],c)&&Jt(t,i,n);p<d;){for(Jt(t,p,d),p++,d--;a(t[p],c)<0;)p++;for(;0<a(t[d],c);)d--}0===a(t[i],c)?Jt(t,i,d):Jt(t,++d,n),d<=r&&(i=d+1),r<=d&&(n=d-1)}}(e,t,r,i||e.length-1,n||Kt)}function Jt(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function Kt(e,t){return e<t?-1:t<e?1:0}function Wt(e,t){if(e.length<=1)return[e];const r=[];let i,n;for(const s of e){var a=function(a){let s=0;for(let e=0,t=a.length,r=t-1,i,n;e<t;r=e++)i=a[e],n=a[r],s+=(n.x-i.x)*(i.y+n.y);return s}(s);0!==a&&(s.area=Math.abs(a),(n=void 0===n?a<0:n)===a<0?(i&&r.push(i),i=[s]):i.push(s))}if(i&&r.push(i),1<t)for(let e=0;e<r.length;e++)r[e].length<=t||(Yt(r[e],t,1,r[e].length-1,Qt),r[e]=r[e].slice(0,t));return r}function Qt(e,t){return t.area-e.area}var e=1/298.257223563;const er=e*(2-e),tr=Math.PI/180;class rr{constructor(e){var t=6378.137*tr*1e3,e=Math.cos(e*tr),r=1/(1-er*(1-e*e)),i=Math.sqrt(r);this.kx=t*i*e,this.ky=t*i*r*(1-er)}distance(e,t){var r=this.wrap(e[0]-t[0])*this.kx,e=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+e*e)}pointOnLine(s,o){let l=1/0,u,h,c,p;for(let a=0;a<s.length-1;a++){let e=s[a][0],t=s[a][1],r=this.wrap(s[a+1][0]-e)*this.kx,i=(s[a+1][1]-t)*this.ky,n=0;0===r&&0===i||(1<(n=(this.wrap(o[0]-e)*this.kx*r+(o[1]-t)*this.ky*i)/(r*r+i*i))?(e=s[a+1][0],t=s[a+1][1]):0<n&&(e+=r/this.kx*n,t+=i/this.ky*n)),r=this.wrap(o[0]-e)*this.kx,i=(o[1]-t)*this.ky;var d=r*r+i*i;d<l&&(l=d,u=e,h=t,c=a,p=n)}return{point:[u,h],index:c,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;180<e;)e-=360;return e}}const ir=100,nr=50;function ar(e,t){return t[0]-e[0]}function sr(e){return e[1]-e[0]+1}function or(e,t){return e[1]>=e[0]&&e[1]<t}function lr(e,t){if(e[0]>e[1])return[null,null];var r=sr(e);if(t){if(2===r)return[e,null];const i=Math.floor(r/2);return[[e[0],e[0]+i],[e[0]+i,e[1]]]}if(1===r)return[e,null];const i=Math.floor(r/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}function ur(t,r){if(!or(r,t.length))return[1/0,1/0,-1/0,-1/0];var i=[1/0,1/0,-1/0,-1/0];for(let e=r[0];e<=r[1];++e)Et(i,t[e]);return i}function hr(e){var t=[1/0,1/0,-1/0,-1/0];for(const r of e)for(const i of r)Et(t,i);return t}function cr(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function pr(e,t,r){if(!cr(e)||!cr(t))return NaN;let i=0,n=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),r.distance([0,0],[i,n])}function dr(e,t,r){t=r.pointOnLine(t,e);return r.distance(e,t.point)}function fr(e,t,r,i,n){var a=Math.min(dr(e,[r,i],n),dr(t,[r,i],n)),r=Math.min(dr(r,[e,t],n),dr(i,[e,t],n));return Math.min(a,r)}function yr(e,t){for(const r of e)for(const i of r)if(Lt(i,t,!0))return 1}function mr(e,t,r,i,n,a){!a||(i=pr(ur(i,a),n,r))<t&&e.push([i,a,[0,0]])}function gr(e,t,r,i,n,a,s){a&&s&&((i=pr(ur(i,a),ur(n,s),r))<t&&e.push([i,a,s]))}function vr(t,e,r,i,n=1/0){let a=Math.min(i.distance(t[0],r[0][0]),n);if(0===a)return a;const s=new Ht([[0,[0,t.length-1],[0,0]]],ar);for(var o=hr(r);0<s.length;){var l=s.pop();if(!(l[0]>=a)){var u=l[1],l=e?nr:ir;if(sr(u)<=l){if(!or(u,t.length))return NaN;if(e){l=function(t,r,i,n){if(!or(r,t.length))return NaN;for(let e=r[0];e<=r[1];++e)if(Lt(t[e],i,!0))return 0;let a=1/0;for(let e=r[0];e<r[1];++e){var s=t[e],o=t[e+1];for(const h of i)for(let e=0,t=h.length,r=t-1;e<t;r=e++){var l=h[r],u=h[e];if(Dt(s,o,l,u))return 0;a=Math.min(a,fr(s,o,l,u,n))}}return a}(t,u,r,i);if(isNaN(l)||0===l)return l;a=Math.min(a,l)}else for(let e=u[0];e<=u[1];++e){var h=function(e,t,r){if(Lt(e,t,!0))return 0;let i=1/0;for(const s of t){var n=s[0],a=s[s.length-1];if(n!==a&&0===(i=Math.min(i,dr(e,[a,n],r))))return i;a=r.pointOnLine(s,e);if(0===(i=Math.min(i,r.distance(e,a.point))))return i}return i}(t[e],r,i);if(0===(a=Math.min(a,h)))return 0}}else{l=lr(u,e);mr(s,a,i,t,o,l[0]),mr(s,a,i,t,o,l[1])}}}return a}function xr(r,e,i,n,a,t=1/0){let s=Math.min(t,a.distance(r[0],i[0]));if(0===s)return s;const o=new Ht([[0,[0,r.length-1],[0,i.length-1]]],ar);for(;0<o.length;){var l=o.pop();if(!(l[0]>=s)){var u=l[1],h=l[2],l=e?nr:ir,c=n?nr:ir;if(sr(u)<=l&&sr(h)<=c){if(!or(u,r.length)&&or(h,i.length))return NaN;let t;if(e&&n)t=function(t,r,i,n,a){if(!(or(r,t.length)&&or(n,i.length)))return 1/0;let s=1/0;for(let e=r[0];e<r[1];++e){var o=t[e],l=t[e+1];for(let e=n[0];e<n[1];++e){var u=i[e],h=i[e+1];if(Dt(o,l,u,h))return 0;s=Math.min(s,fr(o,l,u,h,a))}}return s}(r,u,i,h,a),s=Math.min(s,t);else if(e&&!n){var p=r.slice(u[0],u[1]+1);for(let e=h[0];e<=h[1];++e)if(t=dr(i[e],p,a),0===(s=Math.min(s,t)))return s}else if(!e&&n){var d=i.slice(h[0],h[1]+1);for(let e=u[0];e<=u[1];++e)if(t=dr(r[e],d,a),0===(s=Math.min(s,t)))return s}else t=function(r,e,i,n,a){if(!(or(e,r.length)&&or(n,i.length)))return NaN;let s=1/0;for(let t=e[0];t<=e[1];++t)for(let e=n[0];e<=n[1];++e)if(0===(s=Math.min(s,a.distance(r[t],i[e]))))return s;return s}(r,u,i,h,a),s=Math.min(s,t)}else{l=lr(u,e),c=lr(h,n);gr(o,s,a,r,i,l[0],c[0]),gr(o,s,a,r,i,l[0],c[1]),gr(o,s,a,r,i,l[1],c[0]),gr(o,s,a,r,i,l[1],c[1])}}}return s}function br(t,e){var r=t.geometry();if(0===r.length||0===r[0].length)return NaN;var i=Wt(r,0).map(e=>e.map(e=>e.map(e=>Tt([e.x,e.y],t.canonical)))),n=new rr(i[0][0][0][1]);let a=1/0;for(const s of e)for(const o of i){switch(s.type){case"Point":a=Math.min(a,vr([s.coordinates],!1,o,n,a));break;case"LineString":a=Math.min(a,vr(s.coordinates,!0,o,n,a));break;case"Polygon":a=Math.min(a,function(e,i,n,t=1/0){var r=hr(e),a=hr(i);if(t!==1/0&&pr(r,a,n)>=t)return t;if(Ft(r,a)){if(yr(e,i))return 0}else if(yr(i,e))return 0;let s=1/0;for(const c of e)for(let e=0,t=c.length,r=t-1;e<t;r=e++){var o=c[r],l=c[e];for(const p of i)for(let e=0,t=p.length,r=t-1;e<t;r=e++){var u=p[r],h=p[e];if(Dt(o,l,u,h))return 0;s=Math.min(s,fr(o,l,u,h,n))}}return s}(o,s.coordinates,n,a))}if(0===a)return a}return a}function wr(e){return"MultiPolygon"===e.type?e.coordinates.map(e=>({type:"Polygon",coordinates:e})):"MultiLineString"===e.type?e.coordinates.map(e=>({type:"LineString",coordinates:e})):"MultiPoint"===e.type?e.coordinates.map(e=>({type:"Point",coordinates:e})):[e]}class _r{constructor(e,t){this.type=f,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ye(e[1])){const r=e[1];if("FeatureCollection"===r.type)return new _r(r,r.features.map(e=>wr(e.geometry)).flat());if("Feature"===r.type)return new _r(r,wr(r.geometry));if("type"in r&&"coordinates"in r)return new _r(r,wr(r))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType()){var r=t;var i=this.geometries;const u=r.geometry();var n=u.flat().map(e=>Tt([e.x,e.y],r.canonical));if(0===u.length)return NaN;var a=new rr(n[0][1]);let e=1/0;for(const h of i){switch(h.type){case"Point":e=Math.min(e,xr(n,!1,[h.coordinates],!1,a,e));break;case"LineString":e=Math.min(e,xr(n,!1,h.coordinates,!0,a,e));break;case"Polygon":e=Math.min(e,vr(n,!1,h.coordinates,a,e))}if(0===e)return e}return e;return}if("LineString"===t.geometryType()){var s=t;i=this.geometries;const c=s.geometry();var o=c.flat().map(e=>Tt([e.x,e.y],s.canonical));if(0===c.length)return NaN;var l=new rr(o[0][1]);let e=1/0;for(const p of i){switch(p.type){case"Point":e=Math.min(e,xr(o,!0,[p.coordinates],!1,l,e));break;case"LineString":e=Math.min(e,xr(o,!0,p.coordinates,!0,l,e));break;case"Polygon":e=Math.min(e,vr(o,!0,p.coordinates,l,e))}if(0===e)return e}return e;return}if("Polygon"===t.geometryType())return br(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Sr={"==":V,"!=":kt,">":It,"<":At,">=":zt,"<=":Mt,array:Qe,at:class _c{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,f),e=t.parse(e[2],2,y(t.expectedType||c));return r&&e?(t=e.type,new _c(t.itemType,r,e)):null}evaluate(e){var t=this.index.evaluate(e),e=this.input.evaluate(e);if(t<0)throw new b(`Array index out of bounds: ${t} < 0.`);if(t>=e.length)throw new b(`Array index out of bounds: ${t} > ${e.length-1}.`);if(t!==Math.floor(t))throw new b(`Array index must be an integer, but found ${t} instead.`);return e[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}},boolean:Qe,case:class Sc{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let i;r.expectedType&&"value"!==r.expectedType.kind&&(i=r.expectedType);const n=[];for(let e=1;e<t.length-1;e+=2){var a=r.parse(t[e],e,h);if(!a)return null;var s=r.parse(t[e+1],e+1,i);if(!s)return null;n.push([a,s]),i=i||s.type}var e=r.parse(t[t.length-1],t.length-1,i);if(!e)return null;if(i)return new Sc(i,n,e);throw new Error("Can't infer output type")}evaluate(e){for(var[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(var[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([,e])=>e.outputDefined())&&this.otherwise.outputDefined()}},coalesce:bt,collator:Pt,format:Ct,image:class kc{constructor(e){this.type=fe,this.input=e}static parse(e,t){return 2!==e.length?t.error("Expected two arguments."):(e=t.parse(e[1],1,u))?new kc(e):t.error("No image name provided.")}evaluate(e){var t=this.input.evaluate(e);const r=Xe.fromString(t);return r&&e.availableImages&&(r.available=-1<e.availableImages.indexOf(t)),r}eachChild(e){e(this.input)}outputDefined(){return!1}},in:class Ac{constructor(e,t){this.type=h,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,c),e=t.parse(e[2],2,c);return r&&e?ve(r.type,[h,u,f,re,c])?new Ac(r,e):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${g(r.type)} instead`):null}evaluate(e){var t=this.needle.evaluate(e);const r=this.haystack.evaluate(e);if(!r)return!1;if(!xe(t,["boolean","string","number","null"]))throw new b(`Expected first argument to be of type boolean, string, number or null, but found ${g(m(t))} instead.`);if(xe(r,["string","array"]))return 0<=r.indexOf(t);throw new b(`Expected second argument to be of type array or string, but found ${g(m(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}},"index-of":class Ic{constructor(e,t,r){this.type=f,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,c),i=t.parse(e[2],2,c);return r&&i?ve(r.type,[h,u,f,re,c])?4===e.length?(e=t.parse(e[3],3,f))?new Ic(r,i,e):null:new Ic(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${g(r.type)} instead`):null}evaluate(e){var t=this.needle.evaluate(e);const r=this.haystack.evaluate(e);if(!xe(t,["boolean","string","number","null"]))throw new b(`Expected first argument to be of type boolean, string, number or null, but found ${g(m(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),xe(r,["string"]))return-1===(e=r.indexOf(t,i))?-1:[...r.slice(0,e)].length;if(xe(r,["array"]))return r.indexOf(t,i);throw new b(`Expected second argument to be of type array or string, but found ${g(m(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}},interpolate:vt,"interpolate-hcl":vt,"interpolate-lab":vt,length:class Mc{constructor(e){this.type=f,this.input=e}static parse(e,t){return 2!==e.length?t.error(`Expected 1 argument, but found ${e.length-1} instead.`):(e=t.parse(e[1],1))?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?t.error(`Expected argument of type string or array, but found ${g(e.type)} instead.`):new Mc(e):null}evaluate(e){if("string"==typeof(e=this.input.evaluate(e)))return[...e].length;if(Array.isArray(e))return e.length;throw new b(`Expected value to be of type string or array, but found ${g(m(e))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}},let:at,literal:Ke,match:class zc{constructor(e,t,r,i,n,a){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=n,this.otherwise=a}static parse(r,i){if(r.length<5)return i.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&"value"!==i.expectedType.kind&&(a=i.expectedType);const s={},o=[];for(let t=2;t<r.length-1;t+=2){let e=r[t];var l=r[t+1];Array.isArray(e)||(e=[e]);const u=i.concat(t);if(0===e.length)return u.error("Expected at least one branch label.");for(const h of e){if("number"!=typeof h&&"string"!=typeof h)return u.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof h&&Math.floor(h)!==h)return u.error("Numeric branch labels must be integer values.");if(n){if(u.checkSubtype(n,m(h)))return null}else n=m(h);if(void 0!==s[String(h)])return u.error("Branch labels must be unique.");s[String(h)]=o.length}if(!(l=i.parse(l,t,a)))return null;a=a||l.type,o.push(l)}var e=i.parse(r[1],1,c);if(!e)return null;var t=i.parse(r[r.length-1],r.length-1,a);return!t||"value"!==e.type.kind&&i.concat(1).checkSubtype(n,e.type)?null:new zc(n,a,e,s,o,t)}evaluate(e){var t=this.input.evaluate(e);const r=m(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise;return r.evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}},number:Qe,"number-format":class Pc{constructor(e,t,r,i,n){this.type=u,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");var r=t.parse(e[1],1,f);if(!r)return null;if("object"!=typeof(e=e[2])||Array.isArray(e))return t.error("NumberFormat options argument must be an object.");let i=null;if(e.locale&&!(i=t.parse(e.locale,1,u)))return null;let n=null;if(e.currency&&!(n=t.parse(e.currency,1,u)))return null;let a=null;if(e["min-fraction-digits"]&&!(a=t.parse(e["min-fraction-digits"],1,f)))return null;let s=null;return e["max-fraction-digits"]&&!(s=t.parse(e["max-fraction-digits"],1,f))?null:new Pc(r,i,n,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}},object:Qe,slice:class Cc{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,c),i=t.parse(e[2],2,f);return r&&i?ve(r.type,[y(c),u,c])?4===e.length?(e=t.parse(e[3],3,f))?new Cc(r.type,r,i,e):null:new Cc(r.type,r,i):t.error(`Expected first argument to be of type array or string, but found ${g(r.type)} instead`):null}evaluate(e){const t=this.input.evaluate(e);var r=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),xe(t,["string"]))return[...t].slice(r,i).join("");if(xe(t,["array"]))return t.slice(r,i);throw new b(`Expected first argument to be of type array or string, but found ${g(m(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}},step:lt,string:Qe,"to-boolean":tt,"to-color":tt,"to-number":tt,"to-string":tt,var:st,within:Xt,distance:_r};class kr{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(r,i){var e=r[0],t=kr.definitions[e];if(!t)return i.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0);var n=Array.isArray(t)?t[0]:t.type;const a=Array.isArray(t)?[[t[1],t[2]]]:t.overloads;var s,o,t=a.filter(([e])=>!Array.isArray(e)||e.length===r.length-1);let l=null;for([s,o]of t){l=new nt(i.registry,zr,i.path,null,i.scope);const f=[];let t=!1;for(let e=1;e<r.length;e++){var u=r[e],h=Array.isArray(s)?s[e-1]:s.type,u=l.parse(u,1+f.length,h);if(!u){t=!0;break}f.push(u)}if(!t)if(Array.isArray(s)&&s.length!==f.length)l.error(`Expected ${s.length} arguments, but found ${f.length} instead.`);else{for(let e=0;e<f.length;e++){var c=Array.isArray(s)?s[e]:s.type,p=f[e];l.concat(e+1).checkSubtype(c,p.type)}if(0===l.errors.length)return new kr(e,n,o,f)}}if(1===t.length)i.errors.push(...l.errors);else{const y=t.length?t:a;t=y.map(([e])=>{return Array.isArray(e)?`(${e.map(g).join(", ")})`:`(${g(e.type)}...)`}).join(" | ");const m=[];for(let e=1;e<r.length;e++){var d=i.parse(r[e],1+m.length);if(!d)return null;m.push(g(d.type))}i.error(`Expected arguments of type ${t}, but found (${m.join(", ")}) instead.`)}return null}static register(e,t){for(const r in kr.definitions=t)e[r]=kr}}function Ar(e,[t,r,i,n]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);n=n?n.evaluate(e):1,e=He(t,r,i,n);if(e)throw new b(e);return new v(t/255,r/255,i/255,n,!1)}function Ir(e,t){t=t[e];return void 0===t?null:t}function Mr(e){return{type:e}}function zr(e){if(e instanceof st)return zr(e.boundExpression);if(e instanceof kr&&"error"===e.name)return!1;if(e instanceof Pt)return!1;if(e instanceof Xt)return!1;if(e instanceof _r)return!1;const t=e instanceof tt||e instanceof Qe;let r=!0;return e.eachChild(e=>{r=t?r&&zr(e):r&&e instanceof Ke}),!!r&&(Pr(e)&&Br(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]))}function Pr(e){if(e instanceof kr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Xt)return!1;if(e instanceof _r)return!1;let t=!0;return e.eachChild(e=>{t&&!Pr(e)&&(t=!1)}),t}function Cr(e){if(!(e instanceof kr&&"feature-state"===e.name)){let t=!0;return e.eachChild(e=>{t&&!Cr(e)&&(t=!1)}),t}}function Br(e,t){if(e instanceof kr&&0<=t.indexOf(e.name))return!1;let r=!0;return e.eachChild(e=>{r&&!Br(e,t)&&(r=!1)}),r}function Vr(e){return{result:"success",value:e}}function Tr(e){return{result:"error",value:e}}function Er(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Fr(e){return e.expression&&-1<e.expression.parameters.indexOf("zoom")}function Dr(e){return e.expression&&e.expression.interpolated}function w(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Lr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Or(e){return e}function $r(r,i){var e="color"===i.type,t=r.stops&&"object"==typeof r.stops[0][0],n=t||void 0!==r.property,n=t||!n,a=r.type||(Dr(i)?"exponential":"interval");if(e||"padding"===i.type){const c=(e?v:x).parse;(r=Q({},r)).stops&&(r.stops=r.stops.map(e=>[e[0],c(e[1])])),r.default?r.default=c(r.default):r.default=c(i.default)}if(r.colorSpace&&("rgb"!==(e=r.colorSpace)&&"hcl"!==e&&"lab"!==e))throw new Error(`Unknown color space: "${r.colorSpace}"`);let s,o,l;if("exponential"===a)s=Ur;else if("interval"===a)s=qr;else if("categorical"===a){s=jr,o=Object.create(null);for(const p of r.stops)o[p[0]]=p[1];l=typeof r.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=Nr}if(t){const d={},f=[];for(let e=0;e<r.stops.length;e++){var u=r.stops[e],h=u[0].zoom;void 0===d[h]&&(d[h]={zoom:h,type:r.type,property:r.property,default:r.default,stops:[]},f.push(h)),d[h].stops.push([u[0].value,u[1]])}const y=[];for(const m of f)y.push([d[m].zoom,$r(d[m],i)]);e={name:"linear"};return{kind:"composite",interpolationType:e,interpolationFactor:vt.interpolationFactor.bind(void 0,e),zoomStops:y.map(e=>e[0]),evaluate({zoom:e},t){return Ur({stops:y,base:r.base},i,e).evaluate(e,t)}}}return n?{kind:"camera",interpolationType:t="exponential"===a?{name:"exponential",base:void 0!==r.base?r.base:1}:null,interpolationFactor:vt.interpolationFactor.bind(void 0,t),zoomStops:r.stops.map(e=>e[0]),evaluate:({zoom:e})=>s(r,i,e,o,l)}:{kind:"source",evaluate(e,t){t=t&&t.properties?t.properties[r.property]:void 0;return void 0===t?Rr(r.default,i.default):s(r,i,t,o,l)}}}function Rr(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function jr(e,t,r,i,n){return Rr(typeof r===n?i[r]:void 0,e.default,t.default)}function qr(e,t,r){if("number"!==w(r))return Rr(e.default,t.default);t=e.stops.length;if(1===t)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[t-1][0])return e.stops[t-1][1];t=ot(e.stops.map(e=>e[0]),r);return e.stops[t][1]}function Ur(r,e,t){var i=void 0!==r.base?r.base:1;if("number"!==w(t))return Rr(r.default,e.default);var n=r.stops.length;if(1===n)return r.stops[0][1];if(t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[n-1][0])return r.stops[n-1][1];n=ot(r.stops.map(e=>e[0]),t);const a=function(e,t,r,i){i-=r,e-=r;return 0==i?0:1===t?e/i:(Math.pow(t,e)-1)/(Math.pow(t,i)-1)}(t,i,r.stops[n][0],r.stops[n+1][0]),s=r.stops[n][1],o=r.stops[n+1][1],l=gt[e.type]||Or;return"function"==typeof s.evaluate?{evaluate(...e){var t=s.evaluate.apply(void 0,e),e=o.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==e)return l(t,e,a,r.colorSpace)}}:l(s,o,a,r.colorSpace)}function Nr(e,t,r){switch(t.type){case"color":r=v.parse(r);break;case"formatted":r=M.fromString(r.toString());break;case"resolvedImage":r=Xe.fromString(r.toString());break;case"padding":r=x.parse(r);break;default:w(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0)}return Rr(r,e.default,t.default)}kr.register(Sr,{error:[{kind:"error"},[u],(e,[t])=>{throw new b(t.evaluate(e))}],typeof:[u,[c],(e,[t])=>g(m(t.evaluate(e)))],"to-rgba":[y(f,4),[ie],(e,[t])=>{var[t,e,r,i]=t.evaluate(e).rgb;return[255*t,255*e,255*r,i]}],rgb:[ie,[f,f,f],Ar],rgba:[ie,[f,f,f,f],Ar],has:{type:h,overloads:[[[u],(e,[t])=>t.evaluate(e)in e.properties()],[[u,se],(e,[t,r])=>t.evaluate(e)in r.evaluate(e)]]},get:{type:c,overloads:[[[u],(e,[t])=>Ir(t.evaluate(e),e.properties())],[[u,se],(e,[t,r])=>Ir(t.evaluate(e),r.evaluate(e))]]},"feature-state":[c,[u],(e,[t])=>Ir(t.evaluate(e),e.featureState||{})],properties:[se,[],e=>e.properties()],"geometry-type":[u,[],e=>e.geometryType()],id:[c,[],e=>e.id()],zoom:[f,[],e=>e.globals.zoom],"heatmap-density":[f,[],e=>e.globals.heatmapDensity||0],"line-progress":[f,[],e=>e.globals.lineProgress||0],accumulated:[c,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[f,Mr(f),(e,t)=>{let r=0;for(const i of t)r+=i.evaluate(e);return r}],"*":[f,Mr(f),(e,t)=>{let r=1;for(const i of t)r*=i.evaluate(e);return r}],"-":{type:f,overloads:[[[f,f],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[f],(e,[t])=>-t.evaluate(e)]]},"/":[f,[f,f],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[f,[f,f],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[f,[],()=>Math.LN2],pi:[f,[],()=>Math.PI],e:[f,[],()=>Math.E],"^":[f,[f,f],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[f,[f],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[f,[f],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[f,[f],(e,[t])=>Math.log(t.evaluate(e))],log2:[f,[f],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[f,[f],(e,[t])=>Math.sin(t.evaluate(e))],cos:[f,[f],(e,[t])=>Math.cos(t.evaluate(e))],tan:[f,[f],(e,[t])=>Math.tan(t.evaluate(e))],asin:[f,[f],(e,[t])=>Math.asin(t.evaluate(e))],acos:[f,[f],(e,[t])=>Math.acos(t.evaluate(e))],atan:[f,[f],(e,[t])=>Math.atan(t.evaluate(e))],min:[f,Mr(f),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[f,Mr(f),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[f,[f],(e,[t])=>Math.abs(t.evaluate(e))],round:[f,[f],(e,[t])=>{t=t.evaluate(e);return t<0?-Math.round(-t):Math.round(t)}],floor:[f,[f],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[f,[f],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[h,[u,c],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[h,[c],(e,[t])=>e.id()===t.value],"filter-type-==":[h,[u],(e,[t])=>e.geometryType()===t.value],"filter-<":[h,[u,c],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<t}],"filter-id-<":[h,[c],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<t}],"filter->":[h,[u,c],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<e}],"filter-id->":[h,[c],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<e}],"filter-<=":[h,[u,c],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<=t}],"filter-id-<=":[h,[c],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<=t}],"filter->=":[h,[u,c],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<=e}],"filter-id->=":[h,[c],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<=e}],"filter-has":[h,[c],(e,[t])=>t.value in e.properties()],"filter-has-id":[h,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[h,[y(u)],(e,[t])=>0<=t.value.indexOf(e.geometryType())],"filter-id-in":[h,[y(c)],(e,[t])=>0<=t.value.indexOf(e.id())],"filter-in-small":[h,[u,y(c)],(e,[t,r])=>0<=r.value.indexOf(e.properties()[t.value])],"filter-in-large":[h,[u,y(c)],(e,[t,r])=>{for(var i=e.properties()[t.value],n=r.value,a=0,s=r.value.length-1;a<=s;){var o=a+s>>1;if(n[o]===i)return!0;n[o]>i?s=o-1:a=1+o}return!1}],all:{type:h,overloads:[[[h,h],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Mr(h),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:h,overloads:[[[h,h],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Mr(h),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[h,[h],(e,[t])=>!t.evaluate(e)],"is-supported-script":[h,[u],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[u,[u],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[u,[u],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[u,Mr(c),(t,e)=>e.map(e=>Je(e.evaluate(t))).join("")],"resolved-locale":[u,[oe],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Zr{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new it,this._defaultValue=t?"color"===(e=t).type&&Lr(e.default)?new v(0,0,0,0):"color"===e.type?v.parse(e.default)||null:"padding"===e.type?x.parse(e.default)||null:"variableAnchorOffsetCollection"===e.type?Ge.parse(e.default)||null:void 0===e.default?null:e.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,n,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,n,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null;try{var s=this.expression.evaluate(this._evaluator);if(null==s||"number"==typeof s&&s!=s)return this._defaultValue;if(!this._enumValues||s in this._enumValues)return s;throw new b(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(s)} instead.`)}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Gr(e){return Array.isArray(e)&&0<e.length&&"string"==typeof e[0]&&e[0]in Sr}function Xr(e,t){const r=new nt(Sr,zr,[],t?(i=t,n={color:ie,string:u,number:f,enum:u,boolean:h,formatted:le,padding:de,resolvedImage:fe,variableAnchorOffsetCollection:ye},"array"!==i.type?n[i.type]:y(n[i.value]||c,i.length)):void 0);var i,n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?Vr(new Zr(n,t)):Tr(r.errors)}class Hr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Cr(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,a)}evaluate(e,t,r,i,n,a){return this._styleExpression.evaluate(e,t,r,i,n,a)}}class Yr{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Cr(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,a)}evaluate(e,t,r,i,n,a){return this._styleExpression.evaluate(e,t,r,i,n,a)}interpolationFactor(e,t,r){return this.interpolationType?vt.interpolationFactor(this.interpolationType,e,t,r):0}}function Jr(e){return void 0!==e._styleExpression}function Kr(e,t){e=Xr(e,t);if("error"===e.result)return e;var r=e.value.expression,i=Pr(r);if(!i&&!Er(t))return Tr([new ee("","data expressions not supported")]);var n=Br(r,["zoom"]);if(!n&&!Fr(t))return Tr([new ee("","zoom expressions not supported")]);r=function r(e){let i=null;if(e instanceof at)i=r(e.result);else if(e instanceof bt){for(const t of e.args)if(i=r(t))break}else(e instanceof lt||e instanceof vt)&&e.input instanceof kr&&"zoom"===e.input.name&&(i=e);if(i instanceof ee)return i;e.eachChild(e=>{const t=r(e);t instanceof ee?i=t:!i&&t?i=new ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&t&&i!==t&&(i=new ee("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))});return i}(r);if(!r&&!n)return Tr([new ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(r instanceof ee)return Tr([r]);if(r instanceof vt&&!Dr(t))return Tr([new ee("",'"interpolate" expressions cannot be used with this property')]);if(!r)return Vr(i?new Hr("constant",e.value):new Hr("source",e.value));n=r instanceof vt?r.interpolation:void 0;return Vr(i?new Yr("camera",e.value,r.labels,n):new Yr("composite",e.value,r.labels,n))}class Wr{constructor(e,t){this._parameters=e,this._specification=t,Q(this,$r(this._parameters,this._specification))}static deserialize(e){return new Wr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qr(t,r){if(Lr(t))return new Wr(t,r);if(Gr(t)){const e=Kr(t,r);if("error"===e.result)throw new Error(e.value.map(e=>e.key+": "+e.message).join(", "));return e.value}{let e=t;return"color"===r.type&&"string"==typeof t?e=v.parse(t):"padding"!==r.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===r.type&&Array.isArray(t)&&(e=Ge.parse(t)):e=x.parse(t),{kind:"constant",evaluate:()=>e}}}function ei(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return 2<=e.length&&"$id"!==e[1]&&"$type"!==e[1];case"in":return 3<=e.length&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!ei(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const ti={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ri(e){if(null==e)return{filter:()=>!0,needGeometry:!1};const i=Xr(e=ei(e)?e:ni(e),ti);if("error"===i.result)throw new Error(i.value.map(e=>e.key+": "+e.message).join(", "));return{filter:(e,t,r)=>i.value.evaluate(e,t,{},r),needGeometry:function t(r){if(!Array.isArray(r))return!1;if("within"===r[0]||"distance"===r[0])return!0;for(let e=1;e<r.length;e++)if(t(r[e]))return!0;return!1}(e)}}function ii(e,t){return e<t?-1:t<e?1:0}function ni(e){if(!e)return!0;var t,r=e[0];return e.length<=1?"any"!==r:"=="===r?ai(e[1],e[2],"=="):"!="===r?li(ai(e[1],e[2],"==")):"<"===r||">"===r||"<="===r||">="===r?ai(e[1],e[2],r):"any"===r?(t=e.slice(1),["any"].concat(t.map(ni))):"all"===r?["all"].concat(e.slice(1).map(ni)):"none"===r?["all"].concat(e.slice(1).map(ni).map(li)):"in"===r?si(e[1],e.slice(2)):"!in"===r?li(si(e[1],e.slice(2))):"has"===r?oi(e[1]):"!has"!==r||li(oi(e[1]))}function ai(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function si(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return 200<t.length&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(ii)]]:["filter-in-small",e,["literal",t]]}}function oi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function li(e){return["!",e]}function ui(e){let t="";for(const r of W)t+="/"+function t(r){var e=typeof r;if("number"==e||"boolean"==e||"string"==e||null==r)return JSON.stringify(r);if(Array.isArray(r)){let e="[";for(const a of r)e+=t(a)+",";return e+"]"}var i=Object.keys(r).sort();let n="{";for(let e=0;e<i.length;e++)n+=`${JSON.stringify(i[e])}:${t(r[i[e]])},`;return n+"}"}(e[r]);return t}function hi(e){var t=e.key,e=e.value;return e?[new d(t,e,"constants have been deprecated as of v8")]:[]}function _(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ci(e){if(Array.isArray(e))return e.map(ci);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=ci(e[r]);return t}return _(e)}function S(e){var t=e.key,r=e.value,i=e.valueSpec||{},n=e.objectElementValidators||{},a=e.style,s=e.styleSpec,o=e.validateSpec;let l=[];e=w(r);if("object"!==e)return[new d(t,r,`object expected, ${e} found`)];for(const c in r){var u=c.split(".")[0],h=i[u]||i["*"];let e;if(n[u])e=n[u];else if(i[u])e=o;else if(n["*"])e=n["*"];else{if(!i["*"]){l.push(new d(t,r[c],`unknown property "${c}"`));continue}e=o}l=l.concat(e({key:(t&&t+".")+c,value:r[c],valueSpec:h,style:a,styleSpec:s,object:r,objectKey:c,validateSpec:o},r))}for(const p in i)n[p]||i[p].required&&void 0===i[p].default&&void 0===r[p]&&l.push(new d(t,r,`missing required property "${p}"`));return l}function pi(t){var r=t.value,e=t.valueSpec,i=t.validateSpec,n=t.style,a=t.styleSpec,s=t.key;const o=t.arrayElementValidator||i;if("array"!==w(r))return[new d(s,r,`array expected, ${w(r)} found`)];if(e.length&&r.length!==e.length)return[new d(s,r,`array length ${e.length} expected, length ${r.length} found`)];if(e["min-length"]&&r.length<e["min-length"])return[new d(s,r,`array length at least ${e["min-length"]} expected, length ${r.length} found`)];let l={type:e.value,values:e.values},u=(a.$version<7&&(l.function=e.function),"object"===w(e.value)&&(l=e.value),[]);for(let e=0;e<r.length;e++)u=u.concat(o({array:r,arrayIndex:e,value:r[e],valueSpec:l,validateSpec:t.validateSpec,style:n,styleSpec:a,key:`${s}[${e}]`}));return u}function di(e){var t=e.key,r=e.value,e=e.valueSpec;let i=w(r);return"number"!==(i="number"===i&&r!=r?"NaN":i)?[new d(t,r,`number expected, ${i} found`)]:"minimum"in e&&r<e.minimum?[new d(t,r,r+" is less than the minimum value "+e.minimum)]:"maximum"in e&&r>e.maximum?[new d(t,r,r+" is greater than the maximum value "+e.maximum)]:[]}function fi(e){const n=e.valueSpec,a=_(e.value.type);let s,o={},l,u;var t="categorical"!==a&&void 0===e.value.property,r=!t;const h="array"===w(e.value.stops)&&"array"===w(e.value.stops[0])&&"object"===w(e.value.stops[0][0]),i=S({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new d(e.key,e.value,'identity function may not have a "stops" property')];let t=[];var r=e.value;t=t.concat(pi({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:c})),"array"===w(r)&&0===r.length&&t.push(new d(e.key,r,"array must have at least one stop"));return t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:n,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&t&&i.push(new d(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||i.push(new d(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!Dr(e.valueSpec)&&i.push(new d(e.key,e.value,"exponential functions not supported")),8<=e.styleSpec.$version&&(r&&!Er(e.valueSpec)?i.push(new d(e.key,e.value,"property functions not supported")):t&&!Fr(e.valueSpec)&&i.push(new d(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!h||void 0!==e.value.property||i.push(new d(e.key,e.value,'"property" property is required')),i;function c(e){let t=[];var r=e.value,i=e.key;if("array"!==w(r))return[new d(i,r,`array expected, ${w(r)} found`)];if(2!==r.length)return[new d(i,r,`array length 2 expected, length ${r.length} found`)];if(h){if("object"!==w(r[0]))return[new d(i,r,`object expected, ${w(r[0])} found`)];if(void 0===r[0].zoom)return[new d(i,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new d(i,r,"object stop key must have value")];if(u&&u>_(r[0].zoom))return[new d(i,r[0].zoom,"stop zoom values must appear in ascending order")];_(r[0].zoom)!==u&&(u=_(r[0].zoom),l=void 0,o={}),t=t.concat(S({key:i+"[0]",value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:di,value:p}}))}else t=t.concat(p({key:i+"[0]",value:r[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return Gr(ci(r[1]))?t.concat([new d(i+"[1]",r[1],"expressions are not allowed in function stops.")]):t.concat(e.validateSpec({key:i+"[1]",value:r[1],valueSpec:n,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function p(t,r){var i=w(t.value),e=_(t.value),r=null!==t.value?t.value:r;if(s){if(i!==s)return[new d(t.key,r,i+" stop domain type must match previous stop domain type "+s)]}else s=i;if("number"!==i&&"string"!==i&&"boolean"!==i)return[new d(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===i||"categorical"===a)return"categorical"!==a||"number"!==i||isFinite(e)&&Math.floor(e)===e?"categorical"!==a&&"number"===i&&void 0!==l&&e<l?[new d(t.key,r,"stop domain values must appear in ascending order")]:(l=e,"categorical"===a&&e in o?[new d(t.key,r,"stop domain values must be unique")]:(o[e]=!0,[])):[new d(t.key,r,"integer expected, found "+e)];{let e=`number expected, ${i} found`;return Er(n)&&void 0===a&&(e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new d(t.key,r,e)]}}}function yi(t){const e=("property"===t.expressionContext?Kr:Xr)(ci(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new d(""+t.key+e.key,t.value,e.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new d(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Cr(r))return[new d(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Cr(r))return[new d(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Br(r,["zoom","feature-state"]))return[new d(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Pr(r))return[new d(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mi(e){var t=e.key,r=e.value;const i=e.valueSpec,n=[];return Array.isArray(i.values)?-1===i.values.indexOf(_(r))&&n.push(new d(t,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(i.values).indexOf(_(r))&&n.push(new d(t,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),n}function gi(e){return ei(ci(e.value))?yi(Q({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){const i=r.value;const n=r.key;if("array"!==w(i))return[new d(n,i,`array expected, ${w(i)} found`)];const a=r.styleSpec;let s;let o=[];if(i.length<1)return[new d(n,i,"filter array must have at least 1 element")];o=o.concat(mi({key:n+"[0]",value:i[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec}));switch(_(i[0])){case"<":case"<=":case">":case">=":2<=i.length&&"$type"===_(i[1])&&o.push(new d(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new d(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":2<=i.length&&"string"!==(s=w(i[1]))&&o.push(new d(n+"[1]",i[1],`string expected, ${s} found`));for(let e=2;e<i.length;e++)s=w(i[e]),"$type"===_(i[1])?o=o.concat(mi({key:`${n}[${e}]`,value:i[e],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&o.push(new d(`${n}[${e}]`,i[e],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)o=o.concat(t({key:`${n}[${e}]`,value:i[e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":s=w(i[1]),2!==i.length?o.push(new d(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==s&&o.push(new d(n+"[1]",i[1],`string expected, ${s} found`))}return o}(e)}function vi(e,t){var r=e.key;const i=e.validateSpec;var n=e.style,a=e.styleSpec,s=e.value;const o=e.objectKey;var l=a[t+"_"+e.layerType];if(!l)return[];var u=o.match(/^(.*)-transition$/);if("paint"===t&&u&&l[u[1]]&&l[u[1]].transition)return i({key:r,value:s,valueSpec:a.transition,style:n,styleSpec:a});u=e.valueSpec||l[o];if(!u)return[new d(r,s,`unknown property "${o}"`)];let h;if("string"===w(s)&&Er(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new d(r,s,`"${o}" does not support interpolation syntax
`+`Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const c=[];return"symbol"===e.layerType&&("text-field"===o&&n&&!n.glyphs&&c.push(new d(r,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Lr(ci(s))&&"identity"===_(s.type)&&c.push(new d(r,s,'"text-font" does not support identity functions'))),c.concat(i({key:e.key,value:s,valueSpec:u,style:n,styleSpec:a,expressionContext:"property",propertyType:t,propertyKey:o}))}function xi(e){return vi(e,"paint")}function bi(e){return vi(e,"layout")}function wi(t){let r=[];const i=t.value,n=t.key,a=t.style,e=t.styleSpec;i.type||i.ref||r.push(new d(n,i,'either "type" or "ref" is required'));let s=_(i.type);const o=_(i.ref);if(i.id){var l=_(i.id);for(let e=0;e<t.arrayIndex;e++){var u=a.layers[e];_(u.id)===l&&r.push(new d(n,i.id,`duplicate layer id "${i.id}", previously used at line `+u.id.__line__))}}if("ref"in i){["type","source","source-layer","filter","layout"].forEach(e=>{e in i&&r.push(new d(n,i[e],`"${e}" is prohibited for ref layers`))});let t;a.layers.forEach(e=>{_(e.id)===o&&(t=e)}),t?t.ref?r.push(new d(n,i.ref,"ref cannot reference another ref layer")):s=_(t.type):r.push(new d(n,i.ref,`ref layer "${o}" not found`))}else{var h,c;"background"!==s&&(i.source?(c=(h=a.sources&&a.sources[i.source])&&_(h.type),h?"vector"===c&&"raster"===s?r.push(new d(n,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==c&&"hillshade"===s?r.push(new d(n,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===c&&"raster"!==s?r.push(new d(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==c||i["source-layer"]?"raster-dem"===c&&"hillshade"!==s?r.push(new d(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===c&&h.lineMetrics||r.push(new d(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new d(n,i,`layer "${i.id}" must specify a "source-layer"`)):r.push(new d(n,i.source,`source "${i.source}" not found`))):r.push(new d(n,i,'missing required property "source"')))}return r=r.concat(S({key:n,value:i,valueSpec:e.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*"(){return[]},type(){return t.validateSpec({key:n+".type",value:i.type,valueSpec:e.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"})},filter:gi,layout(e){return S({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*"(e){return bi(Q({layerType:s},e))}}})},paint(e){return S({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*"(e){return xi(Q({layerType:s},e))}}})}}}))}function _i(e){var t=e.value,e=e.key,r=w(t);return"string"!==r?[new d(e,t,`string expected, ${r} found`)]:[]}const Si={promoteId:function({key:e,value:t}){{if("string"===w(t))return _i({key:e,value:t});{const r=[];for(const i in t)r.push(..._i({key:e+"."+i,value:t[i]}));return r}}}};function ki(e){var t=e.value,r=e.key,i=e.styleSpec,n=e.style,a=e.validateSpec;if(!t.type)return[new d(r,t,'"type" is required')];const s=_(t.type);let o;switch(s){case"vector":case"raster":return o=S({key:r,value:t,valueSpec:i["source_"+s.replace("-","_")],style:e.style,styleSpec:i,objectElementValidators:Si,validateSpec:a});case"raster-dem":return o=function(e){var t=null!=(o=e.sourceName)?o:"",r=e.value,i=e.styleSpec,n=i.source_raster_dem,a=e.style;let s=[];var o=w(r);if(void 0===r)return s;if("object"!==o)return s.push(new d("source_raster_dem",r,`object expected, ${o} found`)),s;var l="custom"===_(r.encoding);const u=["redFactor","greenFactor","blueFactor","baseShift"];var h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const c in r)!l&&u.includes(c)?s.push(new d(c,r[c],`In "${t}": "${c}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):n[c]?s=s.concat(e.validateSpec({key:c,value:r[c],valueSpec:n[c],validateSpec:e.validateSpec,style:a,styleSpec:i})):s.push(new d(c,r[c],`unknown property "${c}"`));return s}({sourceName:r,value:t,style:e.style,styleSpec:i,validateSpec:a});case"geojson":if(o=S({key:r,value:t,valueSpec:i.source_geojson,style:n,styleSpec:i,validateSpec:a,objectElementValidators:Si}),t.cluster)for(const h in t.clusterProperties){var[l,u]=t.clusterProperties[h],l="string"==typeof l?[l,["accumulated"],["get",h]]:l;o.push(...yi({key:`${r}.${h}.map`,value:u,validateSpec:a,expressionContext:"cluster-map"})),o.push(...yi({key:`${r}.${h}.reduce`,value:l,validateSpec:a,expressionContext:"cluster-reduce"}))}return o;case"video":return S({key:r,value:t,valueSpec:i.source_video,style:n,validateSpec:a,styleSpec:i});case"image":return S({key:r,value:t,valueSpec:i.source_image,style:n,validateSpec:a,styleSpec:i});case"canvas":return[new d(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mi({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:a,styleSpec:i})}}function Ai(e){var t=e.value,r=e.styleSpec,i=r.light,n=e.style;let a=[];var s=w(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new d("light",t,`object expected, ${s} found`)]);for(const l in t){var o=l.match(/^(.*)-transition$/);a=o&&i[o[1]]&&i[o[1]].transition?a.concat(e.validateSpec({key:l,value:t[l],valueSpec:r.transition,validateSpec:e.validateSpec,style:n,styleSpec:r})):i[l]?a.concat(e.validateSpec({key:l,value:t[l],valueSpec:i[l],validateSpec:e.validateSpec,style:n,styleSpec:r})):a.concat([new d(l,t[l],`unknown property "${l}"`)])}return a}function Ii(e){var t=e.value,r=e.styleSpec,i=r.sky,n=e.style,a=w(t);if(void 0===t)return[];if("object"!==a)return[new d("sky",t,`object expected, ${a} found`)];let s=[];for(const o in t)s=i[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:i[o],style:n,styleSpec:r})):s.concat([new d(o,t[o],`unknown property "${o}"`)]);return s}function Mi(e){var t=e.value,r=e.styleSpec,i=r.terrain,n=e.style;let a=[];var s=w(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new d("terrain",t,`object expected, ${s} found`)]);for(const o in t)a=i[o]?a.concat(e.validateSpec({key:o,value:t[o],valueSpec:i[o],validateSpec:e.validateSpec,style:n,styleSpec:r})):a.concat([new d(o,t[o],`unknown property "${o}"`)]);return a}function zi(e){let t=[];var r=e.value,i=e.key;if(Array.isArray(r)){const n=[],a=[];for(const s in r)r[s].id&&n.includes(r[s].id)&&t.push(new d(i,r,`all the sprites' ids must be unique, but ${r[s].id} is duplicated`)),n.push(r[s].id),r[s].url&&a.includes(r[s].url)&&t.push(new d(i,r,`all the sprites' URLs must be unique, but ${r[s].url} is duplicated`)),a.push(r[s].url),t=t.concat(S({key:`${i}[${s}]`,value:r[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return _i({key:i,value:r})}const Pi={"*"(){return[]},array:pi,boolean:function(e){var t=e.value,e=e.key,r=w(t);return"boolean"!==r?[new d(e,t,`boolean expected, ${r} found`)]:[]},number:di,color:function(e){var t=e.key,r=w(e=e.value);return"string"!==r?[new d(t,e,`color expected, ${r} found`)]:v.parse(String(e))?[]:[new d(t,e,`color expected, "${e}" found`)]},constants:hi,enum:mi,filter:gi,function:fi,layer:wi,object:S,source:ki,light:Ai,sky:Ii,terrain:Mi,projection:function(e){var t=e.value,r=e.styleSpec,i=r.projection,n=e.style,a=w(t);if(void 0===t)return[];if("object"!==a)return[new d("projection",t,`object expected, ${a} found`)];let s=[];for(const o in t)s=i[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:i[o],style:n,styleSpec:r})):s.concat([new d(o,t[o],`unknown property "${o}"`)]);return s},string:_i,formatted:function(e){return 0===_i(e).length?[]:yi(e)},resolvedImage:function(e){return 0===_i(e).length?[]:yi(e)},padding:function(r){var i=r.key,n=r.value;if("array"!==w(n))return di({key:i,value:n,valueSpec:{}});{if(n.length<1||4<n.length)return[new d(i,n,`padding requires 1 to 4 values; ${n.length} values found`)];var a={type:"number"};let t=[];for(let e=0;e<n.length;e++)t=t.concat(r.validateSpec({key:`${i}[${e}]`,value:n[e],validateSpec:r.validateSpec,valueSpec:a}));return t}},variableAnchorOffsetCollection:function(t){var r=t.key,i=t.value,e=w(i),n=t.styleSpec;if("array"!==e||i.length<1||i.length%2!=0)return[new d(r,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let e=0;e<i.length;e+=2)a=(a=a.concat(mi({key:`${r}[${e}]`,value:i[e],valueSpec:n.layout_symbol["text-anchor"]}))).concat(pi({key:`${r}[${e+1}]`,value:i[e+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:n}));return a},sprite:zi};function Ci(e){var t=e.value,r=e.valueSpec,i=e.styleSpec;return e.validateSpec=Ci,r.expression&&Lr(_(t))?fi(e):r.expression&&Gr(ci(t))?yi(e):r.type&&Pi[r.type]?Pi[r.type](e):S(Q({},e,{valueSpec:r.type?i[r.type]:r}))}function Bi(e){const t=e.value;var r=e.key;const i=_i(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new d(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new d(r,t,'"glyphs" url must include a "{range}" token'))),i}function Vi(e,t=l){let r=[];return r=r.concat(Ci({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Ci,objectElementValidators:{glyphs:Bi,"*"(){return[]}}})),Ei(r=e.constants?r.concat(hi({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:Ci})):r)}function Ti(t){return function(e){return t({...e,validateSpec:Ci})}}function Ei(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function Fi(t){return function(...e){return Ei(t.apply(this,e))}}Vi.source=Fi(Ti(ki)),Vi.sprite=Fi(Ti(zi)),Vi.glyphs=Fi(Ti(Bi)),Vi.light=Fi(Ti(Ai)),Vi.sky=Fi(Ti(Ii)),Vi.terrain=Fi(Ti(Mi)),Vi.layer=Fi(Ti(wi)),Vi.filter=Fi(Ti(gi)),Vi.paintProperty=Fi(Ti(xi)),Vi.layoutProperty=Fi(Ti(bi));Zr,Wr,Hr,Yr;const Di="AbortError";function Li(){return new Error(Di)}const Oi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function $i(e,t){Oi.REGISTERED_PROTOCOLS[e]=t}function Ri(e){delete Oi.REGISTERED_PROTOCOLS[e]}const ji="global-dispatcher";class qi extends Error{constructor(e,t,r,i){super(`AJAXError: ${t} (${e}): `+r),this.status=e,this.statusText=t,this.url=r,this.body=i}}const Ui=()=>Z(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,Ni=e=>/^file:/.test(e)||/^file:/.test(Ui())&&!/^\w+:/.test(e);function Zi(e,t){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){r=e.url;const i=Oi.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];if(i)return i(e,t);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:ji},t)}var r,a,s;if(!Ni(e.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(n,a){return p(this,void 0,void 0,function*(){const e=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Ui(),signal:a.signal}),t=("json"!==n.type||e.headers.has("Accept")||e.headers.set("Accept","application/json"),yield fetch(e));if(!t.ok)throw i=yield t.blob(),new qi(t.status,t.statusText,n.url,i);let r;var i=yield r="arrayBuffer"===n.type||"image"===n.type?t.arrayBuffer():"json"===n.type?t.json():t.text();if(a.signal.aborted)throw Li();return{data:i,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires")}})}(e,t);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:ji},t)}return a=e,s=t,new Promise((t,r)=>{var e;const i=new XMLHttpRequest;i.open(a.method||"GET",a.url,!0),"arrayBuffer"!==a.type&&"image"!==a.type||(i.responseType="arraybuffer");for(const n in a.headers)i.setRequestHeader(n,a.headers[n]);"json"===a.type&&(i.responseType="text",null!=(e=a.headers)&&e.Accept||i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===a.credentials,i.onerror=()=>{r(new Error(i.statusText))},i.onload=()=>{if(!s.signal.aborted)if((200<=i.status&&i.status<300||0===i.status)&&null!==i.response){let e=i.response;if("json"===a.type)try{e=JSON.parse(i.response)}catch(e){return void r(e)}t({data:e,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")})}else{var e=new Blob([i.response],{type:i.getResponseHeader("Content-Type")});r(new qi(i.status,i.statusText,a.url,e))}},s.signal.addEventListener("abort",()=>{i.abort(),r(Li())}),i.send(a.body)})}const Gi={};function t(e,t,r={}){if(Gi[e])throw new Error(e+" is already registered.");Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Gi[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}t("Object",Object),t("TransferableGridIndex",K),t("Color",v),t("Error",Error),t("AJAXError",qi),t("ResolvedImage",Xe),t("StylePropertyFunction",Wr),t("StyleExpression",Zr,{omit:["_evaluator"]}),t("ZoomDependentExpression",Yr),t("ZoomConstantExpression",Hr),t("CompoundExpression",kr,{omit:["_evaluate"]});for(const Bc in Sr)Sr[Bc]._classRegistryKey||t("Expression_"+Bc,Sr[Bc]);function Xi(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Hi(e){var t=e.constructor;return e.$name||t._classRegistryKey}function Yi(e){return!function(e){if(null!==e&&"object"==typeof e)return!(!(e=Hi(e))||"Object"===e)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||Xi(e)||G(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function Ji(e,t){if(Yi(e))return(Xi(e)||G(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const s=[];for(const o of e)s.push(Ji(o,t));return s}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);var r,i=Hi(e);if(!i)throw new Error("can't serialize object of unregistered class "+e.constructor.name);if(!Gi[i])throw new Error(i+" is not registered.");const n=Gi[i]["klass"],a=n.serialize?n.serialize(e,t):{};if(n.serialize){if(t&&a===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const l in e)!e.hasOwnProperty(l)||0<=Gi[i].omit.indexOf(l)||(r=e[l],a[l]=0<=Gi[i].shallow.indexOf(l)?r:Ji(r,t));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(a.$name=i),a}function Ki(e){if(Yi(e))return e;if(Array.isArray(e))return e.map(Ki);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);var t,r=Hi(e)||"Object";if(!Gi[r])throw new Error("can't deserialize unregistered class "+r);const i=Gi[r]["klass"];if(!i)throw new Error("can't deserialize unregistered class "+r);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const a of Object.keys(e))"$name"!==a&&(t=e[a],n[a]=0<=Gi[r].shallow.indexOf(a)?t:Ki(t));return n}class Wi{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}class Qi{constructor(e,t){var r,i,n,a;this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Wi(()=>this.process()),this.subscription=(r=this.target,i="message",a=!(n=e=>this.receive(e)),r.addEventListener(i,n,a),{unsubscribe:()=>{r.removeEventListener(i,n,a)}}),this.globalScope=Z(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(i,n){return new Promise((e,t)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[r]={resolve:e,reject:t},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[r];var e={id:r,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)},{once:!0});e=[],t=Object.assign(Object.assign({},i),{id:r,sourceMapId:this.mapId,origin:location.origin,data:Ji(i.data,e)});this.target.postMessage(t,{transfer:e})})}receive(e){var e=e.data,t=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[t];const r=this.abortControllers[t];return delete this.abortControllers[t],void(r&&r.abort())}if(Z(self)||e.mustQueue)return this.tasks[t]=e,this.taskQueue.push(t),void this.invoker.trigger();this.processTask(t,e)}}process(){var e,t;0!==this.taskQueue.length&&(e=this.taskQueue.shift(),t=this.tasks[e],delete this.tasks[e],0<this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t))}processTask(n,a){return p(this,void 0,void 0,function*(){if("<response>"===a.type){const i=this.resolveRejects[n];return(delete this.resolveRejects[n],i)?void(a.error?i.reject(Ki(a.error)):i.resolve(Ki(a.data))):void 0}if(this.messageHandlers[a.type]){var e=Ki(a.data),t=new AbortController;this.abortControllers[n]=t;try{var r=yield this.messageHandlers[a.type](a.sourceMapId,e,t);this.completeTask(n,null,r)}catch(e){this.completeTask(n,e)}}else this.completeTask(n,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: `+Object.keys(this.messageHandlers).join(", ")))})}completeTask(e,t,r){var i=[],e=(delete this.abortControllers[e],{id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ji(t):null,data:Ji(r,i)});this.target.postMessage(e,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}}function en(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function tn(e,t,r){r&&r[e]&&(-1!==(t=r[e].indexOf(t))&&r[e].splice(t,1))}class rn{constructor(e,t={}){R(this,t),this.type=e}}class nn extends rn{constructor(e,t={}){super("error",R({error:e},t))}}const an=Vi;an,an,an,an,an;const sn=an.paintProperty,on=an.layoutProperty;class ln{constructor(){this.first=!0}update(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const n={"Latin-1 Supplement":e=>128<=e&&e<=255,"Hangul Jamo":e=>4352<=e&&e<=4607,Khmer:e=>6016<=e&&e<=6143,"General Punctuation":e=>8192<=e&&e<=8303,"Letterlike Symbols":e=>8448<=e&&e<=8527,"Number Forms":e=>8528<=e&&e<=8591,"Miscellaneous Technical":e=>8960<=e&&e<=9215,"Control Pictures":e=>9216<=e&&e<=9279,"Optical Character Recognition":e=>9280<=e&&e<=9311,"Enclosed Alphanumerics":e=>9312<=e&&e<=9471,"Geometric Shapes":e=>9632<=e&&e<=9727,"Miscellaneous Symbols":e=>9728<=e&&e<=9983,"Miscellaneous Symbols and Arrows":e=>11008<=e&&e<=11263,"Ideographic Description Characters":e=>12272<=e&&e<=12287,"CJK Symbols and Punctuation":e=>12288<=e&&e<=12351,Katakana:e=>12448<=e&&e<=12543,Kanbun:e=>12688<=e&&e<=12703,"CJK Strokes":e=>12736<=e&&e<=12783,"Enclosed CJK Letters and Months":e=>12800<=e&&e<=13055,"CJK Compatibility":e=>13056<=e&&e<=13311,"Yijing Hexagram Symbols":e=>19904<=e&&e<=19967,"Private Use Area":e=>57344<=e&&e<=63743,"Vertical Forms":e=>65040<=e&&e<=65055,"CJK Compatibility Forms":e=>65072<=e&&e<=65103,"Small Form Variants":e=>65104<=e&&e<=65135,"Halfwidth and Fullwidth Forms":e=>65280<=e&&e<=65519};function un(e){for(const t of e)if(yn(t.charCodeAt(0)))return!0;return!1}function hn(e){for(const r of e)if(t=r.charCodeAt(0),pn.test(String.fromCodePoint(t)))return;var t;return 1}function cn(e){const t=e.map(e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}}).filter(e=>e);return new RegExp(t.join("|"),"u")}const pn=cn(["Arab","Dupl","Mong","Ougr","Syrc"]);const dn=cn(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function fn(e){return!(e<11904)&&(!!n["CJK Compatibility Forms"](e)||(!!n["CJK Compatibility"](e)||(!!n["CJK Strokes"](e)||(!!n["CJK Symbols and Punctuation"](e)||(!!n["Enclosed CJK Letters and Months"](e)||(!!n["Halfwidth and Fullwidth Forms"](e)||(!!n["Ideographic Description Characters"](e)||(!!n["Vertical Forms"](e)||dn.test(String.fromCodePoint(e))))))))))}function yn(e){return 746===e||747===e||!(e<4352)&&(n["CJK Compatibility Forms"](e)&&!(65097<=e&&e<=65103)||(n["CJK Compatibility"](e)||(n["CJK Strokes"](e)||(!(!n["CJK Symbols and Punctuation"](e)||12296<=e&&e<=12305||12308<=e&&e<=12319||12336===e)||(n["Enclosed CJK Letters and Months"](e)||(n["Ideographic Description Characters"](e)||(n.Kanbun(e)||(n.Katakana(e)&&12540!==e||(!(!n["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||65306<=e&&e<=65310||65339===e||65341===e||65343===e||65371<=e&&e<=65503||65507===e||65512<=e&&e<=65519)||(!(!n["Small Form Variants"](e)||65112<=e&&e<=65118||65123<=e&&e<=65126)||(n["Vertical Forms"](e)||(n["Yijing Hexagram Symbols"](e)||(/\p{sc=Cans}/u.test(String.fromCodePoint(e))||(/\p{sc=Hang}/u.test(String.fromCodePoint(e))||!!dn.test(String.fromCodePoint(e))))))))))))))))}function mn(e){return!(yn(e)||(e=e,n["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n["Letterlike Symbols"](e)||(n["Number Forms"](e)||(n["Miscellaneous Technical"](e)&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||(n["Control Pictures"](e)&&9251!==e||(n["Optical Character Recognition"](e)||(n["Enclosed Alphanumerics"](e)||(n["Geometric Shapes"](e)||(n["Miscellaneous Symbols"](e)&&!(9754<=e&&e<=9759)||(n["Miscellaneous Symbols and Arrows"](e)&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||(n["CJK Symbols and Punctuation"](e)||(n.Katakana(e)||(n["Private Use Area"](e)||(n["CJK Compatibility Forms"](e)||(n["Small Form Variants"](e)||(n["Halfwidth and Fullwidth Forms"](e)||(8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e)))))))))))))))))))}const gn=cn(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function vn(e){return gn.test(String.fromCodePoint(e))}function xn(e,t){for(const i of e)if(r=i.charCodeAt(0),!t&&vn(r)||(2304<=r&&r<=3583||3840<=r&&r<=4255||n.Khmer(r)))return!1;var r;return!0}const ne=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class z{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ln,this.transition={})}isSupportedScript(e){return xn(e,"loaded"===ne.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class bn{constructor(e,t){this.property=e,this.value=t,this.expression=Qr(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class wn{constructor(e){this.property=e,this.value=new bn(e,void 0)}transitioned(e,t){return new Sn(this.property,this.value,t,R({},e.transition,this.transition),e.now)}untransitioned(){return new Sn(this.property,this.value,null,{},0)}}class _n{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return q(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wn(this._values[e].property)),this._values[e].value=new bn(this._values[e].property,null===t?void 0:q(t))}getTransition(e){return q(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wn(this._values[e].property)),this._values[e].transition=q(t)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r),t=(void 0!==t&&(e[r]=t),this.getTransition(r));void 0!==t&&(e[r+"-transition"]=t)}return e}transitioned(e,t){const r=new kn(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(e,t._values[i]);return r}untransitioned(){const e=new kn(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Sn{constructor(e,t,r,i,n){this.property=e,this.value=t,this.begin=n+i.delay||0,this.end=this.begin+i.duration||0,e.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){var i=e.now||0,n=this.value.possiblyEvaluate(e,t,r);const a=this.prior;return a?i>this.end||this.value.isDataDriven()?(this.prior=null,n):i<this.begin?a.possiblyEvaluate(e,t,r):(i=(i-this.begin)/(this.end-this.begin),this.property.interpolate(a.possiblyEvaluate(e,t,r),n,function(e){if(e<=0)return 0;if(1<=e)return 1;var t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}(i))):n}}class kn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const i=new Mn(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class An{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return q(this._values[e].value)}setValue(e,t){this._values[e]=new bn(this._values[e].property,null===t?void 0:q(t))}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r);void 0!==t&&(e[r]=t)}return e}possiblyEvaluate(e,t,r){const i=new Mn(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}}class In{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,i){return this.property.evaluate(this.value,this.parameters,e,t,r,i)}}class Mn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class r{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,r){var i=this.specification.type;const n=gt[i];return n?n(e,t,r):e}}class i{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,i){return"constant"===e.expression.kind||"camera"===e.expression.kind?new In(this,{kind:"constant",value:e.expression.evaluate(t,null,{},r,i)},t):new In(this,e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new In(this,{kind:"constant",value:void 0},e.parameters);var i=this.specification.type;const n=gt[i];return n?(i=n(e.value.value,t.value.value,r),new In(this,{kind:"constant",value:i},e.parameters)):e}evaluate(e,t,r,i,n,a){return"constant"===e.kind?e.value:e.evaluate(t,r,i,n,a)}}class zn extends i{possiblyEvaluate(e,t,r,i){return void 0===e.value?new In(this,{kind:"constant",value:void 0},t):"constant"===e.expression.kind?(r=e.expression.evaluate(t,null,{},r,i),i="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,r=this._calculate(i,i,i,t),new In(this,{kind:"constant",value:r},t)):"camera"===e.expression.kind?(i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t),new In(this,{kind:"constant",value:i},t)):new In(this,e.expression,t)}evaluate(e,t,r,i,n,a){return"source"===e.kind?(n=e.evaluate(t,r,i,n,a),this._calculate(n,n,n,t)):"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,i),e.evaluate({zoom:Math.floor(t.zoom)},r,i),e.evaluate({zoom:Math.floor(t.zoom)+1},r,i),t):e.value}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class Pn{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){if(void 0!==e.value)return"constant"===e.expression.kind?(r=e.expression.evaluate(t,null,{},r,i),this._calculate(r,r,r,t)):this._calculate(e.expression.evaluate(new z(Math.floor(t.zoom-1),t)),e.expression.evaluate(new z(Math.floor(t.zoom),t)),e.expression.evaluate(new z(Math.floor(t.zoom+1),t)),t)}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class Cn{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){return!!e.expression.evaluate(t,null,{},r,i)}interpolate(){return!1}}class a{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){var t=e[r];t.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new bn(t,void 0),n=this.defaultTransitionablePropertyValues[r]=new wn(t);this.defaultTransitioningPropertyValues[r]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate({})}}}t("DataDrivenProperty",i),t("DataConstantProperty",r),t("CrossFadedDataDrivenProperty",zn),t("CrossFadedProperty",Pn),t("ColorRampProperty",Cn);const Bn="-transition";class Vn extends class{on(e,t){return this._listeners=this._listeners||{},en(e,t,this._listeners),this}off(e,t){return tn(e,t,this._listeners),tn(e,t,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},en(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(e,t){var r=(e="string"==typeof e?new rn(e,t||{}):e).type;if(this.listens(r)){for(const n of(e.target=this)._listeners&&this._listeners[r]?this._listeners[r].slice():[])n.call(this,e);for(const a of this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[])tn(r,a,this._oneTimeListeners),a.call(this,e);const i=this._eventedParent;i&&(R(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof nn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&0<this._listeners[e].length||this._oneTimeListeners&&this._oneTimeListeners[e]&&0<this._oneTimeListeners[e].length||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new An(t.layout)),t.paint)){this._transitionablePaint=new _n(t.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mn(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){if(null!=t){var i=`layers.${this.id}.layout.`+e;if(this._validate(on,i,e,t,r))return}"visibility"===e?this.visibility=t:this._unevaluatedLayout.setValue(e,t)}getPaintProperty(e){return e.endsWith(Bn)?this._transitionablePaint.getTransition(e.slice(0,-Bn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t){var i=`layers.${this.id}.paint.`+e;if(this._validate(sn,i,e,t,r))return!1}if(e.endsWith(Bn))return this._transitionablePaint.setTransition(e.slice(0,-Bn.length),t||void 0),!1;{const a=this._transitionablePaint._values[e];var i="cross-faded-data-driven"===a.property.specification["property-type"],r=a.value.isDataDriven(),n=a.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(e,n,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||(!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility)}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(e,t,r){const i={};for(const n in e)t.call(r||this,e[n],n,e)&&(i[n]=e[n]);return i}(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(t,r,i,n,a={}){if(a&&!1===a.validate)return!1;{var s=this,a=t.call(an,{key:r,layerType:this.type,objectKey:i,value:n,styleSpec:l,style:{glyphs:!0,sprite:!0}});let e=!1;if(a&&a.length)for(const o of a)s.fire(new nn(new Error(o.message))),e=!0;return e}}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){var e=this.paint.get(t);if(e instanceof In&&Er(e.property.specification)&&(("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent))return!0}return!1}}const Tn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class En{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class s{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){e>this.capacity&&(this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),e=this.uint8,this._refreshViews(),e&&this.uint8.set(e))}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function o(e,n=1){let a=0,s=0;return{members:e.map(e=>{t=e.type;var t=Tn[t].BYTES_PER_ELEMENT,r=a=Fn(a,Math.max(n,t)),i=e.components||1;return s=Math.max(s,t),a+=t*i,{name:e.name,type:e.type,components:i,offset:r}}),size:Fn(a,Math.max(s,n)),alignment:n}}function Fn(e,t){return Math.ceil(e/t)*t}class Dn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.int16[0+i]=t,this.int16[1+i]=r,e}}Dn.prototype.bytesPerElement=4,t("StructArrayLayout2i4",Dn);class Ln extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.int16[0+n]=t,this.int16[1+n]=r,this.int16[2+n]=i,e}}Ln.prototype.bytesPerElement=6,t("StructArrayLayout3i6",Ln);class On extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=4*e;return this.int16[0+a]=t,this.int16[1+a]=r,this.int16[2+a]=i,this.int16[3+a]=n,e}}On.prototype.bytesPerElement=8,t("StructArrayLayout4i8",On);class $n extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,a)}emplace(e,t,r,i,n,a,s){var o=6*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.int16[2+o]=i,this.int16[3+o]=n,this.int16[4+o]=a,this.int16[5+o]=s,e}}$n.prototype.bytesPerElement=12,t("StructArrayLayout2i4i12",$n);class Rn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,a)}emplace(e,t,r,i,n,a,s){var o=4*e,l=8*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.uint8[4+l]=i,this.uint8[5+l]=n,this.uint8[6+l]=a,this.uint8[7+l]=s,e}}Rn.prototype.bytesPerElement=8,t("StructArrayLayout2i4ub8",Rn);class jn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.float32[0+i]=t,this.float32[1+i]=r,e}}jn.prototype.bytesPerElement=8,t("StructArrayLayout2f8",jn);class qn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,u){var h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,i,n,a,s,o,l,u)}emplace(e,t,r,i,n,a,s,o,l,u,h){var c=10*e;return this.uint16[0+c]=t,this.uint16[1+c]=r,this.uint16[2+c]=i,this.uint16[3+c]=n,this.uint16[4+c]=a,this.uint16[5+c]=s,this.uint16[6+c]=o,this.uint16[7+c]=l,this.uint16[8+c]=u,this.uint16[9+c]=h,e}}qn.prototype.bytesPerElement=20,t("StructArrayLayout10ui20",qn);class Un extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,u,h,c){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,i,n,a,s,o,l,u,h,c)}emplace(e,t,r,i,n,a,s,o,l,u,h,c,p){var d=12*e;return this.int16[0+d]=t,this.int16[1+d]=r,this.int16[2+d]=i,this.int16[3+d]=n,this.uint16[4+d]=a,this.uint16[5+d]=s,this.uint16[6+d]=o,this.uint16[7+d]=l,this.int16[8+d]=u,this.int16[9+d]=h,this.int16[10+d]=c,this.int16[11+d]=p,e}}Un.prototype.bytesPerElement=24,t("StructArrayLayout4i4ui4i24",Un);class Nn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.float32[0+n]=t,this.float32[1+n]=r,this.float32[2+n]=i,e}}Nn.prototype.bytesPerElement=12,t("StructArrayLayout3f12",Nn);class Zn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[0+ +e]=t,e}}Zn.prototype.bytesPerElement=4,t("StructArrayLayout1ul4",Zn);class Gn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l){var u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,i,n,a,s,o,l)}emplace(e,t,r,i,n,a,s,o,l,u){var h=10*e,c=5*e;return this.int16[0+h]=t,this.int16[1+h]=r,this.int16[2+h]=i,this.int16[3+h]=n,this.int16[4+h]=a,this.int16[5+h]=s,this.uint32[3+c]=o,this.uint16[8+h]=l,this.uint16[9+h]=u,e}}Gn.prototype.bytesPerElement=20,t("StructArrayLayout6i1ul2ui20",Gn);class Xn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,a)}emplace(e,t,r,i,n,a,s){var o=6*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.int16[2+o]=i,this.int16[3+o]=n,this.int16[4+o]=a,this.int16[5+o]=s,e}}Xn.prototype.bytesPerElement=12,t("StructArrayLayout2i2i2i12",Xn);class Hn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n)}emplace(e,t,r,i,n,a){var s=4*e,o=8*e;return this.float32[0+s]=t,this.float32[1+s]=r,this.float32[2+s]=i,this.int16[6+o]=n,this.int16[7+o]=a,e}}Hn.prototype.bytesPerElement=16,t("StructArrayLayout2f1f2i16",Hn);class Yn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,n,a)}emplace(e,t,r,i,n,a,s){var o=16*e,l=4*e,u=8*e;return this.uint8[0+o]=t,this.uint8[1+o]=r,this.float32[1+l]=i,this.float32[2+l]=n,this.int16[6+u]=a,this.int16[7+u]=s,e}}Yn.prototype.bytesPerElement=16,t("StructArrayLayout2ub2f2i16",Yn);class Jn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.uint16[0+n]=t,this.uint16[1+n]=r,this.uint16[2+n]=i,e}}Jn.prototype.bytesPerElement=6,t("StructArrayLayout3ui6",Jn);class Kn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m){var g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m)}emplace(e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m,g){var v=24*e,x=12*e,b=48*e;return this.int16[0+v]=t,this.int16[1+v]=r,this.uint16[2+v]=i,this.uint16[3+v]=n,this.uint32[2+x]=a,this.uint32[3+x]=s,this.uint32[4+x]=o,this.uint16[10+v]=l,this.uint16[11+v]=u,this.uint16[12+v]=h,this.float32[7+x]=c,this.float32[8+x]=p,this.uint8[36+b]=d,this.uint8[37+b]=f,this.uint8[38+b]=y,this.uint32[10+x]=m,this.int16[22+v]=g,e}}Kn.prototype.bytesPerElement=48,t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Kn);class Wn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m,g,v,x,b,w,_,S,k,A,I,M){var z=this.length;return this.resize(z+1),this.emplace(z,e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m,g,v,x,b,w,_,S,k,A,I,M)}emplace(e,t,r,i,n,a,s,o,l,u,h,c,p,d,f,y,m,g,v,x,b,w,_,S,k,A,I,M,z){var P=32*e,C=16*e;return this.int16[0+P]=t,this.int16[1+P]=r,this.int16[2+P]=i,this.int16[3+P]=n,this.int16[4+P]=a,this.int16[5+P]=s,this.int16[6+P]=o,this.int16[7+P]=l,this.uint16[8+P]=u,this.uint16[9+P]=h,this.uint16[10+P]=c,this.uint16[11+P]=p,this.uint16[12+P]=d,this.uint16[13+P]=f,this.uint16[14+P]=y,this.uint16[15+P]=m,this.uint16[16+P]=g,this.uint16[17+P]=v,this.uint16[18+P]=x,this.uint16[19+P]=b,this.uint16[20+P]=w,this.uint16[21+P]=_,this.uint16[22+P]=S,this.uint32[12+C]=k,this.float32[13+C]=A,this.float32[14+C]=I,this.uint16[30+P]=M,this.uint16[31+P]=z,e}}Wn.prototype.bytesPerElement=64,t("StructArrayLayout8i15ui1ul2f2ui64",Wn);class Qn extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[0+ +e]=t,e}}Qn.prototype.bytesPerElement=4,t("StructArrayLayout1f4",Qn);class ea extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.uint16[0+6*e]=t,this.float32[1+n]=r,this.float32[2+n]=i,e}}ea.prototype.bytesPerElement=12,t("StructArrayLayout1ui2f12",ea);class ta extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=4*e;return this.uint32[0+2*e]=t,this.uint16[2+n]=r,this.uint16[3+n]=i,e}}ta.prototype.bytesPerElement=8,t("StructArrayLayout1ul2ui8",ta);class ra extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.uint16[0+i]=t,this.uint16[1+i]=r,e}}ra.prototype.bytesPerElement=4,t("StructArrayLayout2ui4",ra);class ia extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[0+ +e]=t,e}}ia.prototype.bytesPerElement=2,t("StructArrayLayout1ui2",ia);class na extends s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=4*e;return this.float32[0+a]=t,this.float32[1+a]=r,this.float32[2+a]=i,this.float32[3+a]=n,e}}na.prototype.bytesPerElement=16,t("StructArrayLayout4f16",na);class aa extends En{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new O(this.anchorPointX,this.anchorPointY)}}aa.prototype.size=20;class sa extends Gn{get(e){return new aa(this,e)}}t("CollisionBoxArray",sa);class oa extends En{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}oa.prototype.size=48;class la extends Kn{get(e){return new oa(this,e)}}t("PlacedSymbolArray",la);class ua extends En{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ua.prototype.size=64;class ha extends Wn{get(e){return new ua(this,e)}}t("SymbolInstanceArray",ha);class ca extends Qn{getoffsetX(e){return this.float32[+e+0]}}t("GlyphOffsetArray",ca);class pa extends Ln{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}t("SymbolLineVertexArray",pa);class da extends En{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}da.prototype.size=12;class fa extends ea{get(e){return new da(this,e)}}t("TextAnchorOffsetArray",fa);class ya extends En{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ya.prototype.size=8;class ma extends ta{get(e){return new ya(this,e)}}t("FeatureIndexArray",ma);class ga extends Dn{}class va extends Dn{}class xa extends Dn{}class ba extends $n{}class wa extends Rn{}class _a extends jn{}class Sa extends qn{}class ka extends Un{}class Aa extends Nn{}class Ia extends Zn{}class Ma extends Xn{}class za extends Yn{}class Pa extends Jn{}class Ca extends ra{}const Ba=o([{name:"a_pos",components:2,type:"Int16"}],4)["members"];class k{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,i){let n=this.segments[this.segments.length-1];return e>k.MAX_VERTEX_ARRAY_LENGTH&&ue(`Max vertices per segment is ${k.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+e),(!n||n.vertexLength+e>k.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,i){return new k([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}function Va(e,t){return 256*(e=$(Math.floor(e),0,255))+(t=$(Math.floor(t),0,255))}k.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,t("SegmentVector",k);const Ta=o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);function Ea(e,t){for(var r,i,n=3&e.length,a=e.length-n,s=t,o=3432918353,l=461845907,u=0;u<a;)i=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,s=27492+(65535&(r=5*(65535&(s=(s^=i=(65535&(i=(i=(65535&i)*o+(((i>>>16)*o&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(i=0,n){case 3:i^=(255&e.charCodeAt(u+2))<<16;case 2:i^=(255&e.charCodeAt(u+1))<<8;case 1:s^=i=(65535&(i=(i=(65535&(i^=255&e.charCodeAt(u)))*o+(((i>>>16)*o&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295}return s=2246822507*(65535&(s=(s^=e.length)^s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}function Fa(e,t){for(var r,i=e.length,n=t^i,a=0;4<=i;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16),i-=4,++a;switch(i){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}var e={exports:{}},V=(e.exports,Ea),kt=Fa,Da=(e.exports=V,e.exports.murmur3=V,e.exports.murmur2=kt,P(e.exports));class La{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,i){this.ids.push(Oa(e)),this.positions.push(t,r,i)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");var t=Oa(e);let r=0,i=this.ids.length-1;for(;r<i;){var n=r+i>>1;this.ids[n]>=t?i=n:r=1+n}const a=[];for(;this.ids[r]===t;){var s=this.positions[3*r],o=this.positions[3*r+1],l=this.positions[3*r+2];a.push({index:s,start:o,end:l}),r++}return a}static serialize(e,t){var r=new Float64Array(e.ids),e=new Uint32Array(e.positions);return function r(i,n,a,s){for(;a<s;){const o=i[a+s>>1];let e=a-1,t=s+1;for(;;){for(;e++,i[e]<o;);for(;t--,i[t]>o;);if(e>=t)break;$a(i,e,t),$a(n,3*e,3*t),$a(n,3*e+1,3*t+1),$a(n,3*e+2,3*t+2)}t-a<s-t?(r(i,n,a,t),a=t+1):(r(i,n,t+1,s),s=t)}}(r,e,0,r.length-1),t&&t.push(r.buffer,e.buffer),{ids:r,positions:e}}static deserialize(e){const t=new La;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Oa(e){var t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Da(String(e))}function $a(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}t("FeaturePositionMap",La);class Ra{constructor(e,t){this.gl=e.gl,this.location=t}}class ja extends Ra{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class qa extends Ra{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ua extends Ra{constructor(e,t){super(e,t),this.current=v.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}new Float32Array(16);function Na(e){return[Va(255*e.r,255*e.g),Va(255*e.b,255*e.a)]}class Za{constructor(e,t,r){this.value=e,this.uniformNames=t.map(e=>"u_"+e),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return new("color"===this.type?Ua:ja)(e,t)}}class Ga{constructor(e,t){this.uniformNames=t.map(e=>"u_"+e),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,r,i){i="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;i&&e.set(i)}getBinding(e,t,r){return new("u_pattern"===r.substr(0,9)?qa:ja)(e,t)}}class Xa{constructor(e,t,r,i){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,r,i,n){var a=this.paintVertexArray.length,t=this.expression.evaluate(new z(0),t,{},i,[],n);this.paintVertexArray.resize(e),this._setPaintValue(a,e,t)}updatePaintArray(e,t,r,i){r=this.expression.evaluate({zoom:0},r,i);this._setPaintValue(e,t,r)}_setPaintValue(t,r,i){if("color"===this.type){var n=Na(i);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n[0],n[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ha{constructor(e,t,r,i,n,a){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=i,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,r,i,n){var a=this.expression.evaluate(new z(this.zoom),t,{},i,[],n),t=this.expression.evaluate(new z(this.zoom+1),t,{},i,[],n),i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(i,e,a,t)}updatePaintArray(e,t,r,i){var n=this.expression.evaluate({zoom:this.zoom},r,i),r=this.expression.evaluate({zoom:this.zoom+1},r,i);this._setPaintValue(e,t,n,r)}_setPaintValue(t,r,i,n){if("color"===this.type){var a=Na(i),s=Na(n);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,a[0],a[1],s[0],s[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){t=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,t=$(this.expression.interpolationFactor(t,this.zoom,this.zoom+1),0,1);e.set(t)}getBinding(e,t,r){return new ja(e,t)}}class Ya{constructor(e,t,r,i,n,a){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=i,this.layerId=a,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(e,t,r){var i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,i,n){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],n)}_setPaintValues(t,r,e,i){if(i&&e){var{min:e,mid:n,max:a}=e,s=i[e],o=i[n],l=i[a];if(s&&o&&l)for(let e=t;e<r;e++)this.zoomInPaintVertexArray.emplace(e,o.tl[0],o.tl[1],o.br[0],o.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],o.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(e,o.tl[0],o.tl[1],o.br[0],o.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],o.pixelRatio,l.pixelRatio)}}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ta.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ta.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ja{constructor(e,t,r){this.binders={},this._buffers=[];const i=[];for(const h in e.paint._values){var n,a,s,o;r(h)&&((o=e.paint.get(h))instanceof In&&Er(o.property.specification)&&(l=h,u=e.type,l={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(u+"-","").replace(/-/g,"_")],u=o.value,n=o.property.specification.type,a=o.property.useIntegerZoom,o="cross-faded"===(o=o.property.specification["property-type"])||"cross-faded-data-driven"===o,"constant"===u.kind?(this.binders[h]=o?new Ga(u.value,l):new Za(u.value,l,n),i.push("/u_"+h)):"source"===u.kind||o?(s=Wa(h,n,"source"),this.binders[h]=o?new Ya(u,n,a,t,s,e.id):new Xa(u,l,n,s),i.push("/a_"+h)):(o=Wa(h,n,"composite"),this.binders[h]=new Ha(u,l,n,a,t,o),i.push("/z_"+h))))}var l,u;this.cacheKey=i.sort().join("")}getMaxValue(e){e=this.binders[e];return e instanceof Xa||e instanceof Ha?e.maxValue:0}populatePaintArrays(e,t,r,i,n){for(const a in this.binders){const s=this.binders[a];(s instanceof Xa||s instanceof Ha||s instanceof Ya)&&s.populatePaintArray(e,t,r,i,n)}}setConstantPatternPositions(e,t){for(const r in this.binders){const i=this.binders[r];i instanceof Ga&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,i,n){let a=!1;for(const l in e)for(const u of t.getPositions(l)){var s,o=r.feature(u.index);for(const h in this.binders){const c=this.binders[h];(c instanceof Xa||c instanceof Ha||c instanceof Ya)&&!0===c.expression.isStateDependent&&(s=i.paint.get(h),c.expression=s.value,c.updatePaintArray(u.start,u.end,o,e[l],n),a=!0)}}return a}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Za||r instanceof Ga)&&e.push(...r.uniformNames.map(e=>"#define HAS_UNIFORM_"+e))}return e}getBinderAttributes(){const t=[];for(const e in this.binders){var r=this.binders[e];if(r instanceof Xa||r instanceof Ha)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name);else if(r instanceof Ya)for(let e=0;e<Ta.members.length;e++)t.push(Ta.members[e].name)}return t}getBinderUniforms(){const e=[];for(const r in this.binders){var t=this.binders[r];if(t instanceof Za||t instanceof Ga||t instanceof Ha)for(const i of t.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const r=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Za||a instanceof Ga||a instanceof Ha)for(const s of a.uniformNames){var i;t[s]&&(i=a.getBinding(e,t[s],s),r.push({name:s,property:n,binding:i}))}}return r}setUniforms(e,t,r,i){for(var{name:n,property:a,binding:s}of t)this.binders[a].setUniform(s,i,r.get(a),n)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){var t,r=this.binders[i];e&&r instanceof Ya?(t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer)&&this._buffers.push(t):(r instanceof Xa||r instanceof Ha)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Xa||r instanceof Ha||r instanceof Ya)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Xa||t instanceof Ha||t instanceof Ya)&&t.destroy()}}}class Ka{constructor(e,t,r=()=>!0){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Ja(i,t,r);this.needsUpload=!1,this._featureMap=new La,this._bufferOffset=0}populatePaintArrays(e,t,r,i,n,a){for(const s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(e,t,i,n,a);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,i){for(const n of r)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(e,this._featureMap,t,n,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Wa(e,t,r){var i={color:{source:jn,composite:na},number:{source:Qn,composite:jn}},e=(e=e,{"line-pattern":{source:Sa,composite:Sa},"fill-pattern":{source:Sa,composite:Sa},"fill-extrusion-pattern":{source:Sa,composite:Sa}}[e]);return e&&e[r]||i[t][r]}t("ConstantBinder",Za),t("CrossFadedConstantBinder",Ga),t("SourceExpressionBinder",Xa),t("CrossFadedCompositeBinder",Ya),t("CompositeExpressionBinder",Ha),t("ProgramConfiguration",Ja,{omit:["_buffers"]}),t("ProgramConfigurationSet",Ka);const he=8192;const Qa=Math.pow(2,14)-1,es=-Qa-1;function ts(e){var t=he/e.extent,r=e.loadGeometry();for(let e=0;e<r.length;e++){var i=r[e];for(let e=0;e<i.length;e++){const s=i[e];var n=Math.round(s.x*t),a=Math.round(s.y*t);s.x=$(n,es,Qa),s.y=$(a,es,Qa),(n<s.x||n>s.x+1||a<s.y||a>s.y+1)&&ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function rs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?ts(e):[]}}function is(e,t,r,i,n){e.emplaceBack(2*t+(i+1)/2,2*r+(n+1)/2)}class ns{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new va,this.indexArray=new Pa,this.segments=new k,this.programConfigurations=new Ka(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){const i=this.layers[0],n=[];let a=null,s=!1;"circle"===i.type&&(a=i.layout.get("circle-sort-key"),s=!a.isConstant());for(var{feature:o,id:l,index:u,sourceLayerIndex:h}of e){var c,p=this.layers[0]._featureFilter.needGeometry,d=rs(o,p);this.layers[0]._featureFilter.filter(new z(this.zoom),d,r)&&(c=s?a.evaluate(d,{},r):void 0,l={id:l,properties:o.properties,type:o.type,sourceLayerIndex:h,index:u,geometry:p?d.geometry:ts(o),patterns:{},sortKey:c},n.push(l))}s&&n.sort((e,t)=>e.sortKey-t.sortKey);for(const v of n){var{geometry:f,index:y,sourceLayerIndex:m}=v,g=e[y].feature;this.addFeature(v,f,y,r),t.featureIndex.insert(g,f,y,m,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ba),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,i){for(const s of t)for(const o of s){var n=o.x,a=o.y;if(!(n<0||n>=he||a<0||a>=he)){const l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),r=l.vertexLength;is(this.layoutVertexArray,n,a,-1,-1),is(this.layoutVertexArray,n,a,1,-1),is(this.layoutVertexArray,n,a,1,1),is(this.layoutVertexArray,n,a,-1,1),this.indexArray.emplaceBack(r,r+1,r+2),this.indexArray.emplaceBack(r,r+3,r+2),l.vertexLength+=4,l.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},i)}}function as(t,r){if(1===t.length)return hs(r,t[0]);for(let e=0;e<r.length;e++){var i=r[e];for(let e=0;e<i.length;e++)if(cs(t,i[e]))return!0}for(let e=0;e<t.length;e++)if(hs(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(os(t,r[e]))return!0;return!1}function ss(t,r,i){for(let e=0;e<r.length;e++){var n=r[e];if(3<=t.length)for(let e=0;e<n.length;e++)if(cs(t,n[e]))return!0;if(function(t,r,i){if(1<t.length){if(os(t,r))return 1;for(let e=0;e<r.length;e++)if(ls(r[e],t,i))return 1}for(let e=0;e<t.length;e++)if(ls(t[e],r,i))return 1;return}(t,n,i))return!0}return!1}function os(t,r){var i,n;if(0!==t.length&&0!==r.length)for(let e=0;e<t.length-1;e++){var a=t[e],s=t[e+1];for(let e=0;e<r.length-1;e++){var o=r[e],l=r[e+1];if(n=s,N(i=a,o=o,l=l)!==N(n,o,l)&&N(i,n,o)!==N(i,n,l))return 1}}}function ls(t,r,e){var i=e*e;if(1===r.length)return t.distSqr(r[0])<i;for(let e=1;e<r.length;e++)if(us(t,r[e-1],r[e])<i)return 1}function us(e,t,r){var i=t.distSqr(r);if(0===i)return e.distSqr(t);i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return i<0?e.distSqr(t):1<i?e.distSqr(r):e.distSqr(r.sub(t)._mult(i)._add(t))}function hs(i,n){let a=!1,s,o,l;for(let r=0;r<i.length;r++)for(let e=0,t=(s=i[r]).length-1;e<s.length;t=e++)o=s[e],l=s[t],o.y>n.y!=l.y>n.y&&n.x<(l.x-o.x)*(n.y-o.y)/(l.y-o.y)+o.x&&(a=!a);return a}function cs(r,i){let n=!1;for(let e=0,t=r.length-1;e<r.length;t=e++){var a=r[e],s=r[t];a.y>i.y!=s.y>i.y&&i.x<(s.x-a.x)*(i.y-a.y)/(s.y-a.y)+a.x&&(n=!n)}return n}function ps(t,e,r,i,n){for(const s of t)if(e<=s.x&&r<=s.y&&i>=s.x&&n>=s.y)return!0;var a=[new O(e,r),new O(e,n),new O(i,n),new O(i,r)];if(2<t.length)for(const o of a)if(cs(t,o))return!0;for(let e=0;e<t.length-1;e++)if(function(e,t,r){var i=r[0],n=r[2];if(e.x<i.x&&t.x<i.x||e.x>n.x&&t.x>n.x||e.y<i.y&&t.y<i.y||e.y>n.y&&t.y>n.y)return;i=N(e,t,r[0]);return i!==N(e,t,r[1])||i!==N(e,t,r[2])||i!==N(e,t,r[3])}(t[e],t[e+1],a))return!0;return!1}function ds(e,t,r){var i=t.paint.get(e).value;return"constant"===i.kind?i.value:r.programConfigurations.get(t.id).getMaxValue(e)}function fs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ys(t,e,r,i,n){if(!e[0]&&!e[1])return t;const a=O.convert(e)._mult(n),s=("viewport"===r&&a._rotate(-i),[]);for(let e=0;e<t.length;e++){const o=t[e];s.push(o.sub(a))}return s}t("CircleBucket",ns,{omit:["layers"]});let ms;let gs;var vs={get paint(){return gs=gs||new a({"circle-radius":new i(l.paint_circle["circle-radius"]),"circle-color":new i(l.paint_circle["circle-color"]),"circle-blur":new i(l.paint_circle["circle-blur"]),"circle-opacity":new i(l.paint_circle["circle-opacity"]),"circle-translate":new r(l.paint_circle["circle-translate"]),"circle-translate-anchor":new r(l.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new r(l.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new r(l.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new i(l.paint_circle["circle-stroke-width"]),"circle-stroke-color":new i(l.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new i(l.paint_circle["circle-stroke-opacity"])})},get layout(){return ms=ms||new a({"circle-sort-key":new i(l.layout_circle["circle-sort-key"])})}},xs="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function bs(){var e=new xs(9);return xs!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ws(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _s(){var e=new xs(3);return xs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ss(e,t,r){var i=new xs(3);return i[0]=e,i[1]=t,i[2]=r,i}_s();function ks(){var e=new xs(4);return xs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function As(e,t,r){var i=t[0],n=t[1],a=t[2],t=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*t,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*t,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*t,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*t,e}ks();function Is(){var e=new xs(4);return xs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}_s(),Ss(1,0,0),Ss(0,1,0),Is(),Is(),bs();function Ms(){var e=new xs(2);return xs!=Float32Array&&(e[0]=0,e[1]=0),e}Ms();class zs extends Vn{constructor(e){super(e,vs)}createBucket(e){return new ns(e)}queryRadius(e){return ds("circle-radius",this,e)+ds("circle-stroke-width",this,e)+fs(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,i,n,a,s,o){var l,u,e=ys(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,s),t=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r),h="map"===this.paint.get("circle-pitch-alignment"),c=h?e:(l=o,e.map(e=>Ps(e,l))),p=h?t*s:t;for(const y of i)for(const m of y){var d=h?m:Ps(m,o);let e=p;var f=As([],[m.x,m.y,0,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?e*=f[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(e*=a.cameraToCenterDistance/f[3]),f=c,d=d,u=e,cs(f,d)||!!ls(d,f,u))return!0}return!1}}function Ps(e,t){e=As([],[e.x,e.y,0,1],t);return new O(e[0]/e[3],e[1]/e[3])}class Cs extends ns{}t("HeatmapBucket",Cs,{omit:["layers"]});let Bs;var Vs={get paint(){return Bs=Bs||new a({"heatmap-radius":new i(l.paint_heatmap["heatmap-radius"]),"heatmap-weight":new i(l.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new r(l.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cn(l.paint_heatmap["heatmap-color"]),"heatmap-opacity":new r(l.paint_heatmap["heatmap-opacity"])})}};function Ts(e,{width:t,height:r},i,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*r*i)throw new RangeError(`mismatched image size. expected: ${n.length} but got: `+t*r*i)}else n=new Uint8Array(t*r*i);return e.width=t,e.height=r,e.data=n,e}function Es(e,{width:t,height:r},i){var n;t===e.width&&r===e.height||(Fs(e,n=Ts({},{width:t,height:r},i),{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,r)},i),e.width=t,e.height=r,e.data=n.data)}function Fs(t,r,i,n,a,s){if(0!==a.width&&0!==a.height){if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>r.width||a.height>r.height||n.x>r.width-a.width||n.y>r.height-a.height)throw new RangeError("out of range destination coordinates for image copy");var o=t.data;const h=r.data;if(o===h)throw new Error("srcData equals dstData, so image is already copied");for(let e=0;e<a.height;e++){var l=((i.y+e)*t.width+i.x)*s,u=((n.y+e)*r.width+n.x)*s;for(let e=0;e<a.width*s;e++)h[u+e]=o[l+e]}}}class Ds{constructor(e,t){Ts(this,e,1,t)}resize(e){Es(this,e,1)}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n){Fs(e,t,r,i,n,1)}}class Ls{constructor(e,t){Ts(this,e,4,t)}resize(e){Es(this,e,4)}replace(e,t){t?this.data.set(e):e instanceof Uint8ClampedArray?this.data=new Uint8Array(e.buffer):this.data=e}clone(){return new Ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n){Fs(e,t,r,i,n,4)}}function Os(n){const i={};var a=n.resolution||256,e=n.clips?n.clips.length:1;const s=n.image||new Ls({width:a,height:e});if(Math.log(a)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - "+a);var o=(e,t,r)=>{i[n.evaluationKey]=r;r=n.expression.evaluate(i);s.data[e+t+0]=Math.floor(255*r.r/r.a),s.data[e+t+1]=Math.floor(255*r.g/r.a),s.data[e+t+2]=Math.floor(255*r.b/r.a),s.data[e+t+3]=Math.floor(255*r.a)};if(n.clips)for(let r=0,i=0;r<e;++r,i+=4*a)for(let e=0,t=0;e<a;e++,t+=4){var l=e/(a-1),{start:u,end:h}=n.clips[r];o(i,t,u*(1-l)+h*l)}else for(let e=0,t=0;e<a;e++,t+=4){var r=e/(a-1);o(0,t,r)}return s}t("AlphaImage",Ds),t("RGBAImage",Ls);class $s extends Vn{createBucket(e){return new Cs(e)}constructor(e){super(e,Vs),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){var e=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Os({expression:e,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has("big-fb")&&this.heatmapFbos.delete("big-fb")}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Rs;var js={get paint(){return Rs=Rs||new a({"hillshade-illumination-direction":new r(l.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new r(l.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new r(l.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new r(l.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new r(l.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new r(l.paint_hillshade["hillshade-accent-color"])})}};class qs extends Vn{constructor(e){super(e,js)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Us=o([{name:"a_pos",components:2,type:"Int16"}],4)["members"];function Ns(i,e,n=2){var t=e&&e.length,a=t?e[0]*n:i.length;let r=Zs(i,0,a,n,!0);var s=[];if(!r||r.next===r.prev)return s;let o,l,u;if(t&&(r=function(r,i,t,n){const a=[];for(let e=0,t=i.length;e<t;e++){var s=i[e]*n,o=e<t-1?i[e+1]*n:r.length;const l=Zs(r,s,o,n,!1);l===l.next&&(l.steiner=!0),a.push(function(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}(l))}a.sort(Hs);for(let e=0;e<a.length;e++)t=function(e,t){var r=function(e,t){let r=t;var i=e.x,n=e.y;let a=-1/0,s;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a&&(a=o,s=r.x<r.next.x?r:r.next,o===i))return s}}while(r=r.next,r!==t);if(!s)return null;var l=s,u=s.x,h=s.y;let c=1/0;r=s;do{var p;i>=r.x&&r.x>=u&&i!==r.x&&Js(n<h?i:a,n,u,h,n<h?a:i,n,r.x,r.y)&&(p=Math.abs(n-r.y)/(i-r.x),to(r,e)&&(p<c||p===c&&(r.x>s.x||r.x===s.x&&function(e,t){return A(e.prev,e,t.prev)<0&&A(t.next,e,e.next)<0}(s,r)))&&(s=r,c=p)),r=r.next}while(r!==l);return s}(e,t);if(!r)return t;t=ro(r,e);return Gs(t,t.next),Gs(r,r.next)}(a[e],t);return t}(i,e,r,n)),i.length>80*n){o=1/0,l=1/0;let t=-1/0,r=-1/0;for(let e=n;e<a;e+=n){var h=i[e],c=i[e+1];h<o&&(o=h),c<l&&(l=c),h>t&&(t=h),c>r&&(r=c)}u=0!==(u=Math.max(t-o,r-l))?32767/u:0}return Xs(r,s,n,o,l,u,0),s}function Zs(t,r,i,n,e){let a;if(e===0<so(t,r,i,n))for(let e=r;e<i;e+=n)a=io(e/n|0,t[e],t[e+1],a);else for(let e=i-n;e>=r;e-=n)a=io(e/n|0,t[e],t[e+1],a);return a&&Ks(a,a.next)&&(no(a),a=a.next),a}function Gs(e,t){if(!e)return e;t=t||e;let r=e,i;do{if(i=!1,r.steiner||!Ks(r,r.next)&&0!==A(r.prev,r,r.next))r=r.next;else{if(no(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Xs(t,r,i,n,a,s,o){if(t){if(!o&&s){var l=t,u=n,h=a,c=s;let e=l;for(;0===e.z&&(e.z=Ys(e.x,e.y,u,h,c)),e.prevZ=e.prev,e.nextZ=e.next,(e=e.next)!==l;);e.prevZ.nextZ=null,e.prevZ=null;{var p=e;let s,o=1;do{let i=p,n,a=p=null;for(s=0;i;){s++;let t=i,r=0;for(let e=0;e<o&&(r++,t=t.nextZ);e++);let e=o;for(;0<r||0<e&&t;)0!==r&&(0===e||!t||i.z<=t.z)?(i=(n=i).nextZ,r--):(t=(n=t).nextZ,e--),a?a.nextZ=n:p=n,n.prevZ=a,a=n;i=t}a.nextZ=null,o*=2}while(1<s)}}let e=t;for(;t.prev!==t.next;){var d=t.prev,f=t.next;if(s?function(e,t,r,i){var n=e.prev,a=e,s=e.next;if(0<=A(n,a,s))return;var o=n.x,l=a.x,u=s.x,h=n.y,c=a.y,p=s.y,d=o<l?o<u?o:u:l<u?l:u,f=h<c?h<p?h:p:c<p?c:p,y=l<o?u<o?o:u:u<l?l:u,m=c<h?p<h?h:p:p<c?c:p,g=Ys(d,f,t,r,i),v=Ys(y,m,t,r,i);let x=e.prevZ,b=e.nextZ;for(;x&&x.z>=g&&b&&b.z<=v;){if(x.x>=d&&x.x<=y&&x.y>=f&&x.y<=m&&x!==n&&x!==s&&Js(o,h,l,c,u,p,x.x,x.y)&&0<=A(x.prev,x,x.next))return;if(x=x.prevZ,b.x>=d&&b.x<=y&&b.y>=f&&b.y<=m&&b!==n&&b!==s&&Js(o,h,l,c,u,p,b.x,b.y)&&0<=A(b.prev,b,b.next))return;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=d&&x.x<=y&&x.y>=f&&x.y<=m&&x!==n&&x!==s&&Js(o,h,l,c,u,p,x.x,x.y)&&0<=A(x.prev,x,x.next))return;x=x.prevZ}for(;b&&b.z<=v;){if(b.x>=d&&b.x<=y&&b.y>=f&&b.y<=m&&b!==n&&b!==s&&Js(o,h,l,c,u,p,b.x,b.y)&&0<=A(b.prev,b,b.next))return;b=b.nextZ}return 1}(t,n,a,s):function(e){var t=e.prev,r=e,e=e.next;if(0<=A(t,r,e))return;var i=t.x,n=r.x,a=e.x,s=t.y,o=r.y,l=e.y,u=i<n?i<a?i:a:n<a?n:a,h=s<o?s<l?s:l:o<l?o:l,c=n<i?a<i?i:a:a<n?n:a,p=o<s?l<s?s:l:l<o?o:l;let d=e.next;for(;d!==t;){if(d.x>=u&&d.x<=c&&d.y>=h&&d.y<=p&&Js(i,s,n,o,a,l,d.x,d.y)&&0<=A(d.prev,d,d.next))return;d=d.next}return 1}(t))r.push(d.i,t.i,f.i),no(t),t=f.next,e=f.next;else if((t=f)===e){o?1===o?Xs(t=function(e,t){let r=e;do{var i=r.prev,n=r.next.next;!Ks(i,n)&&Ws(i,r,r.next,n)&&to(i,n)&&to(n,i)&&(t.push(i.i,r.i,n.i),no(r),no(r.next),r=e=n),r=r.next}while(r!==e);return Gs(r)}(Gs(t),r),r,i,n,a,s,2):2===o&&function(e,t,r,i,n,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){var o;if(s.i!==e.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Ws(r,r.next,e,t))return 1}while(r=r.next,r!==e);return}(e,t)&&(to(e,t)&&to(t,e)&&function(e,t){let r=e,i=!1;var n=(e.x+t.x)/2,a=(e.y+t.y)/2;for(;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next,r!==e;);return i}(e,t)&&(A(e.prev,e,t.prev)||A(e,t.prev,t))||Ks(e,t)&&0<A(e.prev,e,e.next)&&0<A(t.prev,t,t.next))}(s,e))return o=ro(s,e),s=Gs(s,s.next),o=Gs(o,o.next),Xs(s,t,r,i,n,a,0),Xs(o,t,r,i,n,a,0);e=e.next}}while(s=s.next,s!==e)}(t,r,i,n,a,s):Xs(Gs(t),r,i,n,a,s,1);break}}}}function Hs(e,t){return e.x-t.x}function Ys(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Js(e,t,r,i,n,a,s,o){return(e-s)*(a-o)<=(n-s)*(t-o)&&(r-s)*(t-o)<=(e-s)*(i-o)&&(n-s)*(i-o)<=(r-s)*(a-o)}function A(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ks(e,t){return e.x===t.x&&e.y===t.y}function Ws(e,t,r,i){var n=eo(A(e,t,r)),a=eo(A(e,t,i)),s=eo(A(r,i,e)),o=eo(A(r,i,t));return n!==a&&s!==o||(0===n&&Qs(e,r,t)||(0===a&&Qs(e,i,t)||(0===s&&Qs(r,e,i)||!(0!==o||!Qs(r,t,i)))))}function Qs(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function eo(e){return 0<e?1:e<0?-1:0}function to(e,t){return A(e.prev,e,e.next)<0?0<=A(e,t,e.next)&&0<=A(e,e.prev,t):A(e,t,e.prev)<0||A(e,e.next,t)<0}function ro(e,t){const r=ao(e.i,e.x,e.y),i=ao(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function io(e,t,r,i){const n=ao(e,t,r);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n).next=n,n}function no(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ao(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function so(r,i,n,a){let s=0;for(let e=i,t=n-a;e<n;e+=a)s+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return s}function oo(e,t,r){const i=r.patternDependencies;let n=!1;for(const s of t){const o=s.paint.get(e+"-pattern");o.isConstant()||(n=!0);var a=o.constantOr(null);a&&(n=!0,i[a.to]=!0,i[a.from]=!0)}return n}function lo(e,t,i,n,a){const s=a.patternDependencies;for(const o of t){const l=o.paint.get(e+"-pattern").value;if("constant"!==l.kind){let e=l.evaluate({zoom:n-1},i,{},a.availableImages),t=l.evaluate({zoom:n},i,{},a.availableImages),r=l.evaluate({zoom:n+1},i,{},a.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,r=r&&r.name?r.name:r,s[e]=!0,s[t]=!0,s[r]=!0,i.patterns[o.id]={min:e,mid:t,max:r}}}return i}class uo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xa,this.indexArray=new Pa,this.indexArray2=new Ca,this.programConfigurations=new Ka(e.layers,e.zoom),this.segments=new k,this.segments2=new k,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=oo("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key");var n,a,s,o,l=!i.isConstant();const u=[];for({feature:n,id:a,index:s,sourceLayerIndex:o}of e){var h,c=this.layers[0]._featureFilter.needGeometry,p=rs(n,c);this.layers[0]._featureFilter.filter(new z(this.zoom),p,r)&&(h=l?i.evaluate(p,{},r,t.availableImages):void 0,c={id:a,properties:n.properties,type:n.type,sourceLayerIndex:o,index:s,geometry:c?p.geometry:ts(n),patterns:{},sortKey:h},u.push(c))}l&&u.sort((e,t)=>e.sortKey-t.sortKey);for(const g of u){var{geometry:d,index:f,sourceLayerIndex:y}=g,m=(this.hasPattern?(m=lo("fill",this.layers,g,this.zoom,t),this.patternFeatures.push(m)):this.addFeature(g,d,f,r,{}),e[f].feature);t.featureIndex.insert(m,d,f,y,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Us),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,i,n){for(const l of Wt(t,500)){let e=0;for(const p of l)e+=p.length;const u=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray);var a=u.vertexLength;const h=[],c=[];for(const d of l)if(0!==d.length){d!==l[0]&&c.push(h.length/2);const f=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2);var s=f.vertexLength;this.layoutVertexArray.emplaceBack(d[0].x,d[0].y),this.indexArray2.emplaceBack(s+d.length-1,s),h.push(d[0].x),h.push(d[0].y);for(let e=1;e<d.length;e++)this.layoutVertexArray.emplaceBack(d[e].x,d[e].y),this.indexArray2.emplaceBack(s+e-1,s+e),h.push(d[e].x),h.push(d[e].y);f.vertexLength+=d.length,f.primitiveLength+=d.length}var o=Ns(h,c);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(a+o[e],a+o[e+1],a+o[e+2]);u.vertexLength+=e,u.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,i)}}t("FillBucket",uo,{omit:["layers","patternFeatures"]});let ho;let co;var po={get paint(){return co=co||new a({"fill-antialias":new r(l.paint_fill["fill-antialias"]),"fill-opacity":new i(l.paint_fill["fill-opacity"]),"fill-color":new i(l.paint_fill["fill-color"]),"fill-outline-color":new i(l.paint_fill["fill-outline-color"]),"fill-translate":new r(l.paint_fill["fill-translate"]),"fill-translate-anchor":new r(l.paint_fill["fill-translate-anchor"]),"fill-pattern":new zn(l.paint_fill["fill-pattern"])})},get layout(){return ho=ho||new a({"fill-sort-key":new i(l.layout_fill["fill-sort-key"])})}};class fo extends Vn{constructor(e){super(e,po)}recalculate(e,t){super.recalculate(e,t);e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new uo(e)}queryRadius(){return fs(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,i,n,a,s){return as(ys(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,s),i)}isTileClipped(){return!0}}It=o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4);const yo=o([{name:"a_centroid",components:2,type:"Int16"}],4),mo=It["members"];var go={},vo=C,At=xo;function xo(e,t,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=n,e.readFields(bo,this,t)}function bo(e,t,r){if(1==e)t.id=r.readVarint();else if(2==e)for(var i=r,n=t,a=i.readVarint()+i.pos;i.pos<a;){var s=n._keys[i.readVarint()],o=n._values[i.readVarint()];n.properties[s]=o}else 3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}xo.types=["Unknown","Point","LineString","Polygon"],xo.prototype.loadGeometry=function(){for(var e,t,r=this._pbf,i=(r.pos=this._geometry,r.readVarint()+r.pos),n=1,a=0,s=0,o=0,l=[];r.pos<i;)if(a<=0&&(n=7&(t=r.readVarint()),a=t>>3),a--,1===n||2===n)s+=r.readSVarint(),o+=r.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new vo(s,o));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}return e&&l.push(e),l},xo.prototype.bbox=function(){for(var e,t=this._pbf,r=(t.pos=this._geometry,t.readVarint()+t.pos),i=1,n=0,a=0,s=0,o=1/0,l=-1/0,u=1/0,h=-1/0;t.pos<r;)if(n<=0&&(i=7&(e=t.readVarint()),n=e>>3),n--,1===i||2===i)(a+=t.readSVarint())<o&&(o=a),l<a&&(l=a),(s+=t.readSVarint())<u&&(u=s),h<s&&(h=s);else if(7!==i)throw new Error("unknown command "+i);return[o,u,l,h]},xo.prototype.toGeoJSON=function(e,t,r){var i,n=this.extent*Math.pow(2,r),a=this.extent*e,s=this.extent*t,o=this.loadGeometry(),r=xo.types[this.type];function l(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+s)/n;e[t]=[360*(r.x+a)/n-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:for(var u=[],h=0;h<o.length;h++)u[h]=o[h][0];l(o=u);break;case 2:for(h=0;h<o.length;h++)l(o[h]);break;case 3:for(o=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,n=[],a=0;a<t;a++){var s=function(e){for(var t,r,i=0,n=0,a=e.length,s=a-1;n<a;s=n++)t=e[n],r=e[s],i+=(r.x-t.x)*(t.y+r.y);return i}(e[a]);0!==s&&((i=void 0===i?s<0:i)===s<0?(r&&n.push(r),r=[e[a]]):r.push(e[a]))}r&&n.push(r);return n}(o),h=0;h<o.length;h++)for(i=0;i<o[h].length;i++)l(o[h][i])}1===o.length?o=o[0]:r="Multi"+r;e={type:"Feature",geometry:{type:r,coordinates:o},properties:this.properties};return"id"in this&&(e.id=this.id),e};var wo=At,zt=_o;function _o(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(So,this,t),this.length=this._features.length}function So(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var i=e.readVarint()>>3;t=1==i?e.readString():2==i?e.readFloat():3==i?e.readDouble():4==i?e.readVarint64():5==i?e.readVarint():6==i?e.readSVarint():7==i?e.readBoolean():null}return t}(r))}_o.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new wo(this._pbf,e,this.extent,this._keys,this._values)};function ko(e,t){this.layers=e.readFields(Io,{},t)}var Ao=zt;function Io(e,t,r){3===e&&(e=new Ao(r,r.readVarint()+r.pos)).length&&(t[e.name]=e)}go.VectorTile=ko,go.VectorTileFeature=At,go.VectorTileLayer=zt;const Mo=go.VectorTileFeature.types,zo=Math.pow(2,13);function Po(e,t,r,i,n,a,s,o){e.emplaceBack(t,r,2*Math.floor(i*zo)+s,n*zo*2,a*zo*2,Math.round(o))}class Co{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ba,this.centroidVertexArray=new ga,this.indexArray=new Pa,this.programConfigurations=new Ka(e.layers,e.zoom),this.segments=new k,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.features=[],this.hasPattern=oo("fill-extrusion",this.layers,t);for(var{feature:i,id:n,index:a,sourceLayerIndex:s}of e){var o=this.layers[0]._featureFilter.needGeometry,l=rs(i,o);this.layers[0]._featureFilter.filter(new z(this.zoom),l,r)&&(n={id:n,sourceLayerIndex:s,index:a,geometry:o?l.geometry:ts(i),properties:i.properties,type:i.type,patterns:{}},this.hasPattern?this.features.push(lo("fill-extrusion",this.layers,n,this.zoom,t)):this.addFeature(n,n.geometry,a,r,{}),t.featureIndex.insert(i,n.geometry,a,s,this.index,!0))}}addFeatures(e,t,r){for(const n of this.features){var i=n["geometry"];this.addFeature(n,i,n.index,t,r)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mo),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,yo.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,r,i,n){for(const d of Wt(e,500)){const f={x:0,y:0,vertexCount:0};let e=0;for(const y of d)e+=y.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const m of d)if(0!==m.length&&!((p=m).every(e=>e.x<0)||p.every(e=>e.x>he)||p.every(e=>e.y<0)||p.every(e=>e.y>he))){let t=0;for(let e=0;e<m.length;e++){const g=m[e];if(1<=e){const v=m[e-1];h=g,c=v,h.x===c.x&&(h.x<0||h.x>he)||h.y===c.y&&(h.y<0||h.y>he)||(r.vertexLength+4>k.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)),c=g.sub(v)._perp()._unit(),h=v.dist(g),32768<t+h&&(t=0),Po(this.layoutVertexArray,g.x,g.y,c.x,c.y,0,0,t),Po(this.layoutVertexArray,g.x,g.y,c.x,c.y,0,1,t),f.x+=2*g.x,f.y+=2*g.y,f.vertexCount+=2,t+=h,Po(this.layoutVertexArray,v.x,v.y,c.x,c.y,0,0,t),Po(this.layoutVertexArray,v.x,v.y,c.x,c.y,0,1,t),f.x+=2*v.x,f.y+=2*v.y,f.vertexCount+=2,h=r.vertexLength,this.indexArray.emplaceBack(h,h+2,h+1),this.indexArray.emplaceBack(h+1,h+2,h+3),r.vertexLength+=4,r.primitiveLength+=2)}}}if(r.vertexLength+e>k.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"===Mo[t.type]){const x=[],b=[];var a=r.vertexLength;for(const w of d)if(0!==w.length){w!==d[0]&&b.push(x.length/2);for(let e=0;e<w.length;e++){var s=w[e];Po(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),f.x+=s.x,f.y+=s.y,f.vertexCount+=1,x.push(s.x),x.push(s.y)}}var o=Ns(x,b);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(a+o[e],a+o[e+2],a+o[e+1]);r.primitiveLength+=o.length/3,r.vertexLength+=e;for(let e=0;e<f.vertexCount;e++){var l=Math.floor(f.x/f.vertexCount),u=Math.floor(f.y/f.vertexCount);this.centroidVertexArray.emplaceBack(l,u)}}}var h,c,p;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,i)}}t("FillExtrusionBucket",Co,{omit:["layers","features"]});let Bo;var Vo={get paint(){return Bo=Bo||new a({"fill-extrusion-opacity":new r(l["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new i(l["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new r(l["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new r(l["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zn(l["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new i(l["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new i(l["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new r(l["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};(class extends O{});class To extends Vn{constructor(e){super(e,Vo)}createBucket(e){return new Co(e)}queryRadius(){return fs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,t,i,n,a,s,o){e=ys(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),a=this.paint.get("fill-extrusion-height").evaluate(r,t),s=this.paint.get("fill-extrusion-base").evaluate(r,t),r=function(e,t,r){const i=[];for(const a of e){var n=[a.x,a.y,r,1];As(n,n,t),i.push(new O(n[0]/n[3],n[1]/n[3]))}return i}(e,o,0),t=function(e,t,r,i){const n=[],a=[],s=i[8]*t,o=i[9]*t,l=i[10]*t,u=i[11]*t,h=i[8]*r,c=i[9]*r,p=i[10]*r,d=i[11]*r;for(const _ of e){const S=[],k=[];for(const A of _){var f=A.x,y=A.y,m=i[0]*f+i[4]*y+i[12],g=i[1]*f+i[5]*y+i[13],v=i[2]*f+i[6]*y+i[14],f=i[3]*f+i[7]*y+i[15],y=m+s,x=g+o,b=v+l,w=f+u,m=m+h,g=g+c,v=v+p,f=f+d;const I=new O(y/w,x/w),M=(I.z=b/w,S.push(I),new O(m/f,g/f));M.z=v/f,k.push(M)}n.push(S),a.push(k)}return[n,a]}(i,s,a,o),e=t[0],i=t[1];{var l=e,u=i,h=r;let t=1/0;as(h,u)&&(t=Fo(h,u[0]));for(let e=0;e<u.length;e++){var c=u[e],p=l[e];for(let e=0;e<c.length-1;e++){var d=c[e],f=c[e+1],y=p[e],m=p[e+1],f=[d,f,m,y,d];!function(t,r){for(let e=0;e<t.length;e++)if(cs(r,t[e]))return 1;for(let e=0;e<r.length;e++)if(cs(t,r[e]))return 1;return!!os(t,r)}(h,f)||(t=Math.min(t,Fo(h,f)))}}return t!==1/0&&t}}}function Eo(e,t){return e.x*t.x+e.y*t.y}function Fo(r,i){if(1===r.length){let e=0;const h=i[e++];let t;for(;!t||h.equals(t);)if(!(t=i[e++]))return 1/0;for(;e<i.length;e++){const c=i[e],p=r[0];var n=t.sub(h),a=c.sub(h),s=p.sub(h),o=Eo(n,n),l=Eo(n,a),u=Eo(a,a),n=Eo(s,n),s=Eo(s,a),a=o*u-l*l,u=(u*n-l*s)/a,o=(o*s-l*n)/a,s=h.z*(1-u-o)+t.z*u+c.z*o;if(isFinite(s))return s}return 1/0}{let e=1/0;for(const t of i)e=Math.min(e,t.z);return e}}const Do=o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4)["members"],Lo=o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}])["members"],Oo=go.VectorTileFeature.types,$o=Math.cos(Math.PI/180*37.5);const Ro=Math.pow(2,14)/.5;class jo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new wa,this.layoutVertexArray2=new _a,this.indexArray=new Pa,this.programConfigurations=new Ka(e.layers,e.zoom),this.segments=new k,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=oo("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key");var n,a,s,o,l=!i.isConstant();const u=[];for({feature:n,id:a,index:s,sourceLayerIndex:o}of e){var h,c=this.layers[0]._featureFilter.needGeometry,p=rs(n,c);this.layers[0]._featureFilter.filter(new z(this.zoom),p,r)&&(h=l?i.evaluate(p,{},r):void 0,c={id:a,properties:n.properties,type:n.type,sourceLayerIndex:o,index:s,geometry:c?p.geometry:ts(n),patterns:{},sortKey:h},u.push(c))}l&&u.sort((e,t)=>e.sortKey-t.sortKey);for(const g of u){var{geometry:d,index:f,sourceLayerIndex:y}=g,m=(this.hasPattern?(m=lo("line",this.layers,g,this.zoom,t),this.patternFeatures.push(m)):this.addFeature(g,d,f,r,{}),e[f].feature);t.featureIndex.insert(m,d,f,y,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lo)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Do),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,i,n){const a=this.layers[0].layout;var s=a.get("line-join").evaluate(e,{}),o=a.get("line-cap"),l=a.get("line-miter-limit"),u=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const h of t)this.addLine(h,e,s,o,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,i)}addLine(l,e,u,h,c,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<l.length-1;e++)this.totalDistance+=l[e].dist(l[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var d="Polygon"===Oo[e.type];let f=l.length;for(;2<=f&&l[f-1].equals(l[f-2]);)f--;let y=0;for(;y<f-1&&l[y].equals(l[y+1]);)y++;if(!(f<(d?3:2))){"bevel"===u&&(c=1.05);var m=this.overscaling<=16?15*he/(512*this.overscaling):0,g=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let i,n,a,s,o;this.e1=this.e2=-1,d&&(i=l[f-2],o=l[y].sub(i)._unit()._perp());for(let r=y;r<f;r++)if(!(a=r===f-1?d?l[y+1]:void 0:l[r+1])||!l[r].equals(a)){o&&(s=o),i&&(n=i),i=l[r],o=a?a.sub(i)._unit()._perp():s;let e=(s=s||o).add(o);0===e.x&&0===e.y||e._unit();var v=s.x*o.x+s.y*o.y,x=e.x*o.x+e.y*o.y,b=0!=x?1/x:1/0,w=2*Math.sqrt(2-2*x),x=x<$o&&n&&a,_=0<s.x*o.y-s.y*o.x,S=(x&&r>y&&(2*m<(S=i.dist(n))&&(S=i.sub(i.sub(n)._mult(m/S)._round()),this.updateDistance(n,S),this.addCurrentVertex(S,s,0,0,g),n=S)),n&&a);let t=S?u:d?"butt":h;if(S&&"round"===t&&(b<p?t="miter":b<=2&&(t="fakeround")),"bevel"===(t="miter"===t&&c<b?"bevel":t)&&(2<b&&(t="flipbevel"),b<c&&(t="miter")),n&&this.updateDistance(n,i),"miter"===t)e._mult(b),this.addCurrentVertex(i,e,0,0,g);else if("flipbevel"===t)100<b?e=o.mult(-1):(k=b*s.add(o).mag()/s.sub(o).mag(),e._perp()._mult(k*(_?-1:1))),this.addCurrentVertex(i,e,0,0,g),this.addCurrentVertex(i,e.mult(-1),0,0,g);else if("bevel"===t||"fakeround"===t){var k=-Math.sqrt(b*b-1),b=_?k:0,A=_?0:k;if(n&&this.addCurrentVertex(i,s,b,A,g),"fakeround"===t){var I=Math.round(180*w/Math.PI/20);for(let t=1;t<I;t++){let e=t/I;.5!==e&&(M=e-.5,e+=e*M*(e-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*M*M+(.848013+v*(.215638*v-1.06021))));var M=o.sub(s)._mult(e)._add(s)._unit()._mult(_?-1:1);this.addHalfVertex(i,M.x,M.y,!1,_,0,g)}}a&&this.addCurrentVertex(i,o,-b,-A,g)}else"butt"===t?this.addCurrentVertex(i,e,0,0,g):"square"===t?(w=n?1:-1,this.addCurrentVertex(i,e,w,w,g)):"round"===t&&(n&&(this.addCurrentVertex(i,s,0,0,g),this.addCurrentVertex(i,s,1,1,g,!0)),a&&(this.addCurrentVertex(i,o,-1,-1,g,!0),this.addCurrentVertex(i,o,0,0,g)));x&&r<f-1&&(2*m<(b=i.dist(a))&&(A=i.add(a.sub(i)._mult(m/b)._round()),this.updateDistance(i,A),this.addCurrentVertex(A,o,0,0,g),i=A))}}}addCurrentVertex(e,t,r,i,n,a=!1){var s=t.x+t.y*r,o=t.y-t.x*r,l=-t.x+t.y*i,u=-t.y-t.x*i;this.addHalfVertex(e,s,o,a,!1,r,n),this.addHalfVertex(e,l,u,a,!0,-i,n),this.distance>Ro/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,r,i,n,a))}addHalfVertex({x:e,y:t},r,i,n,a,s,o){var l=.5*(this.lineClips?this.scaledDistance*(Ro-1):this.scaledDistance),t=(this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(a?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&(e=this.scaledDistance-this.lineClips.start,n=this.lineClips.end-this.lineClips.start,this.layoutVertexArray2.emplaceBack(e/n,this.lineClipsArray.length)),o.vertexLength++);0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,t),o.primitiveLength++),a?this.e2=t:this.e1=t}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}t("LineBucket",jo,{omit:["layers","patternFeatures"]});let qo;let Uo;var No={get paint(){return Uo=Uo||new a({"line-opacity":new i(l.paint_line["line-opacity"]),"line-color":new i(l.paint_line["line-color"]),"line-translate":new r(l.paint_line["line-translate"]),"line-translate-anchor":new r(l.paint_line["line-translate-anchor"]),"line-width":new i(l.paint_line["line-width"]),"line-gap-width":new i(l.paint_line["line-gap-width"]),"line-offset":new i(l.paint_line["line-offset"]),"line-blur":new i(l.paint_line["line-blur"]),"line-dasharray":new Pn(l.paint_line["line-dasharray"]),"line-pattern":new zn(l.paint_line["line-pattern"]),"line-gradient":new Cn(l.paint_line["line-gradient"])})},get layout(){return qo=qo||new a({"line-cap":new r(l.layout_line["line-cap"]),"line-join":new i(l.layout_line["line-join"]),"line-miter-limit":new r(l.layout_line["line-miter-limit"]),"line-round-limit":new r(l.layout_line["line-round-limit"]),"line-sort-key":new i(l.layout_line["line-sort-key"])})}};class Zo extends i{possiblyEvaluate(e,t){return t=new z(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,i){return t=R({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,i)}}let Go;class Xo extends Vn{constructor(e){super(e,No),this.gradientVersion=0,Go||((Go=new Zo(No.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){"line-gradient"===e&&(Jr(e=this.gradientExpression())?this.stepInterpolant=e._styleExpression.expression instanceof lt:this.stepInterpolant=!1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Go.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new jo(e)}queryRadius(e){var t=Ho(ds("line-width",this,e),ds("line-gap-width",this,e)),e=ds("line-offset",this,e);return t/2+Math.abs(e)+fs(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,i,n,a,s){e=ys(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),a=s/2*Ho(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),t=this.paint.get("line-offset").evaluate(t,r);return ss(e,i=t?function(t,r){const i=[];for(let e=0;e<t.length;e++){var n=t[e];const s=[];for(let e=0;e<n.length;e++){var a=n[e-1];const o=n[e],l=n[e+1],u=0===e?new O(0,0):o.sub(a)._unit()._perp();a=e===n.length-1?new O(0,0):l.sub(o)._unit()._perp();const h=u._add(a)._unit();a=h.x*a.x+h.y*a.y;0!=a&&h._mult(1/a),s.push(h._mult(r)._add(o))}i.push(s)}return i}(i,t*s):i,a)}isTileClipped(){return!0}}function Ho(e,t){return 0<t?t+2*e:e}const Yo=o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jo=o([{name:"a_projected_pos",components:3,type:"Float32"}],4);o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ko=o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wo=o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),o([{name:"triangle",components:3,type:"Uint16"}]),o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),o([{type:"Float32",name:"offsetX"}]),o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),o([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);function Qo(e,i,n){return e.sections.forEach(e=>{var t,r;e.text=(e=e.text,r=n,"uppercase"===(t=(t=i).layout.get("text-transform").evaluate(r,{}))?e=e.toLocaleUpperCase():"lowercase"===t&&(e=e.toLocaleLowerCase()),e=ne.applyArabicShaping?ne.applyArabicShaping(e):e)}),e}const el={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ce=24,Mt={},V=(Mt.read=function(e,t,r,i,n){var a,s,o=8*n-i-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?n-1:0,p=r?-1:1,n=e[t+c];for(c+=p,a=n&(1<<-h)-1,n>>=-h,h+=o;0<h;a=256*a+e[t+c],c+=p,h-=8);for(s=a&(1<<-h)-1,a>>=-h,h+=i;0<h;s=256*s+e[t+c],c+=p,h-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,i),a-=u}return(n?-1:1)*s*Math.pow(2,a-i)},Mt.write=function(e,t,r,i,n,a){var s,o,l=8*a-n-1,u=(1<<l)-1,h=u>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,d=i?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(t+=1<=s+h?c/i:c*Math.pow(2,1-h))*i&&(s++,i/=2),u<=s+h?(o=0,s=u):1<=s+h?(o=(t*i-1)*Math.pow(2,n),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));8<=n;e[r+p]=255&o,p+=d,o/=256,n-=8);for(s=s<<n|o,l+=n;0<l;e[r+p]=255&s,p+=d,s/=256,l-=8);e[r+p-d]|=128*a},I),tl=Mt;function I(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}I.Varint=0,I.Fixed64=1,I.Bytes=2,I.Fixed32=5;var rl=4294967296,il=1/rl,nl="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function al(e){return e.type===I.Bytes?e.readVarint()+e.pos:e.pos+1}function sl(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function ol(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;e<=n;n--)r.buf[n+i]=r.buf[n]}function ll(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function ul(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function hl(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function cl(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function pl(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function dl(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function fl(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function yl(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function ml(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function gl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function vl(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function xl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}I.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=7&i,e(n,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=gl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=xl(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=gl(this.buf,this.pos)+gl(this.buf,this.pos+4)*rl;return this.pos+=8,e},readSFixed64:function(){var e=gl(this.buf,this.pos)+xl(this.buf,this.pos+4)*rl;return this.pos+=8,e},readFloat:function(){var e=tl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=tl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r=t[this.pos++],i=127&r;if(r<128)return i;if(i|=(127&(r=t[this.pos++]))<<7,r<128)return i;if(i|=(127&(r=t[this.pos++]))<<14,r<128)return i;if(i|=(127&(r=t[this.pos++]))<<21,r<128)return i;var n,a,r=i|=(15&t[this.pos])<<28,t=e,i=this,e=i.buf;if(a=e[i.pos++],n=(112&a)>>4,a<128)return sl(r,n,t);if(a=e[i.pos++],n|=(127&a)<<3,a<128)return sl(r,n,t);if(a=e[i.pos++],n|=(127&a)<<10,a<128)return sl(r,n,t);if(a=e[i.pos++],n|=(127&a)<<17,a<128)return sl(r,n,t);if(a=e[i.pos++],n|=(127&a)<<24,a<128)return sl(r,n,t);if(a=e[i.pos++],n|=(1&a)<<31,a<128)return sl(r,n,t);throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e,t=this.readVarint()+this.pos,r=this.pos;if(12<=(this.pos=t)-r&&nl)return e=this.buf,nl.decode(e.subarray(r,t));for(var i,n,a,s=this.buf,o=t,l="",u=r;u<o;){var h=s[u],c=null,p=239<h?4:223<h?3:191<h?2:1;if(o<u+p)break;1===p?h<128&&(c=h):2===p?128==(192&(i=s[u+1]))&&(c=(31&h)<<6|63&i)<=127&&(c=null):3===p?(i=s[u+1],n=s[u+2],128==(192&i)&&128==(192&n)&&((c=(15&h)<<12|(63&i)<<6|63&n)<=2047||55296<=c&&c<=57343)&&(c=null)):4===p&&(i=s[u+1],n=s[u+2],a=s[u+3],128==(192&i)&&128==(192&n)&&128==(192&a)&&((c=(15&h)<<18|(63&i)<<12|(63&n)<<6|63&a)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,p=1):65535<c&&(c-=65536,l+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),l+=String.fromCharCode(c),u+=p}return l},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==I.Bytes)return e.push(this.readVarint(t));var r=al(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==I.Bytes)return e.push(this.readSVarint());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==I.Bytes)return e.push(this.readBoolean());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==I.Bytes)return e.push(this.readFloat());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==I.Bytes)return e.push(this.readDouble());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==I.Bytes)return e.push(this.readFixed32());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==I.Bytes)return e.push(this.readSFixed32());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==I.Bytes)return e.push(this.readFixed64());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==I.Bytes)return e.push(this.readSFixed64());var t=al(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){e&=7;if(e===I.Varint)for(;127<this.buf[this.pos++];);else if(e===I.Bytes)this.pos=this.readVarint()+this.pos;else if(e===I.Fixed32)this.pos+=4;else{if(e!==I.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,r=this.length||16;r<this.pos+e;)r*=2;r!==this.length&&((t=new Uint8Array(r)).set(this.buf),this.buf=t,this.length=r)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),vl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),vl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),vl(this.buf,-1&e,this.pos),vl(this.buf,Math.floor(e*il),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),vl(this.buf,-1&e,this.pos),vl(this.buf,Math.floor(e*il),this.pos+4),this.pos+=8},writeVarint:function(e){if(268435455<(e=+e||0)||e<0){var t=e,r=this;if(0<=t?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:n=n+1|(i=0)),0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10);var t=i,i=r,t=(i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t,n),n=r,r=(7&t)<<4;return n.buf[n.pos++]|=r|((t>>>=3)?128:0),void(t&&(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),t&&(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),t&&(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),t&&(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),t&&(n.buf[n.pos++]=127&t))))))}this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos,e=(this.pos=function(e,t,r){for(var i,n,a=0;a<t.length;a++){if(55295<(i=t.charCodeAt(a))&&i<57344){if(!n){56319<i||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos),this.pos-t);128<=e&&ol(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(e){this.realloc(4),tl.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),tl.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos,e=(e(t,this),this.pos-r);128<=e&&ol(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeMessage:function(e,t,r){this.writeTag(e,I.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,ll,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,ul,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,pl,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,hl,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,cl,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,dl,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,fl,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,yl,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ml,t)},writeBytesField:function(e,t){this.writeTag(e,I.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,I.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,I.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,I.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,I.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,I.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,I.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,I.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,I.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,I.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var pe,bl=P(V);const wl=3;const _l=wl;function Sl(e){let t=0,r=0;for(const o of e)t+=o.w*o.h,r=Math.max(r,o.w);var i;e.sort((e,t)=>t.h-e.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let a=0,s=0;for(const l of e)for(let e=n.length-1;0<=e;e--){const u=n[e];if(!(l.w>u.w||l.h>u.h)){l.x=u.x,l.y=u.y,s=Math.max(s,l.y+l.h),a=Math.max(a,l.x+l.w),l.w===u.w&&l.h===u.h?(i=n.pop(),e<n.length&&(n[e]=i)):l.h===u.h?(u.x+=l.w,u.w-=l.w):(l.w!==u.w&&n.push({x:u.x+l.w,y:u.y,w:u.w-l.w,h:l.h}),u.y+=l.h,u.h-=l.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}const ae=1;class kl{constructor(e,{pixelRatio:t,version:r,stretchX:i,stretchY:n,content:a,textFitWidth:s,textFitHeight:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=n,this.content=a,this.version=r,this.textFitWidth=s,this.textFitHeight=o}get tl(){return[this.paddedRect.x+ae,this.paddedRect.y+ae]}get br(){return[this.paddedRect.x+this.paddedRect.w-ae,this.paddedRect.y+this.paddedRect.h-ae]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ae)/this.pixelRatio,(this.paddedRect.h-2*ae)/this.pixelRatio]}}class Al{constructor(e,t){var r={},i={},n=(this.haveRenderCallbacks=[],[]);this.addImages(e,r,n),this.addImages(t,i,n);const{w:a,h:s}=Sl(n);var o=new Ls({width:a||1,height:s||1});for(const p in e){var l=e[p],u=r[p].paddedRect;Ls.copy(l.data,o,{x:0,y:0},{x:u.x+ae,y:u.y+ae},l.data)}for(const d in t){var h=t[d],c=i[d].paddedRect;const f=c.x+ae,y=c.y+ae,a=h.data.width,s=h.data.height;Ls.copy(h.data,o,{x:0,y:0},{x:f,y:y},h.data),Ls.copy(h.data,o,{x:0,y:s-1},{x:f,y:y-1},{width:a,height:1}),Ls.copy(h.data,o,{x:0,y:0},{x:f,y:y+s},{width:a,height:1}),Ls.copy(h.data,o,{x:a-1,y:0},{x:f-1,y:y},{width:1,height:s}),Ls.copy(h.data,o,{x:0,y:0},{x:f+a,y:y},{width:1,height:s})}this.image=o,this.iconPositions=r,this.patternPositions=i}addImages(e,t,r){for(const a in e){var i=e[a],n={x:0,y:0,w:i.data.width+2*ae,h:i.data.height+2*ae};r.push(n),t[a]=new kl(n,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){var i;e&&t&&e.version!==t.version&&(e.version=t.version,[e,i]=e.tl,r.update(t.data,void 0,{x:e,y:i}))}}t("ImagePosition",kl),t("ImageAtlas",Al),(kt=pe=pe||{})[kt.none=0]="none",kt[kt.horizontal=1]="horizontal",kt[kt.vertical=2]="vertical",kt[kt.horizontalOnly=3]="horizontalOnly";const Il=-17;class Ml{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Ml;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Ml;return t.imageName=e,t}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const i=new zl;for(let e=0;e<t.sections.length;e++){var n=t.sections[e];n.image?i.addImageSection(n):i.addTextSection(n,r)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(t){let r="";for(let e=0;e<t.length;e++){var i=t.charCodeAt(e+1)||null,n=t.charCodeAt(e-1)||null;(!i||!mn(i)||el[t[e+1]])&&(!n||!mn(n)||el[t[e-1]])&&el[t[e]]?r+=el[t[e]]:r+=t[e]}return r}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&Cl[this.text.charCodeAt(e)];e++)t++;let r=this.text.length;for(let e=this.text.length-1;0<=e&&e>=t&&Cl[this.text.charCodeAt(e)];e--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(e,t){const r=new zl;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Ml.forText(t.scale,t.fontStack||e));var r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r)}addImageSection(e){var t,e=e.image?e.image.name:"";0===e.length?ue("Can't add FormattedSection with an empty image."):(t=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(t),this.sections.push(Ml.forImage(e)),this.sectionIndex.push(this.sections.length-1)):ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pl(e,i,D,n,a,s,L,O,$,u,h,c,R,p,j){const t=zl.fromFeature(e,a);c===pe.vertical&&t.verticalizePunctuation();let d;const{processBidirectionalText:r,processStyledBidirectionalText:o}=ne;if(r&&1===t.sections.length){d=[];for(const l of r(t.toString(),Dl(t,u,s,i,n,p))){const z=new zl;z.text=l,z.sections=t.sections;for(let e=0;e<l.length;e++)z.sectionIndex.push(0);d.push(z)}}else if(o){d=[];for(const P of o(t.text,t.sectionIndex,Dl(t,u,s,i,n,p))){const C=new zl;C.text=P[0],C.sectionIndex=P[1],C.sections=t.sections,d.push(C)}}else d=function(e,t){const r=[];var i=e.text;let n=0;for(const a of t)r.push(e.substring(n,a)),n=a;return n<i.length&&r.push(e.substring(n,i.length)),r}(t,Dl(t,u,s,i,n,p));e=[],a={positionedLines:e,text:t.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:c,iconsInText:!1,verticalizable:!1};{var f=a,q=i,U=D,N=n,y=(s=d,L),Z=(p=O,h=$,c),m=u,g=R,G=j;let o=0,l=Il,t=0,r=0;var v="right"===h?1:"left"===h?0:.5;let e=0;for(const B of s){B.trim();var x=B.getMaxScale(),b=(x-1)*ce;const V={positionedGlyphs:[],lineOffset:0},T=(f.positionedLines[e]=V).positionedGlyphs;let s=0;if(B.length()){for(let a=0;a<B.length();a++){const E=B.getSection(a);var w=B.getSectionIndex(a),_=B.getCharCode(a);let e=0,t=null,r=null,i=null,n=ce;var S=!(Z===pe.horizontal||!g&&!yn(_)||g&&(Cl[_]||function(e){return/\p{sc=Arab}/u.test(String.fromCodePoint(e))}(_)));if(E.imageName){var k=N[E.imageName];if(!k)continue;i=E.imageName,f.iconsInText=f.iconsInText||!0,r=k.paddedRect;var k=k.displaySize,A=(E.scale=E.scale*ce/G,t={width:k[0],height:k[1],left:ae,top:-_l,advance:S?k[1]:k[0]},ce-k[1]*E.scale),A=(e=b+A,n=t.advance,S?k[0]*E.scale-ce*x:k[1]*E.scale-ce*x);0<A&&A>s&&(s=A)}else{k=U[E.fontStack],A=k&&k[_];if(A&&A.rect)r=A.rect,t=A.metrics;else{var I=q[E.fontStack],I=I&&I[_];if(!I)continue;t=I.metrics}e=(x-E.scale)*ce}S?(f.verticalizable=!0,T.push({glyph:_,imageName:i,x:o,y:l+e,vertical:S,scale:E.scale,fontStack:E.fontStack,sectionIndex:w,metrics:t,rect:r}),o+=n*E.scale+m):(T.push({glyph:_,imageName:i,x:o,y:l+e,vertical:S,scale:E.scale,fontStack:E.fontStack,sectionIndex:w,metrics:t,rect:r}),o+=t.advance*E.scale+m)}0!==T.length&&(M=o-m,t=Math.max(M,t),function(t,r,i,e,n){if(e||n){var a=t[i],a=a.metrics.advance*a.scale,s=(t[i].x+a)*e;for(let e=r;e<=i;e++)t[e].x-=s,t[e].y+=n}}(T,0,T.length-1,v,s)),o=0;var M=y*x+s;V.lineOffset=Math.max(s,b),l+=M,r=Math.max(M,r),++e}else l+=y,++e}var h=l-Il,{horizontalAlign:p,verticalAlign:i}=Ll(p);{var X=f.positionedLines;var H=v;var Y=p;var J=i;var K=t;var W=r;var Q=y;var ee=h;var te=s.length;var re=(H-Y)*K;let e=0;e=W!==Q?-ee*J-Il:(-J*te+.5)*Q;for(const ie of X)for(const F of ie.positionedGlyphs)F.x+=re,F.y+=e}f.top+=-i*h,f.bottom=f.top+h,f.left+=-p*t,f.right=f.left+t}return!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return;return 1}(e)&&a}const Cl={[9]:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Bl={[10]:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Vl={[40]:!0};function Tl(e,t,r,i,n,a){return t.imageName?(i=i[t.imageName])?i.displaySize[0]*t.scale*ce/a+n:0:(a=(i=r[t.fontStack])&&i[e])?a.metrics.advance*t.scale+n:0}function El(e,t,r,i){var n=Math.pow(e-t,2);return i?e<t?n/2:2*n:n+Math.abs(r)*r}function Fl(e,t,r,i,n,a){let s=null,o=El(t,r,n,a);for(const u of i){var l=El(t-u.x,r,n,a)+u.badness;l<=o&&(s=u,o=l)}return{index:e,x:t,priorBreak:s,badness:o}}function Dl(t,r,e,i,n,a){if(!t)return[];const s=[];var o=function(t,r,e,i,n,a){let s=0;for(let e=0;e<t.length();e++){var o=t.getSection(e);s+=Tl(t.getCharCode(e),o,i,n,r,a)}return e=Math.max(1,Math.ceil(s/e)),s/e}(t,r,e,i,n,a),l=0<=t.text.indexOf("");let u=0;for(let e=0;e<t.length();e++){var h,c=t.getSection(e),p=t.getCharCode(e);Cl[p]||(u+=Tl(p,c,i,n,r,a)),e<t.length()-1&&(h=fn(p),(Bl[p]||h||c.imageName||e!==t.length()-2&&Vl[t.getCharCode(e+1)])&&s.push(Fl(e+1,u,o,s,function(e,t,r){let i=0;return 10===e&&(i-=1e4),r&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}(p,t.getCharCode(e+1),h&&l),!1)))}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Fl(t.length(),u,o,s,0,!0))}function Ll(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ol(e){let t=e.left,r=e.top,i=e.right-t,n=e.bottom-r;var a=e.image.content[2]-e.image.content[0],s=e.image.content[3]-e.image.content[1],o=null!=(o=e.image.textFitWidth)?o:"stretchOrShrink",e=null!=(e=e.image.textFitHeight)?e:"stretchOrShrink",a=a/s;return"proportional"===e?("stretchOnly"===o&&i/n<a||"proportional"===o)&&(s=Math.ceil(n*a),t*=s/i,i=s):"proportional"===o&&"stretchOnly"===e&&0!=a&&i/n>a&&(s=Math.ceil(i/a),r*=s/n,n=s),{x1:t,y1:r,x2:t+i,y2:r+n}}function $l(e,t,r,i,n,a){e=e.image;let s;e.content&&(o=e.content,l=e.pixelRatio||1,s=[o[0]/l,o[1]/l,e.displaySize[0]-o[2]/l,e.displaySize[1]-o[3]/l]);var o=t.left*a,l=t.right*a;let u,h,c,p;h="width"===r||"both"===r?(p=n[0]+o-i[3],n[0]+l+i[1]):(p=n[0]+(o+l-e.displaySize[0])/2)+e.displaySize[0];o=t.top*a,l=t.bottom*a;return c="height"===r||"both"===r?(u=n[1]+o-i[0],n[1]+l+i[2]):(u=n[1]+(o+l-e.displaySize[1])/2)+e.displaySize[1],{image:e,top:u,right:h,bottom:c,left:p,collisionPadding:s}}const Rl=255,jl=128,ql=Rl*jl;function Ul(r,i){const n=i["expression"];if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new z(r+1))};if("source"===n.kind)return{kind:"source"};{var{zoomStops:a,interpolationType:i}=n;let e=0;for(;e<a.length&&a[e]<=r;)e++;let t=e=Math.max(0,e-1);for(;t<a.length&&a[t]<r+1;)t++;t=Math.min(a.length-1,t);var s=a[e],o=a[t];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:o,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:o,minSize:n.evaluate(new z(s)),maxSize:n.evaluate(new z(o)),interpolationType:i}}}function Nl(e,t,r){let i="never";t=e.get(t);return t?i=t:e.get(r)&&(i="always"),i}const Zl=go.VectorTileFeature.types,Gl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xl(e,t,r,i,n,a,s,o,l,u,h,c,p){var d=o?Math.min(ql,Math.round(o[0])):0,o=o?Math.min(ql,Math.round(o[1])):0;e.emplaceBack(t,r,Math.round(32*i),Math.round(32*n),a,s,(d<<1)+(l?1:0),o,16*u,16*h,256*c,256*p)}function Hl(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function Yl(e){for(const t of e.sections)if(function(e){for(const t of e)if(vn(t.charCodeAt(0)))return 1}(t.text))return!0;return!1}class Jl{constructor(e){this.layoutVertexArray=new ka,this.indexArray=new Pa,this.programConfigurations=e,this.segments=new k,this.dynamicLayoutVertexArray=new Aa,this.opacityVertexArray=new Ia,this.hasVisibleVertices=!1,this.placedSymbolArray=new la}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yo.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Jo.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Gl,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}t("SymbolBuffers",Jl);class Kl{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new k,this.collisionVertexArray=new za}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ko.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}t("CollisionBuffers",Kl);class Wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ws([]),this.placementViewportMatrix=ws([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ul(this.zoom,t["text-size"]),this.iconSizeData=Ul(this.zoom,t["icon-size"]);const r=this.layers[0].layout,i=r.get("symbol-sort-key");t=r.get("symbol-z-order"),this.canOverlap="never"!==Nl(r,"text-overlap","text-allow-overlap")||"never"!==Nl(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==t&&!i.isConstant(),t="viewport-y"===t||"auto"===t&&!this.sortFeaturesByKey;this.sortFeaturesByY=t&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(e=>pe[e])),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID}createArrays(){this.text=new Jl(new Ka(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Jl(new Ka(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ca,this.lineVertexArray=new pa,this.symbolInstances=new ha,this.textAnchorOffsets=new fa}calculateGlyphDependencies(t,r,i,n,a){for(let e=0;e<t.length;e++)if(r[t.charCodeAt(e)]=!0,(i||n)&&a){const s=el[t.charAt(e)];s&&(r[s.charCodeAt(0)]=!0)}}populate(e,t,r){const i=this.layers[0],n=i.layout,a=n.get("text-font"),s=n.get("text-field");var o=n.get("icon-image"),l=("constant"!==s.value.kind||s.value.value instanceof M&&!s.value.value.isEmpty()||0<s.value.value.toString().length)&&("constant"!==a.value.kind||0<a.value.value.length),u="constant"!==o.value.kind||!!o.value.value||0<Object.keys(o.parameters).length;const h=n.get("symbol-sort-key");if(this.features=[],l||u){const S=t.iconDependencies,k=t.glyphDependencies;var c,p,d,f,y=t.availableImages,m=new z(this.zoom);for({feature:c,id:p,index:d,sourceLayerIndex:f}of e){var g,v=i._featureFilter.needGeometry;const A=rs(c,v);if(i._featureFilter.filter(m,A,r)){v||(A.geometry=ts(c));let e;l&&(v=i.getValueAndResolveTokens("text-field",A,r,y),v=M.factory(v),(!(g=this.hasRTLText=this.hasRTLText||Yl(v))||"unavailable"===ne.getRTLTextPluginStatus()||g&&ne.isParsed())&&(e=Qo(v,i,A)));let t;if(u&&(g=i.getValueAndResolveTokens("icon-image",A,r,y),t=g instanceof Xe?g:Xe.fromString(g)),e||t){v=this.sortFeaturesByKey?h.evaluate(A,{},r):void 0,v={id:p,text:e,icon:t,index:d,sourceLayerIndex:f,geometry:A.geometry,properties:c.properties,type:Zl[c.type],sortKey:v};if(this.features.push(v),t&&(S[t.name]=!0),e){var x,b,w=a.evaluate(A,{},r).join(","),_="viewport"!==n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(pe.vertical);for(const I of e.sections)I.image?S[I.image.name]=!0:(x=un(e.toString()),b=I.fontStack||w,b=k[b]=k[b]||{},this.calculateGlyphDependencies(I.text,b,_,this.allowVerticalPlacement,x))}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){const n={},a={},s=[];let r=0;function i(e){s.push(t[e]),r++}function o(e,t,r){var i=a[e];return delete a[e],a[t]=i,s[i].geometry[0].pop(),s[i].geometry[0]=s[i].geometry[0].concat(r[0]),i}function l(e,t,r){var i=n[t];return delete n[t],n[e]=i,s[i].geometry[0].shift(),s[i].geometry[0]=r[0].concat(s[i].geometry[0]),i}function u(e,t,r){r=r?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:`+r.y}for(let e=0;e<t.length;e++){const m=t[e];var h,c,p,d,f=m.geometry,y=m.text?m.text.toString():null;y?(h=u(y,f),c=u(y,f,!0),h in a&&c in n&&a[h]!==n[c]?(p=l(h,c,f),d=o(h,c,s[p].geometry),delete n[h],delete a[c],a[u(y,s[d].geometry,!0)]=d,s[p].geometry=null):h in a?o(h,c,f):c in n?l(h,c,f):(i(e),n[h]=r-1,a[c]=r-1)):i(e)}return s.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}}update(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,n){var e=this.lineVertexArray.length;if(void 0!==i.segment){let t=i.dist(n[i.segment+1]),r=i.dist(n[i.segment]);const s={};for(let e=i.segment+1;e<n.length;e++)s[e]={x:n[e].x,y:n[e].y,tileUnitDistanceFromAnchor:t},e<n.length-1&&(t+=n[e+1].dist(n[e]));for(let e=i.segment||0;0<=e;e--)s[e]={x:n[e].x,y:n[e].y,tileUnitDistanceFromAnchor:r},0<e&&(r+=n[e-1].dist(n[e]));for(let e=0;e<n.length;e++){var a=s[e];this.lineVertexArray.emplaceBack(a.x,a.y,a.tileUnitDistanceFromAnchor)}}return{lineStartIndex:e,lineLength:this.lineVertexArray.length-e}}addSymbols(t,r,i,e,n,a,s,o,l,u,h,c){const p=t.indexArray;var d=t.layoutVertexArray;const f=t.segments.prepareSegment(4*r.length,d,p,this.canOverlap?a.sortKey:void 0);var y=this.glyphOffsetArray.length,m=f.vertexLength,g=this.allowVerticalPlacement&&s===pe.vertical?Math.PI/2:0,v=a.text&&a.text.sections;for(let e=0;e<r.length;e++){var{tl:x,tr:b,bl:w,br:_,tex:S,pixelOffsetTL:k,pixelOffsetBR:A,minFontScaleX:I,minFontScaleY:M,glyphOffset:z,isSDF:P,sectionIndex:C}=r[e],B=f.vertexLength,V=z[1];Xl(d,o.x,o.y,x.x,V+x.y,S.x,S.y,i,P,k.x,k.y,I,M),Xl(d,o.x,o.y,b.x,V+b.y,S.x+S.w,S.y,i,P,A.x,k.y,I,M),Xl(d,o.x,o.y,w.x,V+w.y,S.x,S.y+S.h,i,P,k.x,A.y,I,M),Xl(d,o.x,o.y,_.x,V+_.y,S.x+S.w,S.y+S.h,i,P,A.x,A.y,I,M),Hl(t.dynamicLayoutVertexArray,o,g),p.emplaceBack(B,B+1,B+2),p.emplaceBack(B+1,B+2,B+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(z[0]),e!==r.length-1&&C===r[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,a,a.index,{},c,v&&v[C])}t.placedSymbolArray.emplaceBack(o.x,o.y,y,this.glyphOffsetArray.length-y,m,l,u,o.segment,i?i[0]:0,i?i[1]:0,e[0],e[1],s,0,!1,0,h)}_addCollisionDebugVertex(e,t,r,i,n,a){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,i,n,Math.round(a.x),Math.round(a.y))}addCollisionDebugVertices(e,t,r,i,n,a,s){const o=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray);var l=o.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,c=s.anchorX,s=s.anchorY;this._addCollisionDebugVertex(u,h,a,c,s,new O(e,t)),this._addCollisionDebugVertex(u,h,a,c,s,new O(r,t)),this._addCollisionDebugVertex(u,h,a,c,s,new O(r,i)),this._addCollisionDebugVertex(u,h,a,c,s,new O(e,i)),o.vertexLength+=4;const p=n.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),o.primitiveLength+=4}addDebugCollisionBoxes(t,r,i,n){for(let e=t;e<r;e++){var a=this.collisionBoxArray.get(e),s=a.x1,o=a.y1,l=a.x2,u=a.y2;this.addCollisionDebugVertices(s,o,l,u,n?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kl(Ma,Wo.members,Ca),this.iconCollisionBox=new Kl(Ma,Wo.members,Ca);for(let e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(t,r,i,n,a,s,o,l,u){const h={};for(let e=r;e<i;e++){var c=t.get(e);h.textBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},h.textFeatureIndex=c.featureIndex;break}for(let e=n;e<a;e++){var p=t.get(e);h.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},h.verticalTextFeatureIndex=p.featureIndex;break}for(let e=s;e<o;e++){var d=t.get(e);h.iconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.iconFeatureIndex=d.featureIndex;break}for(let e=l;e<u;e++){var f=t.get(e);h.verticalIconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalIconFeatureIndex=f.featureIndex;break}return h}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(t,r){var r=t.placedSymbolArray.get(r),i=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<i;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;var t=Math.sin(e),r=Math.cos(e);const i=[],n=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);var s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.anchorX+r*s.anchorY)),n.push(s.featureIndex)}return a.sort((e,t)=>i[e]-i[t]||n[t]-n[e]),a}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const r=this.symbolInstances.get(t);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((e,t,r)=>{0<=e&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),0<=r.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),0<=r.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),0<=r.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}t("SymbolBucket",Wl,{omit:["layers","collisionBoxArray","features","compareText"]}),Wl.MAX_GLYPHS=65535,Wl.addDynamicAttributes=Hl;let Ql;let eu;var tu={get paint(){return eu=eu||new a({"icon-opacity":new i(l.paint_symbol["icon-opacity"]),"icon-color":new i(l.paint_symbol["icon-color"]),"icon-halo-color":new i(l.paint_symbol["icon-halo-color"]),"icon-halo-width":new i(l.paint_symbol["icon-halo-width"]),"icon-halo-blur":new i(l.paint_symbol["icon-halo-blur"]),"icon-translate":new r(l.paint_symbol["icon-translate"]),"icon-translate-anchor":new r(l.paint_symbol["icon-translate-anchor"]),"text-opacity":new i(l.paint_symbol["text-opacity"]),"text-color":new i(l.paint_symbol["text-color"],{runtimeType:ie,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new i(l.paint_symbol["text-halo-color"]),"text-halo-width":new i(l.paint_symbol["text-halo-width"]),"text-halo-blur":new i(l.paint_symbol["text-halo-blur"]),"text-translate":new r(l.paint_symbol["text-translate"]),"text-translate-anchor":new r(l.paint_symbol["text-translate-anchor"])})},get layout(){return Ql=Ql||new a({"symbol-placement":new r(l.layout_symbol["symbol-placement"]),"symbol-spacing":new r(l.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new r(l.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new i(l.layout_symbol["symbol-sort-key"]),"symbol-z-order":new r(l.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new r(l.layout_symbol["icon-allow-overlap"]),"icon-overlap":new r(l.layout_symbol["icon-overlap"]),"icon-ignore-placement":new r(l.layout_symbol["icon-ignore-placement"]),"icon-optional":new r(l.layout_symbol["icon-optional"]),"icon-rotation-alignment":new r(l.layout_symbol["icon-rotation-alignment"]),"icon-size":new i(l.layout_symbol["icon-size"]),"icon-text-fit":new r(l.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new r(l.layout_symbol["icon-text-fit-padding"]),"icon-image":new i(l.layout_symbol["icon-image"]),"icon-rotate":new i(l.layout_symbol["icon-rotate"]),"icon-padding":new i(l.layout_symbol["icon-padding"]),"icon-keep-upright":new r(l.layout_symbol["icon-keep-upright"]),"icon-offset":new i(l.layout_symbol["icon-offset"]),"icon-anchor":new i(l.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new r(l.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new r(l.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new r(l.layout_symbol["text-rotation-alignment"]),"text-field":new i(l.layout_symbol["text-field"]),"text-font":new i(l.layout_symbol["text-font"]),"text-size":new i(l.layout_symbol["text-size"]),"text-max-width":new i(l.layout_symbol["text-max-width"]),"text-line-height":new r(l.layout_symbol["text-line-height"]),"text-letter-spacing":new i(l.layout_symbol["text-letter-spacing"]),"text-justify":new i(l.layout_symbol["text-justify"]),"text-radial-offset":new i(l.layout_symbol["text-radial-offset"]),"text-variable-anchor":new r(l.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new i(l.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new i(l.layout_symbol["text-anchor"]),"text-max-angle":new r(l.layout_symbol["text-max-angle"]),"text-writing-mode":new r(l.layout_symbol["text-writing-mode"]),"text-rotate":new i(l.layout_symbol["text-rotate"]),"text-padding":new r(l.layout_symbol["text-padding"]),"text-keep-upright":new r(l.layout_symbol["text-keep-upright"]),"text-transform":new i(l.layout_symbol["text-transform"]),"text-offset":new i(l.layout_symbol["text-offset"]),"text-allow-overlap":new r(l.layout_symbol["text-allow-overlap"]),"text-overlap":new r(l.layout_symbol["text-overlap"]),"text-ignore-placement":new r(l.layout_symbol["text-ignore-placement"]),"text-optional":new r(l.layout_symbol["text-optional"])})}};class ru{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:re,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}t("FormatSectionOverride",ru,{omit:["defaultValue"]});class iu extends Vn{constructor(e){super(e,tu)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){e=this.layout.get("text-writing-mode");if(e){const r=[];for(const i of e)r.indexOf(i)<0&&r.push(i);this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,i){var n,r=this.layout.get(e).evaluate(t,{},r,i);const a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Gr(a.value)||!r?r:(n=t.properties,r.replace(/{([^{}]+)}/g,(e,t)=>n&&t in n?String(n[t]):""))}createBucket(e){return new Wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of tu.paint.overridableProperties)if(iu.hasPaintOverride(this.layout,i)){var t=this.paint.get(i),r=new ru(t),r=new Zr(r,t.property.specification);let e=null;e="constant"===t.value.kind||"source"===t.value.kind?new Hr("source",r):new Yr("composite",r,t.value.zoomStops),this.paint._values[i]=new In(t.property,e,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&iu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){e=e.get("text-field");const r=tu.paint.properties[t];let i=!1;const n=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if("constant"===e.value.kind&&e.value.value instanceof M)n(e.value.value.sections);else if("source"===e.value.kind){const a=e=>{var t;i||(e instanceof Ke&&m(e.value)===le?(t=e.value,n(t.sections)):e instanceof Ct?n(e.sections):e.eachChild(a))};t=e.value;t._styleExpression&&a(t._styleExpression.expression)}return i}}let nu;var au={get paint(){return nu=nu||new a({"background-color":new r(l.paint_background["background-color"]),"background-pattern":new Pn(l.paint_background["background-pattern"]),"background-opacity":new r(l.paint_background["background-opacity"])})}};class su extends Vn{constructor(e){super(e,au)}}let ou;var lu,uu,hu={get paint(){return ou=ou||new a({"raster-opacity":new r(l.paint_raster["raster-opacity"]),"raster-hue-rotate":new r(l.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new r(l.paint_raster["raster-brightness-min"]),"raster-brightness-max":new r(l.paint_raster["raster-brightness-max"]),"raster-saturation":new r(l.paint_raster["raster-saturation"]),"raster-contrast":new r(l.paint_raster["raster-contrast"]),"raster-resampling":new r(l.paint_raster["raster-resampling"]),"raster-fade-duration":new r(l.paint_raster["raster-fade-duration"])})}};class cu extends Vn{constructor(e){super(e,hu)}}class pu extends Vn{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class du{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const a of e){this._layerConfigs[a.id]=a;const s=this._layers[a.id]=function(e){if("custom"===e.type)return new pu(e);switch(e.type){case"background":return new su(e);case"circle":return new zs(e);case"fill":return new fo(e);case"fill-extrusion":return new To(e);case"heatmap":return new $s(e);case"hillshade":return new qs(e);case"line":return new Xo(e);case"raster":return new cu(e);case"symbol":return new iu(e)}}(a);s._featureFilter=ri(s.filter),this.keyCache[a.id]&&delete this.keyCache[a.id]}for(const o of t)delete this.keyCache[o],delete this._layerConfigs[o],delete this._layers[o];this.familiesBySource={};for(const e of function(r,i){const n={};for(let t=0;t<r.length;t++){var a=i&&i[r[t].id]||ui(r[t]);i&&(i[r[t].id]=a);let e=n[a];(e=e||(n[a]=[])).push(r[t])}const e=[];for(const t in n)e.push(n[t]);return e}(Object.values(this._layerConfigs),this.keyCache)){var r=e.map(e=>this._layers[e.id]),i=r[0];if("none"!==i.visibility){var n=i.source||"";let e=this.familiesBySource[n];e=e||(this.familiesBySource[n]={});n=i.sourceLayer||"_geojsonTileLayer";let t=e[n];(t=t||(e[n]=[])).push(r)}}}}class fu{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length `+this._numberToString.length);return this._numberToString[e]}}class yu{constructor(e,t,r,i,n){this.type="Feature",(this._vectorTileFeature=e)._z=t,e._x=r,e._y=i,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class mu{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new K(he,16,0),this.grid3D=new K(he,16,0),this.featureIndexArray=new ma,this.promoteId=t}insert(e,t,r,i,n,a){var s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n);const o=a?this.grid3D:this.grid;for(let e=0;e<t.length;e++){var l=t[e];const h=[1/0,1/0,-1/0,-1/0];for(let e=0;e<l.length;e++){var u=l[e];h[0]=Math.min(h[0],u.x),h[1]=Math.min(h[1],u.y),h[2]=Math.max(h[2],u.x),h[3]=Math.max(h[3],u.y)}h[0]<he&&h[1]<he&&0<=h[2]&&0<=h[3]&&o.insert(s,h[0],h[1],h[2],h[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new go.VectorTile(new bl(this.rawTileData)).layers,this.sourceLayerCoder=new fu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,t,r,a){this.loadVTLayers();const s=n.params||{},o=he/n.tileSize/n.scale,l=ri(s.filter),u=n.queryGeometry,h=n.queryPadding*o;var e=vu(u);const i=this.grid.query(e.minX-h,e.minY-h,e.maxX+h,e.maxY+h);e=vu(n.cameraQueryGeometry);for(const f of this.grid3D.query(e.minX-h,e.minY-h,e.maxX+h,e.maxY+h,(e,t,r,i)=>ps(n.cameraQueryGeometry,e-h,t-h,r+h,i+h)))i.push(f);i.sort(xu);var c={};let p;for(let e=0;e<i.length;e++){var d=i[e];if(d!==p){p=d;d=this.featureIndexArray.get(d);let i=null;this.loadMatchingFeature(c,d.bucketIndex,d.sourceLayerIndex,d.featureIndex,l,s.layers,s.availableImages,t,r,a,(e,t,r)=>(i=i||ts(e),t.queryIntersectsFeature(u,e,r,i,this.z,n.transform,o,n.pixelPosMatrix)))}}return c}loadMatchingFeature(t,e,r,i,n,a,s,o,l,u,h){var c=this.bucketLayerIDs[e];if(!a||function(t,r){for(let e=0;e<t.length;e++)if(0<=r.indexOf(t[e]))return 1}(a,c)){e=this.sourceLayerCoder.decode(r);const m=this.vtLayers[e];var p=m.feature(i);if(n.needGeometry){r=rs(p,!0);if(!n.filter(new z(this.tileID.overscaledZ),r,this.tileID.canonical))return}else if(!n.filter(new z(this.tileID.overscaledZ),p))return;var d=this.getId(p,e);for(let e=0;e<c.length;e++){var f=c[e];if(!(a&&a.indexOf(f)<0)){var y=o[f];if(y){let e={};d&&u&&(e=u.getState(y.sourceLayer||"_geojsonTileLayer",d));const g=R({},l[f]);g.paint=gu(g.paint,y.paint,p,e,s),g.layout=gu(g.layout,y.layout,p,e,s);y=!h||h(p,y,e);if(y){const v=new yu(p,this.z,this.x,this.y,d);v.layer=g;let e=t[f];(e=void 0===e?t[f]=[]:e).push({featureIndex:i,feature:v,intersectionZ:y})}}}}}}lookupSymbolFeatures(e,t,r,i,n,a,s,o){var l={},u=(this.loadVTLayers(),ri(n));for(const h of e)this.loadMatchingFeature(l,r,i,h,u,a,s,o,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(t="string"==typeof this.promoteId?this.promoteId:this.promoteId[t],"boolean"==typeof(r=e.properties[t])&&(r=Number(r))),r}}function gu(e,i,n,a,s){return j(e,(e,t)=>{const r=i instanceof Mn?i.get(t):null;return r&&r.evaluate?r.evaluate(n,a,s):r})}function vu(e){let t=1/0,r=1/0,i=-1/0,n=-1/0;for(const a of e)t=Math.min(t,a.x),r=Math.min(r,a.y),i=Math.max(i,a.x),n=Math.max(n,a.y);return{minX:t,minY:r,maxX:i,maxY:n}}function xu(e,t){return t-e}t("FeatureIndex",mu,{omit:["rawTileData","sourceLayerCoder"]});class bu extends O{constructor(e,t,r,i){super(e,t),this.angle=r,void 0!==i&&(this.segment=i)}clone(){return new bu(this.x,this.y,this.angle,this.segment)}}function wu(e,t,r,i,n){if(void 0===t.segment||0===r)return 1;let a=t,s=t.segment+1,o=0;for(;o>-r/2;){if(--s<0)return;o-=e[s].dist(a),a=e[s]}o+=e[s].dist(e[s+1]),s++;const l=[];let u=0;for(;o<r/2;){const p=e[s-1],d=e[s];var h=e[s+1];if(!h)return;var c=p.angleTo(d)-d.angleTo(h),c=Math.abs((c+3*Math.PI)%(2*Math.PI)-Math.PI);for(l.push({distance:o,angleDelta:c}),u+=c;o-l[0].distance>i;)u-=l.shift().angleDelta;if(u>n)return;s++,o+=d.dist(h)}return 1}function _u(t){let r=0;for(let e=0;e<t.length-1;e++)r+=t[e].dist(t[e+1]);return r}function Su(e,t,r){return e?.6*t*r:0}function ku(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Au(e,t,r,i,n,a,s,o,l){var u=Su(i,a,s),i=ku(i,n),n=i*s,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l,a=(t-n<t/4&&(t=n+t/4),2*a);return function e(t,r,i,n,a,s,o,l,u){const h=s/2;const c=_u(t);let p=0,d=r-i;let f=[];for(let e=0;e<t.length-1;e++){const y=t[e],m=t[e+1],g=y.dist(m),v=m.angleTo(y);for(;d+i<p+g;){const x=((d+=i)-p)/g,b=gt.number(y.x,m.x,x),w=gt.number(y.y,m.y,x);if(0<=b&&b<u&&0<=w&&w<u&&0<=d-h&&d+h<=c){const _=new bu(b,w,v,e);_._round(),n&&!wu(t,_,s,n,a)||f.push(_)}}p+=g}l||f.length||o||(f=e(t,p/2,i,n,a,s,o,!0,u));return f}(e,h?t/2*o%t:(i/2+a)*s*o%t,t,u,r,n,h,!1,l)}t("Anchor",bu);const Iu=ae;function Mu(e,m,g,t){const r=[],v=e.image,x=v.pixelRatio;var i=v.paddedRect.w-2*Iu,n=v.paddedRect.h-2*Iu;let a={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const s=v.stretchX||[[0,i]],o=v.stretchY||[[0,n]];var l=(e,t)=>e+t[1]-t[0];const b=s.reduce(l,0),w=o.reduce(l,0);var u,h,c,l=i-b,p=n-w;let _=0,S=b,k=0,A=w,I=0,M=l,z=0,P=p;v.content&&t&&(h=(u=v.content)[2]-u[0],c=u[3]-u[1],(v.textFitWidth||v.textFitHeight)&&(a=Ol(e)),_=zu(s,0,u[0]),k=zu(o,0,u[1]),S=zu(s,u[0],u[2]),A=zu(o,u[1],u[3]),I=u[0]-_,z=u[1]-k,M=h-S,P=c-A);const C=a.x1,B=a.y1,V=a.x2-C,T=a.y2-B;var d=(e,t,r,i)=>{var n=(e.stretch-_)/S*V+C,a=e.fixed-I-M*e.stretch/b,s=(t.stretch-k)/A*T+B,o=t.fixed-z-P*t.stretch/w,l=(r.stretch-_)/S*V+C,u=r.fixed-I-M*r.stretch/b,h=(i.stretch-k)/A*T+B,c=i.fixed-z-P*i.stretch/w;const p=new O(n,s),d=new O(l,s),f=new O(l,h),y=new O(n,h);s=new O(a/x,o/x),l=new O(u/x,c/x),n=m*Math.PI/180,n&&(h=Math.sin(n),o=[a=Math.cos(n),-h,h,a],p._matMult(o),d._matMult(o),y._matMult(o),f._matMult(o)),u=e.stretch+e.fixed,c=r.stretch+r.fixed,n=t.stretch+t.fixed,h=i.stretch+i.fixed,a={x:v.paddedRect.x+Iu+u,y:v.paddedRect.y+Iu+n,w:c-u,h:h-n},o=M/x/V,e=P/x/T;return{tl:p,tr:d,bl:y,br:f,tex:a,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:s,pixelOffsetBR:l,minFontScaleX:o,minFontScaleY:e,isSDF:g}};if(t&&(v.stretchX||v.stretchY)){var f=Pu(s,l,b),y=Pu(o,p,w);for(let e=0;e<f.length-1;e++){var E=f[e],F=f[e+1];for(let e=0;e<y.length-1;e++){var D=y[e],L=y[e+1];r.push(d(E,D,F,L))}}}else r.push(d({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+i},{fixed:0,stretch:1+n}));return r}function zu(e,t,r){let i=0;for(const n of e)i+=Math.max(t,Math.min(r,n[1]))-Math.max(t,Math.min(r,n[0]));return i}function Pu(e,t,r){const i=[{fixed:-Iu,stretch:0}];for(var[n,a]of e){var s=i[i.length-1];i.push({fixed:n-s.stretch,stretch:s.stretch}),i.push({fixed:n-s.stretch,stretch:s.stretch+(a-n)})}return i.push({fixed:t+Iu,stretch:r}),i}function Cu(e,s,o,t,l,r,u,h){var c=t.layout.get("text-rotate").evaluate(r,{})*Math.PI/180;const p=[];for(const _ of s.positionedLines)for(const S of _.positionedGlyphs)if(S.rect){var d=S.rect||{};let e=_l+1,t=!0,r=1,i=0;var f,y=(l||h)&&S.vertical,m=S.metrics.advance*S.scale/2,g=(h&&s.verticalizable&&(g=(S.scale-1)*ce,f=(ce-S.metrics.width*S.scale)/2,i=_.lineOffset/2-(S.imageName?-f:g)),S.imageName&&(f=u[S.imageName],t=f.sdf,r=f.pixelRatio,e=ae/r),l?[S.x+m,S.y]:[0,0]);let n=l?[0,0]:[S.x+m+o[0],S.y+o[1]-i],a=[0,0];y&&(a=n,n=[0,0]);var v=S.metrics.isDoubleResolution?2:1,x=(S.metrics.left-e)*S.scale-m+n[0],b=(-S.metrics.top-e)*S.scale+n[1],w=x+d.w/v*S.scale/r,v=b+d.h/v*S.scale/r;const k=new O(x,b),A=new O(w,b),I=new O(x,v),M=new O(w,v);y&&(b=new O(-m,m-Il),x=-Math.PI/2,w=ce/2-m,v=S.imageName?w:0,y=new O(5-Il-w,-v),m=new O(...a),k._rotateAround(x,b)._add(y)._add(m),A._rotateAround(x,b)._add(y)._add(m),I._rotateAround(x,b)._add(y)._add(m),M._rotateAround(x,b)._add(y)._add(m)),c&&(w=Math.sin(c),x=[v=Math.cos(c),-w,w,v],k._matMult(x),A._matMult(x),I._matMult(x),M._matMult(x));b=new O(0,0),y=new O(0,0);p.push({tl:k,tr:A,bl:I,br:M,tex:d,writingMode:s.writingMode,glyphOffset:g,sectionIndex:S.sectionIndex,isSDF:t,pixelOffsetTL:b,pixelOffsetBR:y,minFontScaleX:0,minFontScaleY:0})}return p}class Bu{constructor(e,t,r,i,n,a,s,o,l,u){if(this.boxStartIndex=e.length,l){let e=a.top,t=a.bottom;var l=a.collisionPadding,l=(l&&(e-=l[1],t+=l[3]),t-e);0<l&&(l=Math.max(10,l),this.circleDiameter=l)}else{const h=null!=(l=a.image)&&l.content&&(a.image.textFitWidth||a.image.textFitHeight)?Ol(a):{x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};h.y1=h.y1*s-o[0],h.y2=h.y2*s+o[2],h.x1=h.x1*s-o[3],h.x2=h.x2*s+o[1];l=a.collisionPadding;if(l&&(h.x1-=l[0]*s,h.y1-=l[1]*s,h.x2+=l[2]*s,h.y2+=l[3]*s),u){const c=new O(h.x1,h.y1),p=new O(h.x2,h.y1),d=new O(h.x1,h.y2),f=new O(h.x2,h.y2);o=u*Math.PI/180;c._rotate(o),p._rotate(o),d._rotate(o),f._rotate(o),h.x1=Math.min(c.x,p.x,d.x,f.x),h.x2=Math.max(c.x,p.x,d.x,f.x),h.y1=Math.min(c.y,p.y,d.y,f.y),h.y2=Math.max(c.y,p.y,d.y,f.y)}e.emplaceBack(t.x,t.y,h.x1,h.y1,h.x2,h.y2,r,i,n)}this.boxEndIndex=e.length}}class Vu{constructor(e=[],t=(e,t)=>e<t?-1:t<e?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),0<--this.length&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this;for(var i=t[e];0<e;){var n=e-1>>1,a=t[n];if(0<=r(i,a))break;t[e]=a,e=n}t[e]=i}_down(t){const{data:r,compare:i}=this;for(var e=this.length>>1,n=r[t];t<e;){let e=1+(t<<1);var a=e+1;if(a<this.length&&i(r[a],r[e])<0&&(e=a),0<=i(r[e],n))break;r[t]=r[e],t=e}r[t]=n}}function Tu(r,e=1,t=!1){let i=1/0,n=1/0,a=-1/0,s=-1/0;var o=r[0];for(let e=0;e<o.length;e++){var l=o[e];(!e||l.x<i)&&(i=l.x),(!e||l.y<n)&&(n=l.y),(!e||l.x>a)&&(a=l.x),(!e||l.y>s)&&(s=l.y)}var u=a-i,h=s-n,c=Math.min(u,h);let p=c/2;const d=new Vu([],Eu);if(0===c)return new O(i,n);for(let t=i;t<a;t+=c)for(let e=n;e<s;e+=c)d.push(new Fu(t+p,e+p,p,r));let f=function(e){let i=0,n=0,a=0;var s=e[0];for(let e=0,t=s.length,r=t-1;e<t;r=e++){var o=s[e],l=s[r],u=o.x*l.y-l.x*o.y;n+=(o.x+l.x)*u,a+=(o.y+l.y)*u,i+=3*u}return new Fu(n/i,a/i,0,e)}(r),y=d.length;for(;d.length;){var m=d.pop();(m.d>f.d||!f.d)&&(f=m,t&&console.log("found best %d after %d probes",Math.round(1e4*m.d)/1e4,y)),m.max-f.d<=e||(p=m.h/2,d.push(new Fu(m.p.x-p,m.p.y-p,p,r)),d.push(new Fu(m.p.x+p,m.p.y-p,p,r)),d.push(new Fu(m.p.x-p,m.p.y+p,p,r)),d.push(new Fu(m.p.x+p,m.p.y+p,p,r)),y+=4)}return t&&(console.log("num probes: "+y),console.log("best distance: "+f.d)),f.p}function Eu(e,t){return t.max-e.max}function Fu(e,t,r,i){this.p=new O(e,t),this.h=r,this.d=function(i,t){let n=!1,a=1/0;for(let e=0;e<t.length;e++){var s=t[e];for(let e=0,t=s.length,r=t-1;e<t;r=e++){var o=s[e],l=s[r];o.y>i.y!=l.y>i.y&&i.x<(l.x-o.x)*(i.y-o.y)/(l.y-o.y)+o.x&&(n=!n),a=Math.min(a,us(i,o,l))}}return(n?1:-1)*Math.sqrt(a)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}(e=lu=lu||{})[e.center=1]="center",e[e.left=2]="left",e[e.right=3]="right",e[e.top=4]="top",e[e.bottom=5]="bottom",e[e["top-left"]=6]="top-left",e[e["top-right"]=7]="top-right",e[e["bottom-left"]=8]="bottom-left",e[e["bottom-right"]=9]="bottom-right";const Du=7,Lu=Number.POSITIVE_INFINITY;function Ou(r,i){if(i[1]!==Lu){var n=r,a=i[0],s=i[1];let e=0,t=0;switch(a=Math.abs(a),s=Math.abs(s),n){case"top-right":case"top-left":case"top":t=s-Du;break;case"bottom-right":case"bottom-left":case"bottom":t=-s+Du}switch(n){case"top-right":case"bottom-right":case"right":e=-a;break;case"top-left":case"bottom-left":case"left":e=a}return[e,t]}{var n=r,o=i[0];let e=0,t=0;var l=(o=o<0?0:o)/Math.SQRT2;switch(n){case"top-right":case"top-left":t=l-Du;break;case"bottom-right":case"bottom-left":t=-l+Du;break;case"bottom":t=-o+Du;break;case"top":t=o-Du}switch(n){case"top-right":case"bottom-right":e=-l;break;case"top-left":case"bottom-left":e=l;break;case"left":e=o;break;case"right":e=-o}return[e,t]}}function $u(t,r,i){const n=t.layout;var a=null==(a=n.get("text-variable-anchor-offset"))?void 0:a.evaluate(r,{},i);if(a){const s=a.values,o=[];for(let e=0;e<s.length;e+=2){const l=o[e]=s[e],u=s[e+1].map(e=>e*ce);l.startsWith("top")?u[1]-=Du:l.startsWith("bottom")&&(u[1]+=Du),o[e+1]=u}return new Ge(o)}a=n.get("text-variable-anchor");if(a){let e;const h=t._unevaluatedLayout,c=(e=void 0!==h.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(r,{},i)*ce,Lu]:n.get("text-offset").evaluate(r,{},i).map(e=>e*ce),[]);for(const p of a)c.push(p,Ou(p,e));return new Ge(c)}return null}function Ru(i){i.bucket.createArrays();var e,t=512*i.bucket.overscaling,n=(i.bucket.tilePixelRatio=he/t,i.bucket.compareText={},i.bucket.iconsNeedLinear=!1,i.bucket.layers[0]);const a=n.layout,r=n._unevaluatedLayout._values,s={layoutIconSize:r["icon-size"].possiblyEvaluate(new z(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new z(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new z(18))},o=("composite"===i.bucket.textSizeData.kind&&({minZoom:t,maxZoom:e}=i.bucket.textSizeData,s.compositeTextSizes=[r["text-size"].possiblyEvaluate(new z(t),i.canonical),r["text-size"].possiblyEvaluate(new z(e),i.canonical)]),"composite"===i.bucket.iconSizeData.kind&&({minZoom:t,maxZoom:e}=i.bucket.iconSizeData,s.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new z(t),i.canonical),r["icon-size"].possiblyEvaluate(new z(e),i.canonical)]),a.get("text-line-height")*ce);var l="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement"),u=a.get("text-keep-upright");const h=a.get("text-size");for(const m of i.bucket.features){const g=a.get("text-font").evaluate(m,{},i.canonical).join(","),v=h.evaluate(m,{},i.canonical),x=s.layoutTextSize.evaluate(m,{},i.canonical);var c=s.layoutIconSize.evaluate(m,{},i.canonical);const b={horizontal:{},vertical:void 0},w=m.text;let r=[0,0];if(w){const _=w.toString();var p=a.get("text-letter-spacing").evaluate(m,{},i.canonical)*ce;const S=hn(_)?p:0,k=a.get("text-anchor").evaluate(m,{},i.canonical);var d=$u(n,m,i.canonical);d||(p=a.get("text-radial-offset").evaluate(m,{},i.canonical),r=p?Ou(k,[p*ce,Lu]):a.get("text-offset").evaluate(m,{},i.canonical).map(e=>e*ce));let t=l?"center":a.get("text-justify").evaluate(m,{},i.canonical);const A="point"===a.get("symbol-placement")?a.get("text-max-width").evaluate(m,{},i.canonical)*ce:1/0;var f,p=()=>{i.bucket.allowVerticalPlacement&&un(_)&&(b.vertical=Pl(w,i.glyphMap,i.glyphPositions,i.imagePositions,g,A,o,k,"left",S,r,pe.vertical,!0,x,v))};if(!l&&d){const I=new Set;if("auto"===t)for(let e=0;e<d.values.length;e+=2)I.add(ju(d.values[e]));else I.add(t);let e=!1;for(const M of I)b.horizontal[M]||(e?b.horizontal[M]=b.horizontal[0]:(f=Pl(w,i.glyphMap,i.glyphPositions,i.imagePositions,g,A,o,"center",M,S,r,pe.horizontal,!1,x,v))&&(b.horizontal[M]=f,e=1===f.positionedLines.length));p()}else{"auto"===t&&(t=ju(k));var y=Pl(w,i.glyphMap,i.glyphPositions,i.imagePositions,g,A,o,k,t,S,r,pe.horizontal,!1,x,v);y&&(b.horizontal[t]=y),p(),un(_)&&l&&u&&(b.vertical=Pl(w,i.glyphMap,i.glyphPositions,i.imagePositions,g,A,o,k,t,S,r,pe.vertical,!1,x,v))}}let e,t=!1;m.icon&&m.icon.name&&((y=i.imageMap[m.icon.name])&&(e=function(e,t,r){var{horizontalAlign:r,verticalAlign:i}=Ll(r),n=t[0],t=t[1],r=(n=n-e.displaySize[0]*r)+e.displaySize[0],t=t-e.displaySize[1]*i;return{image:e,top:t,bottom:t+e.displaySize[1],left:n,right:r}}(i.imagePositions[m.icon.name],a.get("icon-offset").evaluate(m,{},i.canonical),a.get("icon-anchor").evaluate(m,{},i.canonical)),t=!!y.sdf,void 0===i.bucket.sdfIcons?i.bucket.sdfIcons=t:i.bucket.sdfIcons!==t&&ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),y.pixelRatio===i.bucket.pixelRatio&&0===a.get("icon-rotate").constantOr(1)||(i.bucket.iconsNeedLinear=!0)));p=Uu(b.horizontal)||b.vertical;i.bucket.iconsInText=!!p&&p.iconsInText,(p||e)&&!function(Z,G,X,H,Y,J,K,e,W,Q,ee){let t=J.textMaxSize.evaluate(G,{});void 0===t&&(t=K);const r=Z.layers[0].layout,te=r.get("icon-offset").evaluate(G,{},ee),i=Uu(X.horizontal),n=K/24,re=Z.tilePixelRatio*n,a=Z.tilePixelRatio*t/24,ie=Z.tilePixelRatio*e,s=Z.tilePixelRatio*r.get("symbol-spacing"),ne=r.get("text-padding")*Z.tilePixelRatio,se=function(e,t,r,i=1){return e=e.get("icon-padding").evaluate(t,{},r),[(t=e&&e.values)[0]*i,t[1]*i,t[2]*i,t[3]*i]}(r,G,ee,Z.tilePixelRatio),o=r.get("text-max-angle")/180*Math.PI,oe="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),le="map"===r.get("icon-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("symbol-placement"),w=s/2,u=r.get("icon-text-fit");let ae;H&&"none"!==u&&(Z.allowVerticalPlacement&&X.vertical&&(ae=$l(H,X.vertical,u,r.get("icon-text-fit-padding"),te,n)),i&&(H=$l(H,i,u,r.get("icon-text-fit-padding"),te,n)));var h=(p,d)=>{if(!(d.x<0||d.x>=he||d.y<0||d.y>=he)){var f=Z;var y=d;d=p;var m=X;p=H;var g=Y;var v=ae;var x=Z.layers[0];var b=Z.collisionBoxArray;var w=G.index;var _=G.sourceLayerIndex;var S=Z.index;var k=re;var A=[ne,ne,ne,ne];var I=oe;var M=W;var z=ie;var P=se;var C=le;var B=te;var V=G;var T=J;var E=Q;var F=ee;var D=K;var L=f.addToLineVertexArray(y,d);let e,t,r,i,n=0,a=0,s=0,o=0,l=-1,u=-1;var O={};let h=Da("");f.allowVerticalPlacement&&m.vertical&&(d=x.layout.get("text-rotate").evaluate(V,{},F)+90,$=m.vertical,r=new Bu(b,y,w,_,S,$,k,A,I,d),v&&(i=new Bu(b,y,w,_,S,v,z,P,I,d)));if(p){var $=x.layout.get("icon-rotate").evaluate(V,{}),d="none"!==x.layout.get("icon-text-fit"),R=Mu(p,$,E,d),v=v?Mu(v,$,E,d):void 0,E=(t=new Bu(b,y,w,_,S,p,z,P,!1,$),n=4*R.length,f.iconSizeData);let e=null;"source"===E.kind?(e=[jl*x.layout.get("icon-size").evaluate(V,{})])[0]>ql&&ue(`${f.layerIds[0]}: Value for "icon-size" is >= ${Rl}. Reduce your "icon-size".`):"composite"===E.kind&&((e=[jl*T.compositeIconSizes[0].evaluate(V,{},F),jl*T.compositeIconSizes[1].evaluate(V,{},F)])[0]>ql||e[1]>ql)&&ue(`${f.layerIds[0]}: Value for "icon-size" is >= ${Rl}. Reduce your "icon-size".`),f.addSymbols(f.icon,R,e,B,C,V,pe.none,y,L.lineStartIndex,L.lineLength,-1,F),l=f.icon.placedSymbolArray.length-1,v&&(a=4*v.length,f.addSymbols(f.icon,v,e,B,C,V,pe.vertical,y,L.lineStartIndex,L.lineLength,-1,F),u=f.icon.placedSymbolArray.length-1)}var j=Object.keys(m.horizontal);for(const N of j){var q=m.horizontal[N],U=(e||(h=Da(q.text),U=x.layout.get("text-rotate").evaluate(V,{},F),e=new Bu(b,y,w,_,S,q,k,A,I,U)),1===q.positionedLines.length);if(s+=qu(f,y,q,g,x,I,V,M,L,m.vertical?pe.horizontal:pe.horizontalOnly,U?j:[N],O,l,T,F),U)break}m.vertical&&(o+=qu(f,y,m.vertical,g,x,I,V,M,L,pe.vertical,["vertical"],O,u,T,F));d=e?e.boxStartIndex:f.collisionBoxArray.length,p=e?e.boxEndIndex:f.collisionBoxArray.length,z=r?r.boxStartIndex:f.collisionBoxArray.length,P=r?r.boxEndIndex:f.collisionBoxArray.length,$=t?t.boxStartIndex:f.collisionBoxArray.length,E=t?t.boxEndIndex:f.collisionBoxArray.length,R=i?i.boxStartIndex:f.collisionBoxArray.length,v=i?i.boxEndIndex:f.collisionBoxArray.length;let c=-1;B=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t,c=B(e,c),c=B(r,c),c=B(t,c),C=-1<(c=B(i,c))?1:0;C&&(c*=D/ce);f.glyphOffsetArray.length>=Wl.MAX_GLYPHS&&ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");void 0!==V.sortKey&&f.addToSortKeyRanges(f.symbolInstances.length,V.sortKey);var B=$u(x,V,F),[D,B]=function(t,e){var r=t.length,i=null==e?void 0:e.values;if(0<(null==i?void 0:i.length))for(let e=0;e<i.length;e+=2){var n=lu[i[e]],a=i[e+1];t.emplaceBack(n,a[0],a[1])}return[r,t.length]}(f.textAnchorOffsets,B);f.symbolInstances.emplaceBack(y.x,y.y,0<=O.right?O.right:-1,0<=O.center?O.center:-1,0<=O.left?O.left:-1,O.vertical||-1,l,u,h,d,p,z,P,$,E,R,v,w,s,o,n,a,C,0,k,c,D,B)}};if("line"===l)for(const f of function(t,n,a,s,o){const l=[];for(let e=0;e<t.length;e++){var u=t[e];let i;for(let r=0;r<u.length-1;r++){let e=u[r],t=u[r+1];e.x<n&&t.x<n||(e.x<n?e=new O(n,e.y+(t.y-e.y)*((n-e.x)/(t.x-e.x)))._round():t.x<n&&(t=new O(n,e.y+(t.y-e.y)*((n-e.x)/(t.x-e.x)))._round()),e.y<a&&t.y<a||(e.y<a?e=new O(e.x+(t.x-e.x)*((a-e.y)/(t.y-e.y)),a)._round():t.y<a&&(t=new O(e.x+(t.x-e.x)*((a-e.y)/(t.y-e.y)),a)._round()),e.x>=s&&t.x>=s||(e.x>=s?e=new O(s,e.y+(t.y-e.y)*((s-e.x)/(t.x-e.x)))._round():t.x>=s&&(t=new O(s,e.y+(t.y-e.y)*((s-e.x)/(t.x-e.x)))._round()),e.y>=o&&t.y>=o||(e.y>=o?e=new O(e.x+(t.x-e.x)*((o-e.y)/(t.y-e.y)),o)._round():t.y>=o&&(t=new O(e.x+(t.x-e.x)*((o-e.y)/(t.y-e.y)),o)._round()),i&&e.equals(i[i.length-1])||(i=[e],l.push(i)),i.push(t)))))}}return l}(G.geometry,0,0,he,he))for(const y of Au(f,s,o,X.vertical||i,H,24,a,Z.overscaling,he)){var c=i;c&&function(e,t,r,i){const n=e.compareText;if(t in n){var a=n[t];for(let e=a.length-1;0<=e;e--)if(i.dist(a[e])<r)return 1}else n[t]=[];return n[t].push(i),0}(Z,c.text,w,y)||h(f,y)}else if("line-center"===l)for(const m of G.geometry){var p;1<m.length&&((p=function(t,r,e,i,n,a){var s=Su(e,n,a),o=ku(e,i)*a;let l=0;var u=_u(t)/2;for(let e=0;e<t.length-1;e++){const d=t[e],f=t[e+1];var h=d.dist(f);if(l+h>u){var c=(u-l)/h,p=gt.number(d.x,f.x,c),c=gt.number(d.y,f.y,c);const y=new bu(p,c,f.angleTo(d),e);return y._round(),!s||wu(t,y,o,s,r)?y:void 0}l+=h}}(m,o,X.vertical||i,H,24,a))&&h(m,p))}else if("Polygon"===G.type)for(const g of Wt(G.geometry,0)){var d=Tu(g,16);h(g[0],new bu(d.x,d.y,0))}else if("LineString"===G.type)for(const v of G.geometry)h(v,new bu(v[0].x,v[0].y,0));else if("Point"===G.type)for(const x of G.geometry)for(const b of x)h([b],new bu(b.x,b.y,0))}(i.bucket,m,b,e,i.imageMap,s,x,c,r,t,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()}function ju(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qu(e,t,r,i,n,a,s,o,l,u,h,c,p,d,f){r=Cu(0,r,o,n,a,s,i,e.allowVerticalPlacement),i=e.textSizeData;let y=null;"source"===i.kind?(y=[jl*n.layout.get("text-size").evaluate(s,{})])[0]>ql&&ue(`${e.layerIds[0]}: Value for "text-size" is >= ${Rl}. Reduce your "text-size".`):"composite"===i.kind&&((y=[jl*d.compositeTextSizes[0].evaluate(s,{},f),jl*d.compositeTextSizes[1].evaluate(s,{},f)])[0]>ql||y[1]>ql)&&ue(`${e.layerIds[0]}: Value for "text-size" is >= ${Rl}. Reduce your "text-size".`),e.addSymbols(e.text,r,y,o,a,s,u,t,l.lineStartIndex,l.lineLength,p,f);for(const m of h)c[m]=e.text.placedSymbolArray.length-1;return 4*r.length}function Uu(e){for(const t in e)return e[t];return null}class Nu{constructor(e){const t={},r=[];for(const p in e){var i=e[p];const d=t[p]={};for(const f in i){var n,a=i[+f];a&&0!==a.bitmap.width&&0!==a.bitmap.height&&(n={x:0,y:0,w:a.bitmap.width+2,h:a.bitmap.height+2},r.push(n),d[f]={rect:n,metrics:a.metrics})}}var{w:s,h:o}=Sl(r),l=new Ds({width:s||1,height:o||1});for(const y in e){var u=e[y];for(const m in u){var h,c=u[+m];c&&0!==c.bitmap.width&&0!==c.bitmap.height&&(h=t[y][m].rect,Ds.copy(c.bitmap,l,{x:0,y:0},{x:h.x+1,y:h.y+1},c.bitmap))}}this.image=l,this.positions=t}}function Zu(e,t,r){var i=Gu(256*e,256*(t=Math.pow(2,r)-t-1),r),e=Gu(256*(e+1),256*(t+1),r);return i[0]+","+i[1]+","+e[0]+","+e[1]}function Gu(e,t,r){r=2*Math.PI*6378137/256/Math.pow(2,r);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}t("GlyphAtlas",Nu);const Xu=6371008.8;class Hu{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hu((e=(((e=this.lng)-(t=-180))%(i=(r=180)-t)+i)%i+t)===t?r:e,this.lat);var e,t,r,i}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){var t=Math.PI/180,r=this.lat*t,i=e.lat*t,r=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Xu*Math.acos(Math.min(r,1))}static convert(e){if(e instanceof Hu)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Hu(Number(e[0]),Number(e[1]));if(Array.isArray(e)||"object"!=typeof e||null===e)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new Hu(Number("lng"in e?e.lng:e.lon),Number(e.lat))}}const Yu=2*Math.PI*Xu;function Ju(e){return Yu*Math.cos(e*Math.PI/180)}function Ku(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class Wu{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){var r,e=Hu.convert(e);return new Wu((180+e.lng)/360,(r=e.lat,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360),(r=e.lat,t/Ju(r)))}toLngLat(){return new Hu(360*this.x-180,Ku(this.y))}toAltitude(){return e=this.z,t=this.y,e*Ju(Ku(t));var e,t}meterInMercatorCoordinateUnits(){return 1/Yu*(e=Ku(this.y),1/Math.cos(e*Math.PI/180));var e}}class Qu{constructor(e,t,r){if(n=t,a=r,(i=e)<0||25<i||a<0||a>=Math.pow(2,i)||n<0||n>=Math.pow(2,i))throw new Error(`x=${t}, y=${r}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);var i,n,a;this.z=e,this.x=t,this.y=r,this.key=rh(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,r){var i=Zu(this.x,this.y,this.z),n=function(t,r,i){let n="",a;for(let e=t;0<e;e--)a=1<<e-1,n+=(r&a?1:0)+(i&a?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,1<t?"@2x":"").replace(/{quadkey}/g,n).replace(/{bbox-epsg-3857}/g,i)}isChildOf(e){var t=this.z-e.z;return 0<t&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){var t=Math.pow(2,this.z);return new O((e.x*t-this.x)*he,(e.y*t-this.y)*he)}toString(){return`${this.z}/${this.x}/`+this.y}}class eh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=rh(e,t.z,t.z,t.x,t.y)}}class th{constructor(e,t,r,i,n){if(e<r)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = `+r);this.overscaledZ=e,this.wrap=t,this.canonical=new Qu(r,+i,+n),this.key=rh(t,e,r,i,n)}clone(){return new th(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = `+this.overscaledZ);var t=this.canonical.z-e;return e>this.canonical.z?new th(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new th(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = `+this.overscaledZ);var r=this.canonical.z-e;return e>this.canonical.z?rh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}isChildOf(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new th(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,t=2*this.canonical.x,r=2*this.canonical.y;return[new th(e,this.wrap,e,t,r),new th(e,this.wrap,e,1+t,r),new th(e,this.wrap,e,t,1+r),new th(e,this.wrap,e,1+t,1+r)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new th(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new th(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new eh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}getTilePoint(e){return this.canonical.getTilePoint(new Wu(e.x-this.wrap,e.y))}}function rh(e,t,r,i,n){var a=1<<r;return(a*a*(e=(e*=2)<0?-1*e-1:e)+a*n+i).toString(36)+r.toString(36)+t.toString(36)}t("CanonicalTileID",Qu),t("OverscaledTileID",th,{omit:["posMatrix"]});class ih{constructor(e){this.tileID=new th(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(A,I,M,z){return p(this,void 0,void 0,function*(){this.status="parsing",this.data=A,this.collisionBoxArray=new sa;const e=new fu(Object.keys(A.layers).sort()),t=new mu(this.tileID,this.promoteId),r=(t.bucketLayerIDs=[],{});var i={featureIndex:t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:M},n=I.familiesBySource[this.source];for(const g in n){const v=A.layers[g];if(v){1===v.version&&ue(`Vector tile source "${this.source}" layer "${g}" `+"does not use vector tile spec v2 and therefore may have some rendering errors.");var a=e.encode(g);const x=[];for(let e=0;e<v.length;e++){var s=v.feature(e),o=t.getId(s,g);x.push({feature:s,id:o,index:e,sourceLayerIndex:a})}for(const b of n[g]){const w=b[0];if(w.source!==this.source&&ue(`layer.source = ${w.source} does not equal this.source = `+this.source),!(w.minzoom&&this.zoom<Math.floor(w.minzoom))&&(!(w.maxzoom&&this.zoom>=w.maxzoom)&&"none"!==w.visibility)){nh(b,this.zoom,M);const _=r[w.id]=w.createBucket({index:t.bucketLayerIDs.length,layers:b,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:a,sourceID:this.source});_.populate(x,i,this.tileID.canonical),t.bucketLayerIDs.push(b.map(e=>e.id))}}}}var l=j(i.glyphDependencies,e=>Object.keys(e).map(Number));this.inFlightDependencies.forEach(e=>null==e?void 0:e.abort()),this.inFlightDependencies=[];let u=Promise.resolve({});Object.keys(l).length&&(c=new AbortController,this.inFlightDependencies.push(c),u=z.sendAsync({type:"GG",data:{stacks:l,source:this.source,tileID:this.tileID,type:"glyphs"}},c));l=Object.keys(i.iconDependencies);let h=Promise.resolve({});l.length&&(c=new AbortController,this.inFlightDependencies.push(c),h=z.sendAsync({type:"GI",data:{icons:l,source:this.source,tileID:this.tileID,type:"icons"}},c));var c,l=Object.keys(i.patternDependencies);let p=Promise.resolve({});l.length&&(c=new AbortController,this.inFlightDependencies.push(c),p=z.sendAsync({type:"GI",data:{icons:l,source:this.source,tileID:this.tileID,type:"patterns"}},c));var[d,f,l]=yield Promise.all([u,h,p]),y=new Nu(d),m=new Al(f,l);for(const S in r){const k=r[S];k instanceof Wl?(nh(k.layers,this.zoom,M),Ru({bucket:k,glyphMap:d,glyphPositions:y.positions,imageMap:f,imagePositions:m.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):k.hasPattern&&(k instanceof jo||k instanceof uo||k instanceof Co)&&(nh(k.layers,this.zoom,M),k.addFeatures(i,this.tileID.canonical,m.patternPositions))}return this.status="done",{buckets:Object.values(r).filter(e=>!e.isEmpty()),featureIndex:t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:y.image,imageAtlas:m,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?y.positions:null}})}}function nh(e,t,r){var i=new z(t);for(const n of e)n.recalculate(i,r)}(It=uu=uu||{}).create="create",It.load="load",It.fullLoad="fullLoad";class ah{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}}performance;class sh{constructor(e,t,r){this.actor=e,this.layerIndex=t,this.availableImages=r,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(n,e){return p(this,void 0,void 0,function*(){r=n.request,i=e;var r=yield Zi(R(r,{type:"arrayBuffer"}),i);try{return{vectorTile:new go.VectorTile(new bl(r.data)),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(e){var i=new Uint8Array(r.data),r=31===i[0]&&139===i[1];let t=`Unable to parse the tile at ${n.request.url}, `;throw t+=r?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: "+e.message,new Error(t)}})}loadTile(c){return p(this,void 0,void 0,function*(){var t=c.uid;const e=!!(c&&c.request&&c.request.collectResourceTiming)&&new ah(c.request),r=new ih(c);this.loading[t]=r;var i=new AbortController;r.abort=i;try{var n,a=yield this.loadVectorTile(c,i);if(delete this.loading[t],!a)return null;const l=a.rawData,u={},h=(a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),{});!e||(n=e.finish())&&(h.resourceTiming=JSON.parse(JSON.stringify(n))),r.vectorTile=a.vectorTile;var s=r.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[t]=r,this.fetching[t]={rawTileData:l,cacheControl:u,resourceTiming:h};try{var o=yield s;return R({rawTileData:l.slice(0)},o,u,h)}finally{delete this.fetching[t]}}catch(e){throw delete this.loading[t],r.status="done",this.loaded[t]=r,e}})}reloadTile(e){return p(this,void 0,void 0,function*(){var t=e.uid;if(!this.loaded||!this.loaded[t])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[t];if(r.showCollisionBoxes=e.showCollisionBoxes,"parsing"===r.status){var i=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor);let e;if(this.fetching[t]){const{rawTileData:n,cacheControl:a,resourceTiming:s}=this.fetching[t];delete this.fetching[t],e=R({rawTileData:n.slice(0)},i,a,s)}else e=i;return e}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(r){return p(this,void 0,void 0,function*(){const e=this.loading;var t=r.uid;e&&e[t]&&e[t].abort&&(e[t].abort.abort(),delete e[t])})}removeTile(e){return p(this,void 0,void 0,function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]})}}class oh{constructor(e,t,r,i=1,n=1,a=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&!["mapbox","terrarium","custom"].includes(r))ue(`"${r}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);else{this.stride=t.height;var o=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),r){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=n,this.blueFactor=a,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<o;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(o,e)]=this.data[this._idx(o-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,o)]=this.data[this._idx(e,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<o;t++)for(let e=0;e<o;e++){var l=this.get(t,e);l>this.max&&(this.max=l),l<this.min&&(this.min=l)}}}get(e,t){var r=new Uint8Array(this.data.buffer),e=4*this._idx(e,t);return this.unpack(r[e],r[1+e],r[2+e])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,r){return e*this.redFactor+t*this.greenFactor+r*this.blueFactor-this.baseShift}getPixels(){return new Ls({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,e,t){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,n=e*this.dim+this.dim,a=t*this.dim,s=t*this.dim+this.dim;switch(e){case-1:i=n-1;break;case 1:n=i+1}switch(t){case-1:a=s-1;break;case 1:s=a+1}var o=-e*this.dim,l=-t*this.dim;for(let t=a;t<s;t++)for(let e=i;e<n;e++)this.data[this._idx(e,t)]=r.data[this._idx(e+o,t+l)]}}t("DEMData",oh);class lh{constructor(){this.loaded={}}loadTile(u){return p(this,void 0,void 0,function*(){var{uid:e,encoding:t,rawImageData:r,redFactor:i,greenFactor:n,blueFactor:a,baseShift:s}=u,o=r.width+2,l=r.height+2,o=G(r)?new Ls({width:o,height:l},yield J(r,-1,-1,o,l)):r,l=new oh(e,o,t,i,n,a,s);return this.loaded=this.loaded||{},this.loaded[e]=l})}removeTile(e){const t=this.loaded,r=e.uid;t&&t[r]&&delete t[r]}}function uh(e,t){if(0!==e.length){hh(e[0],t);for(var r=1;r<e.length;r++)hh(e[r],!t)}}function hh(e,t){for(var r=0,i=0,n=0,a=e.length,s=a-1;n<a;s=n++){var o=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=r+o;i+=Math.abs(r)>=Math.abs(o)?r-l+o:o-l+r,r=l}0<=r+i!=!!t&&e.reverse()}var ch=P(function e(t,r){var i,n=t&&t.type;if("FeatureCollection"===n)for(i=0;i<t.features.length;i++)e(t.features[i],r);else if("GeometryCollection"===n)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],r);else if("Feature"===n)e(t.geometry,r);else if("Polygon"===n)uh(t.coordinates,r);else if("MultiPolygon"===n)for(i=0;i<t.coordinates.length;i++)uh(t.coordinates[i],r);return t});const ph=go.VectorTileFeature.prototype.toGeoJSON;let dh=class{constructor(e){this._feature=e,this.extent=he,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const t of this._feature.geometry)e.push([new O(t[0],t[1])]);return e}{const r=[];for(const i of this._feature.geometry){const n=[];for(const a of i)n.push(new O(a[0],a[1]));r.push(n)}return r}}toGeoJSON(e,t,r){return ph.call(this,e,t,r)}},fh=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=he,this.length=e.length,this._features=e}feature(e){return new dh(this._features[e])}};var At={exports:{}},yh=C,zt=go.VectorTileFeature,Mt=mh;function mh(e,t){this.options=t||{},this.features=e,this.length=e.length}function gh(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}mh.prototype.feature=function(e){return new gh(this.features[e],this.options.extent)},gh.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.length;n++)i.push(new yh(r[n][0],r[n][1]));this.geometry.push(i)}return this.geometry},gh.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,i=1/0,n=-1/0,a=0;a<e.length;a++)for(var s=e[a],o=0;o<s.length;o++)var l=s[o],t=Math.min(t,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);return[t,i,r,n]},gh.prototype.toGeoJSON=zt.prototype.toGeoJSON;At.exports;var vh=V,xh=Mt;At.exports=bh,At.exports.fromVectorTileJs=bh,At.exports.fromGeojsonVt=function(e,t){t=t||{};var r,i={};for(r in e)i[r]=new xh(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return bh({layers:i})},At.exports.GeoJSONWrapper=xh;function bh(e){var t,r=new vh,i=e,n=r;for(t in i.layers)n.writeMessage(3,wh,i.layers[t]);return r.finish()}function wh(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);for(var r={keys:[],values:[],keycache:{},valuecache:{}},i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,_h,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,Mh,a[i])}function _h(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,Sh,e),t.writeVarintField(3,r.type),t.writeMessage(4,Ih,r)}function Sh(e,t){var r,i=e.feature,n=e.keys,a=e.values,s=e.keycache,o=e.valuecache;for(r in i.properties){var l,u=i.properties[r],h=s[r];null!==u&&(void 0===h&&(n.push(r),h=n.length-1,s[r]=h),t.writeVarint(h),void 0===(l=o[h=(h=typeof u)+":"+(u="string"!=h&&"boolean"!=h&&"number"!=h?JSON.stringify(u):u)])&&(a.push(u),l=a.length-1,o[h]=l),t.writeVarint(l))}}function kh(e,t){return(t<<3)+(7&e)}function Ah(e){return e<<1^e>>31}function Ih(e,t){for(var r=e.loadGeometry(),i=e.type,n=0,a=0,s=r.length,o=0;o<s;o++){for(var l=r[o],u=1,h=(1===i&&(u=l.length),t.writeVarint(kh(1,u)),3===i?l.length-1:l.length),c=0;c<h;c++){1===c&&1!==i&&t.writeVarint(kh(2,h-1));var p=l[c].x-n,d=l[c].y-a;t.writeVarint(Ah(p)),t.writeVarint(Ah(d)),n+=p,a+=d}3===i&&t.writeVarint(15)}}function Mh(e,t){var r=typeof e;"string"==r?t.writeStringField(1,e):"boolean"==r?t.writeBooleanField(7,e):"number"==r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}var zh,Ph=P(At.exports);const Ch=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Bh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");t=r>>4;if(1!=t)throw new Error(`Got v${t} data when expected v1.`);t=Ch[15&r];if(!t)throw new Error("Unrecognized array type.");var[r]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Bh(i,r,t,e)}constructor(e,t=64,r=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var n=Ch.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+s+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,i,n,a,s){if(a-n<=i)return;const o=n+a>>1;Vh(t,r,o,n,a,s);e(t,r,i,n,o-1,1-s);e(t,r,i,1+o,a,1-s)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");var{ids:a,coords:s,nodeSize:e}=this;const o=[0,a.length-1,0],l=[];for(;o.length;){var u=o.pop()||0,h=o.pop()||0,c=o.pop()||0;if(h-c<=e)for(let e=c;e<=h;e++){var p=s[2*e],d=s[2*e+1];t<=p&&p<=i&&r<=d&&d<=n&&l.push(a[e])}else{var f=c+h>>1,y=s[2*f],m=s[2*f+1];t<=y&&y<=i&&r<=m&&m<=n&&l.push(a[f]),(0===u?t<=y:r<=m)&&(o.push(c),o.push(f-1),o.push(1-u)),(0===u?y<=i:m<=n)&&(o.push(1+f),o.push(h),o.push(1-u))}}return l}within(t,r,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");var{ids:i,coords:n,nodeSize:a}=this;const s=[0,i.length-1,0],o=[];for(var l=e*e;s.length;){var u=s.pop()||0,h=s.pop()||0,c=s.pop()||0;if(h-c<=a)for(let e=c;e<=h;e++)Fh(n[2*e],n[2*e+1],t,r)<=l&&o.push(i[e]);else{var p=c+h>>1,d=n[2*p],f=n[2*p+1];Fh(d,f,t,r)<=l&&o.push(i[p]),(0===u?t-e<=d:r-e<=f)&&(s.push(c),s.push(p-1),s.push(1-u)),(0===u?d<=t+e:f<=r+e)&&(s.push(1+p),s.push(h),s.push(1-u))}}return o}}function Vh(r,i,n,a,s,o){for(;a<s;){600<s-a&&(l=s-a+1,u=n-a+1,c=Math.log(l),h=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1),Vh(r,i,n,Math.max(a,Math.floor(n-u*h/l+c)),Math.min(s,Math.floor(n+(l-u)*h/l+c)),o));var l,u,h,c,p=i[2*n+o];let e=a,t=s;for(Th(r,i,a,n),i[2*s+o]>p&&Th(r,i,a,s);e<t;){for(Th(r,i,e,t),e++,t--;i[2*e+o]<p;)e++;for(;i[2*t+o]>p;)t--}i[2*a+o]===p?Th(r,i,a,t):Th(r,i,++t,s),t<=n&&(a=t+1),n<=t&&(s=t-1)}}function Th(e,t,r,i){Eh(e,r,i),Eh(t,2*r,2*i),Eh(t,2*r+1,2*i+1)}function Eh(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function Fh(e,t,r,i){e-=r,r=t-i;return e*e+r*r}const Dh={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},Lh=Math.fround||(zh=new Float32Array(1),e=>(zh[0]=+e,zh[0])),Oh=3,$h=5,Rh=6;class jh{constructor(e){this.options=Object.assign(Object.create(Dh),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){var{log:r,minZoom:i,maxZoom:n}=this.options,e=(r&&console.time("total time"),`prepare ${t.length} points`);r&&console.time(e),this.points=t;const a=[];for(let e=0;e<t.length;e++){var s,o=t[e];o.geometry&&([o,s]=o.geometry.coordinates,o=Lh(Nh(o)),s=Lh(Zh(s)),a.push(o,s,1/0,e,-1,1),this.options.reduce&&a.push(0))}let l=this.trees[n+1]=this._createTree(a);r&&console.timeEnd(e);for(let e=n;e>=i;e--){var u=+Date.now();l=this.trees[e]=this._createTree(this._cluster(l,e)),r&&console.log("z%d: %d clusters in %dms",e,l.numItems,+Date.now()-u)}return r&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;var i=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;var a=Math.max(-90,Math.min(90,e[3]));if(360<=e[2]-e[0])r=-180,n=180;else if(r>n){const h=this.getClusters([r,i,180,a],t);e=this.getClusters([-180,i,n,a],t);return h.concat(e)}const s=this.trees[this._limitZoom(t)];var e=s.range(Nh(r),Zh(a),Nh(n),Zh(i)),o=s.data;const l=[];for(const c of e){var u=this.stride*c;l.push(1<o[u+$h]?qh(o,u,this.clusterProps):this.points[o[u+Oh]])}return l}getChildren(e){var t=this._getOriginId(e),r=this._getOriginZoom(e),i="No cluster with the specified id.";const n=this.trees[r];if(!n)throw new Error(i);var a=n.data;if(t*this.stride>=a.length)throw new Error(i);var r=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=a[t*this.stride],t=a[t*this.stride+1];const o=[];for(const u of n.within(s,t,r)){var l=u*this.stride;a[4+l]===e&&o.push(1<a[l+$h]?qh(a,l,this.clusterProps):this.points[a[l+Oh]])}if(0===o.length)throw new Error(i);return o}getLeaves(e,t,r){var i=[];return this._appendLeaves(i,e,t=t||10,r=r||0,0),i}getTile(e,t,r){const i=this.trees[this._limitZoom(e)];var e=Math.pow(2,e),{extent:n,radius:a}=this.options,a=a/n,n=(r-a)/e,s=(r+1+a)/e,o={features:[]};return this._addTileFeatures(i.range((t-a)/e,n,(t+1+a)/e,s),i.data,t,r,e,o),0===t&&this._addTileFeatures(i.range(1-a/e,n,1,s),i.data,e,r,e,o),t===e-1&&this._addTileFeatures(i.range(0,n,a/e,s),i.data,-1,r,e,o),o.features.length?o:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,i,n){for(const s of this.getChildren(t)){var a=s.properties;if(a&&a.cluster?n+a.point_count<=i?n+=a.point_count:n=this._appendLeaves(e,a.cluster_id,r,i,n):n<i?n++:e.push(s),e.length===r)break}return n}_createTree(t){const r=new Bh(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,n,a,s,o,l){for(const d of e){var u,h,c=d*this.stride,p=1<n[c+$h];let e,t,r;r=p?(e=Uh(n,c,this.clusterProps),t=n[c],n[1+c]):(u=this.points[n[c+Oh]],[u,h]=(e=u.properties,u.geometry.coordinates),t=Nh(u),Zh(h));const f={type:1,geometry:[[Math.round(this.options.extent*(t*o-a)),Math.round(this.options.extent*(r*o-s))]],tags:e};let i;void 0!==(i=p||this.options.generateId?n[c+Oh]:this.points[n[c+Oh]].id)&&(f.id=i),l.features.push(f)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,s){const{radius:t,extent:r,reduce:o,minPoints:i}=this.options;var l=t/(r*Math.pow(2,s));const u=e.data,h=[];var c=this.stride;for(let a=0;a<u.length;a+=c)if(!(u[a+2]<=s)){u[a+2]=s;var p=u[a],d=u[a+1],f=e.within(u[a],u[a+1],l),y=u[a+$h];let n=y;for(const w of f){var m=w*c;u[2+m]>s&&(n+=u[m+$h])}if(n>y&&n>=i){let e=p*y,t=d*y,r,i=-1;var g=((a/c|0)<<5)+(s+1)+this.points.length;for(const _ of f){var v,x=_*c;u[2+x]<=s||(u[2+x]=s,v=u[x+$h],e+=u[x]*v,t+=u[1+x]*v,u[4+x]=g,o&&(r||(r=this._map(u,a,!0),i=this.clusterProps.length,this.clusterProps.push(r)),o(r,this._map(u,x))))}u[a+4]=g,h.push(e/n,t/n,1/0,g,-1,n),o&&h.push(i)}else{for(let e=0;e<c;e++)h.push(u[a+e]);if(1<n)for(const S of f){var b=S*c;if(!(u[2+b]<=s)){u[2+b]=s;for(let e=0;e<c;e++)h.push(u[b+e])}}}}return h}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(1<e[t+$h])return i=this.clusterProps[e[t+Rh]],r?Object.assign({},i):i;var i=this.points[e[t+Oh]].properties,e=this.options.map(i);return r&&e===i?Object.assign({},e):e}}function qh(e,t,r){return{type:"Feature",id:e[t+Oh],properties:Uh(e,t,r),geometry:{type:"Point",coordinates:[360*(e[t]-.5),function(e){e=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(e[t+1])]}}}function Uh(e,t,r){var i=e[t+$h],n=1e4<=i?Math.round(i/1e3)+"k":1e3<=i?Math.round(i/100)/10+"k":i,a=e[t+Rh],r=-1===a?{}:Object.assign({},r[a]);return Object.assign(r,{cluster:!0,cluster_id:e[t+Oh],point_count:i,point_count_abbreviated:n})}function Nh(e){return e/360+.5}function Zh(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function Gh(t,r,i,e){let n=e;var a=r+(i-r>>1);let s=i-r,o;var l=t[r],u=t[r+1],h=t[i],c=t[i+1];for(let e=r+3;e<i;e+=3){var p=function(e,t,r,i,n,a){let s=n-r,o=a-i;{var l;0===s&&0===o||(1<(l=((e-r)*s+(t-i)*o)/(s*s+o*o))?(r=n,i=a):0<l&&(r+=s*l,i+=o*l))}return s=e-r,o=t-i,s*s+o*o}(t[e],t[e+1],l,u,h,c);p>n?(o=e,n=p):p===n&&(p=Math.abs(e-a))<s&&(o=e,s=p)}n>e&&(3<o-r&&Gh(t,r,o,e),t[o+2]=n,3<i-o&&Gh(t,o,i,e))}function Xh(e,t,r,i){var n={id:null==e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)Hh(n,r);else if("Polygon"===t)Hh(n,r[0]);else if("MultiLineString"===t)for(const a of r)Hh(n,a);else if("MultiPolygon"===t)for(const s of r)Hh(n,s[0]);return n}function Hh(t,r){for(let e=0;e<r.length;e+=3)t.minX=Math.min(t.minX,r[e]),t.minY=Math.min(t.minY,r[e+1]),t.maxX=Math.max(t.maxX,r[e]),t.maxY=Math.max(t.maxY,r[e+1])}function Yh(r,i,n,a){if(i.geometry){var s=i.geometry.coordinates;if(!s||0!==s.length){var o=i.geometry.type,l=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let e=[],t=i.id;if(n.promoteId?t=i.properties[n.promoteId]:n.generateId&&(t=a||0),"Point"===o)Jh(s,e);else if("MultiPoint"===o)for(const h of s)Jh(h,e);else if("LineString"===o)Kh(s,e,l,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(const c of s)e=[],Kh(c,e,l,!1),r.push(Xh(t,"LineString",e,i.properties));return}Wh(s,e,l,!1)}else if("Polygon"===o)Wh(s,e,l,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(const p of i.geometry.geometries)Yh(r,{id:t,geometry:p,properties:i.properties},n,a);return}for(const d of s){var u=[];Wh(d,u,l,!0),e.push(u)}}r.push(Xh(t,o,e,i.properties))}}}function Jh(e,t){t.push(Qh(e[0]),ec(e[1]),0)}function Kh(t,r,e,i){let n,a,s=0;for(let e=0;e<t.length;e++){var o=Qh(t[e][0]),l=ec(t[e][1]);r.push(o,l,0),0<e&&(s+=i?(n*l-o*a)/2:Math.sqrt(Math.pow(o-n,2)+Math.pow(l-a,2))),n=o,a=l}var u=r.length-3;r[2]=1,Gh(r,0,u,e),r[2+u]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function Wh(t,r,i,n){for(let e=0;e<t.length;e++){var a=[];Kh(t[e],a,i,n),r.push(a)}}function Qh(e){return e/360+.5}function ec(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function tc(e,t,r,i,n,a,s,o){if(i/=t,(r/=t)<=a&&s<i)return e;if(s<r||i<=a)return null;const l=[];for(const x of e){var u=x.geometry;let t=x.type;var h=0===n?x.minX:x.minY,c=0===n?x.maxX:x.maxY;if(r<=h&&c<i)l.push(x);else if(!(c<r||i<=h)){let e=[];if("Point"===t||"MultiPoint"===t){g=m=y=f=d=p=void 0;var p=u,d=e,f=r,y=i,m=n;for(let e=0;e<p.length;e+=3){var g=p[e+m];f<=g&&g<=y&&ac(d,p[e],p[e+1],p[e+2])}}else if("LineString"===t)rc(u,e,r,i,n,!1,o.lineMetrics);else if("MultiLineString"===t)nc(u,e,r,i,n,!1);else if("Polygon"===t)nc(u,e,r,i,n,!0);else if("MultiPolygon"===t)for(const b of u){var v=[];nc(b,v,r,i,n,!0),v.length&&e.push(v)}if(e.length)if(o.lineMetrics&&"LineString"===t)for(const w of e)l.push(Xh(x.id,t,w,x.tags));else"LineString"!==t&&"MultiLineString"!==t||(1===e.length?(t="LineString",e=e[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===e.length?"Point":"MultiPoint"),l.push(Xh(x.id,t,e,x.tags))}}return l.length?l:null}function rc(r,i,n,a,s,o,l){let u=ic(r);const h=0===s?sc:oc;let c=r.start,p,d;for(let t=0;t<r.length-3;t+=3){const g=r[t],v=r[t+1],x=r[t+2];var f=r[t+3],y=r[t+4];const b=0===s?g:v;var m=0===s?f:y;let e=!1;l&&(p=Math.sqrt(Math.pow(g-f,2)+Math.pow(v-y,2))),b<n?n<m&&(d=h(u,g,v,f,y,n),l&&(u.start=c+p*d)):b>a?m<a&&(d=h(u,g,v,f,y,a),l&&(u.start=c+p*d)):ac(u,g,v,x),m<n&&b>=n&&(d=h(u,g,v,f,y,n),e=!0),a<m&&b<=a&&(d=h(u,g,v,f,y,a),e=!0),!o&&e&&(l&&(u.end=c+p*d),i.push(u),u=ic(r)),l&&(c+=p)}var e=r.length-3;const g=r[e],v=r[1+e],x=r[2+e],b=0===s?g:v;b>=n&&b<=a&&ac(u,g,v,x),e=u.length-3,o&&3<=e&&(u[e]!==u[0]||u[1+e]!==u[1])&&ac(u,u[0],u[1],u[2]),u.length&&i.push(u)}function ic(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function nc(e,t,r,i,n,a){for(const s of e)rc(s,t,r,i,n,a,!1)}function ac(e,t,r,i){e.push(t,r,i)}function sc(e,t,r,i,n,a){i=(a-t)/(i-t);return ac(e,a,r+(n-r)*i,1),i}function oc(e,t,r,i,n,a){n=(a-r)/(n-r);return ac(e,t+(i-t)*n,a,1),n}function lc(r,i){const n=[];for(let t=0;t<r.length;t++){var a=r[t],s=a.type;let e;if("Point"===s||"MultiPoint"===s||"LineString"===s)e=uc(a.geometry,i);else if("MultiLineString"===s||"Polygon"===s){e=[];for(const o of a.geometry)e.push(uc(o,i))}else if("MultiPolygon"===s){e=[];for(const l of a.geometry){const u=[];for(const h of l)u.push(uc(h,i));e.push(u)}}n.push(Xh(a.id,s,e,a.tags))}return n}function uc(t,r){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let e=0;e<t.length;e+=3)i.push(t[e]+r,t[e+1],t[e+2]);return i}function hc(e,r){if(e.transformed)return e;var i=1<<e.z,n=e.x,a=e.y;for(const o of e.features){var s=o.geometry,t=o.type;if(o.geometry=[],1===t)for(let e=0;e<s.length;e+=2)o.geometry.push(cc(s[e],s[e+1],r,i,n,a));else for(let t=0;t<s.length;t++){const l=[];for(let e=0;e<s[t].length;e+=2)l.push(cc(s[t][e],s[t][e+1],r,i,n,a));o.geometry.push(l)}}return e.transformed=!0,e}function cc(e,t,r,i,n,a){return[Math.round(r*(e*i-n)),Math.round(r*(t*i-a))]}function pc(e,t,r,i,n){var a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const p of e){o=void 0;l=void 0;u=void 0;h=void 0;c=void 0;var o=s;var l=p;var u=a;var h=n;const d=l.geometry,f=l.type,y=[];if(o.minX=Math.min(o.minX,l.minX),o.minY=Math.min(o.minY,l.minY),o.maxX=Math.max(o.maxX,l.maxX),o.maxY=Math.max(o.maxY,l.maxY),"Point"===f||"MultiPoint"===f)for(let e=0;e<d.length;e+=3)y.push(d[e],d[e+1]),o.numPoints++,o.numSimplified++;else if("LineString"===f)dc(y,d,o,u,!1,!1);else if("MultiLineString"===f||"Polygon"===f)for(let e=0;e<d.length;e++)dc(y,d[e],o,u,"Polygon"===f,0===e);else if("MultiPolygon"===f)for(let e=0;e<d.length;e++){var c=d[e];for(let e=0;e<c.length;e++)dc(y,c[e],o,u,!0,0===e)}if(y.length){let e=l.tags||null;if("LineString"===f&&h.lineMetrics){e={};for(const g in l.tags)e[g]=l.tags[g];e.mapbox_clip_start=d.start/d.size,e.mapbox_clip_end=d.end/d.size}const m={geometry:y,type:"Polygon"===f||"MultiPolygon"===f?3:"LineString"===f||"MultiLineString"===f?2:1,tags:e};null!==l.id&&(m.id=l.id),o.features.push(m)}}return s}function dc(e,t,r,i,n,a){var s=i*i;if(0<i&&t.size<(n?s:i))r.numPoints+=t.length/3;else{const h=[];for(let e=0;e<t.length;e+=3)(0===i||t[e+2]>s)&&(r.numSimplified++,h.push(t[e],t[e+1])),r.numPoints++;if(n){var o=h,n=a;let i=0;for(let e=0,t=o.length,r=t-2;e<t;r=e,e+=2)i+=(o[e]-o[r])*(o[e+1]+o[r+1]);if(0<i===n)for(let e=0,t=o.length;e<t/2;e+=2){var l=o[e],u=o[e+1];o[e]=o[t-2-e],o[e+1]=o[t-1-e],o[t-2-e]=l,o[t-1-e]=u}}e.push(h)}}const fc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class yc{constructor(e,t){var r=(t=this.options=function(e,t){for(const r in t)e[r]=t[r];return e}(Object.create(fc),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");e=function(t,r){var i=[];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;e++)Yh(i,t.features[e],r,e);else"Feature"===t.type?Yh(i,t,r):Yh(i,{geometry:t},r);return i}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(e=function(e,t){var r=t.buffer/t.extent;let i=e;var n=tc(e,1,-1-r,r,0,-1,2,t),a=tc(e,1,1-r,2+r,0,-1,2,t);return(n||a)&&(i=tc(e,1,-r,1+r,0,-1,2,t)||[],n&&(i=lc(n,1).concat(i)),a&&(i=i.concat(lc(a,-1)))),i}(e,t)).length&&this.splitTile(e,0,0,0),r&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(a,s,o,l,e,t,r){const u=[a,s,o,l];for(var h=this.options,c=h.debug;u.length;){l=u.pop(),o=u.pop(),s=u.pop(),a=u.pop();var p=1<<s,d=mc(s,o,l);let n=this.tiles[d];if(n||(1<c&&console.time("creation"),n=this.tiles[d]=pc(a,s,o,l,h),this.tileCoords.push({z:s,x:o,y:l}),c&&(1<c&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",s,o,l,n.numFeatures,n.numPoints,n.numSimplified),console.timeEnd("creation")),this.stats[d="z"+s]=(this.stats[d]||0)+1,this.total++)),n.source=a,null==e){if(s===h.indexMaxZoom||n.numPoints<=h.indexMaxPoints)continue}else{if(s===h.maxZoom||s===e)continue;if(null!=e){d=e-s;if(o!==t>>d||l!==r>>d)continue}}if(n.source=null,0!==a.length){1<c&&console.time("clipping");var d=.5*h.buffer/h.extent,f=.5-d,y=.5+d,m=1+d;let e=null,t=null,r=null,i=null;var g=tc(a,p,o-d,o+y,0,n.minX,n.maxX,h),v=tc(a,p,o+f,o+m,0,n.minX,n.maxX,h);a=null,g&&(e=tc(g,p,l-d,l+y,1,n.minY,n.maxY,h),t=tc(g,p,l+f,l+m,1,n.minY,n.maxY,h),0),v&&(r=tc(v,p,l-d,l+y,1,n.minY,n.maxY,h),i=tc(v,p,l+f,l+m,1,n.minY,n.maxY,h),0),1<c&&console.timeEnd("clipping"),u.push(e||[],s+1,2*o,2*l),u.push(t||[],s+1,2*o,2*l+1),u.push(r||[],s+1,2*o+1,2*l),u.push(i||[],s+1,2*o+1,2*l+1)}}}getTile(e,t,r){var{extent:i,debug:n}=this.options;if((e=+e)<0||24<e)return null;var a=1<<e,a=mc(e,t=(t=+t)+a&a-1,r=+r);if(this.tiles[a])return hc(this.tiles[a],i);1<n&&console.log("drilling down to z%d-%d-%d",e,t,r);let s=e,o=t,l=r,u;for(;!u&&0<s;)s--,o>>=1,l>>=1,u=this.tiles[mc(s,o,l)];return u&&u.source?(1<n&&(console.log("found parent tile z%d-%d-%d",s,o,l),console.time("drilling down")),this.splitTile(u.source,s,o,l,e,t,r),1<n&&console.timeEnd("drilling down"),this.tiles[a]?hc(this.tiles[a],i):null):null}}function mc(e,t,r){return 32*((1<<e)*r+t)+e}function gc(e,t){return t?e.properties[t]:e.id}function vc(e,t){if(null==e)return 1;if("Feature"===e.type)return null!=gc(e,t);if("FeatureCollection"===e.type){const i=new Set;for(const n of e.features){var r=gc(n,t);if(null==r)return;if(i.has(r))return;i.add(r)}return 1}}function xc(e,t){const r=new Map;if(null!=e)if("Feature"===e.type)r.set(gc(e,t),e);else for(const i of e.features)r.set(gc(i,t),i);return r}class bc extends sh{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(r,e){return p(this,void 0,void 0,function*(){var e=r.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");e=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!e)return null;e=new fh(e.features);let t=Ph(e);return{vectorTile:e,rawData:(t=0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t:new Uint8Array(t)).buffer}})}loadData(s){return p(this,void 0,void 0,function*(){var e,t,r,i;null!=(e=this._pendingRequest)&&e.abort();const n=!!(s&&s.request&&s.request.collectResourceTiming)&&new ah(s.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(s,this._pendingRequest),this._geoJSONIndex=s.cluster?new jh(function({superclusterOptions:e,clusterProperties:t}){if(!t||!e)return e;const i={},n={},a={accumulated:null,zoom:0},s={properties:null},o=Object.keys(t);for(const u of o){var[r,l]=t[u],l=Xr(l),r=Xr("string"==typeof r?[r,["accumulated"],["get",u]]:r);i[u]=l.value,n[u]=r.value}return e.map=e=>{s.properties=e;const t={};for(const r of o)t[r]=i[r].evaluate(a,s);return t},e.reduce=(e,t)=>{s.properties=t;for(const r of o)a.accumulated=e[r],e[r]=n[r].evaluate(a,s)},e}(s)).load((yield this._pendingData).features):(r=yield this._pendingData,i=s.geojsonVtOptions,new yc(r,i)),this.loaded={};const a={};return n&&(t=n.finish())&&(a.resourceTiming={},a.resourceTiming[s.source]=JSON.parse(JSON.stringify(t))),a}catch(e){if(delete this._pendingRequest,e.message===Di)return{abandoned:!0};throw e}})}getData(){return p(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(e){var t=this.loaded,r=e.uid;return t&&t[r]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(i,n){return p(this,void 0,void 0,function*(){let e=yield this.loadGeoJSON(i,n);if(delete this._pendingRequest,"object"!=typeof e)throw new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`);if(ch(e,!0),i.filter){const r=Xr(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map(e=>e.key+": "+e.message).join(", "));var t=e.features.filter(e=>r.value.evaluate({zoom:0},e));e={type:"FeatureCollection",features:t}}return e})}loadGeoJSON(y,m){return p(this,void 0,void 0,function*(){var e,t=y["promoteId"];if(y.request)return e=y.request,n=m,e=yield Zi(R(e,{type:"json"}),n),this._dataUpdateable=vc(e.data,t)?xc(e.data,t):void 0,e.data;if("string"==typeof y.data)try{var r=JSON.parse(y.data);return this._dataUpdateable=vc(r,t)?xc(r,t):void 0,r}catch(e){throw new Error(`Input data given to '${y.source}' is not a valid GeoJSON object.`)}if(!y.dataDiff)throw new Error(`Input data given to '${y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error("Cannot update existing geojson data in "+y.source);var i=this._dataUpdateable,n=y.dataDiff,a=t;if(n.removeAll&&i.clear(),n.remove)for(const c of n.remove)i.delete(c);if(n.add)for(const p of n.add){var s=gc(p,a);null!=s&&i.set(s,p)}if(n.update)for(const d of n.update){let e=i.get(d.id);if(null!=e){var o=d.newGeometry||d.removeAllProperties,l=!d.removeAllProperties&&(0<(null==(l=d.removeProperties)?void 0:l.length)||0<(null==(l=d.addOrUpdateProperties)?void 0:l.length));if((o||l)&&(e=Object.assign({},e),i.set(d.id,e),l&&(e.properties=Object.assign({},e.properties))),d.newGeometry&&(e.geometry=d.newGeometry),d.removeAllProperties)e.properties={};else if(0<(null==(o=d.removeProperties)?void 0:o.length))for(const f of d.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,f)&&delete e.properties[f];if(0<(null==(o=d.addOrUpdateProperties)?void 0:o.length))for(var{key:u,value:h}of d.addOrUpdateProperties)e.properties[u]=h}}return{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(e){return p(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class wc{constructor(e){this.self=e,this.actor=new Qi(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=$i,this.self.removeProtocol=Ri,this.self.registerRTLTextPlugin=e=>{if(ne.isParsed())throw new Error("RTL text plugin already registered.");ne.setMethods(e)},this.actor.registerMessageHandler("LDT",(e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t)),this.actor.registerMessageHandler("RDT",(e,t)=>p(this,void 0,void 0,function*(){this._getDEMWorkerSource(e,t.source).removeTile(t)})),this.actor.registerMessageHandler("GCEZ",(e,t)=>p(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterExpansionZoom(t)})),this.actor.registerMessageHandler("GCC",(e,t)=>p(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterChildren(t)})),this.actor.registerMessageHandler("GCL",(e,t)=>p(this,void 0,void 0,function*(){return this._getWorkerSource(e,t.type,t.source).getClusterLeaves(t)})),this.actor.registerMessageHandler("LD",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t)),this.actor.registerMessageHandler("GD",(e,t)=>this._getWorkerSource(e,t.type,t.source).getData()),this.actor.registerMessageHandler("LT",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t)),this.actor.registerMessageHandler("RT",(e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t)),this.actor.registerMessageHandler("AT",(e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t)),this.actor.registerMessageHandler("RMT",(e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t)),this.actor.registerMessageHandler("RS",(t,r)=>p(this,void 0,void 0,function*(){if(this.workerSources[t]&&this.workerSources[t][r.type]&&this.workerSources[t][r.type][r.source]){const e=this.workerSources[t][r.type][r.source];delete this.workerSources[t][r.type][r.source],void 0!==e.removeSource&&e.removeSource(r)}})),this.actor.registerMessageHandler("RM",e=>p(this,void 0,void 0,function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})),this.actor.registerMessageHandler("SR",(e,t)=>p(this,void 0,void 0,function*(){this.referrer=t})),this.actor.registerMessageHandler("SRPS",(e,t)=>this._syncRTLPluginState(e,t)),this.actor.registerMessageHandler("IS",(e,t)=>p(this,void 0,void 0,function*(){this.self.importScripts(t)})),this.actor.registerMessageHandler("SI",(e,t)=>this._setImages(e,t)),this.actor.registerMessageHandler("UL",(e,t)=>p(this,void 0,void 0,function*(){this._getLayerIndex(e).update(t.layers,t.removedIds)})),this.actor.registerMessageHandler("SL",(e,t)=>p(this,void 0,void 0,function*(){this._getLayerIndex(e).replace(t)}))}_setImages(i,n){return p(this,void 0,void 0,function*(){this.availableImages[i]=n;for(const e in this.workerSources[i]){const t=this.workerSources[i][e];for(const r in t)t[r].availableImages=n}})}_syncRTLPluginState(e,r){return p(this,void 0,void 0,function*(){if(ne.isParsed())return ne.getState();if("loading"!==r.pluginStatus)return ne.setState(r),r;var e=r.pluginURL,t=(this.self.importScripts(e),ne.isParsed());if(t)return t={pluginStatus:"loaded",pluginURL:e},ne.setState(t),t;throw ne.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from "+e)})}_getAvailableImages(e){let t=this.availableImages[e];return t=t||[]}_getLayerIndex(e){let t=this.layerIndexes[e];return t=t||(this.layerIndexes[e]=new du)}_getWorkerSource(r,e,t){if(this.workerSources[r]||(this.workerSources[r]={}),this.workerSources[r][e]||(this.workerSources[r][e]={}),!this.workerSources[r][e][t]){var i={sendAsync:(e,t)=>(e.targetMapId=r,this.actor.sendAsync(e,t))};switch(e){case"vector":this.workerSources[r][e][t]=new sh(i,this._getLayerIndex(r),this._getAvailableImages(r));break;case"geojson":this.workerSources[r][e][t]=new bc(i,this._getLayerIndex(r),this._getAvailableImages(r));break;default:this.workerSources[r][e][t]=new this.externalWorkerSourceTypes[e](i,this._getLayerIndex(r),this._getAvailableImages(r))}}return this.workerSources[r][e][t]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new lh),this.demWorkerSources[e][t]}}return Z(self)&&(self.worker=new wc(self)),wc}();